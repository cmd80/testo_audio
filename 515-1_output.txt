Ce et ee) (| ee) en) |) i) i) i i) ee

ICS515 | ICS VISIBILITY, DETECTION, AND RESPONSE
GIAC Response and Industrial Defense (GRID)

515.1

ICS Cyber Threat Intelligence

GIAC

CERTIFICATIONS

NANS

THE MOST TRUSTED SOURCE FOR INFORMATION SECURITY TRAINING, CERTIFICATION, AND RESEARCH | sans.org

© 2021 Robert M. Lee. Alll rights reserved to Robert M. Lee and/or SANS Institute.

PLEASE READ THE TERMS AND CONDITIONS OF THIS COURSEWARE LICENSE AGREEMENT
("CLA") CAREFULLY BEFORE USING ANY OF THE COURSEWARE ASSOCIATED WITH THE SANS
COURSE. THIS IS A LEGAL AND ENFORCEABLE CONTRACT BETWEEN YOU (THE “USER”) AND
SANS INSTITUTE FOR THE COURSEWARE. YOU AGREE THAT THIS AGREEMENT IS
ENFORCEABLE LIKE ANY WRITTEN NEGOTIATED AGREEMENT SIGNED BY YOU.

With this CLA, SANS Institute hereby grants User a personal, non-exclusive license to use the Courseware
subject to the terms of this agreement. Courseware includes all printed materials, including course books
and lab workbooks, as well as any digital or other media, virtual machines, and/or data sets distributed by
SANS Institute to User for use in the SANS class associated with the Courseware. User agrees that the
CLA is the complete and exclusive statement of agreement between SANS Institute and you and that this
CLA supersedes any oral or written proposal, agreement or other communication relating to the subject
matter of this CLA.

BY ACCEPTING THIS COURSEWARE, USER AGREES TO BE BOUND BY THE TERMS OF THIS CLA.
BY ACCEPTING THIS SOFTWARE, USER AGREES THAT ANY BREACH OF THE TERMS OF THIS CLA
MAY CAUSE IRREPARABLE HARM AND SIGNIFICANT INJURY TO SANS INSTITUTE, AND THAT
SANS INSTITUTE MAY ENFORCE THESE PROVISIONS BY INJUNCTION (WITHOUT THE
NECESSITY OF POSTING BOND) SPECIFIC PERFORMANCE, OR OTHER EQUITABLE RELIEF.

If User does not agree, User may return the Courseware to SANS Institute for a full refund, if applicable.

User may not copy, reproduce, re-publish, distribute, display, modify or create derivative works based upon
all or any portion of the Courseware, in any medium whether printed, electronic or otherwise, for any
purpose, without the express prior written consent of SANS Institute. Additionally, User may not sell, rent,
lease, trade, or otherwise transfer the Courseware in any way, shape, or form without the express written
consent of SANS Institute.

If any provision of this CLA is declared unenforceable in any jurisdiction, then such provision shall be
deemed to be severable from this CLA and shall not affect the remainder thereof. An amendment or
addendum to this CLA may accompany this Courseware.

SANS acknowledges that any and all software and/or tools, graphics, images, tables, charts or graphs
presented in this Courseware are the sole property of their respective trademark/registered/copyright
owners, including:

AirDrop, AirPort, AirPort Time Capsule, Apple, Apple Remote Desktop, Apple TV, App Nap, Back to My
Mac, Boot Camp, Cocoa, FaceTime, FileVault, Finder, FireWire, FireWire logo, iCal, iChat, iLife, iMac,
iMessage, iPad, iPad Air, iPad Mini, iPhone, iPhoto, iPod, iPod classic, iPod shuffle, iPod nano, iPod touch,
iTunes, iTunes logo, iWork, Keychain, Keynote, Mac, Mac Logo, MacBook, MacBook Air, MacBook Pro,
Macintosh, Mac OS, Mac Pro, Numbers, OS X, Pages, Passbook, Retina, Safari, Siri, Spaces, Spotlight,
There’s an app for that, Time Capsule, Time Machine, Touch ID, Xcode, Xserve, App Store, and iCloud are
registered trademarks of Apple Inc.

PMP® and PMBOK@® are registered trademarks of PMI.

SOF-ELK@ is a registered trademark of Lewes Technology Consulting, LLC. Used with permission.

SIFT® is a registered trademark of Harbingers, LLC. Used with permission.

Governing Law: This Agreement shall be governed by the laws of the State of Maryland, USA.

ICS515_1_G01_07

b
b
“W

www ap «ap

ICS Visibility, Detection, and Response

SANS ICS Cyber Threat

_ Intelligence

Lab 0: Prior to class, please complete Lab 0

© 2021 Robert M. Lee | All Rights Reserved | GO1_07

The SANS ICS515 —ICS Visibility, Detection, and Response course was developed by Robert M. Lee with input
from a collection of experts, whose diverse work experiences, knowledge, and skills truly blended to cover the
specific content areas for this course. The author would like to thank them for their support and contributions. Please
see the following page.

Robert M. Lee

Robert M. Lee is the CEO and Founder of the industrial (ICS/OT/IIoT) cyber security company Dragos, Inc. He is a
SANS Senior Instructor and the course author of SANS ICS515 — “ICS Visibility, Detection, and Response” and the
lead-author of SANS FORS78 — “Cyber Threat Intelligence.” He is currently also a Department of Energy special
service employee on the Electricity Advisory Committee as the Vice Chair of the Grid Resilience National Security
Committee.

Robert obtained his start in cyber security in the U.S. Air Force where he served as a Cyber Warfare Operations
Officer in the National Security Agency. He has performed defense, intelligence, and attack missions in various
government organizations, including the establishment of a first-of-its-kind ICS/SCADA threat discovery mission
blending incident response, threat hunting, and threat intelligence together. Lastly, Robert is author of the book
SCADA and Me, Threat Intelligence and Me, Santa and Me, and the weekly webcomic

http://www. LittleBobbyComic.com

Robert may be found on Twitter @RobertMLee or contacted via email at: RLee@Dragos.com

© 2021 Robert M. Lee 1
Contributions By:

Tim Conway
Tim Conway is currently the Curriculum Lead for ICS Security at SANS. He was responsible for developing,

reviewing, and implementing technical components of the SANS ICS and SCADA product offerings and is the
course author of ICS456 — NERC CIP Essentials. He was formerly the director of CIP Compliance and
Operations Technology at Northern Indiana Public Service Company (NIPSCO). He was responsible for
Operations Technology, NERC CIP Compliance, and the NERC training environments for the operations
departments within NIPSCO Electric. Tim was previously an EMS computer systems engineer at NIPSCO for
eight years, with responsibility over the control system servers and the supporting network infrastructure. Tim
previously served as the chair of the RFC CIPC, is the current chair of the NERC CIP Interpretation Drafting
Team, a current member of the NESCO advisory board, the current chair of the NERC CIPC GridEx 2013
Working Group, and current chair of the NBISE Smart Grid Cyber Security panel.

Michael Assante
Michael Assante was pivotal in creating this course and it was his vision that pushed me to author it. This class

is dedicated to his memory. For those of you who didn’t know Mike, it is almost guaranteed that your career
that has brought you to the ICS community was influenced by him at some point. I wrote this blog on what
Mike meant to me, and why I would not be where I am today without him. I hope these words help keep his
memory alive in this class: http://www.robertmlee.org/goodbye-mike-assante-thank-you-for-literally-

everything/
Jeff Shearer and Jason Dely are both members of the SANS “SROC” team that help create and test technical

components for labs. It’s through their work and dedication with Tim that the kits in the class and interactions
with them were possible. They were the masterminds behind a lot of the hands-on kit work and helped

immensely.

Dragos team members also significantly contributed to the course through their own research and just
countless conversations. Additionally, Austin Scott, Grant Freter, Jackson Evans-Davies, and others operated
the range and performed red teaming of the ICS range at the Dragos HQ that is used in the course scenario.

2 © 2021 Robert M. Lee

we <<

a>
oF JF FHF He SH HY

ap

ovwes 8 JF WV

This page is intentionally left blank.

1CS410: ICS/SCADA Security Essentials

Global Industrial Cyber Security Professional (GICSP)

ICS456: Essentials for NERC Critical Infrastructure Protection.

GIAC Critical Infrastructure Protection (GCIP)

ICSS15: ICS Visibility, Detection, and Response
GIAC Response and Industrial Defense (GRID)

ICS612: ICS Cybersecurity In-Depth

1 AD Me het SOE RMDIN BB Lard -

© 2021 Robert M. Lee 3
Objectives

Empower students to look at their ICS networks and be prepared for what they find

Encourage a nuanced discussion on security
Dispel misconceptions and hype about the adversary
Introduce advanced defense concepts to help students realize that defense is doable

Learn the history and lessons learned of targeted ICS threats

1CS515 | ICS Visibility, Detection, and Response

Welcome to SANS ICS515_- ICS Visibility, Detection, and Response! It is exciting to bring this class to you for a
number of reasons. First, it was not too many years ago (and unfortunately still a commonly held belief in some
circles) that people looked at industrial control system (ICS) and operational technology (OT). ICS and OT will be
used interchangeably in this course. Technically many OT networks and systems aren’t industrial, like an aviation
system, but they are still control systems. For the purposes of the class, we’ll broadly be talking about control
systems in their industrial and non-industrial applications, with a strong emphasis on the industrial ones as a niche
that was not experiencing the risk of cyber threats. For too many years there has been a “we don’t see any ICS
cyber-attacks” mentality. When I authored this class in 2014, my years of experience helped me realize that ICS
cyber threats were real and growing. Unfortunately, the world has experienced many attacks that have proven that
to be the case — but there are so many more things happening that the community doesn’t learn about due to the
sensitivity of those cases. When I started my career, this class would not have been possible to make, there would
have been so much concern about sensitivity of topics and s0 little publicly available to pull from that there would
have been a classification concern with discussing some of these topics. That has always been silly, but itisa
reality. Fast forward to today and we’ve got a vibrant and amazing ICS community where most people realize not
only that our community is facing massive change and that the threats are real, but that the ICS/OT is the point of
the business, and the IT is the add on - not the other way around.

Second, we consistently hear in the industry how the ICS community is "far behind" the IT community. This course
represents a change in that. We need to transition from the "ICS is 10 years behind IT, making security too
difficult" mindset that plagues the community and move toward the motto: Defense is doable.

‘As a 500-level class at SANS, this course introduces the advanced concept of active defense while demonstrating
some of its use cases. It does that with a heavy focus on consuming intelligence to drive your actions, monitoring
your networks, and responding to threats. This class covers four key areas that will be discussed later. The fact that
it covers four different, albeit connected, fields of study makes it impossible to capture everything in 5 days of
class. Therefore, the course introduces concepts, reinforces them through hands-on labs, but ultimately gives you
the tools and confidence to research, practice, and learn more than what this class covers.

4 © 2021 Robert M. Lee

Fear

This is not a single 5-day class that will make you a "certified-in-something" security person. Instead, this 5-day
class will act as the first step in a journey toward taking an active approach to defense and understanding the
security operations of incident response.

Another important takeaway for this class is to give everyone an understanding of the history of targeted ICS
threats. It is in these case studies that we can look to secure our infrastructure against future attacks.

© 2021 Robert M. Lee
Course Roadmap

Section 1: ICS Cyber Threat Intelligence:

Section 2: Visibility and Asset Identification
Section 3: ICS Threat Detection
Section 4: Incident Response

- Section 5: Threat and Environment Manipulation

. Section 6: Under Attack!

ICS5I5 | ICSVisibility, Detection,and Response —*

The course is broken down into sections that cover the five steps of the Active Cyber Defense Cycle (ACDC)
which will be discussed in depth later but is a mental model/learning aid to think about finding and responding to
cyber threats. The five steps in the ACDC model are:

- Threat Intelligence Consumption

- Visibility

- Threat Detection

- Incident Response

- Threat and Environment Manipulation

Section 1 will focus on understanding intelligence as well as consequence analysis. That means being able to learn
from the threats (intel) and be able to learn from failures regardless of cause (consequence). That will allow us to
accomplish threat intelligence consumption (consuming intel to help guide our efforts). Section 2 is all about
Visibility. That focus makes sure we understand how to do Asset Identification and, more than just creating a list of
assets, a true understanding of our environment to really leverage it for security operations and response. Section 3
focuses on detecting threats and employing the Network Security Monitoring phase of ACDC. Naturally, we will
end up finding a threat (spoiler alert) in the labs and that will take us into Incident Response, the 3" step of ACDC
and 4" Section of this course. Section 5 addresses Threat and Environment Manipulation through analyzing threats.
Lastly, Section 6 will be an all-day capstone effort with technical challenges to help you practice what you’ve
learned.

The labs in this course are all based on real world experience. Many of the labs leverage real ICS ranges and
equipment to help us get hands-on with data sets that are traditionally very difficult to get access to.

Note that throughout the course, we also provide references to different pdf documents. These documents are
provided to you in your media file for additional reading.

6 © 2021 Robert M. Lee

¥" ¥V YF Ww Ww

J

~~
se ss & Cee HSH HS HY

we

“ws

Section | Outline

Case Study: Stuxnet

Introduction to Active Defense: Visibility, Detection and Response

Lab 1.1: Build a Programmable Logic Controller
Cyber Threat Intelligence Primer

Thought Exercise: Analysis of Competing Hypotheses _ Lab 1.2: Structured Analytical Techniques

a4
| The ICS Cyber Kill Chain

Consuming Threat Intelligence : : i

In-Class Thought Exercise: Critically Evaluating Intelligence Reports

a
Lab 1.3: ICS Information Attack Surface Thought Exercise: The ICS Information Attack Surface
Lab 1.4. Malicgo aud Shodan ICS Heatmap

ICS515 | ICS Visibility, Detection, and Response

As you'll see, this section’s outline largely focuses on intelligence tradecraft. Too often, people advertise
themselves as "threat analysts" or "intelligence experts" without having a fundamental understanding of
intelligence tradecraft. We will start off with a short section on consequence analysis and spend most of this section
understanding threat intel and how to leverage it. The “leveraging” of threat intel will be done throughout the
course — this section is about the theory and understanding the mental models for success. It is the lightest section
in terms of technical expertise required, but it is extremely important to “think how to think” when trying to counter
sophisticated threats.

© 2021 Robert M. Lee 7

7

Case Study: Stuxnet

ICS515 | ICSVisibility, Detection,and Response 8

This page intentionally left blank.

8 © 2021 Robert M. Lee
Sn en en ee ee

Ty

e- FF WS

ww

Ad

“9

“D

Historical Background of Iran's Nuclear Program

* 1945: The U.S. uses atomic bombs "Little Boy" and "Fat Man" on Hiroshima and Nagasaki

* 1957: Iran enters into an agreement with the U.S. under the "Atoms for Peace" program

* 1967: Tehran Nuclear Research Center is founded and supplied with a 5-megawatt nuclear
research reactor by the United States

* 1968: Iran signs the Treaty on the Non-Proliferation of Nuclear Weapons and opens its
program to inspection by the International Atomic Energy Agency (IAEA)

* 1975: Iran signs a contract with Kraftwerk Union AG Goint venture between Siemens AG
and Allgemeine Elektrizitats-Gesellschaft [AEG]) for a 1,196 MWe nuclear power plant
($4-6 B contract)

+ 1978: The U.S. vetoes the reprocessing of spent nuclear fuel—increasing tension with Iran

* 1979: Iranian revolution overthrows the Shah

* 1979-1982: Kraftwerk Union considers contract null and void; refused to refund Iran

* 1995: Iran enters into an agreement with Russia for plant at 915 MWe reactor at Bushehr

* 2002: Dissident group in Iran leaks the existence of the Natanz nuclear facility

* 2006: Iran announces it has enriched uranium, and President Bush warns of consequences

ICS515 | ICS Visibility, Detection, and Response

Most people talk about Stuxnet with a focus around 2010 when it was discovered. Many researchers and journalists
who have dug deeply enough discuss it dating back to between 2005-2007 (the initial creation and infection of
Natanz versus the discovered impact). However, to understand Stuxnet, it's important to go back to March 5, 1957,
when Iran's Shah Mohammad Reza Shah Pahlavi entered into an agreement with the United States under the Atoms
for Peace program for the "proposed agreement for cooperation in research in the peaceful uses of atomic energy."
Although this bit of history does not impact the incident response lessons of Stuxnet, the context is important. When
analyzing something that has political impact and is revolutionary to a community, there must be an understanding of
historical context and why the impact was felt so deeply.

Tran worked for 20 years following 1957 to reach its goals for nuclear power plants. The Tehran Nuclear Research
Center (TNRC) was founded in 1967 and supplied with a 5-megawatt nuclear research reactor from the United
States. The reactor was known as the Tehran Research Reactor (TRR) and consumed highly enriched uranium as a
fuel source. An important part of the agreement for Iran to receive nuclear support from the United States was the
signing of the Treaty on the Non-Proliferation of Nuclear Weapons (NPT). This was signed by Iran in 1968 and
opened Iran's nuclear program to inspection by the International Atomic Energy Agency (IAEA). It is important to
note that these steps forward for Iran marked the nation as a modern power and was a point of pride for Iran's
government.

The Iranian people never fully liked the concept of having to have IAEA inspectors, and following the Iranian
revolution in 1979, it was most certainly not well received. Following 1979, the deals all fell through and the plans
for the construction of the nuclear plants were scrapped—with no refund of money paid by the Iranian government.
In 1990, the Russian government stepped in to supply expertise and technical support.

In 1995, Iran signed a contract with Russia to finish the Bushehr plant with a 915 MWe pressurized water reactor. At
the same time, the Iranian government was bringing online an underground facility at Natanz. This secret facility
was revealed by a dissident group in 2002. It created tension, and in 2006 (at an all-time high), Iranian President
Mahmoud Ahmadinejad confirmed that Iran had completed its goal of enriching uranium.

© 2021 Robert M. Lee 9

The announcement was met with strong backlash, and President George W. Bush stated that this must be met
with strong consequences. Operating under the assumption that the United States and Israel were responsible
for Stuxnet, it can be assumed that this event set the stage for Stuxnet's development. Given the complexity of
the malware and its need for real test facilities, as well as technical analysis revealing samples as early as
2007, the year 2006 was likely the real birth of Stuxnet.

This information and more can be found in a paper written by Robert M. Lee, which is located here:
"The History of Stuxnet" (https://www.afcea.org/committees/cyber/documents/TheHistoryofStuxnet.pdf)

10 © 2021 Robert M. Lee

oe &§ §@ b&b bbe kb ea

vv @

so es wo

Enter Stuxnet

* Malware with four zero-days, one patched vuln, and an ICS-targeted payload:
* This eventually led to the destruction of ~3000 centrifuges
* Bypassed air-gapped network through engineering laptop or USB
° Timeline:
2006-2007: Estimated creation time of Stuxnet from analysis in 2011 by
Kaspersky

2010: The world (and likely Iran) learned about Stuxnet

2010: Symantec's Liam O’Murchu publishes dossier on Stuxnet and its complexity
2010: Microsoft's Bruce Dang revealed technical analysis of the Windows portion
2010-2011: Langner Group revealed technical analysis of the Siemens portion
2011: Kaspersky Labs shows Stuxnet developed in 2007 at the latest

2012: New York Times leaks "Olympic Games" as a U.S. and Israel run program
2015+: Everyone is tired of talking about Stuxnet, but its impacts are important ©

ICS5IS | ICS Visibility, Detection, and Response

Background

On June 17, 2010, security researchers at the Belarus security firm VirusBlokAda received reports of a new piece
of malware. An Iranian customer contacted VirusBlokAda after experiencing continuous and unintentional reboots
ona SIMATIC WinCC server. In examining the new malware, VirusBlockAda researchers identified a potential
Windows zero-day, or previously unpatched vulnerability. Given the severity of a zero-day vulnerability, the
security firm decided to email and notify researchers at Microsoft. Researchers at Microsoft started working on
analyzing the malware's 1 MB of binary code to identify and remedy the vulnerability. To put the difficulty of this
task into perspective, the 1 MB code was 20 times larger than most other malware. Through its research, the team
identified four Windows zero-day vulnerabilities.

Bruce Dang presented his "Adventures in Analyzing Stuxnet" in December 2010 at 27C3 in Berlin, Germany. As
one of the researchers at Microsoft who received the call from the VirusBlockAda researchers, this was an
unmatched view at the malware.

Reference:

To-kill-a-centrifuge.pdf

In 2011, Kaspersky Labs identified the Tilded platform, which was a common link between Stuxnet and Duqu. It
revealed that Stuxnet was developed at the latest in late 2007 and early 2008 based on the compile times of the
Tilded code. An early sample linked to Stuxnet was also revealed to have been submitted anonymously in 2007—
although, no one paid it any attention at the time (confirming its existence then and likely development in 2006).

What we learned about Stuxnet and how it impacted ICS was important for trying to secure infrastructure.

© 2021 Robert M. Lee 11
Network Observable Qualities

| Command |
Lateral |
Movement ona) ee

Peer-to-Peer | / Print | biti ag mypremierfu | Todaysfutbol |
updates Spooler Service tbol[.Jcom [Jcoom

ae — =

1CS515 | ICS Visibility, Detection, and Response = 2

Stuxnet had a number of obvious network observable qualities. Although the capability was advanced in many
ways, it was still easily detectable, especially on the network. Lateral movement through peer-to-peer updates
caused flow data to be manipulated. PLCs that hadn’t talked to each other previously, HMIs communicating over
weird ports, etc. all should have been identified. The network share movements and print spooler exploit should
have also revealed additional patterns that were abnormal for the environments they were in. For the command and
control servers (during the first stage of Stuxnet, they were in the IT networks to gather off data about the ICS), the
two futbol sites likely should have stood out very quickly for anyone monitoring external network traffic. Lastly,
the WinCC scans should have stood out but only to people with an understanding of the process and of the specific
Siemens systems. This will be explored in the next slide.

12 © 2021 Robert M. Lee

=

ra
es woe wow & &@’ & & we © OY © © GS © Ho wH ww

4p

>

@ Kentccwer (tre cna O78 8 om mE NEE): Copter
e_ tae pew Se Sigmar anatyse Sateen Jools - tot

Hage naxtea .s9oF2 GG aaan

Eau [37 cows, paren, func oo Guid 24 seo ead, pouck, ©
Tre Seance

"293.168. 20, 02
bamerettyd
392,168,20,92

Ro. : LO0890)
= £0880:

td

RERRRORLR SS BS

Fumettons iy
Functsons [stare opiees
Funct tons tstare upload:
function: 1

EERE
Teesseess: sgesseesesss

i

292.268, 2
392.368. 3:

es be babs be ba 08 bs bs a be pe ose ba bt
SERRER
5

4290 4.995063
$314 3.038235
4336 $,042033 393 20.304 le
292,248.10.
8. $02,168.10, 02
‘202.268.30.204 202.168.10.92
192.164-40-364 £92.168.10.92

3

itis}

Funct wp
aquest ] Puncttone(starc uploas)
est ] Function: (sarc upload]

st} wuncton: {stare uploa:

M
ee

302
402
aor
ast
102
bg
BS
202
102
102
1m
202
302
Ud
ae
ist
402
302
102
202
02
282
102

vv ¥¥ VV YY VY YY

BE
pia
eas

Bi vatot 3

Wireshark Capture of Stuxnet Infected WinCC Server
The intent with this image is not to be able to see the fine-tuned details but to stress that Stuxnet was observable,
even in a simple tool such as Wireshark.

This image is from the report "To Kill a Centrifuge." In the image, the author demonstrates that he opened
Wireshark to examine WinCC/PLC network traffic communication. He notes that it was obviously "fishy" looking
and that the constant polling to the PLC indicated an abuse or infection was present. It is exactly this type of
analysis that NSM personnel should perform routinely to analyze traffic past what an IDS alerts them to. This type
of interaction would be used to alert incident response personnel to further check out the devices.

Note that understanding network traffic and what constitutes normal is pivotal to understanding if there is
something wrong. This is another reason that asset identification and understanding your network traffic are
incredibly important. Moreover, it shows the importance of having well-trained analysts over just well-crafted
tools. In addition, understanding this type of interaction and what constitutes normal can be crafted into detection
rules to give an indication when certain thresholds of “normal” are broken, so that you are not confined to having a
network analyst consistently look at the traffic—although they should do that on a regular basis.

© 2021 Robert M. Lee 13

Some Host Observable Qualities

ae - Registry Key Multiple Files JE _ Infected PY :
| DLL Injection Ha Modification Dropped Project File ee ADDING

| New registry |
keys such as —

| Lsass.exe | |
| | mrxnet

|
mA

mdmeric3. |

)

1CS515 | ICS Visibility, Detection,and Response = '*

There were numerous files to be detected on the hosts. It’s not important right now to understand what all these are
and what they represent. It’s more important to realize there were observables and to ask ourselves: Could we see
this before the attack finished? Could we look for these after the attacks in the incident response? How do we

prepare the ICS to be able to do that?

As a general reference: The DLL injection targeted a few key processes (Isass, winlogon, svchost) with the
malicious Stuxnet DLL. There were numerous registry key modifications with one specific one having the value of

19790509 (supposedly to represent May gth, 1979, the day a Jew in Lran was executed, causing an exodus of the

Jewish population there) that Stuxnet continually checked for to determine if it had already infected a system. The
For the Project File

multiple dropped files were consistent among systems, some encrypted and some not.
manipulations, there was @ rootkit-like routine placed into the project files and the S7 process (sTtgtopx.exe) was
injected as well. For the USB jumping, you could have found the WTR4141.tmp file for the USB loader or have
looked for USBs being plugged into the system and checked which ones were put in recently through the registry
paths. Interestingly, after three infections off of a USB, the Stuxnet malware would delete itself. Spoiler alert: If
your malware looks like it’s written by lawyers, you’re likely dealing with a nation-state (usually Western but not

always).

Reference: mitps:!does broadcom .com/doc/security-esponse-w32-stxnet Josie l-en

14 © 2021 Robert M. Lee

@) , Dl) =) =) &) 3) @) 7)
eo 8F 8§ 8 wb BO Oe ew mh

) ty

uv vw & & & SS YE BS &

Stuxnet was as advanced as was required

Defeat the defenses in place First example of ICS-specific malware

Numerous observable qualities

Network observables Host observables ICS observables

This class will prepare you to hunt and respond to threats

Organize a repeatable
Leverage the tools process Focus on the strategy

3

ICSS5I5 | ICS Visibility, Detection,and Response 5

Stuxnet is a prime case study for the ICS community for a number of reasons; however, the real value is in
understanding how personnel could have detected it.

* Stuxnet was an incredibly advanced piece of malware that was the first publicly known example of
malware specifically impacting ICS

* Architecture and passive defenses caused the creators of Stuxnet to craft a piece of malware few other
nations in the world could have imagined

* There were numerous network, host, and ICS qualities that could have easily detected Stuxnet and
remediated it before the incident

* This class will help you understand and leverage the tools and tactics required to find the observable
qualities such as those in Stuxnet and know what to do next

© 2021 Robert M. Lee 15
Introduction to Active Defense:
Visibility, Detection and Response

ICSS15 | ICS Visibility, Detection,and Response 6

This page intentionally left blank.

16 © 2021 Robert M. Lee
vw wow bw we weeeeewweiepepwey &

we 8 § WO WS

wm Ww 4

ig?

The Sliding Scale of Cyber Security

LOHEGREOHHURRUURERRRRRRMER ERE

WereLLIGENce orrenes

Offense:
Legal countermeasures and
self-defense actions

Intelligence:
Collecting data, exploiting it into
information, and producing intelligence

Analysts monitor for, respond to, and learn from
adversaries internal to the network

ve Defense:
Provide protection without constant human
interaction: Firewalls, IPS, AV, etc.

’

Suppl: , tecting the
network, maintaining/patching

ICS515 | ICS Visibility, Detection, and Response

The word cyber is overused and sometimes a bit meaningless. I published a paper in the RUS! Journal titled "OMG
Cyber! Thirteen Reasons Why Hype Makes for Bad Policy" and completely agree with some of the frustrations
with the term. I must admit, though, that it is useful to broadly define the information systems and their
interconnections. Cyber here is not meant as just cyber assets that you might find defined in NERC CIP
compliance. Instead, it refers to the various information systems, whether they are OT or IT. For the full paper on
the sliding scale, see: https://www.sans.org/reading-room/whitepapers/ActiveDefense/paper/36240

When we think of what it means to achieve defense, five categories can group together the various activities and
actions we see in this field:

¢ Architecture
° A majority of the flaws we see are not a failure of what we traditionally think of as defense; the firewall
might end up being more of a Band-Aid than the cure. The issue is the vulnerability in systems and
protocols that have been there since they were designed. Achieving a relatively secure architecture is
where we would see the most return in investment toward security.
° Securing the supply chain, properly architecting networks for reliance and security, maintaining and
patching systems, and so on are all actions of architecture that contribute to defense.
* Passive Defense
* Static or automated defenses such as firewalls, IPS, AV, IDS, HIPS, and so on are defenses that can be
installed, configured, and maintained to provide a level of useful defense. It is not meant to block every
advanced attack, but it keeps out a large portion of threats and ensures that advanced threats have to use
more complex and costly capabilities.

© 2021 Robert M. Lee 17

(2

° Active defense
«This sort of defense will be discussed in depth in this section, but the emphasis here is on trained
analysts and personnel who are searching through the networks looking for adversaries to identify
and dispel. In many ways, this is an act of "hunting" through the network by personnel familiar
with the systems and their operations.

* Intelligence
«This section's main focus is on intelligence, so this will also be discussed quite a bit. The important

thing to note here is that intelligence operations are the first area in which we start seeing an ethical
and legal gray line. For example, if you want to gather information from malware that infected you
for the purposes of producing threat intelligence, that is not only completely legal, but it is also
highly encouraged. If you attempt to exploit your adversary's network to gather intelligence or to
"track them back," that is not only highly discouraged, but in many cases, it is also illegal.
¢ Offense

* Counterstriking, hack-back, or attacking in any other way can still be thought of as fitting in the
scale of defense. Under UN Article 51, each state has the right to self-defense. However, I would
argue that counterstriking, or a hack-back, is never about restoring defense and peace as much as it
is about punishment or deterrence. That is not legally or morally acceptable. However, there are
cases in which an offensive action could be seen as a defensive action that is morally and legally
accepted—such as the takedown of a, botnet while it is denying service to a critical infrastructure
site. These types of actions should be performed only by representatives of the state, such as law
enforcement or the military. What we generally think of as “offense” (such as the design of
exploits and their application) is, in my opinion, hurtful to everyone. Infrastructure, systems,
connections, and so on are common among the world—whether it is a SCADA site in Moscow or
one in DC. We will entirely avoid any discussion of offense in this class.

What Is Defense?
It is not lost on me that starting a SANS security class with a classical discussion on the origins of defense may

seem a bit odd. However, the terms we use matter and drive our approaches to the problems we face. To try
and explain the delicate needs and requirements of OT networks to someone who does not understand the
terms is difficult. You might ask for redundant SIS assets and find that the deliverable was less than you
expected. This is no different when discussing “defense” and its implications. One of the reasons there is
confusion with anything "cyber security" in the international community is that the terms are often so loosely
and locally defined that an "attack" to Chinese diplomats has a different meaning to Russian defense ministers.
Likewise, the community's understanding of defense drives the discussion of "active defense." I will spare the
university-styled lecture on the origins of defense with emphasis on Huig de Groot and Thomas Hobbes' Law
of Nature and Social Contract, but the takeaway is this: Defense as understood both in the classical terms and
in the international community is an action taken for restoring peace in conflict. Specifically, this is discussed
in UN Article 2-4 and NATO Article 5 regarding the right of self-defense. Self-defense can only be done to
restore peace—there is no acceptable "punishment as defense" clauses and there is no capability for a state to
legally strike back against an adversary more so than required to stop an immediate attack or enact legal
countermeasures. In other words, defense under any name or understanding has to actually be about defense.

18 © 2021 Robert M. Lee
~S oo 8 © §© 8 SF HS FF FF FF OB Oe ee we

a “ap

“we

is

TOWARDS SECURITY
OFFENSE
INTELLIGENCE
ACTIVE DEFENSE

PASSIVE DEFENSE

ARCHITECTURE —

ICS515 | ICS Visibility, Detection, and Response

When we look at the Sliding Scale of Cyber Security and apply it to those actions that contribute to security versus
their cost, there is a clear return on investment revealed. As an example, to properly perform offensive operations
with all of the personnel and technical costs as well as the required base (such as intelligence feeding it), offense is
the most expensive category to properly perform. However, attacking someone’s systems has a very low value
towards security. It is arguably useful in a national-level discussion or could theoretically be of value during an

ongoing attack — but its value toward security compared to properly architecting and maintaining the network is
minimal.

This class does not support offense operations at all. However, for the purpose of recognizing the counter
argument, it is mentioned—but this slide helps visualize the argument against it for security’s sake. Additionally,
this graphic helps decision makers understand that the architecture category is the best initial return on investment
one can make for security and supplies the base of all other categories. A well architected and maintained network
is much easier to apply passive defenses to, which ultimately makes active defense easier and offers much more
visibility. Additionally, for those doing intelligence in this space, it is required to have the type of internal network
data that can only be achieved with that appropriate base of architecture, passive defense, and active defense.

© 2021 Robert M. Lee 19

19

Companies Battle Cyberattacks

Free ‘Active Defense’ Tools Emerge : = : —
it's called a "hack back." when the victim of a cyberattack turns the tables

Ammunition for fighting back against cyberattackers in subtle yet disruptive and actively fights back against their attacker.
ways is becoming available in open source
"This iterally is a wild west out there," Greg Hoglund. a cypersecurity
A.wave of open-source tools for turning the tables on cyberatlackers are becoming specialist, toié CNBC.
available in the public dornain for organizations looking for alternatives to traditional

security methods Hoglund is the founder and former CEO of HBGary and has worked on

cybersecurity for the Pentagon and the U.S. intelligence community.
the tools" creators say’ i's more about
some cases, physically focati ing, the bad guys behind (Read More: Hacker Claims: Airplanes Vulnerable at 30,000 Feet)

“When | think of hack back, | think of more of a counterstrike, or a
mitigative action to stop an imminent or ongoing attack, You're aot going
out and trying to find trouble, you're in trouble and trying to stop the pain
right then," he said.

mean.3 company shutting down a cyberattack already
improve the national eyb ; : +8 “i in progress, or hacking into a cybercriminals’ network to delete or alter

: ; ara a pnt! : ink that’s already fe

insufficient to address the threat. This thesis explores the possibility of employing active cyber defenses to improve ‘igrmation inals aready seen siviee

cyber defenses at the national level. The bad guys are so pervasive, according to Hoglund, that some

hacking, pre-emptive hacking, etc, 10 companies are taking matters into thelr own hands, Victims of attacks are

entrant Meipprogch em enhance’s sates cyber defense posture fighting back by hacking the hackers where the hacker becomes the

hackee.

1CS515 | ICS Visibility, Detection, and Response 20

Active defense, often identified as Active Cyber Defense, is largely abused in mainstream media. Even respected
programs such as DARPA and otherwise reputable news sources gather odd statements and definitions for use in the
discussion of active defense. For example, DARPA's statement that the "current IT security response practices to
these attacks boil down to four steps: find the invading code, unplug the affected systems, create security patches to
thwart particular attacks, and apply those patches" is ridiculous. If our state of defense actually came down to just
those four actions, this class would make little difference in the field of security because we would be trapped in the
1980s and far behind the curve. You will often see "experts" quoted in news sources as well as talking about matters
in which they do not truly have any experience or expertise. Hacking back is wrong. We can debate that, but what is
irrefutable is that hacking back is not active defense and hacking back is not appropriate in the context of ICS
networks. Therefore, we will not focus on that interpretation. The rest of this section focuses on showing that.

Active Defense Abused in Academia

Active defense is not only abused in the popular media. In academia, there also have been numerous papers published
by legal experts, military officers, and computer scientists about what Active Cyber Defense is. To nitpick, none of
the academic papers I have read were written by practitioners in this field; the legal experts more often write about
this subject matter while displaying a basic understanding of network security. There is value in the debate, but the
terms are often highly abused. For example, no matter how badly you want to find your intellectual property and "get
it back," you cannot. One of the articles previously listed argues that Active Cyber Defense can help people to find the
attacker and get the stolen information back. Just as you cannot simply "delete" pictures from the Internet (as many
have found over this past year) that have been uploaded, you cannot go and "get back" your sensitive information.

Paper References:

"Active Cyber Defense: Enhancing National Cyber Defense" https://apps.dtic.mil/dtic/tr/fulltext/u2/a556635.pdf
"Active Cyber Defense within the Concept of NATO's Protection of Critical Infrastructures"
https://publications. waset.org/9997871 /active-cyber-defense-within-the-concept-of-natos-protection-of-critical-
infrastructures

20 © 2021 Robert M. Lee
eowewo w

4B wa &%

ig

ctive Defense Influences

* Active defense is an old military strategy that is relatively new to InfoSec
* Many legal experts speak of Article 2-4 and wholly apply it to network security
* Many technical experts take a few sources (such as Mao) and translate practices for land
warfare directly into information and network security
* Two of the most referenced sources and strategies are:
* Mao Zedong and his book On Guerrilla Warfare

* General DePuy and The Army's Field Manual (FM) 100-5
* Neither of these sources are good “cyber” authorities

* These are referenced, though, so we need to consider them

* But what was the strategy regardless of “cyber”?

* The lessons learned are applicable when utilized correctly

ICS515 | ICS Visibility, Detection, and Response

In terms of history and conflict, active defense is a relatively new concept. It was being actively debated, with no
resolution, in the 1970s by a few personnel in the U.S. Army. Mostly though, the various papers and references on
the matter cite two main sources: Mao Zedong and General DePuy. Let's explore these sources to figure out why
and where proponents of Active Cyber Defense as a “hack-back” strategy came up with their information—and
decide for ourselves if that matches with the actual intent and understanding that the original sources intended.

The idea of active defense is often attributed to Mao Zedong (Tse-tung)
Mao wrote on guerrilla warfare:

"Active defense is also known as offensive defense, or defense
through decisive engagements. Passive defense is also known
as purely defensive defense or pure defense. Passive defense
is actually a spurious kind of defense, and the only real defense
is active defense, defense for the purpose of
counterattacking and taking the offensive."

He also said:

"Tt was an objective fact that the enemy was strong and we

were weak, and yet some people refused to give it thought,
talked only of attack but never of defense or retreat, thus
mentally disarming themselves in the matter of defense,

and hence misdirected their actions."

Active Defense Influences — Mao

The single most-used source of active defense is attributed to Mao, the founding father of the People's Republic of
China. Mao lived from 1893 to 1976. Mao was a Chinese Communist revolutionary leader and his book, On
Guerrilla Warfare, discusses his understandings of conflict and lessons learned from the Second Sino-J apanese

© 2021 Robert M. Lee 21

2

War from 1937 to 1945 and the Chinese Civil War, which ended in 1949. In his book, Mao wrote that "the only
real defense is active defense, defense for the purpose of counterattacking and taking the offensive." This is a
compelling statement and argument that according to Mao, the definition of active defense would, and should,
include a discussion on counterstriking. The problem with this, though, is that most individuals who quote Mao
likely did not read the full book and instead focused on this statement. Mao's book goes into great detail in giving
context to these statements and revealing what Mao meant. Mao always wanted to secure China. He did not want to
go back into and invade other countries or counterstrike them. His thought process was that he was a
technologically weaker and outnumbered army. He could not afford to focus on traditional passive defenses where
he lined up his troops and "dug in" waiting for the adversary. He proposed remaining flexible and using his own
territory and understanding of it against the enemy—to fight a people's war or "death by a thousand cuts" where the
adversary would lose the will to fight. His focus on active defense was not on counterstriking into its "network,"
but instead, to fight the adversary on his own land with full understanding of the territory and to use it against the
adversary to force them out.

More problematic is the issue of translation. Mao was not the greatest expert on "cyber" obviously and therefore
references to him in an Active Cyber Defense connotation can be misleading. References to him outside of reading
and understanding his work in the context of its time and in his native tongue is additionally worrisome. Applying
Mao's intention to active defense can be helpful for framing the discussion but realistically those directly quoting
him to build a debate on “hack-back” are not grasping the problems this introduces.

What Mao Understood
Based on Mao, the Chinese People's Liberation Army determined the three guiding principles of active defense.

Spoiler alert: It does not fit with the buzzwords and hype.
Three guiding principles of active defense:

* No provocation of the enemy
* No military bases on foreign soil
* No seizure of enemy land

Pre-emptive strikes against potential threats, call backs, and malware in adversary networks, and taking over
adversary capabilities outside your network, would most certainly not be part of the active defense as discussed by
Mao. These would be intelligence or offense-based actions.

Army FM 100-5 "Operations" (1976)

EM 100-5 was a revolutionary piece in terms of military doctrine and extracted lessons learned from Vietnam and
Israeli-Arab conflicts to determine that there must be a better way to fight than everyone just lining up and shooting
at each other. General William E. DePuy was the first Army Training Command commander and had FM 100-5
written. It made assumptions of the state of readiness of the adversary compared to the United States and decided
that active defense was needed. By DePuy's statements in his personal writings, he noted that active defense was
loosely defined and needed a more set definition. But he proposed that an active defense should be one where the
troops focus on maneuverability and the ability to quickly respond to the adversary crossing into your territory. It
should be mobile and not dug-in just waiting to be hit.

For an exciting (if you enjoy history) look into this reference:
https://www.armyupress.army.mil/Portals/7/combat-studies-institute/csi-books/ Selected-Papers-of-General-

William-Depuy.pdf
One particularly interesting section says the following:

22 © 2021 Robert M. Lee

- - = & TO ©

~
we we wow wo wo w&

we © w we ww wow

we ww w&

se’ se’

ig’ iB’

ig’

"The concept of active defense is to wear down the attacker by confronting him successively and continuously with
strong combined arms teams and task forces. These forces fight from mutually supported battle positions in depth
throughout the battle area. Defending platoons, companies and battalions maximize the effectiveness of their
weapons by selecting advantageous positions and minimizing their vulnerability, using the terrain as concealment,
and otherwise exploiting all of the advantages of the defender." :

Just like Mao, DePuy argued for a mobile active force. He focused on the need to detect the adversary and quickly
respond. He also noted that single defenses (that is, silver bullets) would always fail in modern warfare. He
proposed that "combined arms" were the only way toward success. That is, use all the defenses you have at your
disposal in such a way as to maximize their strengths and limit their weaknesses. It required deployed forces to
interact with the adversary along the defensive front instead of retaining reserves while attempting to detect and out
maneuver enemies.

When discussing "Combined Arms" this translates very well in network security to using the individual strengths of
sensors and defense systems blended together for holistic defense.

Some more tidbits from DePuy:

"During the battle these positions will be lost, fought over, regained, occupied, abandoned, and reoccupied. What
that means is that the defending force must possess the ability to move. It must engage in an active defense of the
sector. There is no such thing as digging in and waiting for the enemy to come to you; because it would be a
foregone failure.”

Ironically, he stated later in life:

"Criticisms often heard within the working Army include statements such as these: 'The defensive doctrine is too
reactive-the enemy calls the tune.' Or, ‘There is too little offense in the defense.' Or put another way, ‘too little
action in the active defense."" (The term "active defense" is mentioned only once in passing in 100-5 as an adjective
and seldom in 71-2. However, in 71-1, "active defense" becomes the official descriptor of the defensive doctrine
set forth in this family of manuals. Although, as we shall see later, there is no consensus on the meaning of that
term.)

The authors of the next edition of 100-5 have the important task of broadening the options by clarifying the
doctrine. It may be that the term "active defense" should be clearly broadened to make it synonymous with
diversity—dynamic diversity. However, they may want to discontinue the term entirely, as it now carries some
confusion in its intellectual baggage, and simply refers to "operations for defensive purposes."

© 2021 Robert M. Lee 23
Active Cy

al
p

ICS515 | ICS Visibility, Detection,and Response =

I've established the Active Cyber Defense Cycle or ACDC (rock on) that incorporates the understanding of active
defense from various original sources, matched up with my experiences in the field of ICS security. While serving
in the intelligence community, I worked at a security/threat operations center and was asked what focus area I
wanted to lead my team in. My passion was with ICS, so that is what we did. I was honored to serve with a talented
group of intelligence professionals empowered by some (quite frankly just neat) capabilities to identify and respond
to adversaries. We stood up an ICS/SCADA threat discovery mission, and I employed this cycle into our
operations. It was a success. This model is not just a theoretical discussion from sources decades old; it is a model
that has been tried and tested to identify advanced adversaries and secure critical infrastructure with a focus on
trained personnel—not just good tools. However, it is not meant to be a perfect model or something you must
leverage — it is a learning tool. I have seen organizations successfully implement these and I’ve seen others that just
use it as a base of learning and then do something else — whatever works for you is fine.

Through this cycle, you can produce a number of things—the two most important are threat mitigation
recommendations to the defense team and/or architecture team, as well as indicators of compromise and threat
information to the intelligence teams. I know of few ICS-related organizations that have dedicated intelligence
teams. I know of even fewer ICS facilities that have a surplus of personnel to train and keep to perform these
phases as distinct teams. So instead, the focus of this class is to give you enough information in each category to be
useful to your organization, give you a place to start, letting you specialize where you'd like and where it makes the
most sense to your organization. Sometimes, you'll be a one-person team that should be staffed by a dozen, but it's
important to know what you're looking for, why youre looking for it, what you’re producing, and how it’s being
consumed.

24 © 2021 Robert M. Lee

™m

2 &

mo

ee @ @

@ > 2 oe ors) @ @ 7 | @)
we we Ww

=)
=]

Lessons Learned: Visibility and Threat Detect

ICSS515 | ICS Visibility, Detection, and Response

There were ~9000 centrifuges, but not that many controllers. The Cascade Protection System was the initial attack
vector (part of the over-pressurized attack), and one $7-417 could control up to six cascades, which equated to 984
centrifuges. That is, Iran would have needed approximately 10 S7-417s for the centrifuges for this portion of its
environment.

The logic running on the controller would not be detected by anything on the network. It was device-level code on
a PLC. It replicated the code that was legitimate so that it displayed to the operators correctly. It was not a
traditional man-in-the-middle attack, which would have had network involvement, but it was done on the device.

The second variant (the rotor speed attack) targeted the Centrifuge Drive System, which used an $7-315 controller
to control one cascade (which means there would have been approximately 60 of these controllers for the ~9,000
centrifuges). Technical analysis determined that there was likely a Siemens WinCC SCADA system monitoring the
frequency converters and likely one WinCC instance per six cascades (approximately 10 WinCC instances).
Because Stuxnet would have used WinCC to sync its attack, the traffic would have been suspect. The technical
analysis provided some details that showed the communication between the SCADA system and the PLCs was odd.
If someone would have looked at the network traffic "within hours, he or she would have realized that something
was fishy... The infected WinCC system probes controllers every five seconds for data outside the legitimate
control blocks."

Reference:
To-kill-a-centrifuge.pdf

© 2021 Robert M. Lee 25

25
Lessons Learned: Incident Response

Verify digital hashes of |
software and lees :
files for

ick analysis to scope
Se ane counter —

ICS515 | ICS Visibility, Detection,and Response 26

It's not feasible to understand what incident response the Iranian personnel did or did not do at Natanz. From open-
source reporting, it's likely they consulted not only with VirusBlokAda but also Kaspersky Labs. It is reasonable to
assume they outsourced most of their incident response and malware analysis efforts. However, the lessons are still
viable.

In this environment, especially with physical destruction occurring during an incident in a nuclear facility, the focus
of incident response is the safety and reliability of the operations while obtaining as much data as possible. During
this "hair on fire" type of stage, the Iranian officials in charge likely cared more about figuring out how to secure
their infrastructure and identify impacted systems than trying to figure out attribution for the attack. An ACDC type
approach in this scenario would have to acquire as much forensic quality evidence as possible, while scoping the
problem and trying to keep the systems safely running.

26 © 2021 Robert M. Lee

oo, (>,

a

<=
w we &© & & S&S S&S &

ve & & w& w&

Lessons Learned: Threat and Environment Manipulation

__ Community effortby Primarily dynamic
malware analysts malware analysis

Information gathered Patching ©
— useful for ~~ vulnerabilities and
infrastructure changes _ Monitoring points

Indicators of
| co Compromise (I0Cs) to
| | Lessons fae useful _ eee DeSean
os se Sa ieee | Adversary Tactics,
— Techniques, and

_Procedures (TTPs)

1CS515 | ICS Visibility, Detection,and Response 27

Threat and Environment Manipulation is going to be fully explored in Section 4, but for this section, you need to
understand what incident response is also aiding. In this scenario, incident response personnel could have passed
network captures, project files, and other forensic data to the threat and environment manipulation teams to try
to identify, extract, and understand the Stuxnet malware. The personnel could have then developed IOCs, which
would have fed back into internal threat intelligence products that could be used in network security monitoring
and incident response. In addition, the efforts to understand the threat could have led to modifications in the
environment that would have made Stuxnet less useful. Deep forensic analysis through reverse engineering
would not be a role of ACDC, but the dynamic analysis and interaction with Stuxnet would have helped
personnel work through the ACDC cycle over and over to clean their environment and maintain it.

In addition, information extracted about the malware and the context to go with it could have been shared with
the community. This was done, but not by the Iranian government. Information about the threat from the
Symantec report was used in a number of incident response scenarios in which Stuxnet was involved at other
facilities.

© 2021 Robert M. Lee 27
Lessons Learned: Threat Intelligence

ICS515 | ICS Visibility, Detection, and Response

When viewing Stuxnet from the Active Cyber Defense Cycle, it was obvious that the impact of threat intelligence
initially was ZERO. No amount of threat intel feeds, data, or intelligence would have helped prepare Iran for an
extremely targeted, covert, and well-funded unique attack. Threat intelligence regarding Stuxnet was useful
AFTER the attack.

° The lessons learned from encountering Stuxnet showed vulnerabilities in Windows computer systems and
in the "features" of the Siemens controllers that adversaries could use; this information proved valuable
because it included the context of the situation and what type of actor would be interested and capable of
using it.

¢ This information can be used in IDS signatures and network security monitoring (NSM) by other
organizations to help identify and clean up Stuxnet.

¢ A major value was the Tactics, Techniques, and Procedures (TTPs), i.e., not just learning the
indicators but the way the attack happened and learning from that.

* This type of information was used by companies doing incident response in facilities around the world that
were connected via the Siemens' VPNs and other sites.

¢ The focus: Threat intelligence helped others—it would not have helped Iran.

Indicators of Compromise (OCs)

Indicators of Compromise add a lot of value to the other security roles in an organization. Hunting in the network
during Network Security Monitoring (NSM), scoping the threat during Incident Response (IR), and focusing the
analysis of threat and environment manipulation (TEM) analysts are all considerably more efficient with IOCs.
This is one of the main outputs for threat intelligence at the tactical level.

Host-Based IOCs

Host-based [OCs are those that are designed for searching on a specific endpoint. File names and properties of files
on the disk, registry keys, processes running in memory, digital hashes, and more are all samples of host artifacts
that can be made into IOCs. Oftentimes, it is incident responders who leverage host-based IOCs; however, endpoint

28 © 2021 Robert M. Lee

28

o

s.lUC CrrllhmlCU SD
we we w@S ©&S © 86S |S &

iB! as!

security analysts leveraging products such as whitelisting solutions can also easily use these types of IOCs.
Usually, these types of IOCs are created through digital forensics or malware analysis. We will cover them more in
Section 3 and much more in-depth during Section 4 with a discussion and lab on the IOC format YARA.

Network-Based IOCs

In ICS environments, network-based IOCs are the most useful. Host-based analysis is usually time-intensive and
requires the running of software and collection tools on systems that might be sensitive. Running new software on
an ICS asset can void its vendor warranty or cause issues that the software was never tested for; however, using
network-based IOCs can be done in an entirely nonintrusive manner. For example, you can develop Snort IDS
signatures from network-based IOCs, such as URL and IP addresses, and run these signatures against packet
captures you collect on the network but analyze off the network, You can also deploy them to systems such as an
IDS to monitor for real-time traffic.

© 2021 Robert M. Lee 29
Active Cyber Defense Cycle in ICS515

Threat
Intelligence _

Consumption

1CS515 | ICS Visibility, Detection,and Response 30

This section's focus is on the Threat Intelligence Consumption step of the cycle. It is rare for ICS security teams to
have dedicated intelligence analysts, so the large focus for the participants in this class should be on understanding
intelligence and where it can come from. This can help guide reasonable decisions on when, where, and how to
obtain threat intelligence for your team. For this reason, this section is more about intelligence and threat
intelligence at large, rather than a focus on specifically consuming threat intelligence. The end of the class will
discuss Threat Intelligence Consumption specifically, and then we will use threat intelligence injects in different
labs throughout the rest of the course.

Section 1: Structure and Focus

Intelligence tradecraft is useful to apply to many different scenarios. Simply, analysis work can be applied to many
different situations. For example, the conveyor belt has quit operating. Why? Do we have data on the normal
operating conditions? Do we have information about any threats that have been seen inside the network or
impacting the border defenses recently? What systems are connected to the conveyor belt? Is it possible the root
cause was related to a nonthreatening issue? What different things could have impacted it? What is the root cause?

Collecting and analyzing data into useful information is not a cyber-specific or threat-specific skillset. We will also
go through how adversaries gather intelligence about your organization, where you can find useful ICS intelligence
reports, and how you can ultimately make threat intelligence useful and actionable in your networked environment.

These are the takeaways | set out to meet when designing this section's content. These are the takeaways I want
each student to achieve, and the items that will be stressed in this section:

* Understand the Active Cyber Defense Cycle

* Identify the steps of the intelligence life cycle

* Understand cyber threat intelligence (CT) and its applicability to ICS
* Identify useful sources of ICS threat intelligence

* Conceptually understand how to generate and use CTI reports

30 © 2021 Robert M. Lee

wD OH OH OO OO OQ &H

oe Ww

eo fo ff OW WOW

~
vw we wo wo we ee we wo we ww

wo

owe JF WJ

This page intentionally left blank.

Course Scenario

ICS515 | ICS Visibility, Detection,and Response 31

© 2021 Robert M. Lee
he City - Calistoga

Calistoga is a large city and has a water, gas, and electric utility as well
as a rail company and oil refinery.

--AND THIS 1S A
WATER FILTRATION PLANT.

ICS515 | ICS Visibility, Detection, and Response

Calistoga is a large city in the country of SANSistan. It has operations typical for a large city, including electric
transmission and distribution as well as electric generation at a nuclear power plant (the safest and cleanest of
energy types). The city also has water plants run by a local utility, including wastewater treatment facilities and
water distribution. The city even manages nearby oil refinery and gas pipelines as an additional energy source for
cogeneration facilities that utilize steam and gas turbines to create power (no they are not black-start capable, even
though the journalists keep asking).

Image Reference:
SCADA and Me (book)

32 © 2021 Robert M. Lee

Ww WH WH WH WH HH OH CO OH HS ow

, wy wy, wy ww

e® PB

7 © @

oS @
os ws ww

we ww ww

Wea a

ICSS15 | ICS Visibility, Detection, and Response

Here we see the Calistoga city in real life — a Lego city range hosted in the Dragos HQ that is roughly 11 ft by 4ft. It
has rail, water, power, and oil and gas operations represented.

© 2021 Robert M. Lee 33

33

Calistoga 3 (Generation, Transmission, Distribution) Power Operations (C3PO)

ICSS15 | ICS Visibility, Detection, and Response

This page intentionally left blank.

34 © 2021 Robert M. Lee

34

1 @o 2 ww OHO LC HO SH ow

&] @® F

7m ® &
ow ewsew

wo

e)

Generation 1 Power G) Transmission
Only

\
External Power C)
Available == Xa L

Transformer

Power Seat
vA Indicators potentiometer!
eq VY |
Ole aw moe
Power

A

Load Factory Load Indicator ts C y
Potentiometer Meter Ens)
Min Max ——
S ee

Ly

a VW
Lt ‘ © ‘Transformer

Distribution

ICSS15 | ICS Visibility, Detection, and Response 3s

C3PO Kit

Sim via VM/HMI Definition

Sim |: Generator Fuel Flow Valve Control 0 = No Remote PLC 1 = Controlled by Remote PLC
Sim 2: Summer / Winter Ratings for Protection Relay. 0 = Winter, | = Summer

Sim 3: Intertie 0 = Off, 1 = On : Radial (one feed) or Electric System Sourced Generation where Electric System
Sourced Generation means generation can come from somewhere else

Sim 4: Ack Generator Alarms

Sim 5: Ack Transmission Alarms

Sim 6: Ack Distribution Residential Alarms

Sim 7: Ack Distribution Industrial Alarms

Sim 8: Expert Mode — Run Generation with Pushbuttons

Generation Overview Screen

Total Consumption

Residential Consumption

Industrial Consumption

Trends:
Trends showing major industrial customers.
Total local system generation.
Total import generation.

Combined Cycle Generation Architecture
Turbine Generator — Exhaust gases are captured to create steam.
Controlled by Student Kit Click PLC.
Steam Turbine Generation — Is active when Turbine Generation is active and producing steam.
Controlled by Student Kit Click PLC.
Turbine Generator has a variable fuel valve that will be controlled from a remote PLC. In our case, an OpenPLC
via Modbus.

Controllable between “Manual” where the fuel valve is 100% open, and “Auto” where OpenPLC controls
the position of the fuel valve.

© 2021 Robert M. Lee 35
Total Generation Load(s) Definition
Industrial = 300MW
Arc Furnace 1 = 300MW x 40% = 120 MW
Arc Furnace 2 = 300MW x 40% = 120 MW
Auxiliary = 300MW x %20 = 60 MW
Residential = 100 MW
Total Local Generation = 280 MW
Supports total Residential (100MW) and partial Industrial [1 Arc Furnace (120 MW) + Auxiliary
(60MW)] = 280 MW

Combined Cycle Generation Behavior
Turbine and Steam total MW capability will be less than Residential and Industrial Load.
Intertie must be present to service total system load from Residential and Industrial.
The Industrial load consists of:
Two “identical” arc furnaces. Meaning, both arc furnaces will pull exactly the same load.
We will assume both arc furnaces are capable of pulling up to 80% of the total industrial load.
We will assume there is a 20% “other plant” load that is controlled by the potentiometer. The are furnace
load will be limited to 80% of total load.

During startup, the Combustion Turbine will spin up to 1 MW and will not go higher until it is synchronized, and
the breaker is closed.
If the Generation breaker opens, the Combustion Turbine will go to a shut down.
Shut down will be defined as a ramp to a stop.
Steam Turbine acts the same as the Combustion Turbine.
If Intertie == True
// Economic mode is selling power to the market.
AVR = Doesn’t matter, Economic Mode = True
Elself Intertie == False && AVR = True && Total Load <= Generator Max Output
// Balancing mode is equal to trying to balance generation with load.
Generation = True, Balancing Mode = True
Else Intertie == False && AVR = True && Total Load > Generator Max Output
Generation = Fault - Ramp to Stop, Transmission Relay = Trip
IF AVR = Off && Total Load = Drops to nothing OR Transmission Protection Relay == Tripped
Generation = Fault - Ramp to Stop

Industrial Plant Behavior

Total Plant Consumption = 300MW

Furnace | can draw up to 40% of total load.

Furnace 2 can draw up to 40 % of total load.

Potentiometer can control up to 20% of load.

Display — Furnace 1, Furnace 2 and Auxiliary (Pot) consumption.

36 © 2021 Robert M. Lee

WwW ww ww

) w ww

i)

@ 2) ™

o @ @

on @

@

aq @
we ww ww WS

Calistoga Refinery

ICS515 | ICS Visibility, Detection, and Response

The Refinery and its accompanying gas operations plant are shown here with the full cabinet range and as a portion
of the Lego city.

© 2021 Robert M. Lee 37
How It All Connects

* Calistoga Refinery
+ “Scenario 1” for the class exercises:
« JT and OT network and represents the beginning of the scenario
¢ May or may not be connected to happenings at Cg3PO (for you to figure out)

* Calistoga 3 Power Operations (C3PO)
+ “Scenario 2” for the class exercises but happening in parallel with Scenario 1:
+ OT only network and physical kit that you interact with

ICS515 | ICS Visibility, Detection, and Response

This page intentionally left blank.

38 © 2021 Robert M. Lee

38

wD oe @S D BS &

> >

™
wwe ses &s & wo w

w

wo ww

oe Fe bw J

ose ws ws © wb

is

Course Scenario Goals

* Calistoga Refinery:
* What are the names and IPs of the Operator stations (HMI/EWS/Historian)?
* What is the make and model of 10.10.20.10?
* What is the adversary’s IP address and domain?
* What is the name of the malicious project file?
What did the adversary do to the safety PLC?
What is the malicious routine in the logic and what does it do?
What is the root cause of the attack?
* Is the incident connected to C3PO’s incident?
¢ C3gPO:
* Create a topology of the control network.
* What is the malicious action on the HMI?
* What Register was manipulated with what.value?
* What malicious file executed on the HMI and when?

ICSSI5 | ICS Visibility, Detection, and Response

This page intentionally left blank.

© 2021 Robert M. Lee
Lab |.|
Build a Programmable Logic Controller

1C$515 | ICS Visibility, Detection, and Response

Reference the Lab Workbook. The next few slides introduce the CYBATI Kit components while you follow the
lab's instruction to build the lab.

40 © 2021 Robert M. Lee

40

«

Oo a anan#eereeeee fee oo @o oo om @
Cyber Threat Intelligence
Primer

ICS515 | ICSVisibility, Detection,and Response «1

This page intentionally left blank.

© 2021 Robert M. Lee 41
(PHASE 1)

1C$515 | ICS Visibility, Detection, and Response

This page intentionally left blank.

42 © 2021 Robert M. Lee
ey wy

rT

What Is Intelligence?

* Both a Product and a Process

¢ Intelligence can be understood as:
¢ The product resulting from the collection, processing, integration,
evaluation, analysis, and interpretation of available information concerning
foreign nations, hostile or potentially hostile forces or elements, or areas of
actual or potential operations

¢ Or more simply: Analyzed information about a competitive entity that fulfills
a requirement

ICS515 | ICS Visibility, Detection, and Response

Much of what we understand about intelligence has been created, tried, and honed, in the government. The
intelligence community has been practicing intelligence operations since the early days of the United States'
founding. Intelligence dates much farther back for the rest of the world and has been incorporated successfully into
combat operations dating back hundreds of years. Intelligence used to be a costly expenditure. Civilian
communities and industries couldn't easily employ human operatives for Human Intelligence (HUMINT) like the
Central Intelligence Agency could. Likewise, setting up a global system of sensors and satellites for Signals
Intelligence (SIGINT) was not possible outside of the National Security Agency and National Reconnaissance
Office. However, the Internet age has opened up vast possibilities with how civilian organizations can collect
information to turn into intelligence.

Vast collections of malware through endpoint security telemetry, internet netflow and records, collections of emails
and attachments, incident response data, and more have contributed to a private sector intelligence revolution
where it is not uncommon for private sector companies to have more insight and depth on given threats and victims
than their government peers. Thus, we have seen a huge influx of intelligence tradecraft into the network security
community. Unfortunately, with any great influx of material comes a lot of misunderstandings and hype.
Intelligence, for example, is not just information gathered from a tool. Likewise, it is not the end-all-be-all source
of information useful to stopping every attack ever. Let's take a look at the relationship of data to intelligence.

Reference:
jp2_0.pdf

© 2021 Robert M. Lee 43

a

Intelligence Life Cycle

The Intelligence Process

Evaluation
*
Dissemination Planning
nd

and and
Integration Direction

Analysis Mission
and
Production

Processing
and
Exploitation

“

and Feedback Reference: JP 2-0

ICS515 | ICS Visibility, Detection,and Response 44

The Intelligence Life Cycle represents a formal and tested process to planning and creating finished intelligence
products. In the next few slides, we go over the steps:

* Planning and Direction

* Collection

* Process and Exploitation

* Analysis and Production

* Dissemination and Integration
* Evaluation and Feedback

Planning and Direction

Intelligence is useless if it is not, from the start, meant for a purpose that benefits the organization that is producing
or consuming it. The planning and direction phase should be guided by requirements. In the U.S. government’s
intelligence community, there is an entire formal process for combatant commanders in the military and for
national level leaders to submit intelligence requirements, assign them priorities, and put them into planning
documents. The ICS community does not and will not have that formal of a process. With less oversight on what
intelligence you are producing or consuming, you must pay extra care to define your requirements in detail and
make sure that the plan and direction line up with those requirements. If you are trying to research ICS threats to
your organization, gathering data about the latest criminal malware deployed against the United Nations might not
be the best data source.

Determine your requirements, establish a realistic goal that you can easily explain to the people who are going to

collect the data and take part in the process, and create different courses of action. You will have multiple ways of
achieving your goals; determine the best one. When this process is done, you can move on to collection.

44 © 2021 Robert M. Lee

Oommen fm @

eo @

a
sos we &§ &© & & & B&B BY Ye Bw ww BF WwW Ww Ww WS Ww ww w

ae

Collection

Where and how you acquire data, information, or other intelligence will make a dramatic impact on your finalized
intelligence product. If you were given an indicator of compromise (IOC) to look for a malicious file in memory,
would you have the collection mechanism to gather that data? In your IT environment? In your ICS? Collection is
important for how we do analysis. So much of intelligence depends on good collection that it is often what analysts
fight about most and protect the most in terms of “sources and methods.”

Processing and Exploitation

The term exploitation here does not mean the same as it does in computer security. Exploitation in computer and
network security occurs when you manipulate a vulnerability in a system to use it or change the system in a way
that was unintended. The exploitation of data in the Intelligence Life Cycle deals with turning data into useful
information that can be analyzed. Analysts who collect raw data, such as Modbus commands off of a network, will
want to process and exploit it into something more easily readable than plain Modbus commands. Having charts
and graphs of how many of what specific commands were seen, and when, makes the data more useful (for
example, do you normally have a lot of write commands? If not, and you see a sudden spike, that might be useful
information for your response teams to investigate). This information can often be used directly, but when it is
analyzed and produced (the next step), it becomes exceptionally valuable.

Analysis and Production ,

The information gathered so far in the cycle becomes a finished intelligence report in this phase. The analysis and
production step of the cycle ensures that other available information from various sources is evaluated and
combined with the information that has been collected. Outliers are eliminated and analyst experience plays a
heavy role in determining the accuracy of the conclusions created so far and the overall takeaways that will be
included in the report. The production of the report ensures that the information can be conveyed in multiple ways
for the intended audience. That is, a Bottom Line Up Front (BLUF) or Executive Summary is going to be useful for
executives, whereas the detailed analysis is going to be important for analysts who want to verify the intelligence
themselves and use it in other intelligence reports. The produced report can be a serialized report that is stored long
term, a PowerPoint or hard copy report handed out to team members, or an oral product simply meant for
producing and sharing quick intelligence. This is useful for tactical-level decisions such as what signatures to
deploy on your defense sensors to catch and stop the threat.

Dissemination and Integration

Intelligence reports that you cannot share are fairly useless. The ICS community is aware of this issue—the
intelligence community has the same troubles. Data that is too sensitive is often withheld from reports. There are
misconceptions about this, though; it is not usually that the data is too sensitive but instead how it was obtained. If
the sources and methods used to obtain the collected data were classified (such as the location of certain sensitive
satellites), then no matter how mundane the intelligence is, it cannot be classified below the level of the collection
source. In the ICS community, we often withhold data from each other if it can cause a compliance issue, can be
used as fodder for lawsuits by environmental groups, or in some way can be used by an adversary to identify now
known vulnerabilities in infrastructure (for example, Aurora). The community has to get better about sharing data
and this will be discussed later. For now, the focus is on understanding that you must have a way to disseminate
and integrate the intelligence produced or obtained into your defensive operations. If the intelligence cannot be
given quickly to the end consumer, then it cannot be integrated and made actionable.

Evaluation and Feedback

Evaluation and feedback are important parts of the Intelligence Life Cycle and take place at various points in the
cycle. All along the way, analysts and consumers should evaluate if the intelligence is useful and meets the
requirements. The end-consumers (final consumers or people the intelligence was intended for) should evaluate
that it met their needs. If it did not, they owe feedback on where and why the intelligence did not meet their needs.
Often forgotten, it is also incredibly important to pass positive feedback. Without reassurance that the intelligence
is good, analysts creating the intelligence will either lose sight of the mission (lose motivation) or include new
information, thinking that they might not be meeting the requirements.

© 2021 Robert M. Lee 45
Reference:
jp2_0.pdf
http://www.robertmlee.org/cyber-intelligence-part- 1-an-introduction-to-cyber-intelligence/

46 © 2021 Robert M. Lee

reas

aooer&kotke@aeoeeneenessFs F&F ® ® ®@ @&

em
“as Us ip’ Us 4s’ <p’ 4B’ «ps!

te’

Relationship of Data, Information, and Intelligence

Relationship of Data, Information, and intelligence

1
Operational | intelligence
Environment |

Collection Processing Analysis
and , and
Exploitation Production

Reference: JP 2-0

ICS515 | ICS Visibility, Detection,and Response 47

The graph in the slide, provided by the DoD's Joint Publication 2-0, shows how data collected from the "operational
environment" (or any area you are monitoring and responsible for) is collected and refined into data, information, and
ultimately intelligence. Intelligence represents a smal] amount of information from a much larger raw data set that is
produced at the end of a relatively structured and formal process. This process is the Intelligence Life Cycle (which will
be discussed in a couple of slides). But it's important to identify who is responsible for creating intelligence first.

We all have a different operational environment. From that environment we can collect a small amount of data, from
which a smaller amount of information is made, producing an even smaller amount of intelligence. We operate on the
understanding that we cannot collect it all. Therefore, intelligence can never answer yes or no questions; it can only be
assessments with varying degrees of confidence because we are always missing something.

1 explained more about this concept in a SANS DFIR blog here: https://www.sans.org/blog/data-information-and-
intelligence-why-your-threat-feed-is-likely-not-threat-intelligence/

© 2021 Robert M. Lee 47
Field of View Bias

”

Operational Environment (location of collection) and Intelligence Requirements yield a “field of view”.

Of the ~320
known targeted
cyber activity
FobasN « groups
The security firm signi LS \ worldwide, it is
collecting from Cy estimated only
customers in the tL ~60 ever
US will see VE operate in any
different data, 4 given region.
threats, etc. than ; b
the security firm
in Iran.

1CS515 | ICS Visibility, Detection, and Response

Fach person and organization has a limited field of view into threats. This is determined by the operational
environment and intelligence requirements that govern each of us. As an example, the California-based electric
utility is going to see different cyber threat activity groups than the Germany-based financial firm. This over the
years has led to a perception that security vendors play favorites to their host countries. While there may be some
of that, the reality is more centered around collection. As an example, the Russian-based antivirus company likely
sees more US and European-based threats targeting their customers in Russia and the Middle East than the US-
based security company would. Yet they report on those groups. The US-based security company likely sees
Chinese, Iranian, and Russian-based threats targeting their customers.

All intelligence firms, security companies, analysts, etc., have methods and sources of data collection that drive
how they perceive the world. This perception is not necessarily good or bad but should be considered when doing
more strategic intelligence analysis.

Now apply that to ICS. We have a huge prevention bias in the community where most of the standards,
frameworks, and regulations around the world have been focused on preventing intrusions (firewalls, segmentation,
antivirus, authentication, application whitelisting, etc.), not detecting them or responding to them. The industries
that are looking the most (e.g., US electric) are still only in the infancy of monitoring their [CS networks
proactively. Yet because they are looking, they find things. That leads to the narrative that a certain industry is
targeted more than others; when in reality sometimes it’s just that they are the ones looking. We have a very limited
understanding of the cyber threats that target ICS, but it is growing quickly. There are around 320 groups in the
world tracked at any given time carrying out cyber operations. Only about 60 of them operate in any given region
of the world. And yet we only know of less than two dozen groups specifically targeting ICS. As our views and
monitoring grows, so will our insights.

48 © 2021 Robert M. Lee

om = ny mm, @

7?

™

7” ™

™=

™ ™ ™ ™

=

=
Who Creates Intelligence?

* Tools collect raw data from various sources:
* Anetwork tap collects raw data in the form of packet captures.
° Tools or analysts can turn raw data into information:
¢ An analyst reviewing Modbus TCP can extract information about the PLCs
on the network and their normal operating behavior from collected raw data
such as packet captures.

* Atool (product, script, program, etc.) can be set to gather information from
raw data that a user defines, such as network mapping tools understanding
and interpreting network data.

« Analysts create intelligence:

* Intelligence comes from critical thinking and analysis work, combining
context, experience, and the training of the analyst.

* Tools do not create intelligence.

ICSS15 | ICS Visibility, Detection,and Response 49

Sensors collect raw data from various sources such as a network tap collecting packet captures. Tools do not
produce intelligence. There are many vendors who sell products that "produce intelligence," but this is inaccurate.
Tools can capture raw data; tools and analysts both can create information from the data based on set rules (for the
tools) or analysis (by the analysts). The final and refined version of the information—intelligence—is produced
only through analysis work combining various information sources. This final step can be done only by human
analysts. Tools can refine information, but no number of analytics or scripts will produce a proper intelligence
report that is useful to an end-customer. This is one reason that good analysts can be hard to find. It takes
experience in the field they are working in, combined with good analysis skills, to create effective intelligence.
This is also why there is no such thing as an "intelligence expert." There are intelligence professionals (paid
individuals), but they have specialties that are often very focused on where they can operate. There are also a lot of
areas they cannot operate. You cannot take an intelligence analyst trained in ICS and plug-and-play them into a
Counter Terrorism division focused on Al-Shabab terrorist cells in northern Africa. The analysis skills may be
similar, but the subject matter expertise can be extremely different.

© 2021 Robert M. Lee 49

What Is a Threat?

Threat can be established by
evaluating Capability + Intent + Capability

Opportunity

Overlap defines a defender's level of
concern (impending, potential,
insubstantial, or existing)

insubstantial

ICSS515 | ICS Visibility, Detection, and Response

Before we can talk about threat intelligence, we need to talk about what a threat is.

Threats can be established by evaluating a specific actor's capability, intent, and opportunity. By using a Venn
diagram, we can visually map potential threats and determine if they are insubstantial, impending, potential or
already exist.

For example, if a threat group has the hostile intent and capability to impact your organization, then they will
eventually find an opportunity. We can classify that actor group as an impending threat. They will research and
likely find an opportunity eventually. An organization should absolutely prioritize an impending threat and make
sure to mitigate their capability by putting defensive measures in place to counter it.

Just because a threat group does not have hostile intent toward your organization does not mean they should be
ignored. Prioritizing these threats in your organization will depend on your needs, but I would be more concerned
about a capability and opportunity that exists than I would be about a hostile threat with an opportunity but no
capability. For example, a radical activist group might have the hostile intent to stop operations. They may know
about critical systems that rely on dial-up modems and know that they should war dial those modems. However,
they do not have the capability to pull off this attack and, short of purchasing it from someone else, they are
unlikely to gain the capability. On the other hand, you know that there is a hard-coded backdoor in one of your
critical field units that is remotely accessible. There is an easy capability (the backdoor) to take advantage of that
system and there is opportunity (a remote connection). | would be more concerned about this potential threat
because you cannot be sure that you know all the threat groups out there. You may feel your threat intelligence is
good and you have a good understanding of the threat landscape. But if you've missed something, or if the
intelligence is incomplete (as even the best intelligence is) you might be completely unprepared for a new
adversary.

50 © 2021 Robert M. Lee

@

=

2

gn? @ @
Se FF © FS SF © FSF © & & 6 BS we

owe wew WB ©

es

Take a hard look at your organization and determine what opportunities exist to impact operations. Determine what
type of capabilities could be used. Then, use the known hostile threats and threat intelligence to prioritize what
issues you should address first.

Reference:
IAEA Paper.pdf

© 2021 Robert M. Lee 51
Cyber Threat Intelligence

+ Simple Cyber Threat Intelligence Definition:
- Analyzed information that meets a requirement related to adversaries that

have the intent, capability, and opportunity to do harm to you.

+ In many ways cyber threat intelligence (CTI) is simply counter-

intelligence:
* You analyze attempts by hostile forces to do you harm for the purpose of
countering those attempts in the future.
+ All CTI begins with an intrusion, an adversary attempt to compromise an
organization and all good CTI is grounded in intrusion analysis.

1CS515 | ICSVisibility, Detection, and Response

Cyber Threat Intelligence is the subject of my SANS FORS’8 course, but I will capture the key points in this
section and its relation to ICS. What is most important to understand though is that CT in many ways is just the
evolution of intrusion analysis. We analyze intrusions that adversaries conduct, their successful or failed attempts
to compromise organizations, to extract lessons learned and insights that meet customers’ requirements. That’s all
this is. Even when you look at the most high-level strategic reporting based on geopolitical strife and economics, at
its core it started somewhere with an intrusion. Analyzing individual intrusions is the core CTI skillset.

Reference:
http://www robertmlee.org/cyber-intelligence-part-5-cyber-threat-intelligence/

52 © 2021 Robert M. Lee

> > =

of fe OO OO OO OD DS

oo

@

m= mn 2 ®@

”
ew

eo &@w &© & wb & ww wwe w

oe we ww

,

So, What Do Intel Analysts Do Anywa)

Network with peers
f| to Solicit insights
fl and tips Agree ona style
it guideand
consistency ip
cominmtnication

Disseminate the
intelligence to the
customer

Capture analysis in Gather feedback to
the form the ensure you met the
customer wants | requirement

Constantly tailor
collection

Tailor the 4
Fequirement for”
Mekecone tuice future improvement

few as possible,
analytical leaps

ICS515 | ICS Visibility, Detection, and Response

Cyber threat intel analysts come in a wide range of skills but ultimately what they are trying to accomplish is
making sense out of the unknowns. Customers, internal or external, have a desire to understand some knowledge
gap or address some pain point. Those knowledge gaps or pain points turn into intelligence requirements,
sometimes not well articulated. The intelligence analyst needs to be adept at working with consumers to understand
and reshape their intelligence requirements, determining the feasibility of that requirement, and then prioritizing the
ones that need to be worked.

From there they leverage structured analytical techniques (mental models and methods such as the kill chain or
diamond model, to be discussed later) and aggressively pursue the right collection that matches the requirements.
From there they analyze intrusions, work with peers on them, and try to defeat their biases so that they don’t jump
to conclusions or fall prey to cognitive issues and logical fallacies. Ultimately, they will make some sort of
analytical leap (i.e., going one step beyond the evidence because intel isn’t fact finding it’s about discerning the
unknown) and then work to capture the analysis in some form or product that the consumer wants. That
dissemination leads to a long cycle of feedback and tailoring of requirements for the future.

© 2021 Robert M. Lee 53
What Does Threat Intelligence Look Like?

« Any product that meets the customer’s requirement:
* Can bea briefing, a report, a new detection, a playbook for an incident, ete.

+ Often delivered in the form of:
¢ Intelligence reports
+ Tactics, Techniques, and Procedures (TTPs)
+ Indicators of Compromise (OCs)

* Must be capable of being actioned:
« A TTP without a mechanism to leverage it is pointless
- An IOC without the data to search against is pointless
- Areport that isn’t going to drive change or be read is pointless

1CS515 | ICS Visibility, Detection, and Response 54

Later in the class, we look at a threat intelligence report for an ICS threat. At this point, the thing to note is that
threat intelligence is usually delivered in a report with background information and context. The report often
ch as the IP address of a known malicious website that can be used to

includes Indicators of Compromise (IOCs), su
search for the threat on the network or block it before it interacts with you. TTPs are often also put in the report if

the activity is seen as an ongoing campaign of some sort. This allows defenders to counter adversaries by tailoring
their defenses before they are attacked. It is also useful to identify adversaries already in your network.

It’s important to understand possible gaps in intelligence products: Intelligence information can be temporal in
nature, and the information can change or be altered quickly by an attacker. Also, upon public release or disclosure,
ts of an attack that remain static and

oftentimes attackers will pivot; however, there may be numerous componen'
useful for identification.

54 © 2021 Robert M. Lee

2 © © © @ @® @ &@ Ww

@

onnm fm ®

= =

<>
eae wh

=~

wwwewe we ww

wwe ww ww ww Wo W&

er

Tactics, Techniques, and Procedures

Tactics, Techniques, and Procedures (TTPs) are often clustered together
as one thing representing adversaries’ efforts; it is three abstractions

* Tactics: High-level approach to achieving the goal

* Techniques: One step down, how the goal will be achieved

* Procedures: Granular view into the steps taken to achieve the goal

. . . MITRE Enterprise ATT&CK” Framework
A focus on TTPs of adversaries is a focal point

for CTI analysts, as TTPs are not adversary-
specific; highly scalable compared to indicators

MITRE ATT&CK focuses on specific
Tactics and Techniques

ICS515 | ICS Visibility, Detection, and Response

Tactics, Techniques, and Procedures are often abbreviated as TTPs and clustered together as one thing: “The
adversary’s TTPs.” However, they represent three different aspects of adversary activity at different levels of
abstraction. Tactics are high-level methods to achieve a goal. Techniques are one step down that refer to how that
goal will be achieved. Procedures are the granular view that describes the steps taken in achieving the goal. It is an
inherently U.S. military term but provides a lot of value in the cyber threat intelligence field. As an example, many
organizations are obsessed with indicators and attribution. Very often, it takes understanding the TTPs that are most
important to understand how to defend against intrusions.

Recently, there has been a large push to the MITRE ATT&CK framework to identify common TTPs of adversaries.
This is not the first look at TTPs, but it presents a widely accepted and easy articulation of TTPs that defenders
should be aware of and plan to defend against. Specifically, ATT&CK is focused on Tactics and Techniques (not
on procedures).

It is worth noting that MITRE’s use of the word “Tactic” is incorrect in some interpretations of a military
perspective and Tactics should not represent “goals” such as “Persistence”, but the mechanism to achieve them.
One perspective is that the framework is actually just Goals and Tactics, and the sub-techniques are actually
Techniques. There are different ways to interpret TTPs, so be aware of what MITRE uses, what others use, and
how your team chooses to define them.

MITRE ATT&CK started off focused on Enterprise.

Reference:
https://attack.mitre.org/

© 2021 Robert M. Lee 55

55

Intended Audience

* The intended audience and their goals determine the type of threat
intelligence

Strategic

Operational |

Tactical

ICS5IS | ICS Visibility, Detection,and Response

To share and consume intelligence, it is important to identify the audience's needs. Are they executives who need
more strategic understanding? Or are they technical folks who need more tactical level information? Understanding
these audience types and what they need helps drive the goals of the intelligence process. Additionally, it helps
drive how the intelligence is presented and in what manner the audience needs the intelligence to be able to
consume it quickly and effectively. The three general types of audience members for threat intelligence: Strategic,
Operational, and Tactical. These three groups are not the only way to identify threat intelligence audiences but are
very useful for structuring how threat intelligence is shared and ultimately used.

Strategic Threat Intelligence can be used to brief executives and decision makers who will think and act at the
strategic level. This can include company-wide decisions, change in organization goals, locations for doing
business, resource investments such as security budget, etc.

Operational Threat Intelligence can be used for those members in the operational level, such as those who develop
and foster relationships with peers and ISACs, decide on staffing and training requirements on the security team,
track the campaigns of adversaries, etc.

Tactical Threat Intelligence is for the members who are doing the day-to-day security of the organization.
Identifying adversary TTPs, 1OCs, and other types of information that can be quickly used for security purposes are
not limited to this category but are mostly used here.

56 © 2021 Robert M. Lee

7 7 * OP OS OO SS OP OH S&S WD OD SH w

nan 2 ® @® ® @®
ry

ws ws

le

) Kill Chain - Intrusions

¢ Deterministic process
Describes stages of a single intrusion
“Compromise” is successful completion

Seven stages to defend

ICS515 | ICS Visibility, Detection, and Response

Kill Chain Overview

The Kill Chain, along with a number of other Cll models, was established in a 2011 white paper by Lockheed
Martin employees Michael Cloppert, Eric Hutchins, and Rohan Amin. It was published in a peer-reviewed
academic journal. It draws from the authors’ experiences with defending networks and their ties to the DoD and
intelligence communities.

The authors were already attempting to capture the discrete, deterministic steps network intruders needed to
execute in order to successfully steal proprietary data when they came across an element of military doctrine
known as the “Kill Chain.” The realization was immediately made that they were attempting to capture what an
intrusion Kill Chain looks like so they could interrupt it for the purposes of network defense.

Two other Kill Chains were influential in digesting and applying this technique to cyberspace: The USAF’s
F2T2EA and the U.S. military’s joint forces’ efforts to defeat Improvised Explosive Devices (IEDs).

This idea isn’t wholly new to computer intrusions. Such a multistep process is articulated in Hacking Exposed,
Volume 1, which also serves as reinforcement for the approach, although the steps described aren’t applicable to
modern intrusions and lack the deterministic element that enables the success of this model.

The Kill Chain is a seven-step process that adversaries need to execute in order to successfully accomplish their
mission. These steps are highly deterministic, which means the adversary needs to execute every step, every
time they intend to gain (or regain) entry into a network. It’s worth noting that there are exceptions, but this rule
of thumb generally holds true in modern network intrusions.

© 2021 Robert M. Lee 57
The seven steps are:

Reconnaissance and Precursors
Weaponization

Delivery

Exploitation

Installation

Command and Control (C2)
Actions on Objectives

AgauwPyyP

Because of the determinism in this model, if an adversary fails to reach the seventh stage due to countermeasures or
responses by network defenders, it means they failed in their objective and the network was successfully defended.

This is an empowering point for defenders: There are six opportunities to prevent a successful intrusion. Moreover,

much of the point of the kill chain is to have a structured analytical technique to think about and analyze intrusions.
In many ways, its power is in visualizing the full intrusion instead of one step and being able to tag data to the

appropriate step for long term analysis and querying.

To bring back a point on vernacular: A compromise is only an intrusion that reaches the seventh stage of the Kill
Chain. Next, we look at each stage of the Kill Chain, with examples and exercises for the students.

This is the “Cyber Kill Chain” as it applies to IT intrusions; later we'll discuss the ICS cyber kill chain and why it
is different. The purpose of describing the IT kill chain is to showcase what intelligence analysts are doing when
they do intrusion analysis.

58 © 2021 Robert M. Lee

® 2 © OD DH PW

o eo ) o A

fd

>
EF we ww we ww

oe F€§ © wow wow Ww ww WwW

3
=)

3
)

3

Make It Easy for Defenders

INITIAL CREDENTIAL LATERAL
ACCESS THEFT MOVEMENT Giellegs. PARSER.

e={ ROP bine force: jae pera _}: —

| ' | ——
ee eee a] AY i i
=e shee)

nun{ Weak application | fa .
ef "| Credentia vauit

sas discindary dete

Credentiisie |. i : wot ets
plinter Je | =

ove-2020472 j

The example above shows different tactics and techniques
with easy-to-follow visual cues, which can map to malware,

families that defenders might encounter
give the defender a “kill chain” like view with an

understanding of timeline

ICSSIS | ICS Visibility, Detection, and Response

Here are examples from various ransomware groups. The “kill chain” used isn’t the classic IT kill chain but that’s
not important; what is important is leveraging a model and analysis in a way that benefits defenders for the specific
challenges/requirements they have.

Remember, the intelligence output that benefits the intel analyst more than the defender is an embarrassment to our
profession. Creating intelligence that’s easily consumable to help satisfy requirements, even broad requirements
such as education of large groups of people, is a great example of intelligence. I understand that the books aren’t in
color, but as presented in the class, the colors will come through and can also be seen in the second link below. The
colors on the graph tying each family of malware to the different objectives and tactics above is a great way to
communicate to defenders what they need to be ready to deal with.

The other graphic showing Ryuk operations and how they can be done in five hours or less with what you might
expect to see is a really great way to educate people; these types of intelligence products are great to use not only in
broad education but also in tabletop exercises ahead of incidents.

This is just an example of “kill chain” like analysis and methodology. The whole point of the kill chain really is just
to put data into buckets; a mental model / structured analytical technique to leverage and analyze the various steps
of the adversary. It’s not about predicting steps or always fitting into the same model, it’s just a tool of analysis.

Reference:

https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/
https://www.helpnetsecurity.com/2020/04/30/ransomware-campaigns/
https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/

© 2021 Robert M. Lee 59

The above is a great example of part of a timeline to

89

Activity Groups

* Activity Groups are the clusters
of intrusions that meet a
requirement (i.e., Threat Group)

* The Diamond Model (right)
is used to express events
to analyze intrusions to help
analysts meet their goals

» Many ways to leverage it, an easy
way is looking for 2+ correlations

| Meta-Features
| Timestamp

| Phase

| Resutt

| Direction

| Methodology
[Resources

Adversary

Infrastructure Capability

ICS515 | [CSVisibility, Detection, and Response

Threat intelligence is represented across strategic, operational, and tactical levels. One of the easiest ways to drive
value at the strategic and tactical levels is to focus on operational level threat intelligence. It is at the operational
level that tradecraft is more apparent and can drive better security practices and response procedures. One of the
core aspects of operational threat intelligence is the tracking of Activity Groups, which are the groups of people

behind adversary events such as singular intrusions or an ad
the Activity Group is a specific clustering of intrusions that
want to track. For example, if the Capability (which could
methods) is the most important to me J would rank it “high.

b
» Infrastructure might be “medium” (you can have more

versary campaign. The easiest way to think about this is
focuses on the characteristics you care about most and
e malware or the adversary’s tradecraft like their

than one of each, so both could be “high”). The Victim might be “low” because T assess | have little insights into
victims anyway, so I don’t want to value it much. Then, if Victim changes, the Activity Group would stay the same

because it was low. If Victim and Infrastructure change,

I might decide to make a new Activity Group (or cluster of

activity). If Capability changed though, I definitely would make a new Activity Group.

The value of doing analysis like this is that you can make a clustering of activity and when you tell your defenders

to focus on “ACTIVITY GROUP1”, they know exactly wh
need to determine if it’s relevant to them (victims), what to

at you mean by that. They have all the information they

look for on the network (infrastructure), and what types

of tradecraft or malware the adversary is using. Other ways of tracking threats (like Threat Actors) don’t have that
same value as they are larger clusters tracked across time—even when tradecraft, victims, and infrastructure

change.

Correlations of specific identifiers across two or more verticals of the diamond model help define an Activity

Group. As an example, if defenders observed a very speci

fic piece of malware (capability) and it was consistently

being used across the same domains for its command and control (C2) (Infrastructure), then there would be an
Activity Group that we could define using that combination. Likewise, a very specific tradecraft (capability) for
exfiltrating out information from an environment (such as specific DNS requests combined with a specific way for
the adversary to authenticate to the command and control server) combined with specific victims (such as water
utilities) would reveal an Activity Group. Victim information also helps identify that there is a campaign, such as a
mission objective to steal industrial information out of water utilities.

60 © 2021 Robert M. Lee

>
4

This is where a lot of threat intelligence work takes place. You do not need to know all this stuff (we cover it in
SANS FORS78). However, as a Threat Intelligence Consumption analyst, you should be aware what Activity

Groups are out there, how their tradecraft could impact your organization, and how you’d defend and respond to it.

Diamond Model paper: http://www.activeresponse.org/wp-content/uploads/2013/07/diamond.pdf

© 2021 Robert M. Lee

61
Creating an Activity Group

* Six distinct steps to creating an Activity Group
Step 1: Analytical Problem (define what you want to solve, your intelligence requirement)
Step 2: Feature Selection (event features and weighting of what’s important to you)
Step 3: Creation (analyze events/ intrusions and compare against the model to cluster)
Step 4: Growth (compare new events and classify them into the Activity Group)
Step 5: Analysis (analyze the Activity Group itself to address the Analytical Problem)
Step 6: Redefinition (redefine the model as your needs change and more to new cluster)

N/A
Problem: Identify tam
unique adversary
tradecraft to create
scalable detections

Moderate:

BEEBE EE

ICS515 | ICS Visibility, Detection, and Response

There are six distinct steps in creating an activity group. Essentially, you are defining an intelligence requirement,
determining your weighting of the features you care about to solve the problem, and then analyzing intrusions
against that model to abstract out the adversary events that matter to you. In the image, the adversary feature is
weighted as not applicable to the requirement, infrastructure is weighted moderately, victims are low, and
Capability/TTPs are high. Next to it we see a mock high-level abstraction of intrusions analyzed along the kill
chain construct. There may be elements we highlight in the kill chain that are common across the intrusions (i.¢.,
clustering the intrusions based on diamond model features that we weighted). This would help us abstract the
intrusions away to a few components each that matter to us, and their meta-features to define an Activity Group
against the analytical model we’ve defined.

As intrusions are observed, so long as they match the model, we can add them to that Activity Group. If the
victimology among the intrusions is different, we may not change to another Activity Group. If the infrastructure is
similar but not identical or has similar aspects, we may keep it in the same Activity Group. But if the
Capability/TTP changes significantly, we’d likely note that there is a second Activity Group because our goal here
is to break them out into answering the problem of having scalable detections. So, we’d want the clustering of
activity to each drive to be different types of threat behavior detections. However, if the victimology and
infrastructure change, we might define that the low and moderate weighting together justifies a new Activity
Group, just like a significant change in Capability would.

One of the unintended but useful benefits of this approach is that false flag attacks (one group attempting to

convince the victim that another group attacked them) do not matter unless we weight and value the adversary
feature. [f the problem being solved isn’t related to attribution, then the “who” of the attack doesn’t matter.

62 © 2021 Robert M. Lee

oc DM © @&

ann ® © ®@ ® ®

m,

anna nm
ww ww Bw Bw Be Fe 8 OO ww

‘es w

=)

oe &

-)
=)
-)

-)

Activity Group Example: Covellite

COVELLITE

Sophisticated implant with
secure communication channels
* Similar features to malware

° Legitimate infrastructure

compromised by the used against South Korean
adversary targets
* Specific university IPs North Korean * Specific session key used for
for C2 State payload and second encrypted
Interests layer

41 minute and 30 second sleep

Electric utility companies in the
United States

ICS515 | ICS Visibility, Detection,and Response 3

Covellite was first discovered in late September 2017 targeting North American electric grid operators through
specific phishing emails. There was follow-up press coverage stating that Covellite was North Korea, and it was
targeting U.S. power companies. Covellite has specific TTPs beyond just phishing emails. The phishing emails
contain specific encoded payloads that reach out to get specific samples of malware. The theming of the emails is
generally toward the engineering side of the house, and there are clear command and control commonalities across
the infrastructure they choose.

© 2021 Robert M. Lee 63
Activity grou

There are various threat groups that
explicitly target ICS environments,
either through Stage 1 or Stage 2

intrusions across hundreds of victims.
COVELLITE CHRYSENE DYMALLOY ELECTRUM

As visibility and collection grow, there
is a growing realization at how prolific
threats against ICS are and how much
they proliferate to other industries.

MAGNALLIUM PARISITE RASPITE STIBNITE

Talonite
WASSONITE m™ XENOTIME

ALANITE HEXANE.

ICS515 | ICS Visibility, Detection, and Response

An Expanding Threat Landscape — Activity Groups

There have been adversaries targeting ICS for a long time. Back in 1998, it was revealed that as part of the Night
Dragon campaigns energy companies were being targeted in the ICS as well, although data was not available from
those environments to answer any questions. We have now started seeing a spike in threat activity and, for this
reason, it’s good to understand that the threat landscape is expanding, and defenders must deal with this
information appropriately.

The point of this slide is not to know every single Activity Group but to appreciate that these groups just represent
one company’s view into the ICS threat landscape based on limited collection. This is not representative of threats
targeting infrastructure companies. It is specifically those that have targeted the ICS of infrastructure companies.
That is a stark contrast to what has been seen before by such groups.

64 © 2021 Robert M. Lee

ao 2 ®» ® ©§ > ® © @

a mo ® ® ®

m)
CSF CS FF FF OO ww

ww ww

E)
=]
=)
=]
3
=)
eS)
5

-)

Developing Your Analyst Skills

¢ Intelligence is strictly a human process — the core skill is analysis
* Analysis skills often require nontechnical training:
* Critical Thinking is more vital than network knowledge
* Various structured analytical techniques exist to help analysts think
while avoiding biases and cognitive errors

* Psychology of Intelligence Analysis is one such book
* Chapter 8 is "Analysis of Competing Hypotheses“ (ACH)
* ACH isa process useful to any decision making—not just intelligence or threat
intelligence

1CS515 | ICS Visibility, Detection, and Response

The next two slides go over a source of information that is useful for more fully understanding intelligence
tradecraft and developing your skills. There just aren't good intelligence courses and Analyst classes available. You
have likely been to technical training before, but when was your last "analysis" class? Some of the best resources to
use are publicly available documents, even in different fields. (Analysis skills are sector neutral.)

For a course specifically on threat intelligence, see SANS FOR578 "Cyber Threat Intelligence" which I also wrote:
http://www.sans.org/course/cyber-threat-intelligence

Reference:
http://www. robertmlee.org/cyber-intelligence-part-2-developing-your-cyber-intelligence-analyst-skills/

Psychology of Intelligence Analysis

With the new analysts on my team in the government and to my students, | always recommend reading Richards J.
Heuer Jr.'s Psychology of Intelligence Analysis, which was published by the CIA in 1999. Richards has a wealth of
information in his books about how to think about intelligence and ultimately develop your own analysis skills. If
you are interested in doing more with intelligence, this is a must-read book; luckily, it is free and can be found at:

Reference:
Pyschology-of-Intelligence-Analysis.pdf

We will take a special look at Chapter 8 of this book.

© 2021 Robert M. Lee 65

65

Causal Relationship Case-Study: Illinois Water y

* The Curran-Gardner Water District in Illinois had a pump fail
* On-site personnel reviewed information and found a Russian IP .
address
* The IP address was in the logs from logging in five months previous
* The Illinois state fusion center found out about the IP address
* Issued reports cautioning about a potential Russian cyber attack
* Garnered national news as information leaked through the community
* DHS, FBI, and ICS-CERT responded
* The Causal Analysis: Because a pump failed, and a Russian IP
was found, there must be a connection
* The Facts:
* Acontractor for the integrator was asked to remote in while on
vacation
* Contractor was on vacation in Russia
¢ No one asked him before the report went out, even though his login was
associated directly with the login and Russian IP

ICS515 | ICS Visibility, Detection, and Response

There are many types of analysis. It is important to learn them if you are going to perform intelligence analysis. This
was apparent in one case in 2011...

After 2010, when Stuxnet forced many to think about ICS security, there was a lot of attention on “SCADA”
security. So, when a pump failed at an Illinois water utility and a Russian IP address showed up in the logs, folks
freaked out. The cause of the IP was a contractor logging into the system, as he was asked to do, while on vacation in
Russia. The Illinois state fusion center heard about the pump failure and thought that it must be related to the IP and
that this was a cyber-attack, even though it occurred five months after the IP appeared in the logs.

The whole case is kind of funny, but it’s also very sad and representative of how information can spiral out of
control due to bad analysis and the hype in the community.

Reference:
https://www.wired.com/201 1/1 1/water-pump-hack-mystery-solved/

Types of Analysis
When attempting to understand the analysis that individuals are performing, it's useful to understand the types of
analysis that exist. These categories help frame the discussion and categorize information in a useful way.

Descriptive analysis is simply describing the information observed in a useful way. You’re not interpreting the
information but just describing what is observed.

Exploratory is the attempt to identify relationships. Has the malware’s domain been registered by an email address?
Has that email address been used to register other domains? That is exploring the relationships and pivoting between
them.

Inferential is your efforts to extrapolate the data. For example, election polls attempt to infer from a small sample

size what the overall population is going to do in the election.

66 © 2021 Robert M. Lee

nomrimnrmn PP OP DH OD DW OD HW OY HY OHO HF ™

7
ad

oe

wy

ae

wv)
—

‘wa

‘iB’ in” ‘iB’ iB’ (By

‘ey

Causal analysis is a bit tricky in intel because we often don’t know for sure the relationships exist for any specific
reason. We as humans love drawing connections when none may exist. The next case study is an example of causal
analysis (next slide).

Mechanistic is just a discussion of specific relationships that emerge among all elements. If we pivoted off of the
domain and its email and found the email registered for the malicious domain was common among all the
malicious domains, it would be a type of mechanistic analysis.

Predictive is an attempt to predict what is going to happen in the future; this is dangerous for intel. You can

posture better, prepare better, etc., but try not to “predict” the attacks and measure yourself against them—it is hard
to measure what does not happen.

© 2021 Robert M. Lee 67
ed

w FY 8 8B OB We eee

A power outage has occurred in Calistoga. Monitoring at the SCADA control
certainly seems operational and there are no system inconsistences. The town
mayor wants to know what caused the power outage, and he believes it could be a
cyber-attack from an evil threat group. One of the engineers believes it's likely a
tree fallen on a line. However, there have been squirrel attacks in the past, and

one of the transformers might have been impacted from this.

ICS515 | CS Visibility, Detection,and Response

We see that there are multiple possibilities presented in this one scenario to identify why the power outage might
have occurred. In real-life situations, the scenarios will often be much more complex, have many variables, and
may suffer from a lack of available data. Yet ACH is often used by personnel, even when they are not actively
thinking about the process.

© 2021 Robert M. Lee 69
The ACH Process

Hypothesis — Identify all potential hypotheses

Evidence — List all evidence and arguments

Diagnostics — Use a matrix to apply evidence to the hypotheses
Refinement — Review findings, gaps, and any needed evidence
Inconsistency — Determine feasibility of hypotheses

Sensitivity - How would the hypotheses be impacted if certain key evidence
were wrong?
Conclusion and evaluation — Determine the best hypotheses

ICS515 | ICSVisibility, Detection,and Response 70

This process should seem familiar, even if you have never heard of ACH before. The formal process, though,
adds a nuance to the refinement of hypotheses and data that can help reach better conclusions and at least help
identify pitfalls that would otherwise lead to wrong conclusions.

70 © 2021 Robert M. Lee

o o>

co

=. ™,

aid

” ”,
w

Se © S§ G&G G&G GS G

S & &

Hypotheses

What caused the power outage?
H1: A cyber-attack on the SCADA control center
H2: Line break/interruption from a falling tree
H3: A squirrel jumped onto the transformer

ICS515 | ICS Visibility, Detection,and Response 71

These are the hypotheses we have presented in the scenario so far. Remember, initial hypotheses can all be wrong,
or mixtures of hypotheses can be correct—the key takeaway is having a starting place and working from there, not
over relying on initial assumptions.

Image Source:
https://c2.staticflickr.com/2/1398/840323040_189a452457.jpg

© 2021 Robert M. Lee 71
* There were no recent storms

¢ There is no abnormal network/system activity

¢ There were no recent breaches, or any threat intel reports about new
threats from E-ISAC, EU-CERT, vendors, etc.

ICS515 | ICS Visibility, Detection,and Response 7

It is useful to first identify and collect all available evidence instead of instantly using it to compare against the
hypotheses. If evidence is evaluated as it is found, it can mislead individuals or have them fall into classical
analysis traps such as confirmation bias. Collect all the evidence and look for evidence relating to all of the
hypotheses, not just the easiest to find.

72 © 2021 Robert M. Lee

own fs © © H*§ OO OPP MD O

@ @ m@ Bibel A ® cL

oO ® @®
pwww wes &

wo ww

wo ow

Diagnostics

What caused the power outage in the town?
H1: A cyber-attack on the SCADA control center
H2: Line break/interruption from a falling tree
H3: A squirrel jumped onto the transformer

E]. There were no recent storms

E2. No abnormal network or system activity detected
E3. No recent breaches or ICS-CERT data about a threat

ICS515 | ICS Visibility, Detection, and Response

In the diagnostics phase, the evidence can then be compared to the hypotheses. This is useful to identify where
there is evidence that supports a conclusion, detracts from it, or has no bearing. Here we see that there are pieces of
evidence that detract from H1 and H2, but not H3. This does not mean H3 is the right answer though. If anything,
we have determined that we do not know enough about H3's evidence.

© 2021 Robert M. Lee 73

13

* Lack of evidence is not always good evidence
* No storm doesn't mean tree didn't fall
* No network activity doesn't mean no threat

+ Evidence could be gathered by visuals

E1. There were no recent storms

°
E2. No abnormal network or system activity detected - o oO
E3. No recent breaches or reports about a threat - ° °
E4. Inspection showed no visible line breaks’ ° - °

e

E5. Inspection showed a burnt squirrel near the transformer

ICS515 | ICS Visibility, Detection,and Response

In the refinement stage of ACH, it is good to look at the lack of evidence, as well as the evidence that is currently
presented. This can help identify the need for more evidence, such as that relating to H3.

74 © 2021 Robert M. Lee

Ce |) |
wo ww w&

wo we wow ww

ws ww

.)

Inconsistency

* There have been squirrel events in the past

¢ There have been threats in the past against the grid, but there isn't a
recent conflict and we aren't at war

* All three events could occur though (no inconsistencies)

ICS515 | ICS Visibility, Detection, and Response

Post-refinement, we try to identify inconsistencies in the evidence presented. Past knowledge, information from
other sources, or physical possibilities are some of the information used to evaluate if the hypotheses are all even
possible. In this scenario, we identify that all three hypotheses are consistent with something that could have
occurred.

© 2021 Robert M. Lee 75

15

* Missed logs could reveal a breach
° Visual inspection on the wrong lines may reveal a break
° If the squirrel was very old that would be critical to the hypothesis

by Robert M. Lee and Jeff Haas

ICSS15 | ICS Visibility, Detection,and Response 76

It is good to identify evidence that is critical to a hypothesis. If the hypothesis or conclusion depends on only one or
a few pieces of evidence, then those pieces of evidence have a high sensitivity. If they turn out to be wrong, the
entire process could be corrupt. Identifying the sensitivity of data helps ensure that analysts do not focus too
heavily on data that is volatile or risky in nature. Or, if they do, that they understand the risk.

76 © 2021 Robert M. Lee

eo ® Dh DH HH HH Hh OH OO OO PE ™

nnn nn om ® ®
owe seboue

wp

os w ws

oo

we

Conclusion and Evaluation

* Because there was no competing evidence, we can evaluate
with high confidence that a squirrel damaging the
transformer resulted in a power outage to the local town.
We have examined all available evidence and, at this time,

do not believe that a cyber-attack or a falling tree were
responsible for the power outage.

ICS515 | ICS Visibility, Detection,and Response 77

The last phase of ACH is to evaluate all of the available information and draw a conclusion. Here, we note that the
squirrel likely caused the power to go out and not a cyber-attack or a falling tree. Those darn squirrels!

Importantly, note that every word in this statement is chosen with a reason. We’re trying to show anyone who
hasn’t been briefed on the event before what has happened. We’re quantifying our statement, so that people
understand why we’re saying, “high confidence” (because there is no competing evidence), and we’re explaining
what we already analyzed (cyber-attack and falling tree) in case anyone else has something new to contribute
(while avoiding someone suggesting something we already did).

Consider your writing as a cost to the reader. Every extra flowery word costs them something. Keep to the point
and speak clearly.

© 2021 Robert M. Lee 77
Lab |.2
Structured Analytical Techniques

= Calistoga Municipal

ICS515 | ICS Visibility, Detection,and Response 78

This page intentionally left blank.

78 © 2021 Robert M. Lee

°° @ © @ MW H OH HH OH OH FT PF OP ™

) ® 1D ® ® e @

aq
wo wo wb wbevsesevswy,,

ww www ow

we wewe wZJ

The ICS Cyber Kill Chain

ICS5I5 | ICS Visibility, Detection,and Response 79

This page intentionally left blank.

© 2021 Robert M. Lee

Adaptation of IT Kill Chain Needed for ICS

High confidence attacks (process manipulation or
physical damage) require intimate ICS knowledge

Understanding
potential impact
is key

IT Kill Chain does not account for the
multiple efforts of the adversary

Dwell time is significant Accidental More opportunities in
for high confidence ICS § disruption/destruction ICS to disrupt the
attacks is possible regardless attacker

ICS515 | ICS Visibility, Detection,and Response 80

There are a lot of adaptations needed in an ICS to the kill chain model. It’s a useful model to identify an
adversary’s steps in an ICS, but there are other opportunities and motivations in an ICS, such as the ability to
damage and disrupt operations. If an adversary wants to just cause disruption, they can do that by running around
scanning things and bricking devices. But if an adversary wants to be able to have a reliable attack where they
understand what will happen and reach the kinds of scenarios we are most concerned about (physical damage, long
term disruption, etc.), they will need to go through additional steps detailed in the next few slides.

80 © 2021 Robert M. Lee

7eeneeemeemeenenawmmaawaenxawmewmmnmanm

0
wo @

vo sw bb b&b b Yb

ww

“ap

ICS Cyber Kill Chain: Stage |

STAGE!
Cyber intrusion Preperation and &xecution

PLANNING Reconnaissance

PREPARATION Weaponization Targeting

Delivery
ATTEMPT
CYBER

INTRUSION Explor
SUCCESS Stage | mimics
Install/Modify targeted and structured
attack campaign.

MANAGEMENT & ENABLEMENT

SUSTAINMENT, ENTRENCHMENT
DEVELOPMENT & EXECUTION

pst Eee

Asse en se Cjbee Ril Chaie™ poe! frm Loken Havin

ICSSI5 | ICS Visibility, Detection, and Response

From what has been observed in the community, there are differences in what could be called an ICS Kill Chain
compared to what would normally be seen in IT. This is partly due to the nature of ICS networks, their unique
aspects, and the sensitivities of many of the systems. Adversaries are unlikely to perform much, if any, active
scanning and reconnaissance once inside an ICS network. Skilled and trained adversaries that are specifically
targeting ICS will attempt to avoid crashing assets and losing connection, causing an incident, or alerting defenders
to their presence on a network the attackers do not fully understand. This ICS Kill Chain is meant to describe
targeted attacks and not unintended infections. For example, the Havex malware was placed in firmware updates on
various ICS vendor websites. This represents a targeted attack and followed the ICS Kill Chain. Accidental
infections of malware, such as Conficker through poor network sanitation practices, would not be targeted.
However, adversaries wanting a level of non-attribution and ease could very well use common malware such as
ZeroAccess to act as a first stage malware. The backdoor connection opened from the environment by ZeroAccess,
in this example, could serve as a useful information-gathering tool and access point to create and deliver a tailored
capability.

The full paper is available here: https://www.sans.org/reading-room/whitepapers/ICS/industrial-control-system-
cyber-kill-chain-36297

Stage 1

Research

Some amateur adversaries might move straight to reconnaissance, but any skilled adversary will do open source
research (social media, contract announcements, procurement orders, user forums, and so on) and potentially create
a lab of their own to test out the equipment and configurations they expect to encounter. For example, adversaries
understand that many defenders use certain types of antivirus and firewalls, so testing their malware against those
ahead of time can ensure success. Furthermore, understanding how to interact with and manipulate specific ICS
protocols and assets within a set environment is critical for any targeted effect. The more targeted and more specific
the wanted impact, the more research will have to be placed into the capability. Any public Internet-facing ICS
assets can be considered as having already been a victim of reconnaissance and a significant security concern.

© 2021 Robert M. Lee 81

8)

1st Stage Delivery

In the Ist Stage Delivery, adversaries will likely use common tactics (such as phishing emails or watering holes) or
supply chain backdoors to deliver a capability. The capability can be malware, or it can simply be a backdoor that
an adversary can connect to. Many people in the industry become obsessed with determining whether the delivery
mechanism is advanced; it ultimately matters only if it is effective. The best adversaries know the minimum effort
needed to accomplish their goals.

Exploitation

The exploit then impacts the system and opetis a communication route to the adversary; exploitation is repeated as
the adversary needs more access throughout the network. As mentioned in the previous step, the exploit does not
need to be anything unique or advanced. If it works in the target environment, it is advanced enough. Advanced
adversaries are just as likely to use old exploits and malware that is obfuscated as they are to use zero-day exploits.
Where Ist Stage Delivery is concerned about getting the exploit and capability to the target system, the
Exploitation phase is concerned about ensuring the capability is successful. Supply chain backdoors are particularly
dangerous because it combines the Ist Stage Delivery and Exploitation phase, shortening the Kill Chain and giving
less opportunity for the defender to detect an adversary.

C2

At some point, the adversary will need access to the target, systems. Generally, this is an early step in the
adversary's Kill Chain and completed with the Exploitation phase. When the exploit is effective, the capability will
beacon back to the adversary by contacting a Command and Control (C2) server. Advanced adversaries often use
neutral-space C2 servers instead of directly calling back to their place of origin or true IP address. Neutral-space
C2 servers might be compromised vendor websites, universities, or ordinary looking web pages. Understanding the
outbound connections in your environment (such as odd DNS requests) is important when identifying a large set of
adversaries who use the tactic of hosting random and obviously malicious C2 servers. However, advanced
adversaries’ use of neutral-space C2s mean that it's also critical to understand the type of requests and data being
sent off your network. Traffic to Vendor X's website might be normal for your environment, but the type of data
sent (such as small payloads and encoded data) might not be normal; it might also not be normal for your HMI to
talk directly to this website.

Exfiltration

Adversaries must collect the information they need off your network. Encryption keys, network maps, project files,
data historian information, and so on, are all useful to developing a tailored capability. Adversaries often utilize the
C2 servers to connect to your environment and collect the information. The C2 server may act as a live exfiltration
spot or as a drop server. That is, the data may be going directly to the adversary or it may wait there for the
adversary to log in and collect. Exfiltration can be sent in more obvious manners (such as emails, telnet, VNC, or
RDP), but it can also be sent as harder-to-identify traffic such as encrypted data streams, encoded DNS requests, or
HTTP GET commands. Ultimately, understanding your network helps you identify what is normal on your
environment; the adversary likely will not know what normal is during this stage and will thus be highly vulnerable
to discovery here.

82 © 2021 Robert M. Lee

enn ® ® A

ron @

”
wo tJ © wo w&© Ww WW

we

a ws “we

ICS Cyber Kill Chain: Stage 2

STAGE 2
ICS Attack Development and &xecution

eceeeee
ATTACK DEVELOPMENT & TUNING 333255:

VALIDATION

ICS ATTACK

Initiating Attack MM Supporting Attack

a ees

Stage 2 shows the steps associated with a material attack that requires high confidence.

ICSSI5 | ICS Visibility, Detection, and Response

Phase Two:

Tailored Capability

With the appropriate exfiltrated data and network access adversaries, if they desire to have a physical impact or to
posture to impact the infrastructure later, they will have to create a tailored capability. Simply creating a DoS is a
sloppy and uncertain method of creating physical impacts in an environment. The more tailored a capability, the
more certain it is to have the desired impact, but the less likely it is to be useful against other targets. That is, more
specific = more impact = less targets. In this stage, adversaries will conduct research back in a mock environment,
test lab, or other areas in which the defender is unlikely to detect the research.

2nd Stage Delivery

Adversaries must deliver the tailored capability to the target environment. This can be done through the already
established C2 server or through the same method as the Ist Stage Delivery. However, it can appear entirely
unrelated. The adversary may choose another attack vector so that if the capability is detected, they do not also
alert defenders to their original access. This helps the adversary remain persistent.

Impact

At this point, it is too late for the defender to counter the adversary. This stage is when the tailored capability has its
desired impact. Likely, the tailored capability will not work perfectly regardless of the research because there are
always unknown variables, even to the adversaries. Therefore, in this stage, although the defender cannot counter
the adversary, the defender can initiate incident response procedures to ensure the safety of personnel and civilians.
Time is of the essence, and incident response is not limited to information security incident response at this point.

© 2021 Robert M. Lee 83
Steer STAGE 2

Intrusion
oO] st
e..,°0
&.

|

Internet Enterprise Network;

=

Delivery

Deliver

“oo

a

ICS Cyber Kill Chain Across the Network

This slide represents what a full kill chain might look like across the Purdue Model of an ICS. Note that it is
important to protect both the IT and OT side of the organization. Threats do not distinguish zones in the same way
defenders often draw lines. It takes full team support to win.

84 © 2021 Robert M. Lee
wo» oF Fb © & O&S OH W

vy

=)

a)

Vey

Stuxnet in the ICS Cyber Kill Chain

STAGE 1- Intrusion “Observable Steps

Reconnaissance

Weaponization

STAGE 2 — ICS Attack

Attack with Impaet

ICS5IS | ICS Visibility, Detection, and Response

The Stuxnet malware, which has been reported to have physically destroyed centrifuges at the Natanz facility in
Iran, serves as a great case study of an attack that took place over Stage 1 and Stage 2 of the ICS Cyber Kill Chain.
Stuxnet was mostly observed in 2010; however, it was a campaign that may have taken place over a number of
years, with earliest estimates around 2006 and 2007. Over that period of time, the actor went to a significant
amount of effort to create a highly targeted attack that was able to physically destroy specific centrifuges. This
intelligence-gathering period is best understood through Stage 1 of the ICS Cyber Kill Chain. The actors behind the
Stuxnet campaign may have performed reconnaissance to identify potential paths to the Natanz facility. However,
experts have speculated that there may also have been a physical component to the reconnaissance to gain such
intimate data about the facility. It is always important to consider the impact of the physical security component, as
well as geopolitical tensions. For example, the Iranian uranium enrichment program at Natanz was of significant
concern for various countries in the world, and the purpose and location of the Natanz facility was publicly leaked
by a dissident group in 2006. That, along with other noncyber data, likely significantly contributed to the actor’s
planning and reconnaissance efforts. Additionally, the Natanz facility reportedly had an air-gapped network that
did not allow for using traditional methods to compromise the ICS over network connections. Instead, it could have
been an insider threat that, knowingly or unknowingly, compromised the network through the use of an infected
engineering laptop or removable media device, such as a USB. The weaponization would have been the malware’s
code combined with the exploits that were placed onto the laptop or removable media. The removable media or
laptop then acted as the delivery mechanism to exploit the Natanz network. Then, Stuxnet installed itself on various
versions of Windows systems and repeated the exploit and install phases, compromising a number of systems until
it could activate Internet access and reach out to the attacker’s C2 servers.

This version of Stuxnet, at the time, may not have had any ICS-specific payload. The gathering of information
about the environment and exfiltration of that to the C2 servers or by other means were the material actions that
took place in the Stage 1 Act phase. Investigators believe a large amount of data was collected over many years, so
that the adversary knew the ICS and its network as well as, if not better, than the engineers and operators on-site.
During the second stage of the ICS Cyber Kill Chain, the attacker developed and tested an update to the Stuxnet

© 2021 Robert M. Lee 85

es

malware that would impact the ICS. Once the capability was ready, the attacker delivered it to Natanz. There are a
number of methods that could have been the delivery mechanism, but the engineering workstation or USB method is
the most common theory. Additionally, the attack had provisions to continually deliver and install itself throughout
the environment until it found its appropriate targets: One updated sample of Stuxnet would move throughout the
network, find older versions of the malware that did not have the newly developed ICS attack modules, and have
those older versions update to the newer version of Stuxnet. Once Stuxnet was on the correct targets, a WinCC
SIMATIC server connected to specific Siemens controllers with other specific conditions, and then performed the
Execute ICS Attack phase. The impact of this attack was the modification and manipulation of the process and
systems to force the centrifuges being controlled into physically destroying themselves.

86 © 2021 Robert M. Lee

Bay 7m ~

2

7m

7m
wo eesesoes &

=

we ws ©

FA

w

we

-)

c)

ws

Stage | ICS

aenreceeens Dtrusions Including Industrial Companies
There are intrusions that

impact every industry — eat
_ globally and as such are Some subset of those
just normal kill chain include industrial — il
intrusions. companies such as power _ A smaller subset are
| plants, manufacturing, etc. | policity targeting
_as well as other industries _ industrial companies.
and are normal intrusions. Those are Stage 1 ICS
_ Cyber Kill Chain
intrusions.

wag Targeted Towards Industrial

ae

|

|

|

|
aaa

|

L

ICS5I5 | ICS Visibility, Detection, and Response

There are intrusions happening daily at companies around the world in all industries. Of those some also include
intrusions into industrial companies across IT networks and sometimes even OT networks. But if they are not
focused on industrial companies, as an example an intrusion that hits a bank and a power company but with no
regard between the two, they are all just normal cyber kill chain focused intrusions and should be analyzed as such.
However, if there is an apparent motive by the adversary to explicitly target industrial companies, such as targeting
power companies but not hitting banks or theming phishing/domains/etc. to target those industrial companies, then
there is an assessment that the analyst makes that the adversary may intend to get into the ICS/OT networks
specifically. That then qualifies and should be tracked as a Stage 1 ICS Cyber Kill Chain intrusion and a focus
should be placed on analyzing the adversary’s efforts to get into ICS networks and disrupt them from doing so
whenever possible.

Said simply — the distinguishing factor between a normal intrusion and an ICS Cyber Kill Chain intrusion is an

assessed motive by the adversary to target industrial companies because of their industrial operations, not simply
just compromising a company that happens to have industrial networks.

© 2021 Robert M. Lee 87

87

Understand *Your* Threat Landscape

The planing tain
bo upg of syste th
euamty i miod

STAGE 2 — ICS Attack

Take intrusions your organization faces or those in your industry
Map them to the ICS Cyber Kill Chain
ode Have an Architecture, Passive Defense, and Active Defense
recommendation for each ICS Cyber Kill Chain phase
a : On some regular basis (quarterly, semiannually, annually) review
the controls and prioritize a few (e.g., 4) of the most common
You will have security controls prioritized off of your threats

ICSS15 | ICS Visibility, Detection,and Response a8

External threat intelligence teams are great about providing more visibility into the threat landscape than you can
obtain. ‘hey also have the ability to productize intelligence and make it more complete and in depth, as well as
polished and usable. However, internal threat intelligence should be a staple of any defense team. This means
learning from your threats and applying lessons learned on what you should do about them.

It is a best practice to take the intrusions you’ ve seen, or intrusions and attacks seen in your industry, and chart
them across the ICS Cyber Kill Chain. At each phase, recommend an Architecture, Passive Defense, and Active
Defense action that would have helped to prevent or mitigate the intrusion, help you to gather data, respond better,
or otherwise be enabled in defense. At the end of a quarter or year (treat this as a regular exercise with some timed
deliverable) gather all the controls across all these threats. Pick the most impactful or the ones that appear most
often across the intrusions — take the top 4 — and you’! have a few actionable recommendations to give the most
return on investment to your specific threat landscape (i.e., you’ ll identify your critical controls). Intelligence is not
about having situational awareness. It’s about understanding threat activity and what to do about it.

The Goal: Train and Prepare for Adversaries

The industrial control community, more than any other community, has a misplaced prioritization on tricks,
research papers, and vulnerabilities rather than actual threats. This has come from years of seeing the hypothetical
before realizing the real threats. This also comes from many IT security best practices being copy/pasted into
industrial automation environments without the proper tailoring or focus. As an example, how many times have we
been told that a sticky note with a password on an HMI is horrible? It’s not a best practice but if there’s no cameras
in the area, and you’re trying to identify and reduce risk to a remote adversary, then it doesn’t make any sense. The
risk is in the adversary breaking into your system and the risk is in your operator forgetting a complex password, so
instead using none or a simple password. The reality of the situation is what sounds like good logical advice is
oftentimes informed from penetration tests and theory, not adversaries.

88 © 2021 Robert M. Lee

 ® ® © ® WW ®O OH OS OC PP ™

1 @® @® @ @® @® @® eo oo @® @®
vevwv wv FB HV Ueeuevsewewy

w wow ae

Consuming Threat
Intelligence

ICS515 | ICS Visibility, Detection,and Response 89

This page intentionally left blank.

© 2021 Robert M. Lee
Generation Consumption

+ Intel Lifecycle « Used by defenders
« Kill Chain + Drives defense
* Diamond Model + (active or passive)

ICSS15 | ICS Visibility, Detection, and Response

When trying to understand the audience, it is important to remember if they are generating intelligence or
consuming it. Right now, there is little separation in the threat intelligence community with regard to the difference
between generating and using threat intel. This has led to the buzz terms "actionable intelligence" and confusion on
the role of threat intelligence analysts. As the community matures, this meaningful separation will become more
important. Organizations and teams can either focus intelligence for the purposes of actuating it or they can
produce threat intelligence. A single team may bounce back and forth between these two concepts but should not
be doing both at the same time. Analysts should focus on producing intelligence or structuring it in formats so that
security personnel can quickly use it.

Generally speaking, intelligence generation focuses on creating intelligence through the models and processes, such
as the Intelligence life cycle. Intelligence consumption is how defenders use that information. Intelligence
consumption is important because it still requires analysts who understand intelligence and who understand the
organization's environment (know thyself and know the adversary). Intelligence and the indicators it begets can be
placed into passive defenses (those that do not require direct and constant human interaction) such as firewalls,
antimalware solutions, IDS/IPS, etc., and it can be used by active defense mechanisms such as network security
monitoring analysts, malware analysts, incident responders, and teams such as security operations centers. We will
discuss threat intelligence consumption more in depth later in this section.

Note: The arrow at the bottom of the graphic is important to keep in mind. Those that consume intelligence, such as
incident responders, are some of the best to provide the data required for generating threat intelligence. It is a back-
and-forth process that requires the best out of every analyst to truly understand, learn from, and respond to
advanced adversaries.

90 © 2021 Robert M. Lee

90
<>

A

’

«<p

‘»

<p

ght Protocol

¢ Limited

distribution
on need-to-
know basis

The Traffic Light Protocol is a standard widely used in various industries inside and outside of the security

TLP Green

¢ Community
wide
distribution;
you define
community

ICSSI5 | ICS Visibility, Detection, and Response

TLP White

«No
restrictions
and can be

posted

online

community. The general premise is that Red-labeled reports should only be shared to specifically named personnel
(list the named personnel at the top of the report with the Red font and TLP: RED header). Amber is usually shared

on a need-to-know basis only to specific teams, companies, or organizations. Green indicates that the information

can be shared community wide—i.e., the entirety of the security community, but it isn't shareable in public such as
on the open Internet. White means there is no limit to where the information can be shared.

Just like government classification, TLP colors are usually assigned either on the sensitivity of the collection source

or on the level of the current threat.

TLP will often govern intelligence and information shared to you and is thus the first part of getting consumption

right: treating the intelligence appropriately.

© 2021 Robert M. Lee

91

a1

ICS Threat Intelligence Providers

- ICS threat intelligence providers are limited but often contain

invaluable data, information, and intelligence
* Be critical of the intelligence analysts’ specialties (ICS) to ensure the
intelligence can be beneficial and question intelligence’s data sources

oe a ‘ Occasional ICS Campaign a
 eadie ed ety and Malware Reports Dedicated. ICS Intelligence

Reports (Non-Dedicated) _

¢ Information Sharing Symantec « FireEye’s iSIGHT
Analysis Centers (ISACs) Kaspersky + Dragos’ ICS WorldView
+ E-ISAC TrendMicro

+ DHS “ICS-CERT” AV Vendors .
Vulnerabilities CERTs

ICS515 | ICS Visibility, Detection,and Response 2

ICS threat intelligence providers are few and far between; it is a niche area that requires a lot of data and analysis
over complex adversary events. There are some community and open accesses available to folks such as the DHS’
ICS-CERT vulnerability announcements. Vulnerability announcements are not intelligence in and of themselves,
but it can be useful to organizations (although later in the class we will talk about the deficiencies). However, it is
also useful to note that the ICS-CERT does not exist anymore. It is a brand still, but the US-CERT and ICS-CERT
have been wrapped up into a larger organization inside the DHS, and ICS is no longer their focus area. There are
also some ISACs that specialize on ICS, such as the Electric ISAC (E-ISAC). Here, be careful to note that some
organizations do really well (like the E-ISAC), and some ISACs too heavily focus on threat feeds that repackage IT
threat data to ICS providers (common practice in the FS-ISAC).

There are also other vendors that have produced ICS reports before, although it is not a dedicated focus for them.
Often, they will talk about the IT organizations of industrial companies getting targeted through the telemetry they
have through their antivirus (AV) products inside customer networks. Symantec, Kaspersky, Cylance, and other
AV vendors have published such reports before. The Symantec and Cylance reports will be reviewed at the end of
this section.

There are only two dedicated ICS Intelligence providers. Dedicated is intended to say that a product line of theirs is
dedicated to the requirements of ICS. FireEye’s iSIGHT team bought Critical Intelligence years ago and still
produces intelligence reports. Often the focus is on vulnerabilities, indicators, and scanning data on the Internet,
such as which IP addresses are commonly searching for ICS ports. The other dedicated team is Dragos, Inc.’s
intelligence team, which produces ICS WorldView.

If you use any external intelligence providers, always question their data sources and ensure the analysts working
on the intelligence product have experience analyzing ICS threats and capabilities. A threat feed is not intelligence.

And, of course, the most valuable intelligence available is in your networks against your threats. This will be
explored later in this section.

92 © 2021 Robert M. Lee

=

we @

in

2 @? @ @ @ @  @ Pf

@

ao @ @ ®@
wy wo ww w

“_>

_-

How Should Threat Intelligence be Measured?

| Complete

Sufficient detail to enable a proper response

| Accurate
A4

Accurate to reduce mistakes and increase impact

Relevant

Addresses threats relevant to an organization + delivers in a consumable manner

Timely

Delivered quickly enough to reduce dwell time or time to recovery

ICSSI5 | ICS Visibility, Detection, and Response

Threat intelligence can be a difficult thing to measure, depending on what you need out of it and the form in which
it’s delivered. However, one simple methodology that was authored by the Dragos, Inc. intelligence team in their
paper “Industrial Control Threat Intelligence” is CART, which stands for Complete, Accurate, Relevant, and
Timely. Many companies prioritize timeliness over the others, but the prioritization is actually in the right order. If
the information is incomplete, you cannot action it no matter how quickly you get it. If the information is
inaccurate, it does not matter how relevant it is to you. If the information is complete and accurate but not relevant,
it may be useful for situational awareness, but it lacks importance. Not all intelligence is the same. ICS-specific
intelligence is needed, not just rehashed financial intelligence. Timeliness always seems to be the most critical, but
how fast can you action the information? How fast do you actually need to? If you’re not in an active incident, it
may not be, and often isn’t, the most important quality. Even if you are in an active incident, getting the other three
elements wrong will cause significant trouble.

In general, if you stick to CART, you will have a great ability to measure threat intelligence.

© 2021 Robert M. Lee 93

93

What Should Threat Intelligence Do for ICS?

Do my investments match
my threat landscape and
requirements?

What do I need to focus on * Strategic analysis
to reduce risk? ¢ Org charts and budgets

(Vulnerabilities, news,
hype, adversaries, etc.)

How do I reduce mean

time to recovery? (MTTR) ° Threat model

How do I reduce dwell + Avoiding noise

time of the adversary?

(Detection)

« Adversary playbooks

° Detections

¢ Hunting hypotheses

ICSSI5 | ICS Visibility, Detection,and Response 4

What Should Threat Intelligence Do for ICS?

Once you know how to measure threat intelligence, and you know what forms it can come in (indicator feeds aren’t
intelligence), it’s important to figure out what you want the intelligence to do for your organization. This will make
sure that your overall investments are appropriate to reduce risk while enabling your security efforts.

Ultimately, intelligence on the IT side of the house is usually postured to reduce the dwell time of the adversary.
Instead of them living in your networks for hundreds of days, how about getting it down to a few hours? This
reduces the impact significantly. “Preventing a hack” is not a good requirement in general, but it is definitely not an
intelligence requirement. On the OT side of the house, it is important to reduce the mean time to recovery. How
quickly can we get operations back to where they should be no matter what happens?

Additionally, what vulnerabilities actually matter? How do | get ahead of the news-hype cycle to keep my
executives informed? How do I ensure my investments match my threat landscape and requirements? These are all

important aspects that threat intelligence should provide.

Intelligence should be one of the drivers to help you determine what you spend time on, make sure you don’t waste
your time or resources, and that you are efficient in achieving your goals.

94 © 2021 Robert M. Lee

we om @

oe

a | en ee eT

a a |

mm,
ee wa wa

An! ae

Example: ICS Vuln Patching

NEVER, NEXT, NOW

* Dragos’s Year in Review
reports reveal major
issues in ICS
vulnerabilities annually:

~35% of vulns have errors
in them

~7% of vulns matter most
~31% of vulns are irrelevant
due to lack of mitigations
~36% cause loss of view and
loss of control

ei

2020
W Never Possible Threat/No Action J Next Limited Threat) Now—tmmediate Action

ICS5IS5 | ICS Visibility, Detection, and Response

Another good example of misplaced resources is in vulnerabilities for ICS. Many of the vulnerabilities that get
prioritized and patched actually introduce little to no risk to the ICS. ‘This is not to say that vulnerabilities do not
need to be patched. It is to say that the way we handle vulnerability patching, combined with what we request be
patched as a community, often does nothing but spend precious resources.

Dale Peterson did a fantastic talk at the 2016 SANS ICS Summit where he made this point. His presentation (slides
linked below) made a couple of key points. First, is that many of the vulnerabilities released are unnecessary to an
adversary. Take, for example, a 2015 advisory on hardcoded credentials and a stack overflow on Modicon devices;
this would facilitate an attacker to upload new software to the controller. Counter to that, an adversary could just
use the intended functionality of Function Code 90 in MobusTCP to do the exact same thing. Using the
vulnerability actually introduces complexity and risk to the attacker. Patching it reduces none of the risk for the
defender yet utilizes resources. Second, he noted that many of the software components are shared among the
vendors. A vulnerability in CODESYS might be advertised out for one vendor but none of the other vendors get
that notification or the customers of that vendor. Because the software is OEM’ed, the supply chain of it is difficult
to fully map out. Third, he noted that many of the ICS software patches stop the proof-of-concept exploit code but
not the underlying vulnerability, so new exploit code can be easily written for it.

Intelligence should help prioritize which vulnerabilities matter and which ones an adversary can use to introduce
risk. Additionally, it should free up defenders with nonaction. Nonaction is a perfectly good outcome of
intelligence. It can save resources and focus on other areas such as network security monitoring to identify abuses
of systems with or without vulnerabilities.

https://dale-peterson.com/20 16/02/24/should-i-apply-security-patches-to-my-ics/
Further, Dragos’ intelligence team downloaded and reviewed all the ICS vulnerabilities. They do this every year

with lessons learned from threats, incident response, and more, as free research to the community called the “Year
in Review” reports which can be found here: https://dragos.com/year-in-review/

© 2021 Robert M. Lee 95

95

“now” instead of relying on vulnerability

One recommendation specifically is to highlight “never” “next” and
Inerabilities are those that pose real risk

scores (CVSS) which have nothing to do with the risk in ICS. Now vu
beyond native functionality in the environment and are likely to be or are
Next would be things you worry about on the next maintenance cycle or opportunity and Never would be

vulnerabilities you never really consider. This makes sure you don’t bother your operations and engineering staff

on things that don’t reduce risk.

96 © 2021 Robert M. Lee

currently being exploited by adversaries.

® ®> > ® PD hh we ww Oo wh ow

m@

i] @ o m@
Sample CTI Use-Cases

Intelligence d ‘
Reports for §_Indicatorfeed —_ICS Activity Incident oa

Situational = intoSIEM —-GroupTTPs _ Response nee

Awareness

Prioritize
what’s most
important to

your org

Understand
what's
happening
outside your
company

ICS515 | ICS Visibility, Detection, and Response

These represent some of the common ways to consume cyber threat intelligence (CTI) also known as use-cases.

Intelligence Reports for Situational Awareness:

Understanding what’s happening outside your company can help inform you on what you should be doing inside
your organization. As an example, what matters or doesn’t matter is something intel can help inform so you
prioritize the right things and resource them correctly.

Indicator feed:

Indicators of Compromise (IOCs) are used by detection tools and security analysts to identify if systems are
potentially compromised and require further investigation. Intel firms produce indicators of compromise (IOCs) to
complement contextual intelligence. The Indicators of Compromise are technical elements (IP addresses, file
hashes, domain names, registry keys, etc.) which can be used to find interesting activity on a host or network that
may require further investigation. This can be integrated into the Security Information and Event Manager (SIEM)
to help quickly scope for known threat capabilities and infrastructure.

ICS Activity Group TTPs:

Leverage the understanding of adversary TTPs to create threat detections (threat behavior analytics) so that you are
not only searching for IOCs that can easily change. TTPs are much more resilient and are not specific to any one
adversary allowing you to identify new groups as well as existing groups.

Threat hunting is the proactive search for malicious activity within network, hosts, services, and devices. Threat
hunting is a component of a mature cybersecurity practice. However, threat hunting can be expensive due to the
size of environments. Therefore, threat hunting is beyond detections, but most don’t know where to start. It’s
effective when done with knowledge of relevant threat activity to increase the chance of finding malicious activity.
Threat Intelligence provides detailed knowledge of adversary operations within ICS environments and helps threat
hunters focus their resources on known places and malicious behaviors. Simply searching for IOCs is not hunting.
Hunting would be generating hypotheses about what the adversary might be doing or where they might be located
and then testing that hypothesis.

© 2021 Robert M. Lee 97

o7

Incident Response:

Effective incident response means understanding the incident, knowing whether the adversary had gained further
access or has intent to gain further access, and scoping the incident out to other networks, assets, and environments
where adversaries may have migrated during their operations. Importantly, part of an effective incident response is
having confidence that the malicious activity was mitigated and removed — completing an incident response while
leaving access for the adversary is a waste of resources. While threat detection is necessary to successfully scope
an incident to achieve mitigation, threat intelligence is necessary as well. Threat intelligence can give you insight
into the intent/actions of the adversary based on previous activity, as well as knowledge of their operations, so that
responders can ensure they are covering known locations and behaviors the adversary may use. This increases
confidence in a complete remediation

Red Teaming:

Penetration testing or “Red Teams” use offensive security tools (OST) to test the security and integrity of
organizations and systems to determine if they are vulnerable to attack. In many cases Red Teams will use threat
intelligence to imitate specific threats or adversaries to test against specific industry threats (customers of third-
party penetration testing can also request teams imitate a certain adversary). Red teaming off of adversaries can
help ensure that the Blue team is well prepared and trained.

98 © 2021 Robert M. Lee

a]

Ps

7? 2 2 Tf m fm

7?
we ww wow ww wo wo oF FF CF DS BW

In-Class Thought Exercise
Critically Evaluating Intelligence Reports

ICS515 | ICS Visibility, Detection, and Response

Please refer to the ISO for the files referenced in the next section. The purpose of this thought exercise is not to
deeply analyze the technical data presented in each report, but to look at the report writing and the style each
vendor used. From this we can learn pros and cons of each report, which reveal lessons learned for other analysts.
What did these vendors do correctly or poorly (in your opinion) with their report-writing styles?

There are few better ways to get better at writing reports than to critically evaluate other reports. Evaluating
especially good and especially bad reports can expedite report writing and communication skills of analysts.

© 2021 Robert M. Lee 99
Symantec’s Dragonfly (1)

* Spend 10 minutes reading
* Identify things you like and do not like

Dragonfly: Cyberespionage Attacks
Against Energy Suppliers

ICS515S | ICS Visibility, Detection,and Response 100

Reference the report in your media file. If you do not have a PDF viewer, you can copy the report into your
SecurityOnion VM and open it there.

100 © 2021 Robert M. Lee

<->

>

7?

» oo om OO
Great use of timeline of the _| Failed to discuss field of view

‘. ‘ bias (where is their
be hes deals ait collection?) to determine

Concise graphics and victim |“energy” targeting
country information

Focus on tradecraft instead
of just indicators but had
tephnie) indicators at the
en

ICS515 | ICS Visibility, Detection, and Response — 0

The Symantec report was done across a large data set of infections with the Havex malware. For this reason, the
Symantec analysts had an opportunity to highlight a timeline, as well as countries they saw infections from. They
took that opportunity and did a great job with it. The report was short and to the point without overhyping anything.
It highlighted aspects of tradecraft and had useful graphics.

Some of the negatives of the report would be the fact that they did not talk to their field-of-view bias at all. The
report highlighted that 50 percent of identified targets were energy related and 30 percent were energy control
systems. However, Symantec does not seem to have visibility into the ICS and is instead talking about adversary
command and control and software targeting. More importantly, how many of their customers are energy
customers? If they have a lot of energy customers but not a lot of water customers (spoiler alert: they do), the data
set would look very biased toward energy. The report also leaves a lot of questions unanswered; however, it does a
great job of focusing people on this being energy specific. Unfortunately, we now know there were victims outside
of energy that weren’t highlighted and weren’t represented in the data set.

© 2021 Robert M. Lee 101

Norse's Iran CIB

« Spend 10 minutes reading Norse's Iran CIB Report
+ Identify things you like and do not like

ie eaH nod Rod poe mod Aa

ICS515 | ICS Visibility, Detection, and Response

Spend 10 minutes reading Norse's Iran CIB report (""Norse_JIB IRAN_01 1_JANUARY_27_201 5.pdf").

Image Reference:
https://www.aei.org/

102 © 2021 Robert M. Lee

102

oe «e

oo

eo ao om 9 8 HF OH OH OH ©

an aaa? ®
wr we wo ww we FF Bo wD BP

Iran CIB Pros and Cons

Grabbed a lot of public Criticized widely for

attention about cyber threats Misleading claims including
ie classifying Iranian IP address
scans as Iranian Government
Cyber Attacks

Did not have subject matter
expertise on the core subject
of the report (ICS/SCADA)

Grammar mistakes, PoC of
Sales, & timing concerns

ICS515 | ICS Visibility, Detection, and Response

Background:

This threat intelligence report had a bit of controversy surrounding it that is good to put into context for the purpose of
evaluating it. This also drives the point home that while we are analyzing threat intel reports, we need to view the full
picture as analysts. This report was released in Feb. 2015 as a TLP:GREEN report from Norse. Their team called
together a group of senior DOD and DHS members to brief the report to them and warn of an Iranian cyber offensive.
The report met criticism primarily because the report did not make it clear that the attribution done was based on IP
addresses alone, and that the attacks on critical infrastructure were scans against IP addresses not associated with real
infrastructure (each scan against a TCP or UDP port related to ICS was considered an attack). Following the criticism,
Norse worked with the conservative think tank AEI to release a more academic version of the data with policy
recommendations against the (at the time) Iranian nuclear negotiations. The purpose of adding this report to this
exercise is not to shame Norse or AEI. It is a perfect case study, though, to analyze the crossover of an intelligence
report into academia, and into policy recommendations where there are opportunities to learn from what occurred. The
critique of those actions provide good context for this exercise but are outside the scope of this exercise. Therefore,
references below will be placed for those interested but, for this exercise, focus on the merit of the report alone.

The Report's Pros and Cons:

Norse's Iranian report did grab a lot of public attention about cyber threats. Specifically, Iran has been a concern for
many national leaders and cyber security personnel for years now, though they are usually not seen as a top-tier player.
In this way, Norse forced some discussion about the threat and what others were observing or not observing. On the
cons aspect, though, this report gained a lot of criticism for the claims made. Norse did not do a good job of educating
the audience that the message of "Iranian government is attacking critical infrastructure" was an analysis of Iranian IP
addresses scanning or performing reconnaissance against unregistered IP addresses. The two key things that Norse
could have done better was have someone familiar with Iranian intelligence operations (or at least an intelligence
analyst) write the report in conjunction with someone who had ICS expertise (for those unfamiliar with ICS, some of
the systems listed did not make sense in the analysis, including the use of the DNP3 protocol as "an ICS" and the
discussion of events such as web defacement in relation to ICS where it wouldn't matter or be related).

© 2021 Robert M. Lee 103

tox

The authors of this report had neither and it showed in some of the analysis. Another mis-step is that the report had
multiple mistakes and came at a sensitive time in Iranian nuclear negotiations. Why is this such an issue? Mistakes
included grammar, the chart that shows "Jan 15 — Dec 15", capitalizing words differently throughout the report,
using hashtags and acronyms where they didn't make sense, etc. Why so much focus on that? Because these
oversights make it appear that the report did not go through a full intelligence life cycle-and that it appears to be
rushed. Intelligence can never look rushed as it devalues the intelligence. A full intelligence life cycle should
always have personnel catching the small mistakes as they read over and cross analyze the report.

This is not meant to bash Norse though. Every company makes mis-steps; it's important to learn from them.

Reference:
https://www.nytimes.com/2015/04/16/world/middleeast/iran-is-raising-sophistication-and-frequency-of-
cyberattacks-study-says.html

https://www.csmonitor.com/World/Passcode/Passcode-V oices/20 1 5/041 7/Opinion-Security-firm-s-Iran-report-
mostly-hype

https://www.aei.org/research-products/report/growing-cyberthreat-from-iran/
https://www.thedailybeast.com/the-overhyping-of-irans-cyberarmy

104 © 2021 Robert M. Lee

2

@>

@ ® ® ® ®@ ® ®

oO @®

na Qg @& @ @ WM PR Oo OO
oo Ww WD

we ww

Tr

ay

w

Dragos’ CRASHOVERRIDE Report

¢ Spend 10 minutes reading
* Identify things you like and do not like

CRASHOVERRIDE

Analysis of the Threat
to Electric Grid Operations

ICS515 | ICS Visibility, Detection,and Response 10s

This page intentionally left blank.

© 2021 Robert M. Lee 105
ragos’ CRASHOVERRID

Educational-based approach

* to inform those not familiar

with electric grid operations
what that | like and why
this matters

Focused on tradecraft
primarily but included
technical indicators

Noted why it was being
pee and highlighted .
ey takeaways

Could have included timing
information related to the
indicators because many
indicators related to IP
addresses and domains have
a temporal nature

ICS5I5 | ICS Visibility, Detection, and Response _ 106

Dragos, Inc. published on the fourth-ever ICS tailored malware (CRASHOVERRIDE). Following their standard
approach, they did not publish their findings until the information was already public (ESET published a public report
and Dragos then had their public report ready to go and published a few hours later). Right up front, the Dragos report
does a good job of identifying why this is being published and gives credit to the other researchers at ESET. They also
give key takeaways, focus on tradecraft, and post key indicators across the ICS Cyber Kill Chain so defenders can
leverage the right indicator for the right query. The report also understands that ICS may be weird to a lot of people and,
even in the ICS community, electric grid operations may not be common knowledge, so the report takes an educational-
based approach to the other ICS malware, electric grid operations, and why people should care about this.

The report, however, does not give timing information related to the indicators. Even though this may seem apparent as
it was a single attack and not a wave of malware infections; indicators should contain information around the time such
as when IP addresses or domains were observed to be malicious.

106

© 2021 Robert M. Lee

-™

eons na rn ff @& @ @2 2

oo mm

Bod]
Cow we we we we ww WD

ap as oT) we ww

Public Reports vs. Intelligence Reports

DRAGS. incigece

¢ Public reports don’t have the luxury of ;
having few intelligence requirements THREAT INTELLIGENCE SUNN ARY
(wide audience = many different
requirements) Ieee

* Most public reports tend to be book report z = :

2 HEXANE Activity Group Maliciou

sande

style or threat compendiums
* Intelligence reports are more focused
and often shorter
* Often trying to satisfy 1-2 intelligence
requirements
* Focused to one type of audience

ICS515 | ICS Visibility, Detection, and Response 107

Good intelligence reports are much different from public reports which tend to have to speak to a wide audience
with no expectation of previous familiarity with the topic. Also, especially in ICS, public reports are very quickly
picked up by the media and others, not just tactical level defenders. Private intel reports are often much more
nuanced and attempt to satisfy less requirements, which allows them to be more focused.

A sample intelligence report from Dragos is in the media file. This is provided just as an example of how private
intelligence reports often differ from public reports.

Reference:
Hexane.pdf

© 2021 Robert M. Lee 107
The ICS Cyber Threat
Landscape

ICSS515 | ICS Visibility, Detection,and Response 108

This page intentionally left blank.

108 © 2021 Robert M. Lee

ooo @o 7 © © 8 OO OO OC Of OO Of

oe oe Oo @

o Oo

oo
wo ww wo ww wo ww wo wo wo wo we we OD ww Ww

wz?

Hyped Up Stories

* Every year there are claims of ICS
focused cyber-attacks; very often they
are inaccurate

1982 Trans-Siberian Pipeline
Illinois Water Hack
Chattanooga APT

BTC Pipeline
Norse Iran Bulletin

2014 Turkey power outage
2020 Indian power outage

* To understand the real threat
landscape, we must avoid the hype

ICS515 | ICS Visibility, Detection, and Response

Every year there are numerous stories that are largely just made up; many folks jump to conclusions and assume
every explosion is the result of an ICS cyber-attack. ‘There have been many throughout history, but one good one to
highlight is the BTC pipeline.

The BTC Pipeline:

According to Bloomberg news media, the BTC pipeline explosion was a result of a cyber-attack. Apparently, two
men in black uniforms without insignia were seen poking around the pipeline. Days later, adversaries broke in via
Internet-connected surveillance equipment. But the break-in wasn’t user/passwords, it was a technical exploit
against the camera systems utilizing vulnerabilities in the software. From there, they pivoted into the control center,
down to the “valve stations” (likely compressor stations), disabled alerting, over-pressurized the pipeline, and then
erased the camera footage and blocked the satellite signals to the control center, resulting in an unexpected
explosion. The attribution to Russia was through “anonymous U.S. intelligence officials.”

Image Reference: Bloomberg
Citation: https://www.bloomberg.com/news/articles/2014-12-10/mysterious-08-turkey-pipeline-blast-opened-new-
cyberwar

The Facts

The story was immediately challenged by me, and then other members in the community (such as Dale Peterson)
quickly identified flaws in the reporting. I wrote a paper with Michael Assante and Tim Conway on it here:
https://ics.sans.org/media/Media-report-of-the-BTC-pipeline-Cyber-Attack.pdf

Basically, not much of the story makes sense. If there were technical vulnerabilities in the camera system allowing
remote access, why would you need two guys in black uniforms along the pipeline? Also, satellite jamming is an
exceptionally risky procedure as it violates many international treaties. More importantly, the control center would
have immediately been notified about a block in the satellite signals, which would have alerted them before the
pipeline explosion. Also, the journalists stated that this attack was a “watershed” moment for the U.S. intelligence
community.

© 2021 Robert M. Lee 109

109

Except, I worked ICS in the U.S. intelligence community and have sought clearance to say the following: There
was no watershed moment regarding this “attack” and there was a CYBERCOM briefing at the time wondering if
there was a cyber element, but it was concluded that there was not.

More importantly, the burden of proof is not on us; the burden of proof is on the reporters to prove this claim.
There was never any tangible evidence presented.

A final nail in this story was placed when a reporter uncovered that the camera system was not installed until after
the attack; it couldn’t have been the initial attack vector.

Reference:

https://ics.sans.org/blog/201 5/06/19/closing-the-case-on-the-reported-2008-russian-cyber-attack-on-the-btc-
pipeline

110 © 2021 Robert M. Lee

we JT FT FT BG BW wv

ws ww

_

Attack Difficulty

| &xtremeiys |
\ Diricur °F

ICSSI5 | ICS Visibility, Detection, and Response

Ultimately, it is very difficult to perform high confidence process effects. As an example, for an adversary to
cripple an ICS and cause manipulation of the process that leads to an effect such as physical damage, they must
have intimate knowledge of the ICS, its networks, its safety instrumented systems, hardware failovers, and more. It
is not a trivial task, whereas compromising ICS security is a trivial task—finding unauthenticated connections into
various ICS networks, as an example, can be done by most teams around the world. The attacks we are most
concerned about as defenders are those high confidence process attacks, which are the easiest to defend against and
give defenders the most time to identify the adversary internal to the network. It’s important to protect against all
breaches of security, but there are aspects of defense where we have an upper hand in the ICS community.

But having a wide-open information attack space can lead to compromising ICS security being a trivial act.

© 2021 Robert M. Lee 111
Threat Pool (Continued Growth in Two Dimensions)

a
ICS Capable

Threat Actor Pool IT Attacks

(ICS Specific That Can
Attacks) Impact ICS

%

Actors, Tools, &
§ Skills Increasing

ICS5I5 | ICS Visibility, Detection, and Response

I call this the Sunny Side Up Egg of Doom slide. It's less dramatic than that. A threat pool can be thought of as the
various threat actors or groups (the adversaries or bad guys) and their capabilities for impacting on your
organization. In this example, you'll see the ICS Capable Threat Actor Pool as the red circle. This represents the
number of threat actors out there that are capable of conducting ICS-specific attacks. The yellow shape represents
the number of IT attacks that can impact your ICS. As the threat groups continue to grow in number and capability,
we will continue to see more ICS-related attacks. As ICS facilities continue to become more interconnected and
reliant on IT, we will continue to see an increase in the number of tools and types of research that are useful for
impacting ICS operations through IT attacks.

In general, the threat landscape for ICS is continually increasing. Threat actors are becoming more interested in
ICS, and they are becoming more capable. New tools and research supports their desires to impact operations or
perform economic espionage. Many of the attacks we have seen, and will continue to see, leverage every piece of
infrastructure. ICS threat actors do not look at an IT system and think to themselves, "Darn, it's a Windows 98
computer. I only know how to attack ICS. If only that were a PLC." Threat actors and various threat groups will
use the tools and skills required to complete their mission. Be aware of what your threat landscape is but know that
it is constantly evolving and will increase if not mitigated.

ICS Versus IT Threat Landscape

When determining the threat landscape and identifying vulnerabilities in an organization between the corporate and
ICS environments, be sure to not throw out lessons learned. The high-value IT community (systems that need
99.999 percent up time and reliability such as banking transaction systems) shares a lot in common with the ICS
community. To the high-value IT community, there is not a debate over which is more important in the CIA triad; it
understands that it needs availability, confidentiality, and integrity of its data. It cannot afford system failures and
must be ever vigilant for threat groups so that it can counter threats before they impact operations. ICS
environments are similar to this type of mindset. For this reason, be in constant communication with your corporate
and enterprise network security counterparts. They likely understand their threat landscape and likely have lessons

112 © 2021 Robert M. Lee

12

oT 8 D7 OH OH Hh Hh DH OF &

7, , /  (

a
wow wT wo wo ww

__»

— -

ig”

learned that they can share about protecting against certain types of attacks. If they do not have this understanding,
educating them and offering support will result in better security for you. Many threat groups have been observed

compromising corporate environments as an access point into ICS environments. Better security for others is better
security for you.

¢  High-value IT and ICS share a lot in common:
¢ High-value IT cannot just stop operations for incidents
° Both value all aspects of security
° — Lessons to be learned from IT:
° Best practices, procedures, etc. as a starting point
° ICS trends of Internet-facing touch points
° Threat actors IT has been dealing with are surfacing in ICS

© 2021 Robert M. Lee 113
Common ICS Attack Resources and Vectors

Poorly
‘ Maintained
© Supply Chain Assets

Vendor.
Connections

ie Remote Ops
\ Connections

ICS515 | ICS Visibility, Detection,and Response 114

This lists represents some of the common ICS attack resources and attack vectors.

Enterprise Networks

As mentioned earlier, many threat groups will pivot through enterprise networks to gain access to ICS networks.
If you want the enterprise network to be considered in your threat landscape, you need to evaluate the
vulnerabilities and interconnections to these networks. Its threats are quickly made your threats.

Remote Connections

Remote connections make for a good day for the adversary. VNC and RDP are two of the most widely abused
methods to gain access to information systems. If you need to have remote connections to your ICS network,
make sure they have strong authentication, ask architecture teams if they can place it and any other remote
connections into as few DMZs to monitor as possible, and shut off anything that you do not actually use. Is telnet
or FTP enabled on your device? Is it critical to operations? If not, turn it off. If you cannot disable it, use DMZs to
limit access to it.

Vendor Connections

Remote maintenance and monitoring can be essential to operations. Treat these like any other remote connection,
though, and make sure they pass through DMZs or other chokepoints, and that access to them is validated with
secure authentication practices.

Privileged Users

Administrators and other privileged users on the network are often prized targets for adversaries. Being aware of
all the administrators that should be registered on the network is a good way to start understanding your threat
landscape. If new administrators register, or if their accounts are accessed at odd hours when no one else is
working, there are potentially malicious actors on your network.

114 © 2021 Robert M. Lee

eo eo DH wh wm

oT

| a | |

a
ww ww ww wa w w

ae

Employees

Employees are important; they make the organization run. However, almost every security person knows that
employees are one of the greatest vulnerabilities to a network. Those of us who have worked in IT are familiar with
the concept of a Layer 8 issue and PEBKAC. When employees post on user forums, they may reveal information to
adversaries. As we discussed earlier, if an employee is bragging about a new installation of equipment, that can be
used by the adversary to profile your organization and develop capabilities unique to your environment. When
employees click suspicious links and emails, they are a direct vulnerability to your network.

Hardware and Software Supply Chain

Unfortunately, there is not much available in terms of reducing the threat landscape for hardware and software. If a
nation-state threat group compromises the code on the routers you buy before they are installed in your
organization, that's a hard threat to stop. Your best bet is identifying those adversaries after they enter your
network. However, undocumented equipment shouldn't exist on your network. If there's something on your
network, find out what it is and why it is there. If you are downloading software or firmware updates remotely, be
sure to compare the digital hash given of the software to the digital hash you take of it before you install it.
Reducing this threat landscape can be difficult, but it is doable. Take proper precautions and never purchase
equipment from less-than-legitimate sources. For example, one facility in Europe was undergoing renovations to its
network infrastructure. A certain Far East country offered to pay for all the network infrastructure if the automation
facility would use the routers provided. Unfortunately, the automation facility agreed because it drastically reduced
its budget costs. Two years after everything was complete, there was a massive IP theft from the organization. The
incident response team tracked back the initial attack point. Where was it? Backdoors found in the routers. Be
careful.

Poorly Maintained Assets

When there is a patch for hardware and software, the systems need to be updated as soon as possible. When
systems cannot be taken down to update, or if the maintenance period is months away, it's important to work with
the architecture team to adapt the infrastructure so that these assets can be further protected and monitored until the
patches are in place. Adversaries should not be able to use well-known exploits to compromise infrastructure. In
addition, a firewall that does not have its ACLs and rules properly configured is not a firewall; it is just a router.
Properly maintained infrastructure will always help mitigate your threat landscape.

ICS Attack Paths

This slide serves as a description of the illustration on the previous slide. Think of all the things your ICS depends
on: hardware, software, interconnected networks, remote connectivity, wireless, handheld devices, and more. With
the proper mindset of what can be used to attack your ICS, you can take steps to reduce these attack paths.
Reducing attack paths and vulnerabilities in your organization can help reduce your threat landscape. As attackers
lose options, the defenders win. Sneaker-net and hardware backdoors have been a common example in the industry
of favorite attack vectors. Dirty USBs or infected laptops have done a lot of damage in ICS facilities. As threat
groups become more skilled, though, we will see more and more threats originate from external networks.

ICS Attack Trends

There are not many public examples of ICS-specific attacks. Two of the best examples are Havex and Stuxnet.
Even related attacks such as DuQu and Flame did not actually cause any damage to or infect ICS. However,
through threat intelligence research (often takes place with Honeypot research) and firsthand knowledge of other
nonpublic incidents in the industry, we all know that there are definite trends and that the threats are real.

Air-gap jumping malware is a common capability employed now either intentionally or unintentionally through
USBs and laptops. Attacks that have manipulated-specific protocols have been shown to be effective. Adam Crain
and Chris Sistrunk have done great research on the capabilities of crashing master stations from remote sites
through DNP3. Exploit tools found specifically targeting ICS facilities have been observed heavily in honeypot
research. Process-focused effects have been observed in a few incidents in which attackers have wanted specific
outcomes.

© 2021 Robert M. Lee 115
Firmware manipulations were observed both in honeypot research (Kaspersky Labs showcased this as well), and
the manipulation of firmware updates was observed in Havex. A few nonpublic incidents have found that
adversaries deleted important operations data on the network after gaining access.

Attack trends are useful in understanding the threat landscape. We all know there are threats, but what do we do to
actually reduce these attack paths? The next set of slides will guide you through the process.

116 © 2021 Robert M. Lee

oO oO WD OD ®&

om DP OD WH wh

- © @ @ © OO OO OO OD ®

om
ww ww we ay Ww A ee iw a en At a

au aw au aw

aw

The Information Attack Space

* Every organization has an information attack space
* Information attack space is the “opportunity” in the Threat category
* Common aspects for ICS include:

* Publicly searchable information such as new projects and mergers

° Internet-connected control systems

* Users posting externally on social media and job sites
Reducing the information attack space (or at least being aware of it)
helps drive how security must be done at the organization

* Adversaries utilize the information attack space to determine how they will
target ICS facilities

ICS515 | ICS Visibility, Detection, and Response

Every organization has an information attack space. There’s nothing wrong in this. However, it is important to
know what your information attack space looks like. Attackers don’t usually have the expertise of your
organization and systems, so they have to gather that somehow. If they want to target you, what they find in your
information attack space will drive what their operations look like - at least at first.

Consider an organization that has nothing about them online except an article talking about a new dam they’re
building, and the integration company involved. Targeting the infrastructure site or the integration company itself

may be a good way for the adversary to learn about the organization.

Information attack space most directly maps to the “Opportunity” portion of a Threat (Intent, Opportunity, and
Capability).

© 2021 Robert M. Lee 117
es

Lab |.3
ICS Information Attack Surface

1€$515 | ICS Visibility, Detection, and Response = 118

This page intentionally left blank.

118 © 2021 Robert M. Lee
sv we we ww we wwe as ws wT wo ww WwW

aa aw a

ay au

ay

Thought Exercise: The ICS Information
Attack Surface

ICS515 | ICS Visibility, Detection,and Response 11?

Now that we know what intelligence is, and we have an understanding of the fundamentals of intelligence
tradecraft, it is time to examine what an ICS Information Attack Surface is. In Section 2, we’ll discuss the LCS
Threat Landscape, which is a broader context; in this section, the focus is specifically on the information available
about you that adversaries can harvest and use against you.

© 2021 Robert M. Lee 119
Sources of Open Source Information

* The ICS community often puts out a significant amount of
information that aids novice and advanced attackers. Example

sources of open source information to be aware of:
Public Relations (PR) Documents
Partnership Announcements

Company Information

Job Descriptions
Advisories and Alerts
Internet-Connected Devices
Exploit Databases

User Forums

1CS515 | ICS Visibility, Detection, and Response

The ICS community puts out a significant amount of information about jobs, projects, facilities, and more. None of
this is bad. It’s just important to understand what information is out there about your facility, your people, etc.
Adversaries do not necessarily know anything about your facility—in the beginning, they definitely do not. They
have to get information about you in some way. Initially, that is usually through OSINT and in exploring what is
out there about you—your information attack space.

In the following slides, we look at some of these sources of information while showing some examples.

120 © 2021 Robert M. Lee

i20

*

wo Pb

Tf OO OW HY OH OH W

aoe oo @ Oe oe Oe oO OD MD

ao
woo OP oe wD wo DO Hw

wo © ww © W@W WwW WwW WwW Ww WH we wW

&

Information Attack Surface Demonstration

¢ To visualize the Information Attack Surface of organizations:
* The next slides are presented to evaluate different sources of information
* Demonstrates how they can be used by an adversary for evil or by a defender
to help encourage better practices

° We examine from the stance of a non-ICS-trained attacker:

PR documents: Brazil 2016 Olympics

Partnership announcements: Beer company

Job descriptions and company information: Oil refinery
Advisories and alerts: ICS-CERT

Tailored searches: VSAT vendor

ICS5I5 | ICS Visibility, Detection, and Response

Over the next few slides, we visualize the Information Attack Surface of real organizations. The Attack Surface is
harvested using the various types of documents discussed (such as PR documents), but each collection of
documents and information will be about different organizations. The reason for this is that it would be
irresponsible to gather a collection of information about a single organization. The information is all publicly
available, but it would present a close and personal look at that organization. Because the emphasis of this lesson is
not about shaming people and the information they put out there (some of the information is unavoidably
displayed), but instead on understanding the Attack Surface, this approach has been taken. Realize, though, that if
this quick action would be taken against a single organization and show more than just one sample of each type of
information, a really powerful picture could be captured about the organization—all without ever exploiting them
or interacting with the organization at all.

This is a fake adversary scenario, but it uses real information from different groups.

© 2021 Robert M. Lee 121

121

¢ PR documents are usually put out regarding new endeavors,
projects, large purchases, etc. to inform the public while also
promoting the value of the organization

¢ Attackers can find value in PR documents such as:

¢ New project and company endeavors that may be of interest

¢ Timelines and expectations for development or system purchases

° Specific system information from designs or promotional photographs

* Contact information including emails and websites that can be used for
targeting directly or creating customized phishing emails

ICS515 | ICSVisibility, Detection,and Response 122

Companies often put out PR documents to advertise a new endeavor or project they are undertaking. These types of
documents are sometimes web pages, but almost always include some type of PowerPoint, PDF, or Word
document. Therefore, a lot of PR documents can be found by searching the target with certain Google strings.

122 © 2021 Robert M. Lee

i o) wo

om BH

7 DD ® WW

oo @m

Oo @ wn m@ @® m® cl

@

Ot ] m@ m
Oo oP wD wo OD wD wD WW

wo Ww Ww Wh

aw au aw 40 wy 4 au

EU

ICS515 | ICS Visibility, Detection,and Response 123

The Rio Operations Center is one target that adversaries might be interested in if they are researching the 2016 Rio
Olympics. This would be a great target for spying on or causing damage to the international community. This
document showcasing the operations center was a PR document about the video streaming software and hardware
installed. It was found using a novice search on Google for Rio Olympics SCADA filetype:PDF.

© 2021 Robert M. Lee 123
med by means of the remote -
| capture application eTool Wall software from . a
Mauell’s ME Multiview € Tool Suite. A server applica-
} tion is installed on the workstation to be captured and
the client application is executed on the video wall, | y 7
displaying the captured images on its surface This op- i s
tion is suitable, for graphs, SCADA screens and text. It’s ~ ‘
not suitable for full motion video.

‘The item b} is a pure streaming video displaying, :
which can be performed on the Video Wall by a gene- a

X omnium is a completely yased solution, allowing to .
service contents Cheah ne Na distays or | 2
logical arrangements of displays, which canconsistofLCD |}

modules or rear-projection cubes. The video wall contents

can be managed and controlled from one or several distri-

buted client applications. © Bae Seve a
‘The main content can be described as following: | al

\ IP Cameras and streaming video
i.

Screen Cal - ure over TCH/IP
Web-base: =pp ications a

ICS515 | ICS Visibility, Detection,and Response 124

Inside the document, there was a host of information. (This was only one PR document about seemingly unrelated-

to-security information.) The PR document revealed some basic but useful information about the type of software €
and hardware the video software uses. The diagram also shows the type of switches being used at the facility. This

is useful for adversaries to prepare their training or exploits for that type of infrastructure. In addition, this

information reveals that there are remote IP-connected cameras streaming videos as well as screen captures over é
TCP/IP applications. Finding these types of systems in Rio through other Google or Shodan searches could reveal a

great and unmonitored attack vector into the Operations Center.

o

>

>

>

124 © 2021 Robert M. Lee
ae

w ww

we w

b

ay

Zi

@

ay

Ww

Partnership Announcements

* Partnership announcements often occur with new deals to promote companies.
These announcements reveal key deals and additional organizations that an
organization trusts and does business with

¢ This information can bring value to attackers in:
Exposing trust partners that can be exploited to pivot into your networks,
emails, supply chain, etc.

Specific types and versions of systems that an organization uses
Potential physical or logical layouts of ICS networks and facilities
Frequency bands used for VSAT connections to remote facilities

ICS515 | ICS Visibility, Detection, and Response 125

Companies engaging in partnerships also like to put out PR documents. It is worth noting this as a unique category
of information compared to PR documents, though. These partnership announcements usually indicate new
directions and projects at a company while also informing adversaries of likely connected communications (at least
through email and maybe through network sharing or VPN services). This means that the exploitation of either
company will likely lead to an ability to exploit and infiltrate the other company. These types of announcements
also hold a lot of value to increasing stockholder confidence, so they usually showcase new hardware and software.

© 2021 Robert M. Lee 1265
Fully Automated Brewin

Our scope of supply

+ Design of the hard- and software concept
according to ambev standard

Design of the electrical diagram
with ePLAN P8

Delivery and installation of
MCC-cabinets and field panels

Delivery and installation of server cabinets
and operator stations

Programming of process ~ software
Rockwell Automation — RSLogix V19.

Programming of SCADA/HMI-system
GE iFix, GE Historian

Software FAT with the customer

Electrical supervising on site

Commissioning - training of operators and

maintenance personnel

g Control System for an Emergent Beer and Country

Automation concept

-» Ethernet bus m (Fiber Of
Iv ‘Oo iL
palin mal

Managed switch Cisco and AB Stratix 8000

Scada system: server ~ client, terminal services from Microsoft with remote sessions clients),

2x 24” Monitor Client, ix 40” TV-Client (wall mounted)

Genie Elects GE IFix Scada Siler with 3 servers
(Jerminalserv' cadaserver ‘orlal
AllenBrad} trol Logix PLC with remote Flex-1/0's in Ethernet/IP

Remote Festo-valve blocks with Ethernet/IP connection

Danfoss drives with Ethernet/IP connection

Integrated and networked UPS-supply for servers and dlients

ICS515 | ICSVisibility, Detection, and Response — 126

This partnership document announced a fully automated brewing control system. This system was being installed

to support the Rio Olym
production—but this is just an examp
actual power grid in Rio but thought i

pics. Granted, we would hope no adversary would stoop so low as to affect beer
le of the type of information out there. I found related documents for the
t would be more responsible to showcase a beer facility.

In this document, we see that they have outlined the entire scope of the project, including what type of process

software (and version) the:
SCADA server, and more. The on’

126

y will be using—the types of connections, the structure of the network, the type of
ly thing they did not do here was show the actual layout of the network.

© 2021 Robert M. Lee

» ® ® DD WD WwW OW WOW OH OH wo

m,

nm & @

Oo
wy

rn n,n ed

mo wm @& wy wo YT WW WO W WO W

PO}

ICS515 | ICS Visibility, Detection,and Response 127

Luckily for the adversary, though, in the same PDF document (found in the same Google search as the Rio
Operations Center), they do show the layout of the network. The layout includes PLC types, switches, and the IP-
connected printers (a favorite of adversaries).

This image has intentionally been reduced in quality; it is shown as an instructional aid only. Additionally, the
blacked out areas on this and the next slide were put in place by SANS.

© 2021 Robert M. Lee 127
1CS515 | ICS Visibility, Detection, and Response

A zoomed-in look at the documents reveal the infrastructure and its default IP addresses. It is unlikely that these IP
addresses have been changed, and thus, most of the adversaries’ intelligence-gathering efforts have been done for
them. Again, this is simply a beer facility, but it might surprise you how many of these documents are out there,
including the exact specification as well as vendor hardcoded passwords for a variety of critical infrastructure sites.

128 © 2021 Robert M. Lee

oe

™> ™m ™ ™

™,

> ™-
St i er a a a ad

U

we wewvweyVvwvewvVvwVv wv wVwwwiw s.

ay

Company Information and Websites

Most companies have corporate websites that contain information about the company
such as contact information, locations, and partners

Many larger ICS facilities (especially those that are critical infrastructure) also have
Wikipedia pages and other publicly available information that is not directly controlled
by the organization

Company/facility information and websites can:

Yield IP addresses of the company's corporate web server, which can be targeted and is often
connected (even if through multiple zones) to the ICS

History and accompanying information for better phishing emails

Previous incidents, lawsuits, or incidents that reveal weak spots

Email addresses and names of key personnel

ICS5I5 | ICS Visibility, Detection, and Response 129

After the adversary has discovered a potential target and gathered information such as those presented in the
previous slides, it is important to find access points to the network. Corporate networks are often connected in some
way to ICS networks, whether it is with direct VPNs, through data historians, business applications, web mail
servers, DNS, or even just email communications back and forth. Compromising these websites is often a favorite
way for adversaries to pivot into the ICS network. If the adversary is discovered before getting to the ICS network,
it is unlikely it will make headlines or be met with any serious incident response effort—it has a low risk/attribution
for the adversary early on.

© 2021 Robert M. Lee 129
MMMM Refinery

From Wikipedia, the free encyclopedia

The IEE efinery is the largest oil refinery in RRM ¢ is located about 7 mi (11 km) south off
bccn BR 1: MS The Project was overseen by

feet G lao and a leader in his own right in the ail refinery design and innovation. Itis the fou
refinery supplies about 20% of the gasoline in ace i

The plant was constructed in ith an original capacity of about 100,000 barrels (16,000 m3). It currently

90% becoming gasoline, diesel or jet fuel." The facility is owned by

south offend 8 mi (13 km) northwest of MME a few miles south of

a wholly owned subsidiary of the

it currently processes over 223,009 barrels (35 800. m?) of petroleurn crude oil) per day with

Itis the fourth largest refinery on

ICS515 | ICS Visibility, Detection, and Response

Adversaries wanting to pick out targets may resort to simple searches on Google looking for things they are
interested in. For example, this Wikipedia page revealed a "target" of interest just because they dealt in jet fuel.
One truth about the adversary-defender relationship is that you do not get to determine whether you are a good
target. Even seemingly mundane targets and noncritical infrastructure sites can be valuable targets depending on
the adversary's requirements. In this case, the *** Refinery laid out the exact location of the facility, the amount of
production, and the type of production that takes place at the facility. This may not seem important, but when
combining it with the type of job skills that would be required to support that facility, adversaries can quickly
identify personnel of the facility through LinkedIn or other job and social media websites.

130 © 2021 Robert M. Lee

130

™
Le

Job Descriptions and Skills

* Inthe ICS community, there are many vendors and products for control
systems; thus, there is usually a need to make specific job requirements

* Job descriptions and skill requirements can reveal:
Detailed information about the exact type of systems an ICS uses
Product versions for both hardware and software

Vendor choices and interdependencies

Positions that are currently unfilled or teams that are growing

Team structures and positions with trusted access

Job titles and descriptions as well as an avenue to submit phishing emails or malware
embedded resumes

A a a a a, od

ww

5

ICS515 | ICS Visibility, Detection,and Response 131

Due to the specific nature of ICS networks and the reliance on certain types of vendors or software/hardware, job

4 postings often contain specific needs for the facility. The type of hardware, software, and processes that job
applicants need to be familiar with reveal a lot of information about the assets in use at a specific facility and

& present the adversary with an opportunity to tailor expectations and exploits before ever encountering your

» network,

D

»

SLT wo

© 2021 Robert M. Lee 131
Ey Job description

Role synopsis
The Process Control Engineer's primary responsibility is to ensure the safe and optimal operation of

via the control system on a day to day basis. This includes design, implementation, support
and troubleshooting of DCS control strategies (both regulatory and advanced) and DCS systems.

You will also play a significant role supporting project work on your assigned units sienna ae
is a user of Honeywell TDC3000. Honeywell Experion. and Aspen OMCPlus multivariable technology.

The Process Control Team &
support specialist. In addition various contractor resources are periodically utilized. The group has shared

responsibility for all software (and limited hardware) on the process computing system. This role feports
to the Process Control Superintendent,

ICS515 | ICS Visibility, Detection, and Response 132

In this job posting, the Process Control Engineer job is highlighted. Some interesting nuggets of information
include the role of that job, who he directly reports to, and the type of jobs/groups/roles that exist at the company
(useful for further intelligence gathering or spearphishing attempts). In addition, the job posting contains the type of
systems our **** Refinery uses. A search on LinkedIn for **** Refinery revealed 435+ profiles of past and
present employees who were useful in mapping out a significant portion of their network and systems in use.
Emails of these personnel were also on display in multiple locations and offer an adversary even more information.
For example, the email domain could be used in reconnaissance efforts to find IP addresses of the domain server, to
find people to spearphish, or to reveal information about the company based on where it was registered. In addition,
the people's emails could be already publicly available in any number of the large-scale data breaches and
password dumps that occurred this past year. Searching those databases can reveal usernames and passwords for
those personnel—leaving you and the organization to just hope they had good password reuse management.

132 © 2021 Robert M. Lee

YP ©. D ©

wm WwW

onowmm?e@t © © oo OD OD

am @ @ ® @ @

nm
‘er a . a

Sd — a 7 WS 4 wa 7 Ww Ww Ww Ww Ww wr wy

Ces 4

Advisory (ICSA-12-150-01)
Honeywell HMIWeb Browser Buffer Overflow Vulnerability

Original release date: September 07. 2012 | Last revised: August 29. 2014

ICS-CERT received a report from Honeywell and the Zero Day Initiative (ZD!),a concerning a buffer overflow vulnerability
in all products using the Honeywell HMIWeb browser. This vulnerability was reported to ZDI by an anonymous
researcher.

AFFECTED PRODUCTS
The affected products and versions are:

1. Honeywell Process Solutions:

1. Experion Releases R400.x. R31x, R30x, and R2xx,
Fe eins amie nines

Honeywell Building Solutions:
1. Enterprise Building Manager Releases.

3. R400 and R410.1 and SymmetrE R410.1 release.
Honeywell Environmental Combustion & Controls, and
5. SymmetrE R410.1 release.

IMPACT
vulnerable system.

ICSSI5 | ICS Visibility, Detection,and Response — 133

For example, here is an ICS-CERT Advisory on a vulnerability for Honeywell systems. This one shows the
Experion system that we found in the job posting. This now has given the adversary a significant amount of
information against the **** Refinery (location, personnel, systems in use, vulnerability against systems if they are
the appropriate unpatched version, and so on).

Reference:
https://ics-cert.us-cert.gov/advisories/ICSA-12-150-01

© 2021 Robert M. Lee 133
IP; 148.
Locati

Latitude/ Longitude: ae

Product name: 1747-L553 C7 -DC 2.59
Vendor ID: Ro
Serial number:
Device type: Programmable Lo
Device IP: 172

Automation/Allen-Bradliey

ic Controller

Ref: Shodan

1CS515 | ICS Visibility, Detection, and Response

Tailored searches for ICS assets or information usually takes place on Google or Shodan, such as:
Google: Brazi! Olympics power scada filetype:pdf

Shodan: Rockwell 1747-L553

Shodan and Google searches can be made to be specific including specific types of PLCs,
protocols, messages observed when interacting with a port, etc.
Adversaries perform searches from servers or botnets searching for specific ports, protocols, or assets:

Collected information is usually put into a

information to interact with

database that can later be analyzed to find targets and

The adversaries often use different infrastructure so that the scans appear unrelated

VSAT Provider

This is a system that belonged to a certain VSAT provider for ICS facilities. Compromising this system could lead

to connections and paths into multiple ICS sites. To perform this s

earch in Shodan, a specific type of PLC was

searched for (1747-L553) from a job posting of one of the employees at this specific VSAT company. The fact that
Shodan shows EtherNetIP was in use with this device gives us a high confidence that this is a directly Internet-

connected PLC.

134 © 2021 Robert M. Lee

134

wy

7

o

eo

@

ey
Si! a fo

Ww Hy WwW iw

ww

wvwwuwewuvuvwvewwywwww

AB Allen Bradley SLC Processor 1747-L553 1747L553

Stem
$3,499.00 4 FREE SHIPPING

Note: Not eligible fcr Amazon Prim2,

far ard soks by lopscre

2new from $3,499.80

Countdown to Black Friday Deals in GPS & Navigation
on vehicle GPS, spots & handheld GPS, ond move. Shap nex

‘heck out ear Biad

ICS515 | ICS Visibility, Detection,and Response 35

If an adversary wanted to know more about this controller, any sort of search on the term would reveal
documentation, configuration paperwork, and announcements about what this type of controller controls. If
adversaries wanted to experiment with the controller and see in what way it could be exploited, they could buy one
for themselves off of Amazon.com for ~$4 k or off of eBay for much less. Or, they could search for these PLCs at
other Internet-connected locations where they weren't targeting and learning about them for free through trial and
error.

© 2021 Robert M. Lee 135
How Advanced Does Advanced Need to Be?

+ Advanced adversaries often have a full-time paying job with the task of exploiting
targets
+ Advanced adversaries often want intelligence for preparing future capabilities, but do
not engage in physically damaging attacks for a variety of reasons
+ Research has shown that even terrorists want specific and measured results from an attack before
initiating an attack
+ Adversaries have to be advanced to have a specific result occur at specific ICS sites;
there is little room for error
- Adversaries do NOT have to be that advanced to gain access, perform intelligence
activities, and steal data such as intellectual property
+ Many adversaries, paid or not, have familiarity with the Windows systems and applications in OT

environments 1
« Community support is often available in the form of exploits, user forums, guides, etc.

ICSSI5 | ICS Visibility, Detection, and Response

With all the information that was gathered about the various facilities (with all the same types of information
available on each of them), how advanced would an adversary need to be to infiltrate the organization? Advanced
threats are out there, but the bar is not particularly high, and a lot of information is available to help them. OSINT
is a great resource for the novice and funded teams alike. Now there are even plenty of exploit kits available and
ready for purchase.

136 © 2021 Robert M. Lee

wa @®

nnoen»ee»skenrenmeaenwenenensneeeee 7 WW OW DM WD WH

”
ae

a0’ 40 45’ 19/ at ww yw we Te

49)

The ExCraft SCADA Pack
[Oday] and public exploits for SCADA and

Industrial Control Systems

designed for Core Impact Pro ™

The “ExCraft SCADA Pack” is SCADA and ICS focused exploits package. developed and maintained by
security experts from Cyprus based infosec company ~- ExCraft Labs. The package is specially designed to
be used with Core Impact Pro.

We conduct our own research to find [Odays], plus carefully scan the web for public SCADA vuins.
Additionally, the pack is powered by vulnerabilities sharing programs!

xCraft SCADA Pack features:
* Reach set of ICS exploits and constantly goers
e reatly increase “ADA pentesting capabilities of Core Impact Pro
e Powered by external knowledge received from sharing programs.
.

about 2 . 6 fresh and interesting new modules in each monthly update

ICSS5I5 | ICS Visibility, Detection,and Response 137

The ExCraft SCADA Pack from Core Impact boasts 0-day exploits and publicly available exploits for a variety of
ICS with 2-6 new modules included each month. The bar is most certainly low for many adversaries. Would an
advanced adversary use well-known exploits, though? Well, we have seen they would (Havex), but the answer is
most certainly yes—if you are caught with purchased exploits, maybe you aren't an APT but instead just a well-
funded team. It hurts attribution and aids the adversary.

Reference:
https://www.coresecurity.com/

© 2021 Robert M. Lee 137
Community Support When You Need It

{EE LIVE PLC Questions And x
CR DB wwwolctalknet/q srumdisplay.php?f=2
You are not registered yet. Please click here to register!

Show, Threads 4

Sticky: PLC Update - Back Issues Collection Now Available!
Hi, Many of you are readers of our PLC Update newsletter showing plc tips, information and...

Started by: Phil Melore (February 18th, 2013)

GPS over RS232

[have a two part question regarding reading serial information. I am looking to implement a GPS...
Started by: einnh (November 15th, 2014)

100. Pr mini i
Hello | have been programming in RsLogix 5,500,5000 for about 3 years in an electrical and...

Started by: Mark Cole (November 15th, 2014)

ICS515 | ICS Visibility, Detection, and Response

When adversarics are confused about what systems do what, what protocols interact with what systems, or general
configuration questions, it is possible to just ask the helpful ICS community. This is not meant to discourage
working together on forums—but be aware of the answer you give publicly and what it might be used for. For
example, I've seen on numerous occasions sock puppets (fake accounts as a front for someone wanting to remain
anonymous) post specific questions about systems they had no business interacting with—and those questions
almost always received accurate answers. I did see on one occasion, though, that someone noticed the activity was
odd and referred the person to a vendor to talk to directly instead of giving him support. | was tempted to post the
image to give kudos to the individual but out of respect for his privacy, I will just say—well done.

Reference:
http://www. plctalk.net/qanda/forumdisplay.php?f=2

138 © 2021 Robert M. Lee

138

® @®

on onananeaenmnhes@& ® ® ® B® ® wD Hw Hh wh

hed
~»

ay

ww

aw

Put It All Together

* If we would have done all the above on any one of those targets

(which was tested but not displayed), the attacker would have had...

° Enhanced information:
¢ ICS name, physical location, historical information, purpose, etc.
* OT production volumes/output, future goals, and project names

¢ Attack vectors:
* Corporate website IP addresses to search for vulnerabilities
* Third-party contractor network information as a pivot point
* Emails and key personnel to spearphish
* ICS assets connected directly to the Internet

¢ Pre/Post access:
* Publicly available exploits for vulnerable OT assets
* Physical and logical network diagrams to maneuver through the network

ICSSIS | ICS Visibility, Detection, and Response

With all the information we gathered, an adversary could have found a target to meet his requirements, learned all
about it and its goals/production/projects, discovered various attack vectors through the corporate website, third-
party contractors, emails of personnel, and Internet-connected assets. For either pre- or post-exploitation, the
adversary could have also made use of publicly available exploits and physical and logical network diagrams. So,
I'll ask again - how advanced does advanced need to be? Sometimes this information is unavoidable. There is no
reason to beat anyone up over it. But be aware of what is out there and where informed adversaries might attack
based on information available. How might that guide their strategy? How should that guide yours?

© 2021 Robert M. Lee 139
Lab |.4
Maltego and Shodan ICS Heatmap

1CS515 | ICS Visibility, Detection, and Response 140

This page intentionally left blank.

140 © 2021 Robert M. Lee

A

oD

oo fe em a em @ @ OO OO fw wm ow wo ow oe wh
